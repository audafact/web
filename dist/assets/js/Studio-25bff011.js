import{j as e,p as t}from"./audio-0ea8d21d.js";import{r as a,b as r}from"./vendor-b17dff21.js";import{s,u as n,a as o,b as i,c,t as d,L as l,D as u,d as m,e as f,f as p,g as h,S as x}from"./index-a73b4fa8.js";import{b as g,A as b,P as v,c as y,d as w,S as j}from"./ui-e2671ff1.js";import"./auth-86c3050d.js";class k{static FREE_LIMITS={maxUploads:3,maxSessions:2,maxRecordings:1,maxLibraryTracks:10,canDownload:!1};static PRO_LIMITS={maxUploads:1/0,maxSessions:1/0,maxRecordings:1/0,maxLibraryTracks:1/0,canDownload:!0};static getLimitsForTier(e){return"pro"===e?this.PRO_LIMITS:this.FREE_LIMITS}static async getUserAccessStatus(e,t){try{const[a,r,n]=await Promise.all([s.from("uploads").select("id",{count:"exact"}).eq("user_id",e),s.from("sessions").select("id",{count:"exact"}).eq("user_id",e),s.from("recordings").select("id",{count:"exact"}).eq("user_id",e)]),o=a.count||0,i=r.count||0,c=n.count||0,d=await this.getUserLibraryTrackCount(e),l=this.getLimitsForTier(t);return{currentUploads:o,currentSessions:i,currentRecordings:c,currentLibraryTracks:d,limits:l,canUpload:o<l.maxUploads,canSaveSession:i<l.maxSessions,canRecord:c<l.maxRecordings,canAddLibraryTrack:d<l.maxLibraryTracks}}catch(a){return{currentUploads:0,currentSessions:0,currentRecordings:0,currentLibraryTracks:0,limits:this.FREE_LIMITS,canUpload:!1,canSaveSession:!1,canRecord:!1,canAddLibraryTrack:!1}}}static getLibraryTracksToShow(e,t){const a=this.getLimitsForTier(e);return"pro"===e?t:Math.min(a.maxLibraryTracks,t)}static async canPerformAction(e,t,a){const r=this.getLimitsForTier(t);switch(a){case"add_library_track":return"guest"!==t;case"download":return r.canDownload;case"upload":return((await s.from("uploads").select("id",{count:"exact"}).eq("user_id",e)).count||0)<r.maxUploads;case"save_session":return((await s.from("sessions").select("id",{count:"exact"}).eq("user_id",e)).count||0)<r.maxSessions;case"record":return((await s.from("recordings").select("id",{count:"exact"}).eq("user_id",e)).count||0)<r.maxRecordings;default:return!1}}static getUpgradeMessage(e){const t="Upgrade to Pro Creator to unlock this feature.";switch(e){case"upload":return"You've reached your upload limit (3 tracks). "+t;case"save_session":return"You've reached your session limit (2 sessions). "+t;case"record":return"You've reached your recording limit (1 recording). "+t;case"add_library_track":return"Sign up to add tracks from the library to your studio. "+t;case"download":return"Download your recordings with Pro Creator. "+t;default:return t}}static async getUserLibraryTrackCount(e){return 0}static async addLibraryTrackToUser(e,t){return!0}static async removeLibraryTrackFromUser(e,t){return!0}static async getUserLibraryTracks(e){return[]}static async getRotationInfo(){try{const{data:e,error:t}=await s.rpc("get_rotation_info");return t?null:e?.[0]||null}catch(e){return null}}}class N extends k{static canAccessFeature(e,t){return{upload:t.features.canUpload,save_session:t.features.canSaveSession,record:t.features.canRecord,download:t.features.canDownload,edit_cues:t.features.canEditCues,edit_loops:t.features.canEditLoops,browse_library:t.features.canBrowseLibrary,access_pro_tracks:t.features.canAccessProTracks}[e]||!1}static getFeatureGateConfig(e,t){return{upload:{gateType:"modal",message:"🎧 Ready to remix your own sounds?",ctaText:"Sign up to upload tracks",upgradeRequired:!1},save_session:{gateType:"modal",message:"💾 Don't lose your work",ctaText:"Sign up to save session",upgradeRequired:!1},record:{gateType:"modal",message:"free"===t?.id?"🎙 You've used your free recording. Upgrade for unlimited recordings!":"🎙 Record and export your performances",ctaText:"Upgrade to Pro Creator",upgradeRequired:!0},download:{gateType:"modal",message:"💿 Download your recordings",ctaText:"Upgrade to Pro Creator",upgradeRequired:!0},edit_cues:{gateType:"tooltip",message:"Sign up to customize cue points",ctaText:"Sign up now",upgradeRequired:!1},edit_loops:{gateType:"tooltip",message:"Sign up to set custom loops",ctaText:"Sign up now",upgradeRequired:!1}}[e]||{gateType:"modal",message:"Upgrade to unlock this feature",ctaText:"Upgrade now",upgradeRequired:!0}}static async checkUsageLimits(e,t,a){if("pro"===t.id)return!0;const r=t.limits;switch(a){case"upload":return await this.getUserUploadCount(e)<r.maxUploads;case"save_session":return await this.getUserSessionCount(e)<r.maxSessions;case"record":return await this.getUserRecordingCount(e)<r.maxRecordings;default:return!0}}static async getUserUploadCount(e){const{count:t}=await s.from("uploads").select("id",{count:"exact"}).eq("user_id",e);return t||0}static async getUserSessionCount(e){const{count:t}=await s.from("sessions").select("id",{count:"exact"}).eq("user_id",e);return t||0}static async getUserRecordingCount(e){const{count:t}=await s.from("recordings").select("id",{count:"exact"}).eq("user_id",e);return t||0}}const S=()=>{const{user:e}=n(),{tier:t}=o(),[r,s]=a.useState(null),[i,c]=a.useState(!0),d=async()=>{if(e?.id){c(!0);try{const a=await k.getUserAccessStatus(e.id,t.id);s(a)}catch(a){}finally{c(!1)}}};a.useEffect(()=>{d()},[e?.id,t.id]),a.useEffect(()=>{const e=()=>{d()};return window.addEventListener("recordingSaved",e),()=>{window.removeEventListener("recordingSaved",e)}},[d]);const l=e=>N.canAccessFeature(e,t);return{accessStatus:r,loading:i,refreshAccessStatus:d,canAccessFeature:l,canPerformAction:async a=>{if(!e?.id)return!1;if("add_library_track"===a)return"guest"!==t.id;return!!l(a)&&N.checkUsageLimits(e.id,t,a)},getUpgradeMessage:e=>N.getFeatureGateConfig(e).message,tier:t}},C="audafact_onboarding_state",T=({message:t,feature:a,onClose:s,variant:n="modal"})=>{const o=r(),i=()=>{o("/pricing"),s?.()};return"banner"===n?e.jsx("div",{className:"bg-gradient-to-r from-audafact-accent-cyan to-audafact-accent-blue p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(g,{className:"h-5 w-5 text-audafact-text-primary"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-audafact-text-primary",children:[a," requires Pro Creator"]}),e.jsx("p",{className:"text-xs text-audafact-text-primary opacity-90",children:t})]})]}),e.jsxs("button",{onClick:i,className:"bg-audafact-text-primary text-audafact-accent-cyan px-4 py-2 rounded-lg text-sm font-medium hover:bg-opacity-90 transition-colors flex items-center space-x-2",children:[e.jsx("span",{children:"Upgrade"}),e.jsx(b,{className:"h-4 w-4"})]})]})}):"inline"===n?e.jsxs("div",{className:"audafact-card p-6 text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gradient-to-br from-audafact-accent-cyan to-audafact-accent-blue p-3 rounded-full",children:e.jsx(g,{className:"h-6 w-6 text-audafact-text-primary"})})}),e.jsxs("h3",{className:"text-lg font-semibold audafact-heading mb-2",children:[a," - Pro Feature"]}),e.jsx("p",{className:"audafact-text-secondary mb-4",children:t}),e.jsx("button",{onClick:i,className:"audafact-button-primary",children:"Upgrade to Pro Creator"})]}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"audafact-card-enhanced p-6 max-w-md w-full",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gradient-to-br from-audafact-accent-cyan to-audafact-accent-blue p-3 rounded-full",children:e.jsx(g,{className:"h-8 w-8 text-audafact-text-primary"})})}),e.jsx("h2",{className:"text-xl font-bold audafact-heading text-center mb-2",children:"Upgrade Required"}),e.jsx("h3",{className:"text-lg font-semibold audafact-text-secondary text-center mb-4",children:a}),e.jsx("p",{className:"audafact-text-secondary text-center mb-6",children:t}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:s,className:"audafact-button-secondary flex-1",children:"Maybe Later"}),e.jsx("button",{onClick:i,className:"audafact-button-primary flex-1",children:"Upgrade Now"})]})]})})};class L{constructor(){this.listeners={}}on(e,t,a){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),null==a?void 0:a.once){const a=()=>{this.un(e,a),this.un(e,t)};return this.on(e,a),a}return()=>this.un(e,t)}un(e,t){var a;null===(a=this.listeners[e])||void 0===a||a.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(e=>e(...t))}}class E extends L{constructor(e){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=e}onInit(){}_init(e){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}function M(e,t,a,r,s=3,n=0,o=100){if(!e)return()=>{};const i=matchMedia("(pointer: coarse)").matches;let c=()=>{};const d=d=>{if(d.button!==n)return;d.preventDefault(),d.stopPropagation();let l=d.clientX,u=d.clientY,m=!1;const f=Date.now(),p=r=>{if(r.preventDefault(),r.stopPropagation(),i&&Date.now()-f<o)return;const n=r.clientX,c=r.clientY,d=n-l,p=c-u;if(m||Math.abs(d)>s||Math.abs(p)>s){const r=e.getBoundingClientRect(),{left:s,top:o}=r;m||(null==a||a(l-s,u-o),m=!0),t(d,p,n-s,c-o),l=n,u=c}},h=t=>{if(m){const a=t.clientX,s=t.clientY,n=e.getBoundingClientRect(),{left:o,top:i}=n;null==r||r(a-o,s-i)}c()},x=e=>{e.relatedTarget&&e.relatedTarget!==document.documentElement||h(e)},g=e=>{m&&(e.stopPropagation(),e.preventDefault())},b=e=>{m&&e.preventDefault()};document.addEventListener("pointermove",p),document.addEventListener("pointerup",h),document.addEventListener("pointerout",x),document.addEventListener("pointercancel",x),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("click",g,{capture:!0}),c=()=>{document.removeEventListener("pointermove",p),document.removeEventListener("pointerup",h),document.removeEventListener("pointerout",x),document.removeEventListener("pointercancel",x),document.removeEventListener("touchmove",b),setTimeout(()=>{document.removeEventListener("click",g,{capture:!0})},10)}};return e.addEventListener("pointerdown",d),()=>{c(),e.removeEventListener("pointerdown",d)}}function P(e,t){const a=t.xmlns?document.createElementNS(t.xmlns,e):document.createElement(e);for(const[r,s]of Object.entries(t))if("children"===r&&s)for(const[e,t]of Object.entries(s))t instanceof Node?a.appendChild(t):"string"==typeof t?a.appendChild(document.createTextNode(t)):a.appendChild(P(e,t));else"style"===r?Object.assign(a.style,s):"textContent"===r?a.textContent=s:a.setAttribute(r,s.toString());return a}function R(e,t,a){const r=P(e,t||{});return null==a||a.appendChild(r),r}class D extends L{constructor(e,t,a=0){var r,s,n,o,i,c,d,l,u,m;super(),this.totalDuration=t,this.numberOfChannels=a,this.element=null,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.isRemoved=!1,this.subscriptions=[],this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(e.start),this.end=this.clampPosition(null!==(r=e.end)&&void 0!==r?r:e.start),this.drag=null===(s=e.drag)||void 0===s||s,this.resize=null===(n=e.resize)||void 0===n||n,this.resizeStart=null===(o=e.resizeStart)||void 0===o||o,this.resizeEnd=null===(i=e.resizeEnd)||void 0===i||i,this.color=null!==(c=e.color)&&void 0!==c?c:"rgba(0, 0, 0, 0.1)",this.minLength=null!==(d=e.minLength)&&void 0!==d?d:this.minLength,this.maxLength=null!==(l=e.maxLength)&&void 0!==l?l:this.maxLength,this.channelIdx=null!==(u=e.channelIdx)&&void 0!==u?u:-1,this.contentEditable=null!==(m=e.contentEditable)&&void 0!==m?m:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){var e;const t=this.start===this.end;null===(e=this.element)||void 0===e||e.setAttribute("part",`${t?"marker":"region"} ${this.id}`)}addResizeHandles(e){const t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},a=R("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},t),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},e),r=R("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},t),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},e);this.subscriptions.push(M(a,e=>this.onResize(e,"start"),()=>null,()=>this.onEndResizing(),1),M(r,e=>this.onResize(e,"end"),()=>null,()=>this.onEndResizing(),1))}removeResizeHandles(e){const t=e.querySelector('[part*="region-handle-left"]'),a=e.querySelector('[part*="region-handle-right"]');t&&e.removeChild(t),a&&e.removeChild(a)}initElement(){if(this.isRemoved)return null;const e=this.start===this.end;let t=0,a=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(a=100/this.numberOfChannels,t=a*this.channelIdx);const r=R("div",{style:{position:"absolute",top:`${t}%`,height:`${a}%`,backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(r),r}renderPosition(){if(!this.element)return;const e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*t+"%"}toggleCursor(e){var t;this.drag&&(null===(t=this.element)||void 0===t?void 0:t.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){const{element:e}=this;e&&(e.addEventListener("click",e=>this.emit("click",e)),e.addEventListener("mouseenter",e=>this.emit("over",e)),e.addEventListener("mouseleave",e=>this.emit("leave",e)),e.addEventListener("dblclick",e=>this.emit("dblclick",e)),e.addEventListener("pointerdown",()=>this.toggleCursor(!0)),e.addEventListener("pointerup",()=>this.toggleCursor(!1)),this.subscriptions.push(M(e,e=>this.onMove(e),()=>this.toggleCursor(!0),()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")})),this.contentEditable&&this.content&&(this.content.addEventListener("click",e=>this.onContentClick(e)),this.content.addEventListener("blur",()=>this.onContentBlur())))}_onUpdate(e,t){var a;if(!(null===(a=this.element)||void 0===a?void 0:a.parentElement))return;const{width:r}=this.element.parentElement.getBoundingClientRect(),s=e/r*this.totalDuration,n=t&&"start"!==t?this.start:this.start+s,o=t&&"end"!==t?this.end:this.end+s,i=o-n;n>=0&&o<=this.totalDuration&&n<=o&&i>=this.minLength&&i<=this.maxLength&&(this.start=n,this.end=o,this.renderPosition(),this.emit("update",t))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&(this.resizeStart||"start"!==t)&&(this.resizeEnd||"end"!==t)&&this._onUpdate(e,t)}onEndResizing(){this.resize&&this.emit("update-end")}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(e){this.emit("play",e&&this.end!==this.start?this.end:void 0)}getContent(e=!1){var t;return e?this.content||void 0:this.element instanceof HTMLElement?(null===(t=this.content)||void 0===t?void 0:t.innerHTML)||void 0:""}setContent(e){var t;if(this.element)if(null===(t=this.content)||void 0===t||t.remove(),e){if("string"==typeof e){const t=this.start===this.end;this.content=R("div",{style:{padding:`0.2em ${t?.2:.4}em`,display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true"),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content),this.emit("content-changed")}else this.content=void 0}setOptions(e){var t,a;if(this.element){if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),void 0!==e.drag&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),void 0!==e.start||void 0!==e.end){const r=this.start===this.end;this.start=this.clampPosition(null!==(t=e.start)&&void 0!==t?t:this.start),this.end=this.clampPosition(null!==(a=e.end)&&void 0!==a?a:r?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),void 0!==e.resize&&e.resize!==this.resize){const t=this.start===this.end;this.resize=e.resize,this.resize&&!t?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}void 0!==e.resizeStart&&(this.resizeStart=e.resizeStart),void 0!==e.resizeEnd&&(this.resizeEnd=e.resizeEnd)}}remove(){this.isRemoved=!0,this.emit("remove"),this.subscriptions.forEach(e=>e()),this.element&&(this.element.remove(),this.element=null)}}class z extends E{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new z(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",t=>{const a=this.regions.filter(e=>e.start<=t&&(e.end===e.start?e.start+.05:e.end)>=t);a.forEach(t=>{e.includes(t)||this.emit("region-in",t)}),e.forEach(e=>{a.includes(e)||this.emit("region-out",e)}),e=a}))}initRegionsContainer(){return R("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){e.content&&setTimeout(()=>{const t=e.content,a=t.getBoundingClientRect(),r=this.regions.map(t=>{if(t===e||!t.content)return 0;const r=t.content.getBoundingClientRect();return a.left<r.left+r.width&&r.left<a.left+a.width?r.height:0}).reduce((e,t)=>e+t,0);t.style.marginTop=`${r}px`},10)}adjustScroll(e){var t,a;if(!e.element)return;const r=null===(a=null===(t=this.wavesurfer)||void 0===t?void 0:t.getWrapper())||void 0===a?void 0:a.parentElement;if(!r)return;const{clientWidth:s,scrollWidth:n}=r;if(n<=s)return;const o=r.getBoundingClientRect(),i=e.element.getBoundingClientRect(),c=i.left-o.left,d=i.right-o.left;c<0?r.scrollLeft+=c:d>s&&(r.scrollLeft+=d-s)}virtualAppend(e,t,a){const r=()=>{if(!this.wavesurfer)return;const r=this.wavesurfer.getWidth(),s=this.wavesurfer.getScroll(),n=t.clientWidth,o=this.wavesurfer.getDuration(),i=Math.round(e.start/o*n),c=i+(Math.round((e.end-e.start)/o*n)||1)>s&&i<s+r;c&&!a.parentElement?t.appendChild(a):!c&&a.parentElement&&a.remove()};setTimeout(()=>{if(!this.wavesurfer)return;r();const t=this.wavesurfer.on("scroll",r);this.subscriptions.push(e.once("remove",t),t)},0)}saveRegion(e){if(!e.element)return;this.virtualAppend(e,this.regionsContainer,e.element),this.avoidOverlapping(e),this.regions.push(e);const t=[e.on("update",t=>{t||this.adjustScroll(e),this.emit("region-update",e,t)}),e.on("update-end",()=>{this.avoidOverlapping(e),this.emit("region-updated",e)}),e.on("play",t=>{var a;null===(a=this.wavesurfer)||void 0===a||a.play(e.start,t)}),e.on("click",t=>{this.emit("region-clicked",e,t)}),e.on("dblclick",t=>{this.emit("region-double-clicked",e,t)}),e.on("content-changed",()=>{this.emit("region-content-changed",e)}),e.once("remove",()=>{t.forEach(e=>e()),this.regions=this.regions.filter(t=>t!==e),this.emit("region-removed",e)})];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,a;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const r=this.wavesurfer.getDuration(),s=null===(a=null===(t=this.wavesurfer)||void 0===t?void 0:t.getDecodedData())||void 0===a?void 0:a.numberOfChannels,n=new D(e,r,s);return this.emit("region-initialized",n),r?this.saveRegion(n):this.subscriptions.push(this.wavesurfer.once("ready",e=>{n._setTotalDuration(e),this.saveRegion(n)})),n}enableDragSelection(e,t=3){var a;const r=null===(a=this.wavesurfer)||void 0===a?void 0:a.getWrapper();if(!(r&&r instanceof HTMLElement))return()=>{};let s=null,n=0;return M(r,(e,t,a)=>{s&&s._onUpdate(e,a>n?"end":"start")},t=>{var a,r;if(n=t,!this.wavesurfer)return;const o=this.wavesurfer.getDuration(),i=null===(r=null===(a=this.wavesurfer)||void 0===a?void 0:a.getDecodedData())||void 0===r?void 0:r.numberOfChannels,{width:c}=this.wavesurfer.getWrapper().getBoundingClientRect(),d=t/c*o,l=(t+5)/c*o;s=new D(Object.assign(Object.assign({},e),{start:d,end:l}),o,i),this.emit("region-initialized",s),s.element&&this.regionsContainer.appendChild(s.element)},()=>{s&&(this.saveRegion(s),s=null)},t)}clearRegions(){this.regions.slice().forEach(e=>e.remove()),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}const A=({duration:t,tempo:r,zoomLevel:s,onFirstMeasureChange:n,timeSignature:o,firstMeasureTime:i,visible:c=!0,containerRef:d})=>{const[l,u]=a.useState(!1),[m,f]=a.useState(0),[p,h]=a.useState(0),x=a.useRef(null),g=d||x,b=a.useCallback(()=>{const e=60/r,t=4/o.denominator;return o.numerator*e*t},[r,o]),v=a.useCallback(()=>{const e=b(),a=[];let r=i,s=1;for(;r<=t;)a.push({time:r,number:s}),r+=e,s++;return a},[t,i,b]),y=a.useCallback(e=>e*(40*s),[s]),w=a.useCallback(e=>e/(40*s),[s]),j=a.useCallback(e=>{e.preventDefault(),u(!0),f(e.clientX),h(i)},[i]),k=a.useCallback(e=>{if(!l||!g.current)return;const a=e.clientX-m,r=w(a),s=Math.max(0,Math.min(t,p+r));n(s)},[l,m,p,w,t,n]),N=a.useCallback(()=>{u(!1)},[]);a.useEffect(()=>{if(l)return document.addEventListener("mousemove",k),document.addEventListener("mouseup",N),()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",N)}},[l,k,N]);const S=v();return c?e.jsxs("div",{ref:x,className:"absolute pointer-events-auto",style:{height:"120px",top:0,left:0,right:0},children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-yellow-500 pointer-events-auto cursor-ew-resize z-20",style:{left:`${y(i)}px`,transform:"translateX(-50%)"},onMouseDown:j,title:`First measure at ${i.toFixed(2)}s`,children:e.jsx("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 bg-yellow-500 text-yellow-900 text-xs px-1 py-0.5 rounded whitespace-nowrap",children:"Measure 1"})}),S.map((t,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-yellow-400 opacity-80",style:{left:`${y(t.time)}px`,transform:"translateX(-50%)"}}),t.number%4==1&&e.jsx("div",{className:"absolute top-1 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-yellow-900 text-xs px-1 py-0.5 rounded whitespace-nowrap font-medium",style:{left:`${y(t.time)}px`,transform:"translateX(-50%)"},children:t.number})]},a))]}):null},F=({duration:t,tempo:r,zoomLevel:s,timeSignature:n,firstMeasureTime:o,visible:i=!0,showMeasures:c=!1})=>{const d=a.useRef(null),l=a.useCallback(()=>60/r*(4/n.denominator),[r,n]),u=a.useCallback(()=>{const e=60/r,t=4/n.denominator;return n.numerator*e*t},[r,n]),m=a.useCallback(()=>{const e=l(),a=u(),r=[];let s=o,i=1,c=1;for(;s<=t;){for(let a=0;a<n.numerator;a++){const n=s+a*e;n<=t&&(r.push({time:n,beatNumber:i,measureNumber:c,isMeasureStart:0===a}),i++)}s+=a,c++}return r},[t,o,l,u,n]),f=a.useCallback(()=>{const e=u(),a=[];let r=o,s=1;for(;r<=t;)a.push({time:r,number:s}),r+=e,s++;return a},[t,o,u]),p=a.useCallback(e=>e*(40*s),[s]),h=m(),x=f();return i?e.jsx("div",{ref:d,className:"absolute pointer-events-none",style:{height:"120px",top:0,left:0,right:0},children:c?x.map((t,a)=>e.jsx("div",{children:e.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-white opacity-40",style:{left:`${p(t.time)}px`,transform:"translateX(-50%)"}})},`measure-${a}`)):h.map((t,a)=>e.jsx("div",{children:e.jsx("div",{className:"absolute top-0 bottom-0 w-px "+(t.isMeasureStart?"bg-white opacity-60":"bg-white opacity-30"),style:{left:`${p(t.time)}px`,transform:"translateX(-50%)"}})},`beat-${a}`))}):null},B=({audioFile:r,mode:s,playhead:n,loopStart:o,loopEnd:c,cuePoints:d,onLoopPointsChange:l,onCuePointChange:u,playbackTime:m=0,zoomLevel:f,onZoomIn:p,onZoomOut:h,onResetZoom:x,trackId:g,showMeasures:b=!1,tempo:v=120,timeSignature:y={numerator:4,denominator:4},firstMeasureTime:w=0,onFirstMeasureChange:j,showCueThumbs:k=!1,isPlaying:N=!1,onPlayheadChange:S,onScrollStateChange:C,isDemoMode:T=!1})=>{const L=a.useRef(null),M=a.useRef(null),[P,R]=a.useState(void 0),[D,B]=a.useState([]),[_,I]=a.useState(!1),[U,O]=a.useState(!1),[$,W]=a.useState(!1),q=a.useRef(null),H=a.useRef(null),V=a.useRef([]),Y=a.useRef(0),X=a.useRef(!1),Z=a.useRef(null),G=a.useRef(o),K=a.useRef(c),J=a.useRef(d),Q=a.useRef(s),ee=a.useRef(l),te=a.useRef(u);a.useEffect(()=>{ee.current=l},[l]),a.useEffect(()=>{te.current=u},[u]);const ae=a.useCallback((e,t=100)=>{Z.current&&clearTimeout(Z.current),Z.current=setTimeout(e,t)},[]);a.useEffect(()=>()=>{Z.current&&clearTimeout(Z.current)},[]),a.useEffect(()=>{const e=URL.createObjectURL(r);return R(e),()=>{URL.revokeObjectURL(e)}},[r]),a.useEffect(()=>{const e=z.create();return H.current=e,B([e]),X.current=!1,()=>{H.current=null,V.current=[],B([])}},[P]);const{wavesurfer:re,isReady:se,currentTime:ne}=t({container:L,url:P,waveColor:"#008CFF",progressColor:"#00F5C3",cursorColor:"#00F5C3",height:120,normalize:!0,autoplay:!1,plugins:D});a.useEffect(()=>{if(!re)return;const e=()=>{O(!0)},t=()=>{O(!1)},a=()=>{O(!1)};return re.on("play",e),re.on("pause",t),re.on("finish",a),()=>{re.un("play",e),re.un("pause",t),re.un("finish",a)}},[re]),a.useEffect(()=>{if(!re||!S)return;const e=()=>{const e=re.getCurrentTime();S(e)};return re.on("interaction",e),()=>{re.un("interaction",e)}},[re,S]);const oe=a.useCallback(()=>{if(!re||!se||!L.current)return 40*f;const e=re.getDuration();if(f<=1){const t=L.current.parentElement;if(t){return t.clientWidth/e}}return 40*f},[re,se,f]);a.useEffect(()=>{if(re&&se){const e=re.getDuration(),t=oe();setTimeout(()=>{if(L.current){const a=e*t;L.current.style.width=`${a}px`}},50)}},[re,se,f,oe]),a.useEffect(()=>{if(!re||!se||!L.current)return;const e=L.current.parentElement;if(!e)return;if(!N)return;const t=oe(),a=(ne??0)*t,r=e.clientWidth,s=r/2,n=a-s;if(a>=s){const a=re.getDuration()*t,s=Math.max(0,a-r),o=Math.max(0,Math.min(n,s));e.scrollTo({left:o,behavior:"auto"})}},[ne,re,se,f,N]);const ie=a.useCallback((e=f)=>{if(!re||!se||!L.current)return;const t=re.getCurrentTime(),a=oe(),r=t*a,s=L.current.parentElement;if(!s)return;const n=s.clientWidth,o=re.getDuration()*a,i=r-n/2,c=Math.max(0,o-n),d=Math.max(0,Math.min(i,c));s.scrollTo({left:d,behavior:"smooth"})},[re,se,f]),ce=a.useCallback(async()=>{if(H.current&&V.current.length>0&&(V.current.forEach(e=>{try{e.thumbElement&&(e.thumbElement.remove(),e.thumbElement=null),e.unAll(),e.remove()}catch(E){}}),V.current=[]),H.current)try{const e=H.current.getRegions();try{H.current.clearRegions()}catch(E){Object.values(e).forEach(e=>{try{e.thumbElement&&(e.thumbElement.remove(),e.thumbElement=null),e.unAll(),e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element),e.remove()}catch(t){}})}await new Promise(e=>setTimeout(e,10))}catch(E){}if(L.current){const e=g||"default";L.current.querySelectorAll(`.cue-thumb-${e}`).forEach(e=>e.remove())}return new Promise(e=>setTimeout(e,5))},[g,N]),de=a.useCallback(async()=>{if(re&&se&&H.current)if(await ce(),"loop"===s){const e=H.current.addRegion({start:o,end:c,color:"rgba(0, 245, 195, 0.2)",drag:!0,resize:!0,id:`loop-region-${g||"default"}`,handleStyle:{left:{backgroundColor:"rgba(0, 245, 195, 0.8)",border:"2px solid #00F5C3",borderRadius:"2px"},right:{backgroundColor:"rgba(0, 245, 195, 0.8)",border:"2px solid #00F5C3",borderRadius:"2px"}}});e.on("update-end",()=>{const t=Math.max(0,e.start),a=Math.max(t+.1,e.end);ae(()=>{ee.current(t,a),G.current=t,K.current=a})}),V.current=[e]}else if("cue"===s){const e=re.getDuration(),t=.05,a=d.map((a,r)=>{const s=Math.max(0,Math.min(a,e-t)),n=Math.min(s+.01,e),o=H.current.addRegion({start:s,end:n,color:"rgba(255, 77, 79, 0.3)",drag:!T,resize:!1,id:`cue-${g||"default"}-${r}`,handleStyle:{left:{backgroundColor:"rgba(255, 77, 79, 0.8)",border:"2px solid #FF4D4F",borderRadius:"2px"},right:{backgroundColor:"rgba(255, 77, 79, 0.8)",border:"2px solid #FF4D4F",borderRadius:"2px"}}});return o.on("update-end",()=>{const e=o.start+(o.end-o.start)/2,t=Math.max(0,Math.min(re.getDuration(),e));ae(()=>{te.current(r,t);const e=[...J.current];e[r]=t,J.current=e})}),k&&setTimeout(()=>{le(o,r)},100),T&&(o.on("mousedown",e=>{e.preventDefault(),e.stopPropagation(),i("custom_cue_points")}),o.on("touchstart",e=>{e.preventDefault(),e.stopPropagation(),i("custom_cue_points")}),o.on("click",e=>{e.preventDefault(),e.stopPropagation(),i("custom_cue_points")})),o});V.current=a}},[re,se,s,o,c,d.length,g,k,T]),le=a.useCallback((e,t)=>{const a=e.element;if(!a)return;e.thumbElement&&(e.thumbElement.remove(),e.thumbElement=null);const r=g||"default";a.querySelectorAll(`.cue-thumb-${r}`).forEach(e=>e.remove());const s=document.createElement("div"),n=T?"pointer":"grab";s.style.cssText=`\n      position: absolute;\n      bottom: -4px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 40px;\n      height: 40px;\n      cursor: ${n};\n      z-index: 31;\n      pointer-events: auto;\n      background: transparent;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `;const o=document.createElement("div");if(o.className=`cue-thumb cue-thumb-${g||"default"}`,o.style.cssText="\n      width: 24px;\n      height: 24px;\n      background-color: #FF4D4F;\n      border: 2px solid #FF4D4F;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      font-size: 12px;\n      font-weight: bold;\n      pointer-events: none;\n      position: relative;\n    ",o.textContent=9===t?"0":(t+1).toString(),T){const e=document.createElement("div");e.style.cssText="\n        position: absolute;\n        bottom: -3px;\n        right: -3px;\n        width: 16px;\n        height: 16px;\n        background-color: transparent;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 12px;\n        color: #FFD700;\n        font-weight: bold;\n        z-index: 32;\n        pointer-events: none;\n        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));\n      ",e.innerHTML="🔒",o.appendChild(e)}s.appendChild(o),a.appendChild(s),T&&(s.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation(),i("custom_cue_points")}),s.addEventListener("touchstart",e=>{e.preventDefault(),e.stopPropagation(),i("custom_cue_points")}),s.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),i("custom_cue_points")})),e.thumbElement=s},[g,T]),ue=a.useCallback(()=>{if(V.current.forEach(e=>{e.thumbElement&&(e.thumbElement.remove(),e.thumbElement=null)}),L.current){const e=g||"default";L.current.querySelectorAll(`.cue-thumb-${e}`).forEach(e=>e.remove())}},[]);a.useEffect(()=>{re&&se&&X.current&&("cue"===s&&k?(ue(),setTimeout(()=>{V.current.forEach((e,t)=>{le(e,t)})},200)):ue())},[k,s,re,se,le,ue]),a.useEffect(()=>{(async()=>{if(!re||!se||!X.current)return;Q.current!==s&&(await ce(),await de(),Q.current=s)})()},[s,re,se,de,ce]),a.useEffect(()=>{(async()=>{if(!re||!se||!X.current)return;if(Q.current!==s)return;const e="loop"===s&&(G.current!==o||K.current!==c),t="cue"===s&&(J.current.length!==d.length||J.current.some((e,t)=>e!==d[t]));(e||t)&&(await ce(),await de(),G.current=o,K.current=c,J.current=[...d])})()},[re,se,s,o,c,d,de,ce]),a.useEffect(()=>{(async()=>{if(re&&se&&!X.current){const e=oe();re.setOptions({minPxPerSec:e}),await de();const t=ne||m||0;setTimeout(()=>{re&&se&&re.setTime(t)},100),X.current=!0,G.current=o,K.current=c,J.current=[...d],Q.current=s}})()},[re,se,f,ne,m,o,c,d,s,de,oe]),a.useEffect(()=>{if(re&&se&&X.current){const e=oe();if(re.setOptions({minPxPerSec:e}),L.current){const t=re.getDuration()*e;L.current.style.width=`${t}px`}setTimeout(()=>ie(f),10)}},[f,re,se,ie,oe]),a.useEffect(()=>{if(f>1||!re||!se||!X.current)return;const e=()=>{if(!L.current||!M.current)return;const e=L.current.parentElement;if(e){const t=re.getDuration(),a=e.clientWidth/t;re.setOptions({minPxPerSec:a});const r=t*a;L.current.style.width=`${r}px`;const s=M.current.parentElement?.parentElement;s&&(M.current.style.width="100%")}};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[f,re,se]),a.useEffect(()=>{if(M.current&&re&&se)if(f<=1){const e=M.current.parentElement?.parentElement;e&&(M.current.style.width="100%")}else M.current.style.width="auto"},[f,re,se]),a.useEffect(()=>{if(!M.current||!C)return;const e=()=>{W(!0),C(!0),q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{W(!1),C(!1)},150)},t=M.current;return t.addEventListener("scroll",e,{passive:!0}),()=>{t.removeEventListener("scroll",e),q.current&&clearTimeout(q.current)}},[C]),a.useEffect(()=>{if(!re||!se)return;const e=performance.now();e-Y.current<33||(re.setTime(m),Y.current=e)},[m,re,se]),a.useEffect(()=>{re&&se&&"number"==typeof n&&re.setTime(n)},[n,re,se]),a.useEffect(()=>{re&&se&&X.current&&I(b||!1)},[b,re,se]);const me=a.useCallback(()=>{const e=60/v*(4/y.denominator)*(40*f);return Math.max(10,Math.round(e))},[v,y,f])();return e.jsxs("div",{className:"w-full box-border overflow-hidden relative",children:[e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-1 bg-audafact-surface-2 bg-opacity-80 border border-audafact-divider rounded-md shadow-sm px-1 py-0.5",children:[e.jsx("button",{type:"button",onClick:h,className:"p-1 rounded hover:bg-audafact-surface-1 text-audafact-text-secondary hover:text-audafact-accent-cyan focus:outline-none",title:"Zoom Out (X)","aria-label":"Zoom out",children:e.jsx("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})}),e.jsxs("button",{type:"button",onClick:x,className:"px-1.5 py-0.5 text-[10px] leading-none rounded hover:bg-audafact-surface-1 text-audafact-text-secondary hover:text-audafact-accent-cyan focus:outline-none",title:"Reset Zoom (C)","aria-label":"Reset zoom",children:[("number"==typeof f?f:1).toFixed(2).replace(/\.00$/,""),"x"]}),e.jsx("button",{type:"button",onClick:p,className:"p-1 rounded hover:bg-audafact-surface-1 text-audafact-text-secondary hover:text-audafact-accent-cyan focus:outline-none",title:"Zoom In (Z)","aria-label":"Zoom in",children:e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]}),!se&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center audafact-text-secondary bg-audafact-surface-1 z-10",children:`Loading waveform... ${s}`}),e.jsx("div",{className:"transition-opacity duration-300 "+(se?"opacity-100":"opacity-0"),children:e.jsx("div",{ref:M,style:{overflowX:f<=1?"hidden":"auto",overflowY:"hidden"},children:e.jsxs("div",{ref:L,className:"w-full box-border",style:{height:"170px",minWidth:"100%",position:"relative",backgroundColor:"#111827",backgroundImage:"\n                linear-gradient(rgba(139, 148, 158, 0.1) 1px, transparent 1px),\n                linear-gradient(90deg, rgba(139, 148, 158, 0.1) 1px, transparent 1px)\n              ",backgroundSize:`${me}px ${me}px`},children:[se&&re&&e.jsx(F,{duration:re.getDuration(),tempo:v,zoomLevel:f,timeSignature:y,firstMeasureTime:w,visible:!0,showMeasures:_},`grid-lines-${g||"default"}-${v}`),se&&re&&e.jsx(A,{duration:re.getDuration(),tempo:v,zoomLevel:f,onFirstMeasureChange:j||(()=>{}),timeSignature:y,firstMeasureTime:w,visible:_,containerRef:L},`measure-display-${g||"default"}-${v}`)]},P||"no-url")})})]})},_=t=>e.jsx("div",{className:"w-full relative box-border overflow-hidden audafact-waveform-bg",style:{height:"190px"},children:e.jsx(B,{...t})}),I=({mode:t,audioContext:r,audioBuffer:s,loopStart:n,loopEnd:o,cuePoints:i,ensureAudio:d,isSelected:l=!1,onSelect:u,onPlaybackTimeChange:m,onSpeedChange:f,trackTempo:p=120,volume:h=1,onVolumeChange:x,playbackSpeed:g=1,onPlaybackStateChange:b,playbackTime:w,disabled:j=!1,lowpassFreq:k,onLowpassFreqChange:N,highpassFreq:S,onHighpassFreqChange:C,showDeleteButton:T=!1,onDelete:L,trackId:E,seekFunctionRef:M,recordingDestination:P})=>{const{addRecordingEvent:R}=c(),[D,z]=a.useState(g),[A,F]=a.useState(!1);a.useEffect(()=>{if(P&&Y.current&&A&&r){const e=r.createGain();e.gain.value=Z.current?.gain.value||1,Y.current.connect(e),e.connect(P)}},[P,A,E,r,t]);const[B,_]=a.useState(0),[I,U]=a.useState(null),[O,$]=a.useState(k||2e4),[W,q]=a.useState(S||20),[H,V]=a.useState(!1),Y=a.useRef(null),X=a.useRef(0),Z=a.useRef(null),G=a.useRef(null),K=a.useRef(0),J=a.useRef(h),Q=a.useRef(1),ee=a.useRef(null),te=a.useRef(0),ae=a.useRef(0),re=a.useRef(t),se=a.useRef(null),ne=a.useRef(null),oe=a.useRef(k||2e4),ie=a.useRef(S||20),ce=a.useRef(!1);a.useEffect(()=>{void 0!==k&&($(k),oe.current=k)},[k]),a.useEffect(()=>{void 0!==S&&(q(S),ie.current=S)},[S]);const de=a.useCallback(()=>({minTempo:Math.max(40,Math.round(.5*p)),maxTempo:Math.min(300,Math.round(2*p)),stepSize:Math.max(.001,Math.min(.05,1/p))}),[p]),le=a.useCallback(e=>Math.round(p*e),[p]),ue=a.useCallback(()=>le(D),[D,le]),me=a.useCallback(e=>{$(e),oe.current=e,se.current&&se.current.frequency.setValueAtTime(e,r?.currentTime||0),N&&N(e),E&&R({type:"filter_change",trackId:E,data:{filterType:"lowpass",oldFreq:O,newFreq:e,mode:t}})},[r,N,E,R,O,t]),fe=a.useCallback(e=>{q(e),ie.current=e,ne.current&&ne.current.frequency.setValueAtTime(e,r?.currentTime||0),C&&C(e),E&&R({type:"filter_change",trackId:E,data:{filterType:"highpass",oldFreq:W,newFreq:e,mode:t}})},[r,C,E,R,W,t]),pe=a.useCallback(()=>O<2e4||W>20,[O,W]),he=a.useCallback(()=>{if(!r)return null;const e=J.current,t=Q.current,a=r.createBufferSource(),n=r.createGain();a.buffer=s,a.playbackRate.value=t,n.gain.value=e;const o=oe.current,i=ie.current;if(o<2e4||i>20){const e=r.createBiquadFilter();e.type="lowpass",e.frequency.value=o,e.Q.value=1;const t=r.createBiquadFilter();if(t.type="highpass",t.frequency.value=i,t.Q.value=1,se.current=e,ne.current=t,a.connect(t),t.connect(e),e.connect(n),n.connect(r.destination),P){const t=r.createGain();t.gain.value=n.gain.value,e.connect(t),t.connect(P)}return{sourceNode:a,gainNode:n,lowpassFilter:e,highpassFilter:t}}if(a.connect(n),n.connect(r.destination),P){const e=r.createGain();e.gain.value=n.gain.value,a.connect(e),e.connect(P)}return{sourceNode:a,gainNode:n}},[r,s,P,E,t]),xe=a.useCallback(()=>{if(!A||!r||!Y.current)return;if(ce.current)return void(G.current=requestAnimationFrame(xe));const e=performance.now();if(e-K.current<16)return void(G.current=requestAnimationFrame(xe));const a=r.getOutputTimestamp().contextTime;if(a){const e=a-X.current,i=Y.current.playbackRate.value;if("loop"===t){const t=o-n;if(B<n||B>o){const t=ae.current+e*i,a=t>=s.duration?0:t;if(_(a),m&&m(a),a>=n&&a<=o&&Y.current){Y.current.stop();const e=he();if(e){const{sourceNode:t,gainNode:s,lowpassFilter:i,highpassFilter:c}=e;t.loop=!0,t.loopStart=n,t.loopEnd=o;const d=a-n;t.start(0,n+d),Y.current=t,Z.current=s,i&&(se.current=i),c&&(ne.current=c),X.current=r.currentTime,ae.current=n+d}}}else{const a=n+e*i%t;_(a),m&&m(a)}}else{const t=ae.current+e*i,a=t>=s.duration?0:t;_(a),m&&m(a)}}K.current=e,G.current=requestAnimationFrame(xe)},[A,r,s.duration,m,t,n,o]);a.useEffect(()=>{ee.current=I,null!==I&&I<i.length&&(te.current=i[I])},[I,i]);const ge=a.useCallback(e=>{if(!A||!Y.current||!r||ce.current)return;ce.current=!0;Y.current.stop();const a=he();if(a){const{sourceNode:s,gainNode:i,lowpassFilter:c,highpassFilter:d}=a;if("loop"===t){e>=n&&e<=o?(s.loop=!0,s.loopStart=n,s.loopEnd=o,s.start(0,e)):(s.loop=!1,s.start(0,e))}else s.loop=!1,s.start(0,e);Y.current=s,Z.current=i,c&&(se.current=c),d&&(ne.current=d),X.current=r.currentTime,ae.current=e,_(e),setTimeout(()=>{ce.current=!1},10)}else ce.current=!1},[A,r,t,n,o]);a.useEffect(()=>{M&&(M.current=ge)},[ge,M]),a.useEffect(()=>{A||"number"!=typeof w||_(w)},[w,A]),a.useEffect(()=>{if(A&&re.current!==t&&Y.current){Y.current.stop();const e=he();if(e){const{sourceNode:a,gainNode:s,lowpassFilter:i,highpassFilter:c}=e;if("loop"===t){B>=n&&B<=o?(a.loop=!0,a.loopStart=n,a.loopEnd=o,a.start(0,B),ae.current=B):(a.loop=!1,a.start(0,B),ae.current=B)}else a.loop=!1,a.start(0,B),ae.current=B;Y.current=a,Z.current=s,i&&(se.current=i),c&&(ne.current=c),X.current=r?.currentTime||0}}re.current=t},[t,A,B,n,o,r]),a.useEffect(()=>(A?(K.current=performance.now(),G.current=requestAnimationFrame(xe)):G.current&&(cancelAnimationFrame(G.current),G.current=null),()=>{G.current&&cancelAnimationFrame(G.current)}),[A,xe]),a.useEffect(()=>{const e=e=>{if("cue"!==t||!l)return;const a={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,0:9}[e.key];void 0!==a&&a<i.length&&be(a)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[t,l,i]);const be=async e=>{if(r&&s&&!(e>=i.length))try{await d(()=>{}),Y.current&&(Y.current.stop(),Y.current=null),Z.current&&(Z.current.disconnect(),Z.current=null),se.current&&(se.current.disconnect(),se.current=null),ne.current&&(ne.current.disconnect(),ne.current=null),U(e),ee.current=e;const a=i[e];te.current=a,_(a),m&&m(a);const s=he();if(!s)return;const{sourceNode:n,gainNode:o,lowpassFilter:c,highpassFilter:l}=s;Y.current=n,Z.current=o,c&&(se.current=c),l&&(ne.current=l),X.current=r.currentTime,n.start(0,a),ae.current=a,F(!0),b&&b(!0),K.current=performance.now(),G.current=requestAnimationFrame(xe),E&&R({type:"cue_trigger",trackId:E,data:{cueIndex:e,cueTime:a,mode:t}}),n.onended=()=>{Y.current===n&&(F(!1),Y.current=null,Z.current=null,se.current&&(se.current.disconnect(),se.current=null),ne.current&&(ne.current.disconnect(),ne.current=null),G.current&&(cancelAnimationFrame(G.current),G.current=null),b&&b(!1))}}catch(a){F(!1)}};return a.useEffect(()=>{J.current=h,Z.current&&(Z.current.gain.value=h)},[h]),a.useEffect(()=>{Y.current&&(Y.current.playbackRate.value=Q.current)},[D]),a.useEffect(()=>()=>{Y.current&&Y.current.stop(),Z.current&&Z.current.disconnect(),se.current&&se.current.disconnect(),ne.current&&ne.current.disconnect()},[]),e.jsxs("div",{className:"audafact-card p-2 md:p-4 space-y-2 md:space-y-4 "+(j?"opacity-50":""),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:async()=>{try{if(await d(()=>{}),!r||!s)return;if(A)Y.current&&(Y.current.stop(),Y.current=null),Z.current&&(Z.current.disconnect(),Z.current=null),se.current&&(se.current.disconnect(),se.current=null),ne.current&&(ne.current.disconnect(),ne.current=null),G.current&&(cancelAnimationFrame(G.current),G.current=null),F(!1),b&&b(!1),E&&"loop"===t&&R({type:"loop_stop",trackId:E,data:{mode:t}});else{const e=he();if(!e)return;const{sourceNode:a,gainNode:s,lowpassFilter:c,highpassFilter:d}=e;if("loop"===t)a.loop=!0,a.loopStart=n,a.loopEnd=o,a.start(0,n),ae.current=n;else if("cue"===t&&null!==I){const e=i[I];te.current=e,a.start(0,e),ae.current=e}else a.start(0,B),ae.current=B;Y.current=a,Z.current=s,c&&(se.current=c),d&&(ne.current=d),F(!0),b&&b(!0),E&&"loop"===t&&R({type:"loop_play",trackId:E,data:{mode:t,loopStart:n,loopEnd:o,currentTime:ae.current}}),X.current=r.currentTime,K.current=performance.now(),G.current=requestAnimationFrame(xe),a.onended=()=>{Y.current===a&&(F(!1),Y.current=null,Z.current=null,se.current&&(se.current.disconnect(),se.current=null),ne.current&&(ne.current.disconnect(),ne.current=null),G.current&&(cancelAnimationFrame(G.current),G.current=null),b&&b(!1))}}}catch(e){F(!1)}},disabled:j,className:"p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan transition-colors duration-200 "+(j?"bg-audafact-text-secondary text-audafact-bg-primary cursor-not-allowed":"bg-audafact-accent-cyan text-audafact-bg-primary hover:bg-opacity-90"),"data-testid":"play-button",children:A?e.jsx(v,{size:16}):e.jsx(y,{size:16})}),e.jsxs("div",{className:"text-center text-xs audafact-text-secondary",children:[B.toFixed(2),"s / ",s.duration.toFixed(2),"s"]}),"loop"===t&&e.jsxs("div",{className:"text-xs md:text-sm audafact-text-secondary",children:["Loop: ",n.toFixed(2),"s - ",o.toFixed(2),"s"]})]}),"cue"===t&&e.jsxs("div",{className:"flex items-center space-x-3",children:[l&&e.jsx("div",{className:"text-xs audafact-text-secondary hidden md:block",children:"Press 1-0 keys to trigger cues"}),e.jsxs("button",{onClick:u,disabled:j,className:"px-2 py-0.5 text-xs rounded-sm md:px-3 md:py-1 md:text-sm transition-colors duration-200 "+(j?"bg-audafact-surface-2 text-audafact-text-secondary cursor-not-allowed":l?"bg-audafact-alert-red text-audafact-text-primary":"bg-audafact-surface-2 text-audafact-text-secondary hover:bg-audafact-divider hover:text-audafact-text-primary"),children:[e.jsx("span",{className:"md:hidden",children:l?"Selected":"Select"}),e.jsx("span",{className:"hidden md:inline",children:l?"Selected to Cue":"Select to Cue"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 md:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs md:text-sm font-medium audafact-heading",children:"Volume"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:h,disabled:j,onChange:e=>{if(j)return;const a=parseFloat(e.target.value);x&&x(a),E&&R({type:"volume_change",trackId:E,data:{oldVolume:h,newVolume:a,mode:t}})},className:"flex-1 h-1.5 md:h-2 bg-audafact-surface-2 rounded-lg appearance-none cursor-pointer slider "+(j?"cursor-not-allowed opacity-50":"")}),e.jsxs("span",{className:"text-xs md:text-sm audafact-text-secondary w-10 md:w-12",children:[Math.round(100*h),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs md:text-sm font-medium audafact-heading",children:[e.jsxs("span",{className:"md:hidden",children:["Speed: ",D.toFixed(2),"x"]}),e.jsxs("span",{className:"hidden md:inline",children:["Playback Speed: ",D.toFixed(2),"x"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"range",min:de().minTempo/p,max:de().maxTempo/p,step:de().stepSize,value:D,disabled:j,onChange:e=>{if(j)return;const a=parseFloat(e.target.value);z(a),Q.current=a,f&&f(a),E&&R({type:"speed_change",trackId:E,data:{oldSpeed:D,newSpeed:a,mode:t}})},className:"flex-1 h-1.5 md:h-2 bg-audafact-surface-2 rounded-lg appearance-none cursor-pointer slider "+(j?"cursor-not-allowed opacity-50":"")}),e.jsxs("span",{className:"text-xs md:text-sm text-gray-600 w-14 md:w-16",children:[ue()," BPM"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>V(!H),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium audafact-text-secondary bg-audafact-surface-1 border border-audafact-divider rounded hover:bg-audafact-surface-2 transition-colors duration-200",children:[e.jsxs("span",{children:["Audio Filters ",pe()&&e.jsx("span",{className:"text-audafact-accent-cyan",children:"●"})]}),e.jsx("svg",{className:"w-3 h-3 transition-transform "+(H?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),T&&L&&e.jsxs("button",{onClick:L,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium audafact-text-secondary hover:text-audafact-red hover:bg-audafact-surface-2 border border-audafact-divider rounded transition-colors duration-200",title:"Delete Track",children:[e.jsx("span",{children:"Delete"}),e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]})]}),H&&e.jsx("div",{className:"p-4 border-b bg-audafact-surface-1",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"text-sm font-medium audafact-heading",children:["Low Pass Filter: ",(k||2e4)>=1e3?`${((k||2e4)/1e3).toFixed(1)}kHz`:`${k||2e4}Hz`]})}),e.jsx("input",{type:"range",min:"20",max:"20000",step:"1",value:k||2e4,disabled:j,onChange:e=>{if(j)return;const t=parseInt(e.target.value);me(t)},className:"w-full h-2 bg-audafact-surface-2 rounded-lg appearance-none cursor-pointer slider "+(j?"cursor-not-allowed opacity-50":"")}),e.jsxs("div",{className:"flex justify-between text-xs audafact-text-secondary",children:[e.jsx("span",{children:"20Hz"}),e.jsx("span",{children:"20kHz"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"text-sm font-medium audafact-heading",children:["High Pass Filter: ",(S||20)>=1e3?`${((S||20)/1e3).toFixed(1)}kHz`:`${S||20}Hz`]})}),e.jsx("input",{type:"range",min:"20",max:"20000",step:"1",value:S||20,disabled:j,onChange:e=>{if(j)return;const t=parseInt(e.target.value);fe(t)},className:"w-full h-2 bg-audafact-surface-2 rounded-lg appearance-none cursor-pointer slider "+(j?"cursor-not-allowed opacity-50":"")}),e.jsxs("div",{className:"flex justify-between text-xs audafact-text-secondary",children:[e.jsx("span",{children:"20Hz"}),e.jsx("span",{children:"20kHz"})]})]})]})})]}),"cue"===t&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium mb-2 audafact-text-secondary",children:"Cue Points"}),e.jsx("div",{className:"grid grid-cols-5 gap-0.5 md:gap-1 mb-1",children:i.slice(0,5).map((t,a)=>e.jsx("button",{onClick:()=>!j&&be(a),disabled:j,className:"h-7 md:h-8 text-[10px] md:text-xs py-0.5 md:py-1 px-1 rounded-sm md:rounded transition-colors duration-200 "+(j?"bg-audafact-surface-2 text-audafact-text-secondary cursor-not-allowed":I===a?"bg-audafact-alert-red text-audafact-text-primary":"bg-audafact-surface-2 hover:bg-audafact-divider text-audafact-text-secondary hover:text-audafact-text-primary"),children:a+1},`cue-top-${a}`))}),e.jsx("div",{className:"grid grid-cols-5 gap-0.5 md:gap-1",children:i.slice(5,10).map((t,a)=>{const r=a+5,s=9===r?"0":String(r+1);return e.jsx("button",{onClick:()=>!j&&be(r),disabled:j,className:"h-7 md:h-8 text-[10px] md:text-xs py-0.5 md:py-1 px-1 rounded-sm md:rounded transition-colors duration-200 "+(j?"bg-audafact-surface-2 text-audafact-text-secondary cursor-not-allowed":I===r?"bg-audafact-alert-red text-audafact-text-primary":"bg-audafact-surface-2 hover:bg-audafact-divider text-audafact-text-secondary hover:text-audafact-text-primary"),children:s},`cue-bottom-${r}`)})})]})]})},U=({trackId:t,initialTempo:r=120,onTempoChange:s,playbackSpeed:n=1})=>{const[o,i]=a.useState(r),[c,d]=a.useState(r.toString()),[l,u]=a.useState(!1),[m,f]=a.useState(0),[p,h]=a.useState(null),[x,g]=a.useState([]),[b,v]=a.useState(r),y=a.useRef(null),w=a.useRef(null);a.useEffect(()=>{v(o*n)},[o,n]),a.useEffect(()=>{i(r),d(r.toString())},[r]);const j=a.useCallback(e=>{if(e.length<2)return null;const t=[];for(let s=1;s<e.length;s++)t.push(e[s]-e[s-1]);const a=t.reduce((e,t)=>e+t,0)/t.length,r=Math.round(6e4/a);return Math.max(40,Math.min(300,r))},[]),k=a.useCallback(()=>{const e=Date.now();if(p&&e-p>3e3)g([e]),f(1);else{const a=[...x,e];if(g(a),f(a.length),a.length>8){const e=a.slice(-8);g(e),f(e.length)}if(a.length>=2){const e=j(a);e&&(i(e),d(e.toString()),s(t,e))}}h(e),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{u(!1),f(0),g([]),h(null)},3e3)},[p,x,j]);a.useEffect(()=>{if(!l)return;const e=e=>{"Space"!==e.code||e.repeat||(e.preventDefault(),k())};return w.current=e,document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[l,k]),a.useEffect(()=>()=>{y.current&&clearTimeout(y.current),w.current&&document.removeEventListener("keydown",w.current)},[]);return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:space-x-4 md:gap-4 p-2 md:p-3 audafact-card",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs md:text-sm font-medium audafact-heading",children:"Original Tempo"}),e.jsx("span",{className:"hidden md:block text-xs audafact-text-secondary",children:"BPM"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",min:"40",max:"300",value:c,onChange:e=>(e=>{d(e);const a=parseFloat(e);!isNaN(a)&&a>=40&&a<=300&&(i(a),s(t,a))})(e.target.value),onBlur:()=>{const e=parseFloat(c);(isNaN(e)||e<40||e>300)&&d(o.toString())},className:"w-14 md:w-16 px-2 py-0.5 md:py-1 text-xs md:text-sm border border-audafact-divider rounded bg-audafact-surface-2 text-audafact-text-primary focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-transparent",disabled:l}),e.jsx("span",{className:"text-xs md:text-sm audafact-text-secondary",children:"→"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs md:text-sm font-medium audafact-accent-cyan",children:[Math.round(b)," BPM"]}),e.jsxs("span",{className:"text-[10px] md:text-xs audafact-text-secondary",children:["Speed: ",n.toFixed(2),"x"]})]})]}),e.jsxs("button",{onClick:()=>{l?(u(!1),f(0),g([]),h(null),y.current&&clearTimeout(y.current)):(u(!0),f(0),g([]),h(null))},className:"px-2 py-1 text-xs md:px-3 md:py-1.5 md:text-sm font-medium rounded-md transition-colors duration-200 "+(l?"bg-audafact-alert-red text-audafact-text-primary border border-audafact-alert-red hover:bg-opacity-90":"bg-audafact-surface-2 text-audafact-text-secondary border border-audafact-divider hover:bg-audafact-divider hover:text-audafact-text-primary"),title:l?"Click to stop tap tempo":"Click to start tap tempo",children:[e.jsx("span",{className:"md:hidden",children:l?"Stop":"Tap"}),e.jsx("span",{className:"hidden md:inline",children:l?"Stop Tap":"Tap Tempo"})]}),l&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-audafact-alert-red rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs md:text-sm text-audafact-alert-red font-medium",children:"Active"})]}),e.jsx("span",{className:"text-xs md:text-sm audafact-text-secondary",children:m>0?`Taps: ${m}`:"Press Spacebar to tap"})]})]})},O=({timeSignature:t,onTimeSignatureChange:r})=>{const[s,n]=a.useState(!1);return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:space-x-4 md:gap-4 p-2 md:p-3 audafact-card",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs md:text-sm font-medium audafact-heading",children:"Time Signature"}),e.jsx("span",{className:"hidden md:block text-xs audafact-text-secondary",children:"Beats per measure"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",min:"1",max:"32",value:t.numerator,onChange:e=>(e=>{const a=parseInt(e);!isNaN(a)&&a>0&&a<=32&&r({...t,numerator:a})})(e.target.value),className:"w-10 md:w-12 px-2 py-0.5 md:py-1 text-xs md:text-sm border border-audafact-divider rounded bg-audafact-surface-2 text-audafact-text-primary focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-transparent text-center"}),e.jsx("span",{className:"text-xs md:text-sm audafact-text-secondary",children:"/"}),e.jsx("input",{type:"number",min:"1",max:"32",value:t.denominator,onChange:e=>(e=>{const a=parseInt(e);!isNaN(a)&&a>0&&a<=32&&r({...t,denominator:a})})(e.target.value),className:"w-10 md:w-12 px-2 py-0.5 md:py-1 text-xs md:text-sm border border-audafact-divider rounded bg-audafact-surface-2 text-audafact-text-primary focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-transparent text-center"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>n(!s),className:"px-2 py-1 text-xs md:px-3 md:py-1.5 md:text-sm font-medium bg-audafact-surface-2 text-audafact-text-secondary border border-audafact-divider rounded-md hover:bg-audafact-divider hover:text-audafact-text-primary transition-colors duration-200",children:"Common"}),s&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-40 bg-audafact-surface-1 rounded-md shadow-card border border-audafact-divider z-10",children:[{numerator:2,denominator:2,label:"2/2 (Cut time)"},{numerator:2,denominator:4,label:"2/4"},{numerator:3,denominator:4,label:"3/4"},{numerator:4,denominator:4,label:"4/4 (Common time)"},{numerator:3,denominator:8,label:"3/8"},{numerator:6,denominator:8,label:"6/8"},{numerator:9,denominator:8,label:"9/8"},{numerator:12,denominator:8,label:"12/8"},{numerator:5,denominator:4,label:"5/4"},{numerator:7,denominator:8,label:"7/8"},{numerator:5,denominator:8,label:"5/8"}].map(t=>e.jsx("button",{onClick:()=>(e=>{r({numerator:e.numerator,denominator:e.denominator}),n(!1)})(t),className:"w-full text-left px-3 py-2 text-xs md:text-sm hover:bg-audafact-surface-2 text-audafact-text-secondary hover:text-audafact-text-primary transition-colors duration-200",children:t.label},t.label))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs md:text-sm font-medium audafact-accent-cyan",children:[t.numerator,"/",t.denominator]}),e.jsxs("span",{className:"text-[10px] md:text-xs audafact-text-secondary",children:[t.numerator," beats per measure"]})]})]})},$=({className:t="",onSave:r,audioContext:s})=>{const{isRecordingPerformance:n,currentPerformance:d,startPerformanceRecording:l,stopPerformanceRecording:u}=c(),{canPerformAction:m,getUpgradeMessage:f}=S(),{tier:p}=o(),[h,x]=a.useState(!1),[g,b]=a.useState(!1),[v,y]=a.useState(!1);return e.jsxs("div",{className:`flex items-center justify-between w-full ${t}`,children:[e.jsx("button",{onClick:async()=>{if(!r)return;if(!p||"guest"===p.id)return void i("save_session");if(await m("save_session")){y(!0);try{await r(),x(!0),setTimeout(()=>x(!1),2e3)}catch(e){}finally{y(!1)}}else b(!0)},disabled:!r||v,className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed "+(h?"bg-green-500 text-white":"bg-audafact-text-secondary text-audafact-bg-primary hover:bg-opacity-90"),children:h?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:12}),"Saved!"]}):v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{size:12}),"Save"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[n&&d&&e.jsxs("div",{className:"flex items-center gap-2 text-sm audafact-text-secondary",children:[e.jsx("span",{children:"Recording Performance & Audio..."}),e.jsx("span",{className:"font-mono",children:(e=>{const t=Math.floor(e/1e3);return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`})(Date.now()-d.startTime)})]}),n?e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-4 py-2 bg-audafact-text-secondary text-audafact-bg-primary rounded-lg hover:bg-opacity-90 transition-colors shadow-sm",children:[e.jsx("div",{className:"w-3 h-3 bg-current rounded-full animate-pulse"}),"Stop Recording"]}):e.jsxs("button",{onClick:async()=>{if(!p||"guest"===p.id)return void i("record");await m("record")?l(s):b(!0)},className:"flex items-center gap-2 px-4 py-2 bg-audafact-alert-red text-audafact-text-primary rounded-lg hover:bg-opacity-90 transition-colors shadow-sm",children:[e.jsx("div",{className:"w-3 h-3 bg-current rounded-full"}),"Record"]})]}),g&&e.jsx(T,{message:f("record"),feature:"Recording",onClose:()=>b(!1)})]})};class W{static UPLOAD_BUCKET="user-uploads";static RECORDING_BUCKET="session-recordings";static LIBRARY_BUCKET="library-tracks";static MAX_FILE_SIZE=52428800;static ALLOWED_AUDIO_TYPES=["audio/mpeg","audio/wav","audio/ogg","audio/mp4","audio/aac","audio/flac"];static async uploadAudioFile(e,t,a){try{if(!this.isValidAudioFile(e))throw new Error("Invalid file type or size");const r=e.name.split(".").pop(),n=`${t}/${Date.now()}-${Math.random().toString(36).substring(2)}.${r}`,{data:o,error:i}=await s.storage.from(this.UPLOAD_BUCKET).upload(n,e,{cacheControl:"3600",upsert:!1,metadata:{title:a||e.name,originalName:e.name,size:e.size,type:e.type,uploadedBy:t}});if(i)throw i;return{data:{name:n,bucket_id:this.UPLOAD_BUCKET,owner:t,id:o?.path||"",updated_at:(new Date).toISOString(),created_at:(new Date).toISOString(),last_accessed_at:(new Date).toISOString(),metadata:{title:a||e.name,originalName:e.name,size:e.size,type:e.type,uploadedBy:t}},error:null}}catch(r){return{data:null,error:r}}}static async uploadRecording(e,t,a,r){try{if(!this.isValidAudioFile(e))throw new Error("Invalid file type or size");const n=e.name.split(".").pop(),o=`${t}/${a}/${Date.now()}-${Math.random().toString(36).substring(2)}.${n}`,{data:i,error:c}=await s.storage.from(this.RECORDING_BUCKET).upload(o,e,{cacheControl:"3600",upsert:!1,metadata:{originalName:e.name,size:e.size,type:e.type,sessionId:a,notes:r,uploadedBy:t}});if(c)throw c;return{data:{name:o,bucket_id:this.RECORDING_BUCKET,owner:t,id:i?.path||"",updated_at:(new Date).toISOString(),created_at:(new Date).toISOString(),last_accessed_at:(new Date).toISOString(),metadata:{originalName:e.name,size:e.size,type:e.type,sessionId:a,notes:r,uploadedBy:t}},error:null}}catch(n){return{data:null,error:n}}}static async downloadFile(e,t){try{const{data:a,error:r}=await s.storage.from(e).download(t);if(r)throw r;return{data:a,error:null}}catch(a){return{data:null,error:a}}}static async getSignedUrl(e,t,a=3600){try{const{data:r,error:n}=await s.storage.from(e).createSignedUrl(t,a);if(n)throw n;return r.signedUrl}catch(r){throw r}}static getPublicUrl(e,t){const{data:a}=s.storage.from(e).getPublicUrl(t);return a.publicUrl}static async listUserFiles(e,t,a){try{const r=a?`${t}/${a}`:t,{data:n,error:o}=await s.storage.from(e).list(r,{limit:100,offset:0,sortBy:{column:"created_at",order:"desc"}});if(o)throw o;return{data:n||[],error:null}}catch(r){return{data:null,error:r}}}static async deleteFile(e,t){try{const{error:a}=await s.storage.from(e).remove([t]);if(a)throw a;return{error:null}}catch(a){return{error:a}}}static async getAudioFileInfo(e,t){try{const{data:a,error:r}=await s.storage.from(e).list(t.split("/").slice(0,-1).join("/"),{search:t.split("/").pop()});if(r||!a||0===a.length)throw new Error("File not found");const n=a[0],o=this.getPublicUrl(e,t),i=await this.getAudioDuration(o);return{id:n.id,name:n.name,url:o,duration:i||0,size:n.metadata?.size||0,type:n.metadata?.type||"audio/mpeg",uploaded_at:n.created_at}}catch(a){return null}}static async uploadLibraryTrack(e,t,a){try{if(!this.isValidAudioFile(e))throw new Error("Invalid file type or size");const r=`${t}.${e.name.split(".").pop()}`,{data:n,error:o}=await s.storage.from(this.LIBRARY_BUCKET).upload(r,e,{cacheControl:"3600",upsert:!0,metadata:{trackId:t,originalName:e.name,size:e.size,type:e.type,...a}});if(o)throw o;return{data:{name:r,bucket_id:this.LIBRARY_BUCKET,owner:"system",id:n?.path||"",updated_at:(new Date).toISOString(),created_at:(new Date).toISOString(),last_accessed_at:(new Date).toISOString(),metadata:{trackId:t,originalName:e.name,size:e.size,type:e.type,...a}},error:null}}catch(r){return{data:null,error:r}}}static getLibraryTrackUrl(e,t){return this.getPublicUrl(this.LIBRARY_BUCKET,`${e}.${t}`)}static async getLibraryTrackSignedUrl(e,t,a=3600){return this.getSignedUrl(this.LIBRARY_BUCKET,`${e}.${t}`,a)}static async getAudioDuration(e){return new Promise(t=>{const a=new Audio;a.addEventListener("loadedmetadata",()=>{t(a.duration)}),a.addEventListener("error",()=>{t(0)}),a.src=e})}static isValidAudioFile(e){return!(e.size>this.MAX_FILE_SIZE)&&!!this.ALLOWED_AUDIO_TYPES.includes(e.type)}static formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}static formatDuration(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}}const q=({track:t,isPreviewing:a,onPreview:r,onAddToStudio:s,canAddToStudio:n,isProOnly:i})=>{const{tier:c}=o(),d=()=>{"guest"!==c.id?s():window.dispatchEvent(new CustomEvent("showSignupModal",{detail:{trigger:"add_library_track"}}))};return e.jsxs("div",{className:"track-item "+(i?"pro-only":""),draggable:n,onDragStart:e=>{"guest"!==c.id?(e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.setData("application/json",JSON.stringify({type:"library-track",name:t.name,id:t.id,file:t.file,trackType:t.type})),e.dataTransfer.effectAllowed="copy"):e.preventDefault()},children:[e.jsxs("div",{className:"track-info",children:[e.jsxs("div",{className:"track-header",children:[e.jsx("h4",{className:"track-name",children:t.name}),i&&e.jsx("span",{className:"pro-badge",children:"PRO"})]}),t.artist&&e.jsx("p",{className:"track-artist",children:t.artist}),e.jsxs("div",{className:"track-meta",children:[e.jsx("span",{className:"track-genre",children:t.genre}),e.jsxs("span",{className:"track-bpm",children:[t.bpm," BPM"]}),t.key&&e.jsx("span",{className:"track-key",children:t.key})]}),e.jsx("div",{className:"track-tags",children:t.tags.slice(0,3).map(t=>e.jsx("span",{className:"track-tag",children:t},t))})]}),e.jsxs("div",{className:"track-actions",children:[e.jsx("button",{onClick:r,className:"preview-button "+(a?"playing":""),title:a?"Stop preview":"Preview track",children:a?e.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]}):e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),n?e.jsx("button",{onClick:d,className:"add-button",title:"Add to studio",style:{color:"white",fontSize:"18px",fontWeight:"bold"},children:"+"}):e.jsx("button",{onClick:d,className:"add-button locked",title:"Sign up to add this track to your studio",style:{color:"white",fontSize:"16px"},children:"🔒"})]})]})},H=({isOpen:t,onToggle:r,onUploadTrack:s,onAddFromLibrary:m,onAddUserTrack:f,initialMode:p})=>{const{savedSessions:h,performances:x,exportSession:g,exportPerformance:b,deleteSession:v,deletePerformance:y}=c(),{user:w}=n(),{canPerformAction:j,getUpgradeMessage:k,canAccessFeature:N}=S(),{tier:C}=o(),{togglePreview:L,isPreviewing:E}=(()=>{const[e,t]=a.useState(null),{tier:r}=o(),s=async a=>{e&&(e.audio.pause(),e.audio.currentTime=0);try{const e=a.file,s=new Audio(e);s.volume=.7,s.loop=!1,s.addEventListener("ended",()=>{t(null)}),s.addEventListener("error",()=>{t(null)}),await s.play(),t({trackId:a.id,audio:s}),d("library_track_previewed",{trackId:a.id,genre:a.genre,bpm:a.bpm,userTier:r.id})}catch(s){}},n=()=>{e&&(e.audio.pause(),e.audio.currentTime=0,t(null))},i=t=>e?.trackId===t;return a.useEffect(()=>()=>{e&&e.audio.pause()},[e]),{startPreview:s,stopPreview:n,isPreviewing:i,togglePreview:async e=>{i(e.id)?n():await s(e)},currentPreview:e}})(),[M,P]=a.useState(()=>{const e=localStorage.getItem("sidePanelExpandedMenus");return e?JSON.parse(e):{"audio-library":!1,sessions:!1,recordings:!1}}),[R,D]=a.useState(()=>localStorage.getItem("sidePanelActiveAudioTab")||"library"),[z,A]=a.useState(()=>localStorage.getItem("sidePanelActiveSessionsTab")||"saved"),[F,B]=a.useState(!1),[_,I]=a.useState(!1),[U,O]=a.useState({}),[$,H]=a.useState({}),[V,Y]=a.useState([]),[X,Z]=a.useState({show:!1,message:"",feature:""}),[G,K]=a.useState([]),[J,Q]=a.useState(!1),ee=a.useRef(null);a.useEffect(()=>{"library"===R&&0===G.length&&te()},[R]),a.useEffect(()=>{(async()=>{if(w)try{const e=await u.getUserUploads(w.id),t=await Promise.all(e.map(async e=>{let t="0MB",a="audio/mpeg";try{const r=await W.getAudioFileInfo("user-uploads",e.file_url);r&&(t=W.formatFileSize(r.size),a=r.type)}catch(r){}return{id:e.id,name:e.title,file:null,type:a,size:t,url:e.file_url,uploadedAt:new Date(e.created_at).getTime()}}));Y(t)}catch(e){Y([])}else Y([])})()},[w]);const te=async()=>{Q(!0);try{const e=await l.getLibraryTracks(C.id);K(e)}catch(e){}finally{Q(!1)}},ae=e=>{P(t=>{const a={...t,[e]:!t[e]};return localStorage.setItem("sidePanelExpandedMenus",JSON.stringify(a)),a}),"audio-library"===e&&B(!1),"sessions"===e&&I(!1)},re=e=>{D(t=>{const a=t===e?null:e;return B(null===a),null!==a&&B(!1),a})},se=e=>{A(t=>{const a=t===e?null:e;return I(null===a),null!==a&&I(!1),a})};a.useEffect(()=>{"library"===p&&"library"!==R&&(D("library"),P(e=>{const t={...e,"audio-library":!0};return localStorage.setItem("sidePanelExpandedMenus",JSON.stringify(t)),t}))},[p,R]),a.useEffect(()=>{!M["audio-library"]||R||F||D("library")},[M["audio-library"],R,F]),a.useEffect(()=>{!M.sessions||z||_||A("saved")},[M.sessions,z,_]),a.useEffect(()=>{R?localStorage.setItem("sidePanelActiveAudioTab",R):localStorage.removeItem("sidePanelActiveAudioTab")},[R]),a.useEffect(()=>{z?localStorage.setItem("sidePanelActiveSessionsTab",z):localStorage.removeItem("sidePanelActiveSessionsTab")},[z]),a.useEffect(()=>()=>{Object.values(U).forEach(e=>{e&&(e.pause(),e.currentTime=0)})},[U]);const ne=e=>new Promise(t=>{const a=new Audio,r=URL.createObjectURL(e);a.addEventListener("loadedmetadata",()=>{t(a.duration),URL.revokeObjectURL(r)}),a.addEventListener("error",()=>{t(0),URL.revokeObjectURL(r)}),a.src=r}),oe=async(e,t=!1)=>{if(t){f(e,"preview")}else{if(!(await j("add_library_track")))return void Z({show:!0,message:k("add_library_track"),feature:"Library Track"});m(e,"preview")}window.innerWidth<1024&&r()};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:"fixed top-15 left-0 right-0 bottom-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:r}),e.jsxs("div",{"data-sidepanel":!0,className:`fixed top-16 left-0 h-[calc(100vh-4rem)] bg-audafact-surface-1 border-r border-audafact-divider shadow-card transition-transform duration-300 ease-in-out z-50 overflow-hidden flex flex-col ${t?"translate-x-0":"-translate-x-full"} w-full lg:w-[400px]`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-audafact-divider",children:[e.jsx("h2",{className:"text-lg font-semibold audafact-heading",children:"Stash"}),e.jsx("button",{onClick:r,className:"p-2 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded-lg transition-colors duration-200","data-testid":"side-panel-toggle",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"border-b border-audafact-divider",children:[e.jsxs("button",{onClick:()=>ae("audio-library"),className:"w-full flex items-center justify-between px-4 py-3 text-sm font-medium text-audafact-text-primary hover:bg-audafact-surface-2 transition-colors duration-200",children:[e.jsx("span",{children:"Tracks"}),e.jsx("svg",{className:"w-4 h-4 transition-transform duration-200 "+(M["audio-library"]?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),M["audio-library"]&&e.jsxs("div",{className:"bg-audafact-surface-2",children:[e.jsx("button",{onClick:()=>re("library"),className:"w-full px-8 py-2 text-xs text-left transition-colors duration-200 "+("library"===R?"text-audafact-accent-cyan bg-audafact-surface-3":"text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-3"),children:"Audafact Library"}),"library"===R&&e.jsx("div",{className:"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"text-md font-medium audafact-heading",children:"Track Library"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",placeholder:"Search tracks...",className:"w-full px-3 py-2 bg-audafact-surface-2 border border-audafact-divider rounded-lg text-audafact-text-primary placeholder-audafact-text-secondary focus:outline-none focus:border-audafact-accent-cyan"}),e.jsx("div",{className:"text-sm audafact-text-secondary bg-audafact-surface-2 p-2 rounded",children:"Preview tracks and add them to your studio. Drag tracks to the studio or use the + button. Guest users can preview but need to sign up to add tracks."}),e.jsx("div",{className:"space-y-3",children:J?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"loading-spinner mx-auto"}),e.jsx("p",{className:"text-sm audafact-text-secondary mt-2",children:"Loading tracks..."})]}):0===G.length?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm audafact-text-secondary",children:"No tracks available"})}):G.map(t=>e.jsx(q,{track:t,isPreviewing:E(t.id),onPreview:()=>L(t),onAddToStudio:()=>oe({id:t.id,name:t.name,file:t.file,type:t.type,size:t.size},!1),canAddToStudio:"guest"!==C.id,isProOnly:t.isProOnly||!1},t.id))})]})]})}),e.jsx("button",{onClick:()=>re("my-tracks"),className:"w-full px-8 py-2 text-xs text-left transition-colors duration-200 "+("my-tracks"===R?"text-audafact-accent-cyan bg-audafact-surface-3":"text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-3"),children:"My Tracks"}),"my-tracks"===R&&e.jsx("div",{className:"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("h3",{className:"text-md font-medium audafact-heading",children:w?"My Uploaded Tracks":"Upload Tracks"})}),w?0===V.length?e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col justify-center",children:[e.jsx("div",{className:"text-audafact-text-secondary mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("p",{className:"audafact-text-secondary mb-4",children:"No tracks uploaded yet"}),e.jsx("button",{onClick:()=>{w?ee.current?.click():i("upload")},className:"audafact-button-primary",children:"Upload Your First Track"})]}):w?e.jsx("div",{className:"space-y-3",children:V.map(t=>e.jsx("div",{draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.setData("application/json",JSON.stringify({type:"user-track",name:t.name,id:t.id})),e.dataTransfer.effectAllowed="copy"},className:"p-3 border border-audafact-divider rounded-lg hover:bg-audafact-surface-2 transition-colors duration-200 audafact-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),(async(e,t=!1)=>{const a=e.id;if(Object.entries(U).forEach(([e,t])=>{e!==a&&t&&(t.pause(),t.currentTime=0,H(t=>({...t,[e]:!1})))}),$[a]){const e=U[a];return void(e&&(e.pause(),e.currentTime=0,H(e=>({...e,[a]:!1}))))}let r;if(t)try{r=await W.getSignedUrl("user-uploads",e.url)}catch(n){return}else r=e.file;const s=new Audio(r);s.addEventListener("ended",()=>{H(e=>({...e,[a]:!1}))}),s.addEventListener("pause",()=>{H(e=>({...e,[a]:!1}))}),s.addEventListener("error",e=>{}),s.play().then(()=>{H(e=>({...e,[a]:!0})),O(e=>({...e,[a]:s}))}).catch(e=>{})})(t,!0)},className:"flex-shrink-0 p-2 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded transition-colors duration-200",title:$[t.id]?"Pause Preview":"Play Preview",children:$[t.id]?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347c-.75.412-1.667-.13-1.667-.986V5.653Z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium audafact-text-primary truncate max-w-[200px]",title:t.name,children:t.name}),e.jsxs("p",{className:"text-sm audafact-text-secondary truncate max-w-[200px]",children:[t.type&&t.type.split("/")[1]?.toUpperCase()||"AUDIO"," • ",t.size]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),oe(t,!0)},className:"flex-shrink-0 p-2 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded transition-colors duration-200",title:"Add to Studio",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{const t=V.find(t=>t.id===e);if(t&&w)try{if((await W.deleteFile("user-uploads",t.url)).error,await u.deleteUpload(e,w.id)){const t=V.filter(t=>t.id!==e);Y(t)}}catch(a){}})(t.id)},className:"flex-shrink-0 p-2 text-audafact-text-secondary hover:text-audafact-alert-red hover:bg-audafact-surface-2 rounded transition-colors duration-200",title:"Remove Track",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},t.id))}):null:e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col justify-center",children:[e.jsx("div",{className:"text-audafact-text-secondary mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("p",{className:"audafact-text-secondary mb-4",children:"Upload your own tracks"}),e.jsx("p",{className:"text-sm audafact-text-secondary mb-4",children:"Sign up to upload and manage your audio files"}),e.jsx("button",{onClick:()=>{w?ee.current?.click():i("upload")},className:"audafact-button-primary",children:"Upload Track"})]})]})})]})]}),w&&e.jsxs("div",{className:"border-b border-audafact-divider",children:[e.jsxs("button",{onClick:()=>ae("sessions"),className:"w-full flex items-center justify-between px-4 py-3 text-sm font-medium text-audafact-text-primary hover:bg-audafact-surface-2 transition-colors duration-200",children:[e.jsx("span",{children:"Sessions"}),e.jsx("svg",{className:"w-4 h-4 transition-transform duration-200 "+(M.sessions?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),M.sessions&&e.jsxs("div",{className:"bg-audafact-surface-2",children:[e.jsx("button",{onClick:()=>se("saved"),className:"w-full px-8 py-2 text-xs text-left transition-colors duration-200 "+("saved"===z?"text-audafact-accent-cyan bg-audafact-surface-3":"text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-3"),children:"Saved Sessions"}),"saved"===z&&e.jsx("div",{className:"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-md font-medium audafact-heading",children:"Saved Sessions"}),e.jsxs("span",{className:"text-xs audafact-text-secondary",children:[h.length," sessions"]})]}),0===h.length?e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col justify-center",children:[e.jsx("div",{className:"text-audafact-text-secondary mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})})}),e.jsx("p",{className:"audafact-text-secondary mb-4",children:"No sessions saved yet"}),e.jsx("p",{className:"text-xs audafact-text-secondary",children:'Use "Record" "Save" to store current studio state'})]}):e.jsx("div",{className:"space-y-3",children:h.map(t=>{const a=t.id.startsWith("session_"),r=t.id.startsWith("recording_");return e.jsxs("div",{className:"p-3 border border-audafact-divider rounded-lg hover:bg-audafact-surface-2 transition-colors duration-200 audafact-card",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h4",{className:"font-medium audafact-text-primary text-sm",children:[new Date(t.startTime).toLocaleDateString()," at ",new Date(t.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),a&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-audafact-accent-cyan text-audafact-bg-primary rounded-full",children:"State"}),r&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-audafact-alert-red text-audafact-text-primary rounded-full",children:"Recording"})]}),r&&e.jsxs("p",{className:"text-xs audafact-text-secondary",children:["Duration: ",Math.floor(t.duration/6e4),":",(t.duration%6e4/1e3).toFixed(0).padStart(2,"0")]}),e.jsxs("p",{className:"text-xs audafact-text-secondary",children:[a?"Studio snapshot":`${t.events.length} events`," • ",t.tracks.length," tracks"]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[N("download")&&e.jsx("button",{onClick:async()=>{await j("download")?g(t.id):Z({show:!0,message:k("download"),feature:"Download"})},className:"p-1 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded transition-colors duration-200",title:"Export Session",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("button",{onClick:async()=>await v(t.id),className:"p-1 text-audafact-text-secondary hover:text-audafact-alert-red hover:bg-audafact-surface-2 rounded transition-colors duration-200",title:"Delete Session",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),t.events.length>0&&e.jsxs("details",{className:"mt-2",children:[e.jsxs("summary",{className:"text-xs audafact-text-secondary cursor-pointer hover:text-audafact-text-primary",children:["View Events (",t.events.length,")"]}),e.jsxs("div",{className:"mt-2 space-y-1 max-h-32 overflow-y-auto",children:[t.events.slice(0,5).map((t,a)=>e.jsxs("div",{className:"text-xs bg-audafact-surface-3 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"font-mono text-audafact-accent-cyan",children:[Math.floor(t.timestamp/1e3),":",(t.timestamp%1e3/10).toFixed(0).padStart(2,"0")]}),e.jsx("span",{className:"text-audafact-alert-red",children:t.type})]}),e.jsxs("div",{className:"text-audafact-text-secondary",children:["Track: ",t.trackId.substring(0,8),"..."]})]},a)),t.events.length>5&&e.jsxs("div",{className:"text-xs text-center audafact-text-secondary py-1",children:["...and ",t.events.length-5," more events"]})]})]})]},t.id)})})]})}),e.jsx("button",{onClick:()=>se("shared"),className:"w-full px-8 py-2 text-xs text-left transition-colors duration-200 "+("shared"===z?"text-audafact-accent-cyan bg-audafact-surface-3":"text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-3"),children:"Shared Sessions"}),"shared"===z&&e.jsx("div",{className:"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"text-md font-medium audafact-heading",children:"Shared Sessions"})}),e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col justify-center",children:[e.jsx("div",{className:"text-audafact-text-secondary mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})})}),e.jsx("p",{className:"audafact-text-secondary mb-4",children:"Shared sessions coming soon"}),e.jsx("p",{className:"text-xs audafact-text-secondary",children:"Discover and import sessions shared by the community"})]})]})})]})]}),w&&e.jsxs("div",{className:"border-b border-audafact-divider",children:[e.jsxs("button",{onClick:()=>ae("recordings"),className:"w-full flex items-center justify-between px-4 py-3 text-sm font-medium text-audafact-text-primary hover:bg-audafact-surface-2 transition-colors duration-200",children:[e.jsx("span",{children:"Recordings"}),e.jsx("svg",{className:"w-4 h-4 transition-transform duration-200 "+(M.recordings?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),M.recordings&&e.jsx("div",{className:"bg-audafact-surface-2",children:e.jsxs("div",{className:"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-md font-medium audafact-heading",children:"Recordings"}),e.jsxs("span",{className:"text-xs audafact-text-secondary",children:[x.length," recordings"]})]}),0===x.length?e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col justify-center",children:[e.jsx("div",{className:"text-audafact-text-secondary mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})})}),e.jsx("p",{className:"audafact-text-secondary mb-4",children:"No recordings captured yet"}),e.jsx("p",{className:"text-xs audafact-text-secondary",children:'Use "Record" to capture your edits and flips'})]}):e.jsx("div",{className:"space-y-3",children:x.map(t=>e.jsx("div",{className:"p-3 border border-audafact-divider rounded-lg hover:bg-audafact-surface-2 transition-colors duration-200 audafact-card",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h4",{className:"font-medium audafact-text-primary text-sm",children:[new Date(t.startTime).toLocaleDateString()," at ",new Date(t.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-audafact-alert-red text-audafact-text-primary rounded-full",children:"Performance"})]}),e.jsxs("p",{className:"text-xs audafact-text-secondary",children:["Duration: ",Math.floor(t.duration/6e4),":",(t.duration%6e4/1e3).toFixed(0).padStart(2,"0")]}),e.jsxs("p",{className:"text-xs audafact-text-secondary",children:[t.events.length," events • ",t.tracks.length," tracks",t.audioBlob&&" • Audio recorded"]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[t.audioBlob&&e.jsx("button",{onClick:()=>{try{const e=URL.createObjectURL(t.audioBlob),a=new Audio(e);a.onerror=e=>{alert("Failed to play audio. The format may not be supported.")},a.onloadeddata=()=>{},a.play().catch(e=>{alert("Failed to play audio. Please check browser audio permissions.")})}catch(e){alert("Failed to setup audio playback.")}},className:"p-1 text-audafact-text-secondary hover:text-audafact-accent-green hover:bg-audafact-surface-2 rounded transition-colors duration-200",title:"Play Audio",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 3l14 9-14 9V3z"})})}),N("download")&&e.jsx("button",{onClick:async()=>{await j("download")?b(t.id):Z({show:!0,message:k("download"),feature:"Download"})},className:"p-1 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded transition-colors duration-200",title:"Export Performance",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("button",{onClick:async()=>await y(t.id),className:"p-1 text-audafact-text-secondary hover:text-audafact-alert-red hover:bg-audafact-surface-2 rounded transition-colors duration-200",title:"Delete Performance",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},t.id))})]})})]})]})]}),e.jsx("input",{ref:ee,type:"file",accept:"audio/*",onChange:async e=>{const t=e.target.files?.[0];if(!t)return;if(!w)return i("upload"),void(ee.current&&(ee.current.value=""));if(!(await j("upload")))return Z({show:!0,message:k("upload"),feature:"Track Upload"}),void(ee.current&&(ee.current.value=""));try{const e=await W.uploadAudioFile(t,w.id,t.name);if(e.error)throw e.error;if(e.data){const a=await u.createUpload({user_id:w.id,file_url:e.data.name,title:t.name,duration:await ne(t)});if(a){const n={id:a.id,name:t.name,file:t,type:t.type,size:`${(t.size/1048576).toFixed(1)}MB`,url:e.data.name,uploadedAt:Date.now()},o=[...V,n];Y(o),s(t,"preview"),window.innerWidth<1024&&r()}}}catch(a){}ee.current&&(ee.current.value="")},className:"hidden"}),X.show&&e.jsx(T,{message:X.message,feature:X.feature,onClose:()=>Z({show:!1,message:"",feature:""})})]})},V=({className:t=""})=>e.jsx("div",{className:`demo-mode-indicator ${t}`,children:"Demo Mode"}),Y=({isOpen:t,onClose:r,onComplete:s,steps:n,currentStep:o,onStepChange:i})=>{const[c,d]=a.useState(null),l=a.useRef(null),u=a.useRef(null),[,m]=a.useState(0);a.useEffect(()=>{if(!t||o>=n.length)return;const e=n[o],a=()=>{if(e.action&&u.current!==e.id){u.current=e.id;try{e.action()}catch(l){}return void requestAnimationFrame(()=>setTimeout(a,50))}const t=(()=>{if("track-modes"===e.id){const e=Array.from(document.querySelectorAll('[data-testid="preview-mode-button"]'));if(e.length>0)return e}if("volume-controls"===e.id){const e=Array.from(document.querySelectorAll('[data-testid="volume-control"]'));if(e.length>0)return e}return Array.from(document.querySelectorAll(e.targetSelector))})(),r=window.innerWidth,s=window.innerHeight,n=r/2,o=s/2,i=t.map(e=>{const t=e.getBoundingClientRect(),a=window.getComputedStyle(e),i="none"!==a.display&&"hidden"!==a.visibility&&parseFloat(a.opacity||"1")>0,c=t.width>0&&t.height>0,d=t.top>=0&&t.left>=0&&t.bottom<=s&&t.right<=r,l=t.right>0&&t.bottom>0&&t.left<r&&t.top<s,u=i&&c&&(d||l),m=t.left+t.width/2,f=t.top+t.height/2;return{el:e,rect:t,visible:u,distanceToCenter:Math.hypot(m-n,f-o),fullyOnScreen:d}}).filter(e=>e.visible);let c;if(0===i.length)c=t[0];else if("volume-controls"===e.id){const e=i.sort((e,t)=>e.fullyOnScreen!==t.fullyOnScreen?e.fullyOnScreen?-1:1:e.rect.left-t.rect.left);c=e[0].el}else{const e=i.filter(e=>e.fullyOnScreen).sort((e,t)=>e.distanceToCenter-t.distanceToCenter);c=e.length>0?e[0].el:i.sort((e,t)=>e.distanceToCenter-t.distanceToCenter)[0].el}localStorage.getItem("audafact_debug_onboarding");if(c){d(c);try{c.scrollIntoView({behavior:"auto",block:"center",inline:"center"})}catch{c.scrollIntoView()}requestAnimationFrame(()=>d(c))}else d(null)};a();const r=setTimeout(a,150);return()=>clearTimeout(r)},[t,o]),a.useEffect(()=>{if(!t)return;const e=()=>m(e=>e+1);return window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[t]),a.useEffect(()=>{if(!t)return;const e=e=>{e.repeat||("Escape"===e.key?r():"ArrowRight"===e.key||" "===e.key?(e.preventDefault(),e.stopPropagation(),f()):"ArrowLeft"===e.key&&(e.preventDefault(),e.stopPropagation(),p()))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,o,n.length]);const f=a.useCallback(()=>{o<n.length-1?i(o+1):s()},[o,n.length,i,s]),p=a.useCallback(()=>{o>0&&i(o-1)},[o,i]);if(!t||o>=n.length)return null;const h=n[o],x=(o+1)/n.length*100,g=()=>"time-tempo-controls"===h.id?2:4;return e.jsxs("div",{className:"fixed inset-0 z-50",children:[c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute bg-black bg-opacity-50 backdrop-blur-sm",style:{top:0,left:0,right:0,height:c.getBoundingClientRect().top-4},onClick:h.required?void 0:f}),e.jsx("div",{className:"absolute bg-black bg-opacity-50 backdrop-blur-sm",style:{top:c.getBoundingClientRect().bottom+4,left:0,right:0,bottom:0},onClick:h.required?void 0:f}),e.jsx("div",{className:"absolute bg-black bg-opacity-50 backdrop-blur-sm",style:{top:c.getBoundingClientRect().top-4,left:0,width:c.getBoundingClientRect().left-4,height:c.getBoundingClientRect().height+8},onClick:h.required?void 0:f}),e.jsx("div",{className:"absolute bg-black bg-opacity-50 backdrop-blur-sm",style:{top:c.getBoundingClientRect().top-4,left:c.getBoundingClientRect().right+4,right:0,height:c.getBoundingClientRect().height+8},onClick:h.required?void 0:f})]}),!c&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:h.required?void 0:f}),c&&e.jsx("div",{className:"absolute border-2 border-audafact-accent-cyan rounded-lg shadow-lg transition-all duration-300 ease-in-out",style:{top:c.getBoundingClientRect().top-g(),left:c.getBoundingClientRect().left-g(),width:c.getBoundingClientRect().width+2*g(),height:c.getBoundingClientRect().height+2*g(),pointerEvents:"none",boxShadow:"0 0 0 4px rgba(6, 182, 212, 0.3), 0 0 20px rgba(6, 182, 212, 0.5)",opacity:c?1:0,zIndex:5}}),e.jsxs("div",{ref:l,className:"absolute bg-audafact-surface-1 border border-audafact-divider rounded-lg shadow-xl max-w-sm p-4 transition-all duration-300 ease-in-out",style:{...(()=>{if(!c)return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};const e=c.getBoundingClientRect(),t=window.innerWidth,a=window.innerHeight,r=250,s=40;let n=e.top+e.height/2,o=e.left+e.width/2,i="translate(-50%, -50%)";switch(h.position){case"top":n=e.top-20,o=e.left+e.width/2,i="translateX(-50%)",n<165&&(n=e.bottom+20);break;case"bottom":const c="volume-controls"===h.id?120:60;n=e.bottom+c,o=e.left+e.width/2,i="translateX(-50%)",n>a-r-s&&(n=e.top-c);break;case"left":n=e.top+e.height/2,o=e.left-20,i="translateY(-50%)",o<200&&(o=e.right+20);break;case"right":n=e.top+e.height/2,o=e.right+20,i="translateY(-50%)",o>t-160-s&&(o=e.left-20);break;default:n=a/2,o=t/2,i="translate(-50%, -50%)"}const d=t-160-s,l=a-125-s;o=Math.max(200,Math.min(d,o));const u=Math.min(l,a-r-80);if(n=Math.max(165,Math.min(u,n)),"volume-controls"===h.id&&c){n=c.getBoundingClientRect().top-r-40}else if(n>a-r-50&&c){const e=c.getBoundingClientRect().top-r-20;e>s&&e<n&&(n=e)}return{top:`${n}px`,left:`${o}px`,transform:i}})(),zIndex:60},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-xs text-audafact-text-secondary",children:["Step ",o+1," of ",n.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{r()},className:"text-xs text-audafact-text-secondary hover:text-audafact-text-primary transition-colors",children:"Skip"}),e.jsx("button",{onClick:r,className:"text-xs text-audafact-text-secondary hover:text-audafact-text-primary transition-colors",children:"✕"})]})]}),e.jsx("div",{className:"w-full bg-audafact-surface-2 rounded-full h-1 mb-3",children:e.jsx("div",{className:"bg-audafact-accent-cyan h-1 rounded-full transition-all duration-300",style:{width:`${x}%`}})}),e.jsx("h3",{className:"font-medium text-audafact-text-primary mb-2",children:h.title}),e.jsx("p",{className:"text-sm text-audafact-text-secondary mb-4",children:h.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:p,disabled:0===o,className:"px-3 py-1 text-xs rounded transition-colors "+(0===o?"text-audafact-text-secondary cursor-not-allowed":"text-audafact-accent-cyan hover:bg-audafact-surface-2"),children:"← Previous"}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-audafact-text-secondary",children:e.jsx("span",{children:"Use arrow keys or click to navigate"})}),e.jsx("button",{onClick:f,className:"px-3 py-1 text-xs bg-audafact-accent-cyan text-audafact-bg-primary rounded hover:bg-opacity-90 transition-colors",children:o===n.length-1?"Finish":"Next →"})]})]})]})},X=({onStartTutorial:t,onShowHelp:r,className:s=""})=>{const[n,o]=a.useState(!1);return e.jsxs("div",{className:`fixed bottom-6 right-6 z-40 ${s}`,children:[n&&e.jsxs("div",{className:"absolute bottom-16 right-0 bg-audafact-surface-1 border border-audafact-divider rounded-lg shadow-xl p-2 min-w-48",children:[e.jsxs("button",{onClick:()=>{o(!1),t()},className:"w-full text-left px-3 py-2 text-sm text-audafact-text-primary hover:bg-audafact-surface-2 rounded transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Start Tutorial"]}),e.jsxs("button",{onClick:()=>{o(!1),r()},className:"w-full text-left px-3 py-2 text-sm text-audafact-text-primary hover:bg-audafact-surface-2 rounded transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Help & Tips"]}),e.jsx("div",{className:"border-t border-audafact-divider my-1"}),e.jsx("div",{className:"px-3 py-1 text-xs text-audafact-text-secondary",children:"Press ? for keyboard shortcuts"})]}),e.jsx("button",{onClick:()=>{o(!n)},className:"bg-audafact-accent-cyan text-audafact-bg-primary w-12 h-12 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center hover:scale-105",title:"Help & Tutorial",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})},Z=({isOpen:t,onClose:a})=>{if(!t)return null;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative bg-audafact-surface-1 border border-audafact-divider rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-audafact-divider",children:[e.jsx("h2",{className:"text-xl font-medium text-audafact-text-primary",children:"Help & Tips"}),e.jsx("button",{onClick:a,className:"text-audafact-text-secondary hover:text-audafact-text-primary transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-audafact-text-primary mb-3",children:"Keyboard Shortcuts"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[{key:"Space",description:"Play/Pause current track"},{key:"Left/Right Arrow",description:"Navigate between tracks"},{key:"1-0",description:"Trigger cue points (in Chop mode)"},{key:"Escape",description:"Close modals and dialogs"},{key:"?",description:"Show this help modal"},{key:"Z",description:"Zoom in on waveform"},{key:"X",description:"Zoom out on waveform"},{key:"C",description:"Reset zoom level"}].map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-audafact-surface-2 rounded",children:[e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-audafact-bg-primary border border-audafact-divider rounded",children:t.key}),e.jsx("span",{className:"text-sm text-audafact-text-secondary",children:t.description})]},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-audafact-text-primary mb-3",children:"Pro Tips"}),e.jsx("ul",{className:"space-y-2",children:["Click anywhere on the waveform to jump to that position","Drag on the waveform to set loop start and end points","Use the side panel to browse and preview tracks from your library","Switch between Preview, Loop, and Chop modes for different workflows","Adjust tempo and time signature to match different tracks","Use filters to shape your sound and create effects","Record your performances to capture your creative process","Save your sessions to return to them later"].map((t,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-audafact-text-secondary",children:[e.jsx("span",{className:"text-audafact-accent-cyan mt-0.5",children:"•"}),t]},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-audafact-text-primary mb-3",children:"Track Modes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-audafact-surface-2 rounded",children:[e.jsx("h4",{className:"font-medium text-audafact-accent-blue mb-1",children:"Preview Mode"}),e.jsx("p",{className:"text-sm text-audafact-text-secondary",children:"Play the full track from start to finish. Perfect for listening and getting familiar with the material."})]}),e.jsxs("div",{className:"p-3 bg-audafact-surface-2 rounded",children:[e.jsx("h4",{className:"font-medium text-audafact-accent-cyan mb-1",children:"Loop Mode"}),e.jsx("p",{className:"text-sm text-audafact-text-secondary",children:"Create repeating sections by setting custom start and end points. Great for practicing and building arrangements."})]}),e.jsxs("div",{className:"p-3 bg-audafact-surface-2 rounded",children:[e.jsx("h4",{className:"font-medium text-audafact-alert-red mb-1",children:"Chop Mode"}),e.jsx("p",{className:"text-sm text-audafact-text-secondary",children:"Trigger specific points in the track using keyboard shortcuts. Ideal for live performances and remixing."})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-audafact-text-primary mb-3",children:"Getting Started"}),e.jsxs("div",{className:"space-y-2 text-sm text-audafact-text-secondary",children:[e.jsxs("p",{children:["1. ",e.jsx("strong",{children:"Load a track"})," - Use the navigation arrows or browse the library"]}),e.jsxs("p",{children:["2. ",e.jsx("strong",{children:"Play and explore"})," - Try different playback modes and controls"]}),e.jsxs("p",{children:["3. ",e.jsx("strong",{children:"Set up loops"})," - Switch to Loop mode and drag on the waveform"]}),e.jsxs("p",{children:["4. ",e.jsx("strong",{children:"Trigger cues"})," - Use Chop mode and press 1-0 keys"]}),e.jsxs("p",{children:["5. ",e.jsx("strong",{children:"Experiment"})," - Adjust tempo, filters, and effects"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-audafact-divider",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-sm bg-audafact-surface-2 text-audafact-text-primary rounded hover:bg-audafact-surface-3 transition-colors",children:"Close"}),e.jsx("div",{className:"text-xs text-audafact-text-secondary",children:"Need more help? Contact support at help@audafact.com"})]})]})]})},G=[{id:"ron-drums",name:"RON Drums",file:"/src/assets/audio/RON-drums.wav",type:"wav",size:"5.5MB"},{id:"secrets-of-the-heart",name:"Secrets of the Heart",file:"/src/assets/audio/Secrets of the Heart.mp3",type:"mp3",size:"775KB"},{id:"rhythm-revealed",name:"The Rhythm Revealed (Drums)",file:"/src/assets/audio/The Rhythm Revealed(Drums).wav",type:"wav",size:"5.5MB"},{id:"unveiled-desires",name:"Unveiled Desires",file:"/src/assets/audio/Unveiled Desires.wav",type:"wav",size:"6.0MB"}],K=()=>{const{audioContext:t,initializeAudio:r,resumeAudioContext:s}=m(),{isOpen:i,toggleSidePanel:d}=f(),{addRecordingEvent:u,saveCurrentState:g,isRecordingPerformance:b,getRecordingDestination:v}=c(),{user:y,loading:w}=n(),{isDemoMode:j,currentDemoTrack:k,loadRandomDemoTrack:N,isLoading:L,trackDemoEvent:M}=p(),{modalState:P,closeSignupModal:R}=h(),{canPerformAction:D,getUpgradeMessage:z}=S(),{tier:A}=o(),[F,B]=a.useState([]),[W,q]=a.useState(!1),[K,J]=a.useState(!1),[Q,ee]=a.useState(null),[te,ae]=a.useState(!1),[re,se]=a.useState(G),ne={onPlayTrack:()=>{F.length>0&&F[0]},onNextTrack:()=>{Bt()},onPreviousTrack:()=>{_t()},onToggleSidePanel:()=>{d()},onSwitchToLoopMode:()=>{F.length>0&&Wt(F[0].id,"loop")},onSwitchToCueMode:()=>{F.length>0&&Wt(F[0].id,"cue")},onToggleControls:()=>{F.length>0&&aa(F[0].id)},onAdjustVolume:()=>{},onSetLoopPoints:()=>{},onTriggerCue:()=>{}},oe=[{id:"welcome",title:"Welcome to Audafact Studio!",description:"Let's take a quick tour of your music production workspace. You can skip this anytime and explore freely.",targetSelector:'[data-testid="main-track-card"]',position:"center",required:!1},{id:"track-navigation",title:"Track Navigation",description:"Use these arrow buttons to navigate between different tracks. You can also swipe left/right on mobile or use keyboard arrows.",targetSelector:'[data-testid="previous-track-button"], [data-testid="next-track-button"]',position:"bottom"},{id:"playback-controls",title:"Playback Controls",description:"Here you can play, pause, and control the current track. Try playing the track to hear it!",targetSelector:'[data-testid="play-button"], button[title*="Play"], button[title*="Pause"]',position:"center",action:(ie=ne).onPlayTrack},{id:"track-modes",title:"Track Modes",description:"Switch between different playback modes: Preview (full track), Loop (repeat a section), and Chop (trigger specific points).",targetSelector:'[data-testid="preview-mode-button"], [data-testid="loop-mode-button"], [data-testid="chop-mode-button"]',position:"bottom"},{id:"loop-mode",title:"Loop Mode",description:"Switch to Loop mode to create repeating sections. You can set custom start and end points on the waveform.",targetSelector:'[data-testid="loop-mode-button"]',position:"bottom",action:ie.onSwitchToLoopMode},{id:"loop-points",title:"Setting Loop Points",description:"Click and drag on the waveform to set your loop start and end points. The highlighted section will repeat continuously.",targetSelector:".audafact-waveform-bg",position:"top",action:ie.onSetLoopPoints},{id:"cue-mode",title:"Chop Mode",description:"Switch to Chop mode to trigger specific points in the track. Perfect for live performances and remixing.",targetSelector:'[data-testid="chop-mode-button"]',position:"bottom",action:ie.onSwitchToCueMode},{id:"cue-triggering",title:"Triggering Cues",description:"In Chop mode, press keys 1-0 to trigger different cue points. Each number corresponds to a specific position in the track.",targetSelector:".audafact-waveform-bg",position:"top",action:ie.onTriggerCue},{id:"volume-controls",title:"Volume & Effects",description:"Adjust the volume, playback speed, and apply filters to shape your sound. Try the low-pass and high-pass filters for different effects.",targetSelector:'[data-testid="volume-control"], input[type="range"]',position:"bottom",action:ie.onAdjustVolume},{id:"time-tempo-controls",title:"Time & Tempo",description:"Expand this section to adjust tempo and time signature. Great for matching different tracks and setting the musical grid.",targetSelector:'[data-testid="time-tempo-controls-button"]',position:"bottom"},{id:"side-panel",title:"Track Library",description:"Open the side panel to browse your track library. You can preview tracks and add them to your studio.",targetSelector:'[data-testid="side-panel-toggle"]',position:"left"},{id:"waveform-interaction",title:"Waveform Interaction",description:"Click anywhere on the waveform to jump to that position. Use the zoom controls to get a closer look at specific sections.",targetSelector:".audafact-waveform-bg",position:"top"},{id:"measures-grid",title:"Measures & Grid",description:"Toggle the measures display to see musical grid lines. This helps with timing and beat matching.",targetSelector:'[data-testid="measures-button"]',position:"bottom"},{id:"completion",title:"You're All Set!",description:"You now know the basics of Audafact Studio. Feel free to explore and experiment with different tracks and features. Happy creating!",targetSelector:'[data-testid="main-track-card"]',position:"center",required:!1}];var ie;(e=>{e.onPlayTrack,e.onToggleSidePanel})(ne);const ce=!y&&!w,de=((e,t=!1)=>{const[r,s]=a.useState({isOpen:!1,currentStep:0,hasCompleted:!1,hasBeenShown:!1});a.useEffect(()=>{try{const e=localStorage.getItem(C);if(e){const t=JSON.parse(e);s(e=>({...e,hasCompleted:t.hasCompleted||!1,hasBeenShown:t.hasBeenShown||!1}))}}catch(Q){}},[]);const n=a.useCallback(e=>{try{const t=localStorage.getItem(C),a={...t?JSON.parse(t):{},...e};localStorage.setItem(C,JSON.stringify(a))}catch(Q){}},[]),o=a.useCallback(()=>{s(e=>({...e,isOpen:!0,currentStep:0,hasBeenShown:!0})),n({hasBeenShown:!0})},[n]),i=a.useCallback(()=>{s(e=>({...e,isOpen:!1}))},[]),c=a.useCallback(()=>{s(e=>({...e,isOpen:!1,hasCompleted:!0})),n({hasCompleted:!0})},[n]),d=a.useCallback(t=>{s(a=>({...a,currentStep:Math.max(0,Math.min(t,e.length-1))}))},[e.length]),l=a.useCallback(()=>{s({isOpen:!1,currentStep:0,hasCompleted:!1,hasBeenShown:!1}),localStorage.removeItem(C)},[]),u=a.useCallback(()=>t?!r.hasCompleted:!r.hasCompleted&&!r.hasBeenShown,[r.hasCompleted,r.hasBeenShown,t]);return{...r,startOnboarding:o,closeOnboarding:i,completeOnboarding:c,setCurrentStep:d,resetOnboarding:l,shouldShowOnboarding:u,totalSteps:e.length}})(oe,ce),[le,ue]=a.useState(!1),[me,fe]=a.useState(!1),[pe,he]=a.useState(!1),[xe,ge]=a.useState(0),[be,ve]=a.useState(0);a.useState(null);const[ye,we]=a.useState(null),[je,ke]=a.useState({}),[Ne,Se]=a.useState({}),[Ce,Te]=a.useState({}),[Le,Ee]=a.useState({}),[Me,Pe]=a.useState(1),Re=a.useRef(Me);a.useEffect(()=>{Re.current=Me},[Me]);const[De,ze]=a.useState({}),[Ae,Fe]=a.useState({}),[Be,_e]=a.useState({}),[Ie,Ue]=a.useState({}),Oe=a.useRef({}),$e=a.useCallback(e=>(Oe.current[e]||(Oe.current[e]={current:null}),Oe.current[e]),[]),[We,qe]=a.useState({}),[He,Ve]=a.useState({}),[Ye,Xe]=a.useState({}),[Ze,Ge]=a.useState(0),[Ke,Je]=a.useState(null),[Qe,et]=a.useState(null),[tt,at]=a.useState(null),[rt,st]=a.useState(null),[nt,ot]=a.useState(!1),[it,ct]=a.useState(!1),[dt,lt]=a.useState(!1),[ut,mt]=a.useState(!1),[ft,pt]=a.useState(!1),[ht,xt]=a.useState(0),[gt,bt]=a.useState(!1),vt=a.useRef(""),[yt,wt]=a.useState(!1),[jt,kt]=a.useState(!1),[Nt,St]=a.useState(null),[Ct,Tt]=a.useState(null),[Lt,Et]=a.useState({show:!1,message:"",feature:""}),Mt=(e,t)=>{localStorage.setItem(`cuePoints-${e}`,JSON.stringify(t))},Pt=(e,t)=>{localStorage.setItem(`trackSettings-${e}`,JSON.stringify(t))},Rt=e=>{const t=localStorage.getItem(`trackSettings-${e}`);return t?JSON.parse(t):null};a.useEffect(()=>{const e=localStorage.getItem("selectedCueTrackId");e&&we(e)},[]),a.useEffect(()=>{if(0===F.length)return void mt(!1);const e=F[0],t=e&&"preview"===e.mode;mt(!t)},[F]),a.useEffect(()=>{let e=!1;return(async()=>{try{if(j)return;const t=await l.getLibraryTracks(A.id);if(e)return;if(t&&t.length>0){const e=t.map(e=>({id:e.id,name:e.name,file:e.file,type:e.type,size:e.size}));se(e)}else se(G)}catch(E){e||se(G)}})(),()=>{e=!0}},[A.id,j]),a.useEffect(()=>{if(0===F.length&&!pe&&!yt){if(j&&!k)return;(async()=>{try{let s;if(wt(!0),ee(null),j&&k)s={id:k.id,name:k.name,file:k.file,type:k.type};else{const e=re&&re.length>0?re:G,t=Math.floor(Math.random()*e.length);s=e[t]}let n=t;if(n){if("suspended"===n.state)try{await n.resume()}catch(e){return ue(!0),void wt(!1)}}else try{n=await r(),ae(!0)}catch(a){return ue(!0),void wt(!1)}if(!n)return ue(!0),void wt(!1);const o=await fetch(s.file),i=await o.blob(),c=new File([i],`${s.name}.${s.type}`,{type:`audio/${s.type}`}),d=await $t(c,n),l=s.id,u=Rt(l)||{},m={id:l,file:c,buffer:d,mode:j?"preview":u.mode||"preview",loopStart:u.loopStart||0,loopEnd:u.loopEnd||d.duration,cuePoints:u.cuePoints||Array.from({length:10},(e,t)=>d.duration*(t/10)),tempo:u.tempo||120,timeSignature:u.timeSignature||{numerator:4,denominator:4},firstMeasureTime:u.firstMeasureTime||0,showMeasures:u.showMeasures||!1};if(B([m]),j)Ge(0);else{const e=(re&&re.length>0?re:G).findIndex(e=>e.id===s.id);Ge(Math.max(0,e))}ze(e=>({...e,[l]:!!u.showMeasures})),Fe(e=>({...e,[l]:!!u.showCueThumbs})),Se(e=>({...e,[l]:u.zoomLevel||1})),Te(e=>({...e,[l]:1}));const f="preview"===m.mode?Re.current:"number"==typeof u.volume?u.volume:Re.current;Ee(e=>({...e,[l]:f})),Ue(e=>({...e,[l]:!1})),j&&M("session_started",{trackId:s.id,timestamp:Date.now()}),ce&&de.shouldShowOnboarding()&&setTimeout(()=>{de.startOnboarding()},1e3),wt(!1)}catch(s){const e=s instanceof Error?s.message:"An unknown error occurred";ee(`Error loading track: ${e}`),wt(!1)}})()}},[t,r,F.length,pe,j,k,de,re,yt]),a.useEffect(()=>{const e=e=>{if("?"===e.key)return e.preventDefault(),void J(!0);if(F.length>0){const t=F[0].id;if("z"===e.key||"Z"===e.key)return e.preventDefault(),void Vt(t);if("x"===e.key||"X"===e.key)return e.preventDefault(),void Yt(t);if("c"===e.key||"C"===e.key)return e.preventDefault(),void Xt(t)}"ArrowLeft"===e.key?(e.preventDefault(),_t()):"ArrowRight"===e.key&&(e.preventDefault(),Bt())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[F,Ze]),a.useEffect(()=>{if(j&&k&&t&&F.length>0){if(F[0]?.id===k.id)return;const e=async()=>{try{const e=await fetch(k.file),a=await e.blob(),r=new File([a],`${k.name}.${k.type}`,{type:`audio/${k.type}`}),s=await $t(r,t),n=k.id,o=Rt(n)||{},i={id:n,file:r,buffer:s,mode:j?"preview":o.mode||"preview",loopStart:o.loopStart||0,loopEnd:o.loopEnd||s.duration,cuePoints:o.cuePoints||Array.from({length:10},(e,t)=>s.duration*(t/10)),tempo:o.tempo||120,timeSignature:o.timeSignature||{numerator:4,denominator:4},firstMeasureTime:o.firstMeasureTime||0,showMeasures:o.showMeasures||!1};B([i]),ze(e=>({...e,[n]:!!o.showMeasures})),Fe(e=>({...e,[n]:!!o.showCueThumbs})),Se(e=>({...e,[n]:o.zoomLevel||1})),Te(e=>({...e,[n]:1}));const c="preview"===i.mode?Re.current:"number"==typeof o.volume?o.volume:Re.current;Ee(e=>({...e,[n]:c})),Ue(e=>({...e,[n]:!1})),M("next_track",{fromTrackId:F[0]?.id,toTrackId:n}),Ge(0)}catch(e){}};e()}},[j,k,t,F.length,M]);const Dt=e=>{if(yt||nt)return;if(null!==Ke)return;const t=e.target;if(null!==t.closest(".audafact-waveform-bg"))return;const a=null!==t.closest(".audafact-card.p-4.space-y-4"),r=null!==t.closest(".p-4.border-b.bg-audafact-surface-2");if(a||r)return;null!==t.closest(".flex.items-center.justify-between.bg-audafact-surface-2.border-b.border-audafact-divider.py-1.px-2")&&(e.preventDefault(),e.stopPropagation(),Je(e.targetTouches[0].clientX),et(e.targetTouches[0].clientY))},zt=e=>{if(yt||nt)return;if(null===Ke||null===Qe)return;const t=e.target;if(null!==t.closest(".audafact-waveform-bg"))return;const a=null!==t.closest(".audafact-card.p-4.space-y-4"),r=null!==t.closest(".p-4.border-b.bg-audafact-surface-2");if(a||r)return;if(!(null!==t.closest(".flex.items-center.justify-between.bg-audafact-surface-2.border-b.border-audafact-divider.py-1.px-2")))return;const s=e.targetTouches[0].clientX,n=e.targetTouches[0].clientY;at(s),st(n);const o=Math.abs(Ke-s),i=Math.abs(Qe-n),c=i>50&&i>2*o&&Qe-n<0&&o<50;o>20&&o>i&&e.preventDefault(),c&&ut&&!it&&!j?(pt(!0),e.preventDefault()):pt(!1)},At=e=>{if(yt||nt)return;if(null===Ke||null===tt||null===Qe||null===rt)return;e.preventDefault(),e.stopPropagation();const t=e.target;if(null!==t.closest(".audafact-waveform-bg"))return;const a=null!==t.closest(".audafact-card.p-4.space-y-4"),r=null!==t.closest(".p-4.border-b.bg-audafact-surface-2");if(a||r)return;if(!(null!==t.closest(".flex.items-center.justify-between.bg-audafact-surface-2.border-b.border-audafact-divider.py-1.px-2")))return;e.preventDefault();const s=Ke-tt,n=Qe-rt,o=Math.abs(s),i=Math.abs(n),c=o>120&&o>4*i&&i<40,d=i>100&&i>3*o&&o<50;if(gt)return Je(null),at(null),et(null),st(null),void pt(!1);const l=Date.now();if(l-ht<800)return Je(null),at(null),et(null),st(null),void pt(!1);if(c){const e=`${s>0?"swipe-left":"swipe-right"}-${l}`;if(vt.current===e)return;xt(l),bt(!0),vt.current=e,s>0?Bt():_t(),setTimeout(()=>{bt(!1),vt.current=""},1e3)}else if(d&&n<0&&ut&&!it&&!j){const e=`swipe-down-${l}`;if(vt.current===e)return;xt(l),bt(!0),vt.current=e,Ut(),setTimeout(()=>{bt(!1),vt.current=""},1e3)}Je(null),at(null),et(null),st(null),pt(!1)},Ft=e=>{if(yt||nt)return;if(gt)return void e.preventDefault();const t=Date.now();if(t-ht<800)return void e.preventDefault();const a=e.target;if(null!==a.closest(".audafact-waveform-bg"))return;const r=null!==a.closest(".p-4.relative.z-10.bg-audafact-surface-1"),s=null!==a.closest(".p-4.border-b.bg-audafact-surface-2");if(r||s)return;if(!(null!==a.closest(".flex.items-center.justify-between.bg-audafact-surface-2.border-b.border-audafact-divider")))return;const n=Math.abs(e.deltaX),o=Math.abs(e.deltaY),i=o>n&&o>10&&n<25;n>o&&n>10?(e.preventDefault(),xt(t),bt(!0),e.deltaX>0?Bt():e.deltaX<0&&_t(),setTimeout(()=>bt(!1),1e3)):i&&e.deltaY<0&&ut&&!it&&!j&&(e.preventDefault(),xt(t),bt(!0),Ut(),setTimeout(()=>bt(!1),1e3))},Bt=a.useCallback(async()=>{if(!yt&&!L&&0!==F.length)if(j)N();else{const e=re&&re.length>0?re:G,t=(Ze+1)%e.length;await It(t,!0)}},[F.length,Ze,yt,L,j,N,re]),_t=a.useCallback(async()=>{if(!yt&&!L&&0!==F.length)if(j)N();else{const e=re&&re.length>0?re:G,t=0===Ze?e.length-1:Ze-1;await It(t,!0)}},[F.length,Ze,yt,L,j,N,re]),It=async(e,a=!1)=>{try{wt(!0),ee(null);const o=re&&re.length>0?re:G,i=(e%o.length+o.length)%o.length,c=o[i];let d=t;if(d){if("suspended"===d.state)try{await d.resume()}catch(s){throw new Error("Browser blocked audio playback. Please try again.")}}else try{d=await r(),ae(!0)}catch(n){throw new Error("Unable to initialize audio. Please try again or check your browser settings.")}if(!d)throw new Error("Audio initialization failed. Please try again.");const l=await fetch(c.file),u=await l.blob(),m=new File([u],`${c.name}.${c.type}`,{type:`audio/${c.type}`}),f=await $t(m,d);let p;p=a&&F.length>0?F[0].id:c.id;const h=Rt(p)||{},x={id:p,file:m,buffer:f,mode:h.mode||"preview",loopStart:h.loopStart||0,loopEnd:h.loopEnd||f.duration,cuePoints:h.cuePoints||Array.from({length:10},(e,t)=>f.duration*(t/10)),tempo:h.tempo||120,timeSignature:h.timeSignature||{numerator:4,denominator:4},firstMeasureTime:h.firstMeasureTime||0,showMeasures:h.showMeasures||!1};a&&F.length>0?B(e=>{const t=[...e];return t[0]={...t[0],...x,id:t[0].id},t}):B([x]),Ge(i),ze(e=>({...e,[p]:!!h.showMeasures})),Fe(e=>({...e,[p]:!!h.showCueThumbs})),Se(e=>({...e,[p]:h.zoomLevel||1})),Te(e=>({...e,[p]:1}));const g="preview"===x.mode?Re.current:"number"==typeof h.volume?h.volume:Re.current;Ee(e=>({...e,[p]:g})),Ue(e=>({...e,[p]:!1})),de.shouldShowOnboarding()&&setTimeout(()=>{de.startOnboarding()},1e3),wt(!1)}catch(o){const e=o instanceof Error?o.message:"An unknown error occurred";ee(`Error loading track: ${e}`),wt(!1)}},Ut=async()=>{if(ut&&!it)try{ct(!0),lt(!0),ee(null);const e=re&&re.length>0?re:G,a=F.map(e=>e.id),s=e.filter(e=>!a.includes(e.id));let n;n=s.length>0?s[Math.floor(Math.random()*s.length)]:e[Math.floor(Math.random()*e.length)];let o=t;if(o?"suspended"===o.state&&await o.resume():(o=await r(),ae(!0)),!o)throw new Error("Audio initialization failed. Please try again.");const i=await fetch(n.file),c=await i.blob(),d=new File([c],`${n.name}.${n.type}`,{type:`audio/${n.type}`}),l=await $t(d,o),u=Date.now(),m=`${n.id}-${u}`,f={id:m,file:d,buffer:l,mode:"preview",loopStart:0,loopEnd:l.duration,cuePoints:Array.from({length:10},(e,t)=>l.duration*(t/10)),tempo:120,timeSignature:{numerator:4,denominator:4},firstMeasureTime:0,showMeasures:!1},p=F.map(e=>"preview"===e.mode?{...e,mode:"loop"}:e);B([f,...p]),ze(e=>({...e,[m]:!1})),Fe(e=>({...e,[m]:!1})),Se(e=>({...e,[m]:1})),Te(e=>({...e,[m]:1})),Ee(e=>({...e,[m]:Re.current})),Ue(e=>({...e,[m]:!1})),setTimeout(()=>{lt(!1),ct(!1)},500)}catch(e){const t=e instanceof Error?e.message:"An unknown error occurred";ee(`Error adding track: ${t}`),ct(!1),lt(!1)}},Ot=e=>{if(F.length<=1)return;const t=F.find(t=>t.id===e);t&&"preview"!==t.mode&&(B(t=>{const a=t.filter(t=>t.id!==e);return a.length>0&&t[0],a}),ze(t=>{const{[e]:a,...r}=t;return r}),Fe(t=>{const{[e]:a,...r}=t;return r}),Se(t=>{const{[e]:a,...r}=t;return r}),Te(t=>{const{[e]:a,...r}=t;return r}),Ee(t=>{const{[e]:a,...r}=t;return r}),Ue(t=>{const{[e]:a,...r}=t;return r}),ye===e&&we(null),(e=>{localStorage.removeItem(`trackSettings-${e}`)})(e),(e=>{localStorage.removeItem(`cuePoints-${e}`)})(e))};a.useEffect(()=>{F.forEach(e=>{if(!e)return;const t={mode:e.mode,loopStart:e.loopStart,loopEnd:e.loopEnd,tempo:e.tempo,timeSignature:e.timeSignature,firstMeasureTime:e.firstMeasureTime,showMeasures:De[e.id]||!1,showCueThumbs:Ae[e.id]||!1,zoomLevel:Ne[e.id]||1,playbackSpeed:Ce[e.id]||1};"preview"!==e.mode&&(t.volume=Le[e.id]||1),Pt(e.id,t)})},[F,De,Ae,Ne,Ce,Le]),a.useEffect(()=>{var e;(e=ye)?localStorage.setItem("selectedCueTrackId",e):localStorage.removeItem("selectedCueTrackId")},[ye]);const $t=async(e,t)=>{if(!t)throw new Error("Audio context not initialized");return new Promise((a,r)=>{const s=new FileReader;s.onload=async e=>{try{if(!e.target)return void r(new Error("Failed to read file. Please try again."));const n=e.target.result;if(!n)return void r(new Error("Failed to read file. Please try again."));try{const e=await t.decodeAudioData(n);a(e)}catch(s){r(new Error("Unable to decode audio file. The file might be corrupted or in an unsupported format. Please try a different file."))}}catch(n){r(n)}},s.onerror=e=>{r(new Error("Error reading file. Please try again."))},s.readAsArrayBuffer(e)})},Wt=(e,t)=>{if(F){if("preview"===t){if(0!==F.findIndex(t=>t.id===e))return}B(a=>a.map(a=>{if(!a||a.id!==e)return a;if("cue"===t&&(!a.cuePoints||0===a.cuePoints.length)){const r=a.buffer?.duration||0,s=Array.from({length:10},(e,t)=>r*(t/10)),n=Rt(e)||{};return Pt(e,{...n,cuePoints:s}),Mt(e,s),{...a,mode:t,cuePoints:s}}return{...a,mode:t}})),"loop"===t?(ye===e&&we(null),Fe(t=>({...t,[e]:!1}))):"cue"===t?(Fe(t=>({...t,[e]:!0})),we(e)):"preview"===t&&(ye===e&&we(null),Fe(t=>({...t,[e]:!1})))}},qt=async e=>{try{te?"suspended"===t?.state&&await s():(await r(),ae(!0)),e()}catch(a){ee("Failed to initialize audio context. Please try again.")}},Ht=e=>{we(t=>t===e?null:e)},Vt=e=>{Se(t=>{const a=t[e]||1,r=Math.min(2*a,8);return{...t,[e]:r}})},Yt=e=>{Se(t=>{const a=t[e]||1,r=Math.max(a/2,1);return{...t,[e]:r}})},Xt=e=>{Se(t=>({...t,[e]:1}))},Zt=(e,t)=>{B(a=>a.map(a=>a.id===e?{...a,tempo:t}:a))},Gt=e=>{e.preventDefault(),e.stopPropagation();const t=e.target;if(i&&null!==t.closest("[data-sidepanel]"))return kt(!1),void Tt(null);const a=e.dataTransfer.types.includes("text/plain"),r=e.dataTransfer.types.includes("Files");(a||r)&&(e.dataTransfer.dropEffect="copy",kt(!0),r&&!Ct&&Tt({type:"file",name:"Audio file",id:`file-${Date.now()}`}))},Kt=e=>{e.preventDefault(),e.stopPropagation();const t=e.target;if(i&&null!==t.closest("[data-sidepanel]"))return kt(!1),void Tt(null);const a=e.dataTransfer.types.includes("text/plain")&&e.dataTransfer.types.includes("application/json"),r=e.dataTransfer.types.includes("Files");if(a||r){if(kt(!0),a)try{const t=e.dataTransfer.getData("application/json");if(t){const e=JSON.parse(t);Tt(e)}}catch(s){}r&&Tt({type:"file",name:"Audio file",id:`file-${Date.now()}`})}},Jt=e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.contains(e.relatedTarget)||(kt(!1),St(null),Tt(null))},Qt=async e=>{e.preventDefault(),e.stopPropagation();const t=e.target;if(i&&null!==t.closest("[data-sidepanel]"))return kt(!1),St(null),void Tt(null);kt(!1),St(null),Tt(null);try{if(e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];return["audio/wav","audio/mp3","audio/mpeg","audio/aac","audio/ogg","audio/flac"].includes(t.type)||t.name.toLowerCase().endsWith(".wav")||t.name.toLowerCase().endsWith(".mp3")||t.name.toLowerCase().endsWith(".m4a")||t.name.toLowerCase().endsWith(".aac")||t.name.toLowerCase().endsWith(".ogg")||t.name.toLowerCase().endsWith(".flac")?void(await ra(t,"preview")):void ee("Please drop a valid audio file (WAV, MP3, M4A, AAC, OGG, or FLAC)")}const t=e.dataTransfer.getData("text/plain");if(!t)return;const a=(re&&re.length>0?re:G).find(e=>e.id===t);if(a)return void(await sa(a,"preview"))}catch(a){ee("Failed to add dropped track. Please try again.")}},ea=e=>{ze(t=>({...t,[e]:!t[e]}))},ta=e=>{Fe(t=>({...t,[e]:!t[e]}))},aa=e=>{Ue(t=>({...t,[e]:!t[e]}))},ra=async(e,a="preview")=>{try{he(!0),q(!0),ee(null);let n=t;n?"suspended"===n.state&&await s():(n=await r(),ae(!0));const o=await $t(e,n),i={id:`track-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,file:e,buffer:o,mode:a,loopStart:0,loopEnd:o.duration,cuePoints:[],tempo:120,timeSignature:{numerator:4,denominator:4},firstMeasureTime:0,showMeasures:!1};B(e=>{const t=[i,...e];return"preview"===a&&e.length>0&&"preview"===e[0].mode&&(t[1]={...e[0],mode:"cue"}),t}),ke(e=>({...e,[i.id]:0})),Se(e=>({...e,[i.id]:1})),Te(e=>({...e,[i.id]:1})),Ee(e=>({...e,[i.id]:Re.current})),ze(e=>({...e,[i.id]:!1})),Fe(e=>({...e,[i.id]:!1})),_e(e=>({...e,[i.id]:!1})),Ue(e=>({...e,[i.id]:!1})),qe(e=>({...e,[i.id]:2e4})),Ve(e=>({...e,[i.id]:20})),Xe(e=>({...e,[i.id]:!1})),setTimeout(()=>{},500)}catch(n){ee(n instanceof Error?n.message:"Failed to upload track")}finally{q(!1),he(!1)}},sa=async(e,a="preview")=>{try{he(!0),q(!0),ee(null);let n=t;n?"suspended"===n.state&&await s():(n=await r(),ae(!0));const o=await fetch(e.file),i=await o.blob(),c=await n.decodeAudioData(await i.arrayBuffer()),d=new File([i],`${e.name}.${e.type}`,{type:`audio/${e.type}`}),l={id:`track-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,file:d,buffer:c,mode:a,loopStart:0,loopEnd:c.duration,cuePoints:[],tempo:120,timeSignature:{numerator:4,denominator:4},firstMeasureTime:0,showMeasures:!1};B(e=>{const t=[l,...e];return"preview"===a&&e.length>0&&"preview"===e[0].mode&&(t[1]={...e[0],mode:"cue"}),t}),ke(e=>({...e,[l.id]:0})),Se(e=>({...e,[l.id]:1})),Te(e=>({...e,[l.id]:1})),Ee(e=>({...e,[l.id]:Re.current})),ze(e=>({...e,[l.id]:!1})),Fe(e=>({...e,[l.id]:!1})),_e(e=>({...e,[l.id]:!1})),Ue(e=>({...e,[l.id]:!1})),qe(e=>({...e,[l.id]:2e4})),Ve(e=>({...e,[l.id]:20})),Xe(e=>({...e,[l.id]:!1})),setTimeout(()=>{},500)}catch(n){ee(n instanceof Error?n.message:"Failed to add track from library")}finally{q(!1),he(!1)}},na=async(e,a="preview")=>{if(e.file)try{he(!0),q(!0),ee(null);let n=t;n?"suspended"===n.state&&await s():(n=await r(),ae(!0));const o=await $t(e.file,n),i={id:`track-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,file:e.file,buffer:o,mode:a,loopStart:0,loopEnd:o.duration,cuePoints:[],tempo:120,timeSignature:{numerator:4,denominator:4},firstMeasureTime:0,showMeasures:!1};B(e=>{const t=[i,...e];return"preview"===a&&e.length>0&&"preview"===e[0].mode&&(t[1]={...e[0],mode:"cue"}),t}),ke(e=>({...e,[i.id]:0})),Se(e=>({...e,[i.id]:1})),Te(e=>({...e,[i.id]:1})),Ee(e=>({...e,[i.id]:Re.current})),ze(e=>({...e,[i.id]:!1})),Fe(e=>({...e,[i.id]:!1})),_e(e=>({...e,[i.id]:!1})),Ue(e=>({...e,[i.id]:!1})),qe(e=>({...e,[i.id]:2e4})),Ve(e=>({...e,[i.id]:20})),Xe(e=>({...e,[i.id]:!1})),setTimeout(()=>{},500)}catch(n){ee(n instanceof Error?n.message:"Failed to add user track")}finally{q(!1),he(!1)}else ee("File not available for this track")},oa=async()=>{try{ue(!1),fe(!0),ee(null);const e=await r();let t;if(ae(!0),j){if(!k)return void fe(!1);t={id:k.id,name:k.name,file:k.file,type:k.type}}else{const e=re&&re.length>0?re:G;t=e[Math.floor(Math.random()*e.length)]}const a=await fetch(t.file),s=await a.blob(),n=new File([s],`${t.name}.${t.type}`,{type:`audio/${t.type}`}),o=await $t(n,e),i=t.id,c=Rt(i)||{},d={id:i,file:n,buffer:o,mode:j?"preview":c.mode||"preview",loopStart:c.loopStart||0,loopEnd:c.loopEnd||o.duration,cuePoints:c.cuePoints||Array.from({length:10},(e,t)=>o.duration*(t/10)),tempo:c.tempo||120,timeSignature:c.timeSignature||{numerator:4,denominator:4},firstMeasureTime:c.firstMeasureTime||0,showMeasures:c.showMeasures||!1};B([d]),Ge(0),ze(e=>({...e,[i]:!!c.showMeasures})),Fe(e=>({...e,[i]:!!c.showCueThumbs})),Se(e=>({...e,[i]:c.zoomLevel||1})),Te(e=>({...e,[i]:1}));const l="preview"===d.mode?Re.current:"number"==typeof c.volume?c.volume:Re.current;Ee(e=>({...e,[i]:l})),Ue(e=>({...e,[i]:!1})),j&&M("session_started",{trackId:t.id,timestamp:Date.now()}),ce&&de.shouldShowOnboarding()&&setTimeout(()=>{de.startOnboarding()},1e3),fe(!1)}catch(e){ee("Failed to initialize audio. Please try again."),ue(!0),fe(!1)}};return W?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"audafact-card p-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-medium audafact-heading mb-4",children:"Loading Audafact Studio"}),e.jsx("p",{className:"audafact-text-secondary mb-8",children:"Loading audio track..."}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-audafact-accent-cyan"})})]})}):Q?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"bg-audafact-surface-1 border border-audafact-alert-red rounded-lg p-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-medium text-audafact-alert-red mb-4",children:"Error Loading Track"}),e.jsx("p",{className:"text-audafact-alert-red mb-8",children:Q}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-audafact-alert-red text-audafact-text-primary px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors",children:"Try Again"})]})}):le?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-auto p-4 lg:p-6 space-y-6 relative transition-all duration-300 ease-in-out "+((y||j)&&i?"lg:ml-[400px] lg:max-w-[calc(100vw-400px)] lg:bg-audafact-surface-2 lg:bg-opacity-30":"max-w-6xl"),children:e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"audafact-card p-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-medium audafact-heading mb-4",children:"Audio Context Required"}),e.jsx("p",{className:"audafact-text-secondary mb-6",children:"Your browser requires user interaction before allowing audio playback. Click the button below to initialize audio and load a random track."}),y?e.jsx("p",{className:"audafact-text-secondary mb-6",children:"You can also select a track from the side panel after audio is initialized."}):e.jsxs("p",{className:"audafact-text-secondary mb-6",children:[e.jsx("a",{href:"/auth",className:"text-audafact-accent-cyan hover:underline",children:"Login to Audafact"})," to access your library and select specific tracks."]}),e.jsx("button",{onClick:oa,className:"audafact-button-primary",disabled:me,children:me?"Initializing...":"Initialize Audio & Load Track"})]})})}),y&&e.jsx(H,{isOpen:i,onToggle:d,onUploadTrack:ra,onAddFromLibrary:sa,onAddUserTrack:na})]}):0===F.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto p-4 lg:p-6 space-y-6 relative transition-all duration-300 ease-in-out "+((y||j)&&i?"lg:ml-[400px] lg:max-w-[calc(100vw-400px)] lg:bg-audafact-surface-2 lg:bg-opacity-30":"max-w-6xl"),onDragOver:Gt,onDragEnter:Kt,onDragLeave:Jt,onDrop:Qt,children:[(y||j)&&!i&&jt&&e.jsx("div",{className:"fixed inset-0 z-40 bg-transparent",onDragOver:Gt,onDragEnter:Kt,onDragLeave:Jt,onDrop:Qt}),(y||j)&&jt&&i&&e.jsx("div",{className:"fixed inset-0 z-40 bg-transparent",onDragOver:Gt,onDragEnter:Kt,onDragLeave:Jt,onDrop:Qt}),jt&&e.jsx("div",{className:"fixed inset-0 z-50 pointer-events-none flex items-center justify-center",children:e.jsxs("div",{className:"bg-audafact-accent-cyan bg-opacity-90 text-audafact-bg-primary px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 animate-pulse",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-lg font-medium block",children:"file"===Ct?.type?"Drop audio file to add to studio":"Drop track to add to studio"}),Ct&&e.jsx("span",{className:"text-sm opacity-90 block mt-1",children:Ct.name})]})]})}),e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"relative overflow-hidden audafact-card p-12 text-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border border-slate-700/50 shadow-2xl",children:[e.jsxs("div",{className:"absolute inset-0 opacity-5",children:[e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 rounded-full border-8 border-slate-600"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 rounded-full border-4 border-slate-500"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 rounded-full bg-slate-400"})]}),e.jsx("div",{className:"absolute inset-0 opacity-10",children:[...Array(20)].map((t,a)=>e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 rounded-full border border-slate-500",style:{width:200+8*a+"px",height:200+8*a+"px",animation:`vinyl-spin ${20+.5*a}s linear infinite`,animationDelay:.1*a+"s"}},a))}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-audafact-accent-cyan to-audafact-accent-purple mb-4 shadow-lg",children:e.jsx("svg",{className:"w-10 h-10 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})})}),y?e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-audafact-accent-cyan via-audafact-accent-purple to-audafact-accent-cyan bg-clip-text text-transparent mb-6 tracking-tight",children:"Welcome Back to Audafact Studio"}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-lg text-slate-300 mb-6 leading-relaxed",children:"Start creating by:"}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mb-8 text-sm text-slate-400",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"🔄 Looping segments"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"🎯 Adjusting cue points"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"🎛️ Creating real-time remixes"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"📚 Adding tracks from your library"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"📤 Uploading new samples"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"🎙️ Recording your live performances"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:oa,className:"group relative inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-audafact-accent-cyan to-audafact-accent-purple text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",disabled:me,children:[e.jsx("span",{className:"relative z-10 flex items-center gap-2",children:me?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),"Load a Random Track"]})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-audafact-accent-purple to-audafact-accent-cyan rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200"})]}),e.jsx("button",{onClick:d,className:"group relative inline-flex items-center justify-center px-8 py-4 bg-slate-800 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 border border-slate-600 hover:border-slate-500",children:e.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),"Select from Your Library"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-audafact-accent-cyan via-audafact-accent-purple to-audafact-accent-cyan bg-clip-text text-transparent mb-6 tracking-tight",children:"Welcome to Audafact Studio"}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("p",{className:"text-lg text-slate-300 mb-6 leading-relaxed",children:"Explore the basics of Audafact in this interactive demo:"}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mb-8 text-sm text-slate-400",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"🎵 Preview curated tracks"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"🔄 Create loops from segments"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"🎯 Trigger cues for playback"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"⬅️➡️ Navigate with buttons/swipe"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50",children:"📚 Browse curated library"})]}),e.jsx("p",{className:"text-slate-300 mb-8 font-medium",children:"Ready for more? Sign up to unlock advanced tools and features."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:oa,className:"group relative inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-audafact-accent-cyan to-audafact-accent-purple text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",disabled:me,children:[e.jsx("span",{className:"relative z-10 flex items-center gap-2",children:me?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),"Load a Random Track"]})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-audafact-accent-purple to-audafact-accent-cyan rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200"})]}),e.jsx("button",{onClick:d,className:"group relative inline-flex items-center justify-center px-8 py-4 bg-slate-800 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 border border-slate-600 hover:border-slate-500",children:e.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),"Browse Curated Library"]})})]})]})]})]})})]}),e.jsx(H,{isOpen:i,onToggle:d,onUploadTrack:ra,onAddFromLibrary:sa,onAddUserTrack:na})]}):e.jsxs(e.Fragment,{children:[j&&e.jsx(V,{}),e.jsxs("div",{className:"mx-auto p-4 lg:p-6 space-y-6 relative transition-all duration-300 ease-in-out "+((y||j)&&i?"lg:ml-[400px] lg:max-w-[calc(100vw-400px)] lg:bg-audafact-surface-2 lg:bg-opacity-30":"max-w-6xl"),style:{overscrollBehaviorX:"none"},onDragOver:Gt,onDragEnter:Kt,onDragLeave:Jt,onDrop:Qt,children:[(y||j)&&!i&&jt&&e.jsx("div",{className:"fixed inset-0 z-40 bg-transparent",onDragOver:Gt,onDragEnter:Kt,onDragLeave:Jt,onDrop:Qt}),(y||j)&&jt&&i&&e.jsx("div",{className:"fixed inset-0 z-40 bg-transparent",onDragOver:Gt,onDragEnter:Kt,onDragLeave:Jt,onDrop:Qt}),ft&&e.jsx("div",{className:"fixed top-16 left-1/2 transform -translate-x-1/2 z-50 pointer-events-none",children:e.jsxs("div",{className:"bg-green-500 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2 animate-bounce",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-sm font-medium",children:"Release to add track"})]})}),jt&&e.jsx("div",{className:"fixed inset-0 z-50 pointer-events-none flex items-center justify-center",children:e.jsxs("div",{className:"bg-audafact-accent-cyan bg-opacity-90 text-audafact-bg-primary px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 animate-pulse",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-lg font-medium block",children:"file"===Ct?.type?"Drop audio file to add to studio":"Drop track to add to studio"}),Ct&&e.jsx("span",{className:"text-sm opacity-90 block mt-1",children:Ct.name})]})]})}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx($,{onSave:async()=>{if(!(await D("save_session")))return void Et({show:!0,message:z("save_session"),feature:"Session Save"});const e={tracks:F.map(e=>({id:e.id,name:e.file.name,mode:e.mode,loopStart:e.loopStart,loopEnd:e.loopEnd,cuePoints:e.cuePoints,tempo:e.tempo,timeSignature:e.timeSignature,firstMeasureTime:e.firstMeasureTime,showMeasures:De[e.id]||!1,showCueThumbs:Ae[e.id]||!1,zoomLevel:Ne[e.id]||1,playbackSpeed:Ce[e.id]||1,volume:Le[e.id]||1,lowpassFreq:We[e.id]||2e4,highpassFreq:He[e.id]||20,filterEnabled:Ye[e.id]||!1})),selectedCueTrackId:ye,timestamp:Date.now()};await g(e)},audioContext:t||void 0})}),F.map((a,r)=>e.jsxs("div",{className:`audafact-card overflow-hidden transition-all duration-300 relative ${0===r?"border-audafact-accent-cyan shadow-card":"border-audafact-divider shadow-sm"} ${jt?"ring-2 ring-audafact-accent-cyan ring-opacity-50":""}`,style:{transform:it&&r>0?"translateY(10px)":"translateY(0)"},"data-testid":0===r?"main-track-card":`track-card-${r}`,children:[0===r&&e.jsxs("div",{className:"flex items-center justify-between bg-audafact-surface-2 border-b border-audafact-divider py-1 px-2",style:{touchAction:"pan-y pinch-zoom"},onWheel:Ft,onTouchStart:Dt,onTouchMove:zt,onTouchEnd:At,children:[e.jsx("button",{onClick:_t,disabled:yt,className:"p-2 rounded-full transition-all duration-200 "+(yt?"text-audafact-text-secondary cursor-not-allowed":"text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-1 shadow-sm"),title:"Previous Track (Left Arrow)","data-testid":"previous-track-button",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("button",{onClick:Ut,disabled:!ut||it||yt||j,className:`flex flex-col items-center justify-center p-2 rounded-lg transition-all duration-200 ${!ut||it||yt||j?"text-audafact-text-secondary cursor-not-allowed":"text-audafact-accent-cyan hover:text-audafact-accent-cyan hover:bg-audafact-surface-1 shadow-sm"} ${dt?"animate-pulse":""}`,title:j?"Add tracks not available in demo mode":ut?"Add New Track":"Change current track mode to enable adding tracks",children:[e.jsx("svg",{className:"w-4 h-4 mb-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),it&&e.jsx("span",{className:"text-xs mt-1",children:"Adding..."})]}),e.jsx("button",{onClick:Bt,disabled:yt,className:"p-2 rounded-full transition-all duration-200 "+(yt?"text-audafact-text-secondary cursor-not-allowed":"text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-1 shadow-sm"),title:"Next Track (Right Arrow)","data-testid":"next-track-button",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsxs("div",{className:"p-4 border-b border-audafact-divider bg-audafact-surface-1",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:hidden",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"grid grid-cols-3 gap-1 bg-audafact-surface-2 rounded-md p-0.5 border border-audafact-divider w-full max-w-full",children:[e.jsx("button",{onClick:()=>Wt(a.id,"preview"),className:"w-full text-center px-2 py-1 text-xs font-medium rounded transition-colors "+("preview"===a.mode?"bg-audafact-accent-blue text-audafact-text-primary shadow-sm":"text-audafact-text-secondary hover:text-audafact-text-primary"),"data-testid":"preview-mode-button",children:"Preview"}),e.jsx("button",{onClick:()=>Wt(a.id,"loop"),className:"w-full text-center px-2 py-1 text-xs font-medium rounded transition-colors "+("loop"===a.mode?"bg-audafact-accent-cyan text-audafact-bg-primary shadow-sm":"text-audafact-text-secondary hover:text-audafact-text-primary"),"data-testid":"loop-mode-button",children:"Loop"}),e.jsx("button",{onClick:()=>Wt(a.id,"cue"),className:"w-full text-center px-2 py-1 text-xs font-medium rounded transition-colors "+("cue"===a.mode?"bg-audafact-alert-red text-audafact-text-primary shadow-sm":"text-audafact-text-secondary hover:text-audafact-text-primary"),"data-testid":"chop-mode-button",children:"Chop"})]})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-medium audafact-heading truncate",children:a.file.name}),e.jsx("p",{className:"text-xs audafact-text-secondary truncate",children:"preview"===a.mode?"Preview Mode":"loop"===a.mode?"Loop Mode":"Cue Mode"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>ea(a.id),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 "+(De[a.id]?"bg-audafact-accent-cyan text-audafact-bg-primary":"bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary"),title:De[a.id]?"Hide Measures":"Show Measures","data-testid":"measures-button",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("span",{children:"Measures"})]}),"cue"===a.mode&&e.jsxs("button",{onClick:()=>ta(a.id),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 "+(Ae[a.id]?"bg-audafact-alert-red text-audafact-text-primary":"bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary"),title:Ae[a.id]?"Hide Cue Points":"Show Cue Points",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),e.jsx("span",{children:"Cues"})]}),"cue"===a.mode&&e.jsxs("button",{onClick:()=>Ht(a.id),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 "+(a.id===ye?"bg-audafact-alert-red text-audafact-text-primary":"bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary"),title:a.id===ye?"Selected for Cue Control":"Select for Cue Control",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),e.jsx("span",{children:"Select"})]})]}),e.jsx("div",{children:e.jsxs("button",{onClick:()=>aa(a.id),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium audafact-text-secondary bg-audafact-surface-1 border border-audafact-divider rounded hover:bg-audafact-surface-2 transition-colors duration-200 w-full justify-between",title:Ie[a.id]?"Collapse Controls":"Expand Controls","data-testid":"time-tempo-controls-button",children:[e.jsx("span",{className:"truncate",children:"Time and Tempo"}),e.jsx("svg",{className:"w-3 h-3 transition-transform "+(Ie[a.id]?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]}),e.jsxs("div",{className:"hidden md:flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center bg-audafact-surface-2 rounded-md p-0.5 border border-audafact-divider",children:[e.jsx("button",{onClick:()=>Wt(a.id,"preview"),className:"px-2 py-1 text-xs font-medium rounded transition-colors "+("preview"===a.mode?"bg-audafact-accent-blue text-audafact-text-primary shadow-sm":"text-audafact-text-secondary hover:text-audafact-text-primary"),"data-testid":"preview-mode-button",children:"Preview"}),e.jsx("button",{onClick:()=>Wt(a.id,"loop"),className:"px-2 py-1 text-xs font-medium rounded transition-colors "+("loop"===a.mode?"bg-audafact-accent-cyan text-audafact-bg-primary shadow-sm":"text-audafact-text-secondary hover:text-audafact-text-primary"),"data-testid":"loop-mode-button",children:"Loop"}),e.jsx("button",{onClick:()=>Wt(a.id,"cue"),className:"px-2 py-1 text-xs font-medium rounded transition-colors "+("cue"===a.mode?"bg-audafact-alert-red text-audafact-text-primary shadow-sm":"text-audafact-text-secondary hover:text-audafact-text-primary"),"data-testid":"chop-mode-button",children:"Chop"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-medium audafact-heading truncate max-w-[420px]",children:a.file.name}),e.jsx("p",{className:"text-sm audafact-text-secondary",children:"preview"===a.mode?"Preview Mode":"loop"===a.mode?"Loop Mode":"Cue Mode"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>ea(a.id),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 "+(De[a.id]?"bg-audafact-accent-cyan text-audafact-bg-primary":"bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary"),title:De[a.id]?"Hide Measures":"Show Measures","data-testid":"measures-button",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("span",{children:"Measures"})]}),"cue"===a.mode&&e.jsxs("button",{onClick:()=>ta(a.id),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 "+(Ae[a.id]?"bg-audafact-alert-red text-audafact-text-primary":"bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary"),title:Ae[a.id]?"Hide Cue Points":"Show Cue Points",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),e.jsx("span",{children:"Cues"})]}),"cue"===a.mode&&e.jsxs("button",{onClick:()=>Ht(a.id),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 "+(a.id===ye?"bg-audafact-alert-red text-audafact-text-primary":"bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary"),title:a.id===ye?"Selected for Cue Control":"Select for Cue Control",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),e.jsx("span",{children:"Select"})]}),e.jsxs("button",{onClick:()=>aa(a.id),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium audafact-text-secondary bg-audafact-surface-1 border border-audafact-divider rounded hover:bg-audafact-surface-2 transition-colors duration-200",title:Ie[a.id]?"Collapse Controls":"Expand Controls","data-testid":"time-tempo-controls-button",children:[e.jsx("span",{children:"Time and Tempo"}),e.jsx("svg",{className:"w-3 h-3 transition-transform "+(Ie[a.id]?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})]})]}),Ie[a.id]&&e.jsxs("div",{className:"p-4 border-b border-audafact-divider bg-audafact-surface-2 space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(U,{trackId:a.id,initialTempo:a.tempo,onTempoChange:Zt,playbackSpeed:Ce[a.id]||1})}),e.jsx("div",{className:"space-y-2",children:e.jsx(O,{timeSignature:a.timeSignature,onTimeSignatureChange:e=>((e,t)=>{B(a=>a.map(a=>a.id===e?{...a,timeSignature:t}:a))})(a.id,e)})})]}),e.jsx("div",{className:"audafact-waveform-bg relative",style:{height:"120px"},children:e.jsx(_,{audioFile:a.file,mode:a.mode,loopStart:a.loopStart,loopEnd:a.loopEnd,cuePoints:a.cuePoints,onLoopPointsChange:(e,t)=>((e,t,a)=>{F&&B(r=>r.map(r=>r&&r.id===e?{...r,loopStart:t,loopEnd:a}:r))})(a.id,e,t),onCuePointChange:(e,t)=>((e,t,a)=>{F&&B(r=>r.map(r=>{if(!r||r.id!==e)return r;const s=r.buffer?.duration||0,n=Math.max(0,Math.min(a,s-.01)),o=[...r.cuePoints];o[t]=n,Mt(e,o);const i=Rt(e)||{};return Pt(e,{...i,cuePoints:o}),{...r,cuePoints:o}}))})(a.id,e,t),playhead:"loop"===a.mode?xe:be,playbackTime:je[a.id]||0,zoomLevel:Ne[a.id]||1,onZoomIn:()=>Vt(a.id),onZoomOut:()=>Yt(a.id),onResetZoom:()=>Xt(a.id),trackId:a.id,showMeasures:De[a.id],tempo:a.tempo,timeSignature:a.timeSignature,firstMeasureTime:a.firstMeasureTime,onFirstMeasureChange:e=>((e,t)=>{B(a=>a.map(a=>a.id===e?{...a,firstMeasureTime:t}:a))})(a.id,e),showCueThumbs:Ae[a.id],isPlaying:Be[a.id]||!1,onPlayheadChange:e=>((e,t)=>{const a=F.find(t=>t.id===e);if(Be[e]){const a=Oe.current[e];a?.current&&a.current(t)}else ke(a=>({...a,[e]:t})),"loop"===a?.mode?ge(t):ve(t)})(a.id,e),onScrollStateChange:e=>((e,t)=>{F.length>0&&e===F[0]?.id&&ot(t)})(a.id,e),isDemoMode:j})}),e.jsxs("div",{className:"p-4 relative z-10 bg-audafact-surface-1",children:[e.jsx(I,{mode:a.mode,audioContext:t,audioBuffer:a.buffer,loopStart:a.loopStart,loopEnd:a.loopEnd,cuePoints:a.cuePoints,ensureAudio:qt,isSelected:a.id===ye,onSelect:()=>Ht(a.id),onPlaybackTimeChange:e=>((e,t)=>{ke(a=>({...a,[e]:t}))})(a.id,e),onSpeedChange:e=>((e,t)=>{Te(a=>({...a,[e]:t}))})(a.id,e),trackTempo:a.tempo,volume:Le[a.id]||1,onVolumeChange:e=>((e,t)=>{Ee(a=>({...a,[e]:t})),Pe(t)})(a.id,e),playbackSpeed:Ce[a.id]||1,onPlaybackStateChange:e=>((e,t)=>{_e(a=>({...a,[e]:t}))})(a.id,e),playbackTime:je[a.id]||0,disabled:!1,lowpassFreq:We[a.id]||2e4,onLowpassFreqChange:e=>((e,t)=>{qe(a=>({...a,[e]:t}))})(a.id,e),highpassFreq:He[a.id]||20,onHighpassFreqChange:e=>((e,t)=>{Ve(a=>({...a,[e]:t}))})(a.id,e),filterEnabled:Ye[a.id]||!1,onFilterEnabledChange:e=>((e,t)=>{Xe(a=>({...a,[e]:t}))})(a.id,e),showDeleteButton:F.length>1&&"preview"!==a.mode,onDelete:()=>Ot(a.id),trackId:a.id,seekFunctionRef:$e(a.id),recordingDestination:b?v():null},`controls-${a.id}`),"cue"===a.mode&&a.id===ye&&e.jsx("div",{className:"mt-3 bg-audafact-accent-blue bg-opacity-10 p-2 rounded text-audafact-accent-blue text-xs",children:"Press keyboard keys 1-0 to trigger cue points"})]})]},a.id))]}),e.jsx(H,{isOpen:i,onToggle:d,onUploadTrack:ra,onAddFromLibrary:sa,onAddUserTrack:na}),e.jsx(x,{isOpen:P.isOpen,onClose:R,trigger:P.trigger}),Lt.show&&e.jsx(T,{message:Lt.message,feature:Lt.feature,onClose:()=>Et({show:!1,message:"",feature:""})}),e.jsx(Y,{isOpen:de.isOpen,onClose:de.closeOnboarding,onComplete:de.completeOnboarding,steps:oe,currentStep:de.currentStep,onStepChange:de.setCurrentStep}),e.jsx(X,{onStartTutorial:de.startOnboarding,onShowHelp:()=>J(!0)}),e.jsx(Z,{isOpen:K,onClose:()=>J(!1)})]})};export{K as default};
//# sourceMappingURL=Studio-25bff011.js.map
