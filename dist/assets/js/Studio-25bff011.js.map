{"version":3,"file":"Studio-25bff011.js","sources":["../../../src/services/accessService.ts","../../../src/hooks/useAccessControl.ts","../../../src/hooks/useOnboarding.ts","../../../src/components/UpgradePrompt.tsx","../../../node_modules/wavesurfer.js/dist/plugins/regions.js","../../../src/components/MeasureDisplay.tsx","../../../src/components/GridLines.tsx","../../../src/components/WaveformDisplay.tsx","../../../src/components/TrackControls.tsx","../../../src/components/TempoControls.tsx","../../../src/components/TimeSignatureControls.tsx","../../../src/components/RecordingControls.tsx","../../../src/services/storageService.ts","../../../src/hooks/usePreviewAudio.ts","../../../src/components/LibraryTrackItem.tsx","../../../src/components/SidePanel.tsx","../../../src/components/DemoModeIndicator.tsx","../../../src/components/OnboardingWalkthrough.tsx","../../../src/components/HelpButton.tsx","../../../src/components/HelpModal.tsx","../../../src/views/Studio.tsx","../../../src/config/onboardingConfig.ts"],"sourcesContent":["import { supabase } from './supabase';\nimport { DatabaseService } from './databaseService';\nimport { UserTier, FeatureGateConfig } from '../types/music';\n\nexport interface AccessLimits {\n  maxUploads: number;\n  maxSessions: number;\n  maxRecordings: number;\n  maxLibraryTracks: number;\n  canDownload: boolean;\n}\n\nexport interface AccessStatus {\n  currentUploads: number;\n  currentSessions: number;\n  currentRecordings: number;\n  currentLibraryTracks: number;\n  limits: AccessLimits;\n  canUpload: boolean;\n  canSaveSession: boolean;\n  canRecord: boolean;\n  canAddLibraryTrack: boolean;\n}\n\nexport class AccessService {\n  private static readonly FREE_LIMITS: AccessLimits = {\n    maxUploads: 3,\n    maxSessions: 2,\n    maxRecordings: 1,\n    maxLibraryTracks: 10,\n    canDownload: false\n  };\n\n  private static readonly PRO_LIMITS: AccessLimits = {\n    maxUploads: Infinity,\n    maxSessions: Infinity,\n    maxRecordings: Infinity,\n    maxLibraryTracks: Infinity,\n    canDownload: true\n  };\n\n  /**\n   * Get access limits based on user's tier\n   */\n  static getLimitsForTier(accessTier: string): AccessLimits {\n    return accessTier === 'pro' ? this.PRO_LIMITS : this.FREE_LIMITS;\n  }\n\n  /**\n   * Get current user's access status\n   */\n  static async getUserAccessStatus(userId: string, accessTier: string): Promise<AccessStatus> {\n    try {\n      // Get current counts\n      const [uploadsResult, sessionsResult, recordingsResult] = await Promise.all([\n        supabase.from('uploads').select('id', { count: 'exact' }).eq('user_id', userId),\n        supabase.from('sessions').select('id', { count: 'exact' }).eq('user_id', userId),\n        supabase.from('recordings').select('id', { count: 'exact' }).eq('user_id', userId)\n      ]);\n\n      const currentUploads = uploadsResult.count || 0;\n      const currentSessions = sessionsResult.count || 0;\n      const currentRecordings = recordingsResult.count || 0;\n      \n      // Get current library track count from database\n      const currentLibraryTracks = await this.getUserLibraryTrackCount(userId);\n\n      const limits = this.getLimitsForTier(accessTier);\n\n      return {\n        currentUploads,\n        currentSessions,\n        currentRecordings,\n        currentLibraryTracks,\n        limits,\n        canUpload: currentUploads < limits.maxUploads,\n        canSaveSession: currentSessions < limits.maxSessions,\n        canRecord: currentRecordings < limits.maxRecordings,\n        canAddLibraryTrack: currentLibraryTracks < limits.maxLibraryTracks\n      };\n    } catch (error) {\n      console.error('Error getting user access status:', error);\n      // Return restrictive defaults on error\n      return {\n        currentUploads: 0,\n        currentSessions: 0,\n        currentRecordings: 0,\n        currentLibraryTracks: 0,\n        limits: this.FREE_LIMITS,\n        canUpload: false,\n        canSaveSession: false,\n        canRecord: false,\n        canAddLibraryTrack: false\n      };\n    }\n  }\n\n  /**\n   * Get the number of library tracks to show to a user based on their tier\n   */\n  static getLibraryTracksToShow(accessTier: string, totalTracks: number): number {\n    const limits = this.getLimitsForTier(accessTier);\n    return accessTier === 'pro' ? totalTracks : Math.min(limits.maxLibraryTracks, totalTracks);\n  }\n\n  /**\n   * Check if user can perform a specific action\n   */\n  static async canPerformAction(\n    userId: string, \n    accessTier: string, \n    action: 'upload' | 'save_session' | 'record' | 'add_library_track' | 'download'\n  ): Promise<boolean> {\n    const limits = this.getLimitsForTier(accessTier);\n\n    switch (action) {\n      case 'add_library_track':\n        // Free users can add any of the 10 available library tracks to their studio\n        // The limit is on library availability, not studio usage\n        return accessTier !== 'guest'; // Only guests are blocked from adding tracks\n      \n      case 'download':\n        return limits.canDownload;\n      \n      case 'upload':\n        const uploadsResult = await supabase\n          .from('uploads')\n          .select('id', { count: 'exact' })\n          .eq('user_id', userId);\n        return (uploadsResult.count || 0) < limits.maxUploads;\n      \n      case 'save_session':\n        const sessionsResult = await supabase\n          .from('sessions')\n          .select('id', { count: 'exact' })\n          .eq('user_id', userId);\n        return (sessionsResult.count || 0) < limits.maxSessions;\n      \n      case 'record':\n        const recordingsResult = await supabase\n          .from('recordings')\n          .select('id', { count: 'exact' })\n          .eq('user_id', userId);\n        return (recordingsResult.count || 0) < limits.maxRecordings;\n      \n      default:\n        return false;\n    }\n  }\n\n  /**\n   * Get upgrade prompt message for a specific action\n   */\n  static getUpgradeMessage(action: 'upload' | 'save_session' | 'record' | 'add_library_track' | 'download'): string {\n    const baseMessage = \"Upgrade to Pro Creator to unlock this feature.\";\n    \n    switch (action) {\n      case 'upload':\n        return \"You've reached your upload limit (3 tracks). \" + baseMessage;\n      case 'save_session':\n        return \"You've reached your session limit (2 sessions). \" + baseMessage;\n      case 'record':\n        return \"You've reached your recording limit (1 recording). \" + baseMessage;\n      case 'add_library_track':\n        return \"Sign up to add tracks from the library to your studio. \" + baseMessage;\n      case 'download':\n        return \"Download your recordings with Pro Creator. \" + baseMessage;\n      default:\n        return baseMessage;\n    }\n  }\n\n  /**\n   * Get the number of library tracks a user has added to their studio\n   * Note: This is no longer needed since we don't limit studio usage\n   */\n  private static async getUserLibraryTrackCount(userId: string): Promise<number> {\n    // No longer tracking individual user library usage\n    return 0;\n  }\n\n  /**\n   * Add a library track to user's collection\n   * Note: This is no longer needed since we don't limit studio usage\n   */\n  static async addLibraryTrackToUser(userId: string, trackId: string): Promise<boolean> {\n    // No longer tracking individual user library usage\n    return true;\n  }\n\n  /**\n   * Remove a library track from user's collection\n   * Note: This is no longer needed since we don't limit studio usage\n   */\n  static async removeLibraryTrackFromUser(userId: string, trackId: string): Promise<boolean> {\n    // No longer tracking individual user library usage\n    return true;\n  }\n\n  /**\n   * Get user's current library tracks\n   * Note: This is no longer needed since we don't limit studio usage\n   */\n  static async getUserLibraryTracks(userId: string): Promise<any[]> {\n    // No longer tracking individual user library usage\n    return [];\n  }\n\n  /**\n   * Get rotation information\n   */\n  static async getRotationInfo(): Promise<any> {\n    try {\n      const { data, error } = await supabase.rpc('get_rotation_info');\n      \n      if (error) {\n        console.error('Error getting rotation info:', error);\n        return null;\n      }\n      \n      return data?.[0] || null;\n    } catch (error) {\n      console.error('Error getting rotation info:', error);\n      return null;\n    }\n  }\n}\n\nexport class EnhancedAccessService extends AccessService {\n  static canAccessFeature(feature: string, tier: UserTier): boolean {\n    const featureAccess: Record<string, boolean> = {\n      upload: tier.features.canUpload,\n      save_session: tier.features.canSaveSession,\n      record: tier.features.canRecord,\n      download: tier.features.canDownload,\n      edit_cues: tier.features.canEditCues,\n      edit_loops: tier.features.canEditLoops,\n      browse_library: tier.features.canBrowseLibrary,\n      access_pro_tracks: tier.features.canAccessProTracks\n    };\n    \n    return featureAccess[feature] || false;\n  }\n  \n  static getFeatureGateConfig(feature: string, tier?: UserTier): FeatureGateConfig {\n    const configs: Record<string, FeatureGateConfig> = {\n      upload: {\n        gateType: 'modal',\n        message: \"🎧 Ready to remix your own sounds?\",\n        ctaText: \"Sign up to upload tracks\",\n        upgradeRequired: false\n      },\n      save_session: {\n        gateType: 'modal',\n        message: \"💾 Don't lose your work\",\n        ctaText: \"Sign up to save session\",\n        upgradeRequired: false\n      },\n      record: {\n        gateType: 'modal',\n        message: tier?.id === 'free' \n          ? \"🎙 You've used your free recording. Upgrade for unlimited recordings!\"\n          : \"🎙 Record and export your performances\",\n        ctaText: tier?.id === 'free' \n          ? \"Upgrade to Pro Creator\" \n          : \"Upgrade to Pro Creator\",\n        upgradeRequired: true\n      },\n      download: {\n        gateType: 'modal',\n        message: \"💿 Download your recordings\",\n        ctaText: \"Upgrade to Pro Creator\",\n        upgradeRequired: true\n      },\n      edit_cues: {\n        gateType: 'tooltip',\n        message: \"Sign up to customize cue points\",\n        ctaText: \"Sign up now\",\n        upgradeRequired: false\n      },\n      edit_loops: {\n        gateType: 'tooltip',\n        message: \"Sign up to set custom loops\",\n        ctaText: \"Sign up now\",\n        upgradeRequired: false\n      }\n    };\n    \n    return configs[feature] || {\n      gateType: 'modal',\n      message: \"Upgrade to unlock this feature\",\n      ctaText: \"Upgrade now\",\n      upgradeRequired: true\n    };\n  }\n  \n  static async checkUsageLimits(userId: string, tier: UserTier, action: string): Promise<boolean> {\n    if (tier.id === 'pro') return true; // No limits for pro users\n    \n    const limits = tier.limits;\n    \n    switch (action) {\n      case 'upload':\n        const uploadCount = await this.getUserUploadCount(userId);\n        return uploadCount < limits.maxUploads;\n      \n      case 'save_session':\n        const sessionCount = await this.getUserSessionCount(userId);\n        return sessionCount < limits.maxSessions;\n      \n      case 'record':\n        const recordingCount = await this.getUserRecordingCount(userId);\n        return recordingCount < limits.maxRecordings;\n      \n      default:\n        return true;\n    }\n  }\n\n  private static async getUserUploadCount(userId: string): Promise<number> {\n    const { count } = await supabase\n      .from('uploads')\n      .select('id', { count: 'exact' })\n      .eq('user_id', userId);\n    return count || 0;\n  }\n\n  private static async getUserSessionCount(userId: string): Promise<number> {\n    const { count } = await supabase\n      .from('sessions')\n      .select('id', { count: 'exact' })\n      .eq('user_id', userId);\n    return count || 0;\n  }\n\n  private static async getUserRecordingCount(userId: string): Promise<number> {\n    const { count } = await supabase\n      .from('recordings')\n      .select('id', { count: 'exact' })\n      .eq('user_id', userId);\n    return count || 0;\n  }\n}","import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { useUserTier } from './useUserTier';\nimport { AccessService, AccessStatus, EnhancedAccessService } from '../services/accessService';\n\nexport const useAccessControl = () => {\n  const { user } = useAuth();\n  const { tier } = useUserTier();\n  const [accessStatus, setAccessStatus] = useState<AccessStatus | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  const refreshAccessStatus = async () => {\n    if (!user?.id) return;\n    \n    setLoading(true);\n    try {\n      const status = await AccessService.getUserAccessStatus(user.id, tier.id);\n      setAccessStatus(status);\n    } catch (error) {\n      console.error('Error fetching access status:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    refreshAccessStatus();\n  }, [user?.id, tier.id]);\n\n  // Listen for recording saved events to refresh access status\n  useEffect(() => {\n    const handleRecordingSaved = () => {\n      refreshAccessStatus();\n    };\n\n    window.addEventListener('recordingSaved', handleRecordingSaved);\n    \n    return () => {\n      window.removeEventListener('recordingSaved', handleRecordingSaved);\n    };\n  }, [refreshAccessStatus]);\n\n  const canAccessFeature = (feature: string): boolean => {\n    return EnhancedAccessService.canAccessFeature(feature, tier);\n  };\n\n  const canPerformAction = async (action: 'upload' | 'save_session' | 'record' | 'add_library_track' | 'download'): Promise<boolean> => {\n    if (!user?.id) return false;\n    \n    // Handle add_library_track separately since it's not in the feature access map\n    if (action === 'add_library_track') {\n      return tier.id !== 'guest'; // Only guests are blocked from adding library tracks\n    }\n    \n    const hasFeatureAccess = canAccessFeature(action);\n    if (!hasFeatureAccess) return false;\n    \n    return EnhancedAccessService.checkUsageLimits(user.id, tier, action);\n  };\n\n  const getUpgradeMessage = (action: string): string => {\n    const config = EnhancedAccessService.getFeatureGateConfig(action);\n    return config.message;\n  };\n\n  return {\n    accessStatus,\n    loading,\n    refreshAccessStatus,\n    canAccessFeature,\n    canPerformAction,\n    getUpgradeMessage,\n    tier\n  };\n};","import { useState, useEffect, useCallback } from 'react';\nimport { OnboardingStep } from '../components/OnboardingWalkthrough';\n\ninterface OnboardingState {\n  isOpen: boolean;\n  currentStep: number;\n  hasCompleted: boolean;\n  hasBeenShown: boolean;\n}\n\nconst ONBOARDING_STORAGE_KEY = 'audafact_onboarding_state';\n\nexport const useOnboarding = (steps: OnboardingStep[], isAnonymousUser: boolean = false) => {\n  const [state, setState] = useState<OnboardingState>({\n    isOpen: false,\n    currentStep: 0,\n    hasCompleted: false,\n    hasBeenShown: false\n  });\n\n  // Load state from localStorage on mount\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem(ONBOARDING_STORAGE_KEY);\n      if (stored) {\n        const parsed = JSON.parse(stored);\n        setState(prev => ({\n          ...prev,\n          hasCompleted: parsed.hasCompleted || false,\n          hasBeenShown: parsed.hasBeenShown || false\n        }));\n      }\n    } catch (error) {\n      console.warn('Failed to load onboarding state:', error);\n    }\n  }, []);\n\n  // Save state to localStorage\n  const saveState = useCallback((newState: Partial<OnboardingState>) => {\n    try {\n      const current = localStorage.getItem(ONBOARDING_STORAGE_KEY);\n      const parsed = current ? JSON.parse(current) : {};\n      const updated = { ...parsed, ...newState };\n      localStorage.setItem(ONBOARDING_STORAGE_KEY, JSON.stringify(updated));\n    } catch (error) {\n      console.warn('Failed to save onboarding state:', error);\n    }\n  }, []);\n\n  const startOnboarding = useCallback(() => {\n    setState(prev => ({\n      ...prev,\n      isOpen: true,\n      currentStep: 0,\n      hasBeenShown: true\n    }));\n    saveState({ hasBeenShown: true });\n  }, [saveState]);\n\n  const closeOnboarding = useCallback(() => {\n    setState(prev => ({\n      ...prev,\n      isOpen: false\n    }));\n  }, []);\n\n  const completeOnboarding = useCallback(() => {\n    setState(prev => ({\n      ...prev,\n      isOpen: false,\n      hasCompleted: true\n    }));\n    saveState({ hasCompleted: true });\n  }, [saveState]);\n\n  const setCurrentStep = useCallback((step: number) => {\n    setState(prev => ({\n      ...prev,\n      currentStep: Math.max(0, Math.min(step, steps.length - 1))\n    }));\n  }, [steps.length]);\n\n  const resetOnboarding = useCallback(() => {\n    setState({\n      isOpen: false,\n      currentStep: 0,\n      hasCompleted: false,\n      hasBeenShown: false\n    });\n    localStorage.removeItem(ONBOARDING_STORAGE_KEY);\n  }, []);\n\n  const shouldShowOnboarding = useCallback(() => {\n    // For anonymous users, always show onboarding if not completed\n    if (isAnonymousUser) {\n      return !state.hasCompleted;\n    }\n    // For authenticated users, show only if never seen before\n    return !state.hasCompleted && !state.hasBeenShown;\n  }, [state.hasCompleted, state.hasBeenShown, isAnonymousUser]);\n\n  return {\n    ...state,\n    startOnboarding,\n    closeOnboarding,\n    completeOnboarding,\n    setCurrentStep,\n    resetOnboarding,\n    shouldShowOnboarding,\n    totalSteps: steps.length\n  };\n}; ","import React from 'react';\nimport { Crown, ArrowRight } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\n\ninterface UpgradePromptProps {\n  message: string;\n  feature: string;\n  onClose?: () => void;\n  variant?: 'modal' | 'inline' | 'banner';\n}\n\nexport const UpgradePrompt: React.FC<UpgradePromptProps> = ({\n  message,\n  feature,\n  onClose,\n  variant = 'modal'\n}) => {\n  const navigate = useNavigate();\n\n  const handleUpgrade = () => {\n    navigate('/pricing');\n    onClose?.();\n  };\n\n  if (variant === 'banner') {\n    return (\n      <div className=\"bg-gradient-to-r from-audafact-accent-cyan to-audafact-accent-blue p-4 rounded-lg mb-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <Crown className=\"h-5 w-5 text-audafact-text-primary\" />\n            <div>\n              <p className=\"text-sm font-medium text-audafact-text-primary\">\n                {feature} requires Pro Creator\n              </p>\n              <p className=\"text-xs text-audafact-text-primary opacity-90\">\n                {message}\n              </p>\n            </div>\n          </div>\n          <button\n            onClick={handleUpgrade}\n            className=\"bg-audafact-text-primary text-audafact-accent-cyan px-4 py-2 rounded-lg text-sm font-medium hover:bg-opacity-90 transition-colors flex items-center space-x-2\"\n          >\n            <span>Upgrade</span>\n            <ArrowRight className=\"h-4 w-4\" />\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (variant === 'inline') {\n    return (\n      <div className=\"audafact-card p-6 text-center\">\n        <div className=\"flex justify-center mb-4\">\n          <div className=\"bg-gradient-to-br from-audafact-accent-cyan to-audafact-accent-blue p-3 rounded-full\">\n            <Crown className=\"h-6 w-6 text-audafact-text-primary\" />\n          </div>\n        </div>\n        <h3 className=\"text-lg font-semibold audafact-heading mb-2\">\n          {feature} - Pro Feature\n        </h3>\n        <p className=\"audafact-text-secondary mb-4\">\n          {message}\n        </p>\n        <button\n          onClick={handleUpgrade}\n          className=\"audafact-button-primary\"\n        >\n          Upgrade to Pro Creator\n        </button>\n      </div>\n    );\n  }\n\n  // Modal variant\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"audafact-card-enhanced p-6 max-w-md w-full\">\n        <div className=\"flex justify-center mb-4\">\n          <div className=\"bg-gradient-to-br from-audafact-accent-cyan to-audafact-accent-blue p-3 rounded-full\">\n            <Crown className=\"h-8 w-8 text-audafact-text-primary\" />\n          </div>\n        </div>\n        \n        <h2 className=\"text-xl font-bold audafact-heading text-center mb-2\">\n          Upgrade Required\n        </h2>\n        \n        <h3 className=\"text-lg font-semibold audafact-text-secondary text-center mb-4\">\n          {feature}\n        </h3>\n        \n        <p className=\"audafact-text-secondary text-center mb-6\">\n          {message}\n        </p>\n        \n        <div className=\"flex space-x-3\">\n          <button\n            onClick={onClose}\n            className=\"audafact-button-secondary flex-1\"\n          >\n            Maybe Later\n          </button>\n          <button\n            onClick={handleUpgrade}\n            className=\"audafact-button-primary flex-1\"\n          >\n            Upgrade Now\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};","class t{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}}class e extends t{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit(\"destroy\"),this.subscriptions.forEach((t=>t())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}function i(t,e,i,n,s=3,r=0,o=100){if(!t)return()=>{};const h=matchMedia(\"(pointer: coarse)\").matches;let a=()=>{};const l=l=>{if(l.button!==r)return;l.preventDefault(),l.stopPropagation();let d=l.clientX,c=l.clientY,u=!1;const v=Date.now(),g=n=>{if(n.preventDefault(),n.stopPropagation(),h&&Date.now()-v<o)return;const r=n.clientX,a=n.clientY,l=r-d,g=a-c;if(u||Math.abs(l)>s||Math.abs(g)>s){const n=t.getBoundingClientRect(),{left:s,top:o}=n;u||(null==i||i(d-s,c-o),u=!0),e(l,g,r-s,a-o),d=r,c=a}},p=e=>{if(u){const i=e.clientX,s=e.clientY,r=t.getBoundingClientRect(),{left:o,top:h}=r;null==n||n(i-o,s-h)}a()},m=t=>{t.relatedTarget&&t.relatedTarget!==document.documentElement||p(t)},f=t=>{u&&(t.stopPropagation(),t.preventDefault())},b=t=>{u&&t.preventDefault()};document.addEventListener(\"pointermove\",g),document.addEventListener(\"pointerup\",p),document.addEventListener(\"pointerout\",m),document.addEventListener(\"pointercancel\",m),document.addEventListener(\"touchmove\",b,{passive:!1}),document.addEventListener(\"click\",f,{capture:!0}),a=()=>{document.removeEventListener(\"pointermove\",g),document.removeEventListener(\"pointerup\",p),document.removeEventListener(\"pointerout\",m),document.removeEventListener(\"pointercancel\",m),document.removeEventListener(\"touchmove\",b),setTimeout((()=>{document.removeEventListener(\"click\",f,{capture:!0})}),10)}};return t.addEventListener(\"pointerdown\",l),()=>{a(),t.removeEventListener(\"pointerdown\",l)}}function n(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if(\"children\"===t&&s)for(const[t,e]of Object.entries(s))e instanceof Node?i.appendChild(e):\"string\"==typeof e?i.appendChild(document.createTextNode(e)):i.appendChild(n(t,e));else\"style\"===t?Object.assign(i.style,s):\"textContent\"===t?i.textContent=s:i.setAttribute(t,s.toString());return i}function s(t,e,i){const s=n(t,e||{});return null==i||i.appendChild(s),s}class r extends t{constructor(t,e,i=0){var n,s,r,o,h,a,l,d,c,u;super(),this.totalDuration=e,this.numberOfChannels=i,this.element=null,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.isRemoved=!1,this.subscriptions=[],this.id=t.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(t.start),this.end=this.clampPosition(null!==(n=t.end)&&void 0!==n?n:t.start),this.drag=null===(s=t.drag)||void 0===s||s,this.resize=null===(r=t.resize)||void 0===r||r,this.resizeStart=null===(o=t.resizeStart)||void 0===o||o,this.resizeEnd=null===(h=t.resizeEnd)||void 0===h||h,this.color=null!==(a=t.color)&&void 0!==a?a:\"rgba(0, 0, 0, 0.1)\",this.minLength=null!==(l=t.minLength)&&void 0!==l?l:this.minLength,this.maxLength=null!==(d=t.maxLength)&&void 0!==d?d:this.maxLength,this.channelIdx=null!==(c=t.channelIdx)&&void 0!==c?c:-1,this.contentEditable=null!==(u=t.contentEditable)&&void 0!==u?u:this.contentEditable,this.element=this.initElement(),this.setContent(t.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(t){return Math.max(0,Math.min(this.totalDuration,t))}setPart(){var t;const e=this.start===this.end;null===(t=this.element)||void 0===t||t.setAttribute(\"part\",`${e?\"marker\":\"region\"} ${this.id}`)}addResizeHandles(t){const e={position:\"absolute\",zIndex:\"2\",width:\"6px\",height:\"100%\",top:\"0\",cursor:\"ew-resize\",wordBreak:\"keep-all\"},n=s(\"div\",{part:\"region-handle region-handle-left\",style:Object.assign(Object.assign({},e),{left:\"0\",borderLeft:\"2px solid rgba(0, 0, 0, 0.5)\",borderRadius:\"2px 0 0 2px\"})},t),r=s(\"div\",{part:\"region-handle region-handle-right\",style:Object.assign(Object.assign({},e),{right:\"0\",borderRight:\"2px solid rgba(0, 0, 0, 0.5)\",borderRadius:\"0 2px 2px 0\"})},t);this.subscriptions.push(i(n,(t=>this.onResize(t,\"start\")),(()=>null),(()=>this.onEndResizing()),1),i(r,(t=>this.onResize(t,\"end\")),(()=>null),(()=>this.onEndResizing()),1))}removeResizeHandles(t){const e=t.querySelector('[part*=\"region-handle-left\"]'),i=t.querySelector('[part*=\"region-handle-right\"]');e&&t.removeChild(e),i&&t.removeChild(i)}initElement(){if(this.isRemoved)return null;const t=this.start===this.end;let e=0,i=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(i=100/this.numberOfChannels,e=i*this.channelIdx);const n=s(\"div\",{style:{position:\"absolute\",top:`${e}%`,height:`${i}%`,backgroundColor:t?\"none\":this.color,borderLeft:t?\"2px solid \"+this.color:\"none\",borderRadius:\"2px\",boxSizing:\"border-box\",transition:\"background-color 0.2s ease\",cursor:this.drag?\"grab\":\"default\",pointerEvents:\"all\"}});return!t&&this.resize&&this.addResizeHandles(n),n}renderPosition(){if(!this.element)return;const t=this.start/this.totalDuration,e=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*t+\"%\",this.element.style.right=100*e+\"%\"}toggleCursor(t){var e;this.drag&&(null===(e=this.element)||void 0===e?void 0:e.style)&&(this.element.style.cursor=t?\"grabbing\":\"grab\")}initMouseEvents(){const{element:t}=this;t&&(t.addEventListener(\"click\",(t=>this.emit(\"click\",t))),t.addEventListener(\"mouseenter\",(t=>this.emit(\"over\",t))),t.addEventListener(\"mouseleave\",(t=>this.emit(\"leave\",t))),t.addEventListener(\"dblclick\",(t=>this.emit(\"dblclick\",t))),t.addEventListener(\"pointerdown\",(()=>this.toggleCursor(!0))),t.addEventListener(\"pointerup\",(()=>this.toggleCursor(!1))),this.subscriptions.push(i(t,(t=>this.onMove(t)),(()=>this.toggleCursor(!0)),(()=>{this.toggleCursor(!1),this.drag&&this.emit(\"update-end\")}))),this.contentEditable&&this.content&&(this.content.addEventListener(\"click\",(t=>this.onContentClick(t))),this.content.addEventListener(\"blur\",(()=>this.onContentBlur()))))}_onUpdate(t,e){var i;if(!(null===(i=this.element)||void 0===i?void 0:i.parentElement))return;const{width:n}=this.element.parentElement.getBoundingClientRect(),s=t/n*this.totalDuration,r=e&&\"start\"!==e?this.start:this.start+s,o=e&&\"end\"!==e?this.end:this.end+s,h=o-r;r>=0&&o<=this.totalDuration&&r<=o&&h>=this.minLength&&h<=this.maxLength&&(this.start=r,this.end=o,this.renderPosition(),this.emit(\"update\",e))}onMove(t){this.drag&&this._onUpdate(t)}onResize(t,e){this.resize&&(this.resizeStart||\"start\"!==e)&&(this.resizeEnd||\"end\"!==e)&&this._onUpdate(t,e)}onEndResizing(){this.resize&&this.emit(\"update-end\")}onContentClick(t){t.stopPropagation();t.target.focus(),this.emit(\"click\",t)}onContentBlur(){this.emit(\"update-end\")}_setTotalDuration(t){this.totalDuration=t,this.renderPosition()}play(t){this.emit(\"play\",t&&this.end!==this.start?this.end:void 0)}getContent(t=!1){var e;return t?this.content||void 0:this.element instanceof HTMLElement?(null===(e=this.content)||void 0===e?void 0:e.innerHTML)||void 0:\"\"}setContent(t){var e;if(this.element)if(null===(e=this.content)||void 0===e||e.remove(),t){if(\"string\"==typeof t){const e=this.start===this.end;this.content=s(\"div\",{style:{padding:`0.2em ${e?.2:.4}em`,display:\"inline-block\"},textContent:t})}else this.content=t;this.contentEditable&&(this.content.contentEditable=\"true\"),this.content.setAttribute(\"part\",\"region-content\"),this.element.appendChild(this.content),this.emit(\"content-changed\")}else this.content=void 0}setOptions(t){var e,i;if(this.element){if(t.color&&(this.color=t.color,this.element.style.backgroundColor=this.color),void 0!==t.drag&&(this.drag=t.drag,this.element.style.cursor=this.drag?\"grab\":\"default\"),void 0!==t.start||void 0!==t.end){const n=this.start===this.end;this.start=this.clampPosition(null!==(e=t.start)&&void 0!==e?e:this.start),this.end=this.clampPosition(null!==(i=t.end)&&void 0!==i?i:n?this.start:this.end),this.renderPosition(),this.setPart()}if(t.content&&this.setContent(t.content),t.id&&(this.id=t.id,this.setPart()),void 0!==t.resize&&t.resize!==this.resize){const e=this.start===this.end;this.resize=t.resize,this.resize&&!e?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}void 0!==t.resizeStart&&(this.resizeStart=t.resizeStart),void 0!==t.resizeEnd&&(this.resizeEnd=t.resizeEnd)}}remove(){this.isRemoved=!0,this.emit(\"remove\"),this.subscriptions.forEach((t=>t())),this.element&&(this.element.remove(),this.element=null)}}class o extends e{constructor(t){super(t),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(t){return new o(t)}onInit(){if(!this.wavesurfer)throw Error(\"WaveSurfer is not initialized\");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let t=[];this.subscriptions.push(this.wavesurfer.on(\"timeupdate\",(e=>{const i=this.regions.filter((t=>t.start<=e&&(t.end===t.start?t.start+.05:t.end)>=e));i.forEach((e=>{t.includes(e)||this.emit(\"region-in\",e)})),t.forEach((t=>{i.includes(t)||this.emit(\"region-out\",t)})),t=i})))}initRegionsContainer(){return s(\"div\",{style:{position:\"absolute\",top:\"0\",left:\"0\",width:\"100%\",height:\"100%\",zIndex:\"5\",pointerEvents:\"none\"}})}getRegions(){return this.regions}avoidOverlapping(t){t.content&&setTimeout((()=>{const e=t.content,i=e.getBoundingClientRect(),n=this.regions.map((e=>{if(e===t||!e.content)return 0;const n=e.content.getBoundingClientRect();return i.left<n.left+n.width&&n.left<i.left+i.width?n.height:0})).reduce(((t,e)=>t+e),0);e.style.marginTop=`${n}px`}),10)}adjustScroll(t){var e,i;if(!t.element)return;const n=null===(i=null===(e=this.wavesurfer)||void 0===e?void 0:e.getWrapper())||void 0===i?void 0:i.parentElement;if(!n)return;const{clientWidth:s,scrollWidth:r}=n;if(r<=s)return;const o=n.getBoundingClientRect(),h=t.element.getBoundingClientRect(),a=h.left-o.left,l=h.right-o.left;a<0?n.scrollLeft+=a:l>s&&(n.scrollLeft+=l-s)}virtualAppend(t,e,i){const n=()=>{if(!this.wavesurfer)return;const n=this.wavesurfer.getWidth(),s=this.wavesurfer.getScroll(),r=e.clientWidth,o=this.wavesurfer.getDuration(),h=Math.round(t.start/o*r),a=h+(Math.round((t.end-t.start)/o*r)||1)>s&&h<s+n;a&&!i.parentElement?e.appendChild(i):!a&&i.parentElement&&i.remove()};setTimeout((()=>{if(!this.wavesurfer)return;n();const e=this.wavesurfer.on(\"scroll\",n);this.subscriptions.push(t.once(\"remove\",e),e)}),0)}saveRegion(t){if(!t.element)return;this.virtualAppend(t,this.regionsContainer,t.element),this.avoidOverlapping(t),this.regions.push(t);const e=[t.on(\"update\",(e=>{e||this.adjustScroll(t),this.emit(\"region-update\",t,e)})),t.on(\"update-end\",(()=>{this.avoidOverlapping(t),this.emit(\"region-updated\",t)})),t.on(\"play\",(e=>{var i;null===(i=this.wavesurfer)||void 0===i||i.play(t.start,e)})),t.on(\"click\",(e=>{this.emit(\"region-clicked\",t,e)})),t.on(\"dblclick\",(e=>{this.emit(\"region-double-clicked\",t,e)})),t.on(\"content-changed\",(()=>{this.emit(\"region-content-changed\",t)})),t.once(\"remove\",(()=>{e.forEach((t=>t())),this.regions=this.regions.filter((e=>e!==t)),this.emit(\"region-removed\",t)}))];this.subscriptions.push(...e),this.emit(\"region-created\",t)}addRegion(t){var e,i;if(!this.wavesurfer)throw Error(\"WaveSurfer is not initialized\");const n=this.wavesurfer.getDuration(),s=null===(i=null===(e=this.wavesurfer)||void 0===e?void 0:e.getDecodedData())||void 0===i?void 0:i.numberOfChannels,o=new r(t,n,s);return this.emit(\"region-initialized\",o),n?this.saveRegion(o):this.subscriptions.push(this.wavesurfer.once(\"ready\",(t=>{o._setTotalDuration(t),this.saveRegion(o)}))),o}enableDragSelection(t,e=3){var n;const s=null===(n=this.wavesurfer)||void 0===n?void 0:n.getWrapper();if(!(s&&s instanceof HTMLElement))return()=>{};let o=null,h=0;return i(s,((t,e,i)=>{o&&o._onUpdate(t,i>h?\"end\":\"start\")}),(e=>{var i,n;if(h=e,!this.wavesurfer)return;const s=this.wavesurfer.getDuration(),a=null===(n=null===(i=this.wavesurfer)||void 0===i?void 0:i.getDecodedData())||void 0===n?void 0:n.numberOfChannels,{width:l}=this.wavesurfer.getWrapper().getBoundingClientRect(),d=e/l*s,c=(e+5)/l*s;o=new r(Object.assign(Object.assign({},t),{start:d,end:c}),s,a),this.emit(\"region-initialized\",o),o.element&&this.regionsContainer.appendChild(o.element)}),(()=>{o&&(this.saveRegion(o),o=null)}),e)}clearRegions(){this.regions.slice().forEach((t=>t.remove())),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}export{o as default};\n","import { useState, useEffect, useRef, useCallback } from 'react';\nimport { TimeSignature } from '../types/music';\n\ninterface MeasureDisplayProps {\n  duration: number;\n  tempo: number;\n  zoomLevel: number;\n  onFirstMeasureChange: (time: number) => void;\n  timeSignature: TimeSignature;\n  firstMeasureTime: number;\n  visible?: boolean;\n  containerRef?: React.RefObject<HTMLDivElement>;\n}\n\nconst MeasureDisplay = ({\n  duration,\n  tempo,\n  zoomLevel,\n  onFirstMeasureChange,\n  timeSignature,\n  firstMeasureTime,\n  visible = true,\n  containerRef: externalContainerRef\n}: MeasureDisplayProps) => {\n  const [isDraggingFirstMeasure, setIsDraggingFirstMeasure] = useState(false);\n  const [dragStartX, setDragStartX] = useState(0);\n  const [dragStartTime, setDragStartTime] = useState(0);\n  const internalContainerRef = useRef<HTMLDivElement>(null);\n  const containerRef = externalContainerRef || internalContainerRef;\n\n  // Calculate measure duration in seconds\n  const measureDuration = useCallback(() => {\n    // Convert tempo (BPM) to seconds per beat\n    const secondsPerBeat = 60 / tempo;\n    \n    // The denominator tells us what note gets one beat\n    // 4 = quarter note, 8 = eighth note, 2 = half note, etc.\n    const beatNoteValue = 4 / timeSignature.denominator;\n    \n    // Calculate measure duration: beats per measure × duration per beat\n    return timeSignature.numerator * secondsPerBeat * beatNoteValue;\n  }, [tempo, timeSignature]);\n\n  // Calculate measure positions\n  const calculateMeasures = useCallback(() => {\n    const measureDur = measureDuration();\n    const measures = [];\n    \n    // Start from the first measure time\n    let currentTime = firstMeasureTime;\n    let measureNumber = 1;\n    \n    while (currentTime <= duration) {\n      measures.push({\n        time: currentTime,\n        number: measureNumber\n      });\n      currentTime += measureDur;\n      measureNumber++;\n    }\n    \n    return measures;\n  }, [duration, firstMeasureTime, measureDuration]);\n\n  // Convert time to pixel position\n  const timeToPixels = useCallback((time: number) => {\n    // Calculate pixels per second based on zoom level\n    // Base pixels per second is 40 (WaveSurfer's actual default minPxPerSec)\n    const basePixelsPerSecond = 40;\n    const zoomedPixelsPerSecond = basePixelsPerSecond * zoomLevel;\n    return time * zoomedPixelsPerSecond;\n  }, [zoomLevel]);\n\n  // Convert pixel position to time\n  const pixelsToTime = useCallback((pixels: number) => {\n    // Calculate pixels per second based on zoom level\n    // Base pixels per second is 40 (WaveSurfer's actual default minPxPerSec)\n    const basePixelsPerSecond = 40;\n    const zoomedPixelsPerSecond = basePixelsPerSecond * zoomLevel;\n    return pixels / zoomedPixelsPerSecond;\n  }, [zoomLevel]);\n\n  // Handle first measure marker drag start\n  const handleFirstMeasureMouseDown = useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    setIsDraggingFirstMeasure(true);\n    setDragStartX(e.clientX);\n    setDragStartTime(firstMeasureTime);\n  }, [firstMeasureTime]);\n\n\n\n  // Handle mouse move during drag\n  const handleMouseMove = useCallback((e: MouseEvent) => {\n    if (!isDraggingFirstMeasure || !containerRef.current) return;\n    \n    const deltaX = e.clientX - dragStartX;\n    const relativeDeltaX = deltaX;\n    const timeDelta = pixelsToTime(relativeDeltaX);\n    const newTime = Math.max(0, Math.min(duration, dragStartTime + timeDelta));\n    \n    onFirstMeasureChange(newTime);\n  }, [isDraggingFirstMeasure, dragStartX, dragStartTime, pixelsToTime, duration, onFirstMeasureChange]);\n\n  // Handle mouse up to end drag\n  const handleMouseUp = useCallback(() => {\n    setIsDraggingFirstMeasure(false);\n  }, []);\n\n  // Add/remove global mouse event listeners\n  useEffect(() => {\n    if (isDraggingFirstMeasure) {\n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n      \n      return () => {\n        document.removeEventListener('mousemove', handleMouseMove);\n        document.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isDraggingFirstMeasure, handleMouseMove, handleMouseUp]);\n\n  const measures = calculateMeasures();\n\n\n\n  // Don't render anything if not visible\n  if (!visible) {\n    return null;\n  }\n\n  return (\n    <div \n      ref={internalContainerRef}\n      className=\"absolute pointer-events-auto\"\n      style={{ \n        height: '120px',\n        top: 0,\n        left: 0,\n        right: 0\n      }}\n    >\n      {/* First Measure Marker */}\n      <div\n        className=\"absolute top-0 bottom-0 w-0.5 bg-yellow-500 pointer-events-auto cursor-ew-resize z-20\"\n        style={{\n          left: `${timeToPixels(firstMeasureTime)}px`,\n          transform: 'translateX(-50%)'\n        }}\n        onMouseDown={handleFirstMeasureMouseDown}\n        title={`First measure at ${firstMeasureTime.toFixed(2)}s`}\n      >\n        <div className=\"absolute -top-6 left-1/2 transform -translate-x-1/2 bg-yellow-500 text-yellow-900 text-xs px-1 py-0.5 rounded whitespace-nowrap\">\n          Measure 1\n        </div>\n      </div>\n\n      {/* Measure Lines */}\n      {measures.map((measure, index) => (\n        <div key={index}>\n          {/* Measure line - made darker */}\n          <div\n            className=\"absolute top-0 bottom-0 w-px bg-yellow-400 opacity-80\"\n            style={{\n              left: `${timeToPixels(measure.time)}px`,\n              transform: 'translateX(-50%)'\n            }}\n          />\n          \n          {/* Measure number (show every 4th measure to avoid clutter) */}\n          {measure.number % 4 === 1 && (\n            <div\n              className=\"absolute top-1 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-yellow-900 text-xs px-1 py-0.5 rounded whitespace-nowrap font-medium\"\n              style={{\n                left: `${timeToPixels(measure.time)}px`,\n                transform: 'translateX(-50%)'\n              }}\n            >\n              {measure.number}\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default MeasureDisplay; ","import { useCallback, useRef } from 'react';\nimport { TimeSignature } from '../types/music';\n\ninterface GridLinesProps {\n  duration: number;\n  tempo: number;\n  zoomLevel: number;\n  timeSignature: TimeSignature;\n  firstMeasureTime: number;\n  visible?: boolean;\n  showMeasures?: boolean; // Add prop to know when measures are being displayed\n}\n\nconst GridLines = ({\n  duration,\n  tempo,\n  zoomLevel,\n  timeSignature,\n  firstMeasureTime,\n  visible = true,\n  showMeasures = false\n}: GridLinesProps) => {\n  const internalContainerRef = useRef<HTMLDivElement>(null);\n\n  // Calculate beat duration in seconds (same as MeasureDisplay)\n  const beatDuration = useCallback(() => {\n    // Convert tempo (BPM) to seconds per beat\n    const secondsPerBeat = 60 / tempo;\n    \n    // The denominator tells us what note gets one beat\n    // 4 = quarter note, 8 = eighth note, 2 = half note, etc.\n    const beatNoteValue = 4 / timeSignature.denominator;\n    \n    // Calculate beat duration: duration per beat × beat note value\n    return secondsPerBeat * beatNoteValue;\n  }, [tempo, timeSignature]);\n\n  // Calculate measure duration in seconds (exact same as MeasureDisplay)\n  const measureDuration = useCallback(() => {\n    // Convert tempo (BPM) to seconds per beat\n    const secondsPerBeat = 60 / tempo;\n    \n    // The denominator tells us what note gets one beat\n    // 4 = quarter note, 8 = eighth note, 2 = half note, etc.\n    const beatNoteValue = 4 / timeSignature.denominator;\n    \n    // Calculate measure duration: beats per measure × duration per beat\n    return timeSignature.numerator * secondsPerBeat * beatNoteValue;\n  }, [tempo, timeSignature]);\n\n  // Calculate all beat positions\n  const calculateBeats = useCallback(() => {\n    const beatDur = beatDuration();\n    const measureDur = measureDuration();\n    const beats = [];\n    \n    // Start from the first measure time\n    let currentTime = firstMeasureTime;\n    let beatNumber = 1;\n    let measureNumber = 1;\n    \n    while (currentTime <= duration) {\n      // Add all beats in this measure\n      for (let beatInMeasure = 0; beatInMeasure < timeSignature.numerator; beatInMeasure++) {\n        const beatTime = currentTime + (beatInMeasure * beatDur);\n        if (beatTime <= duration) {\n          beats.push({\n            time: beatTime,\n            beatNumber: beatNumber,\n            measureNumber: measureNumber,\n            isMeasureStart: beatInMeasure === 0\n          });\n          beatNumber++;\n        }\n      }\n      currentTime += measureDur;\n      measureNumber++;\n    }\n    \n    return beats;\n  }, [duration, firstMeasureTime, beatDuration, measureDuration, timeSignature]);\n\n  // Calculate measure positions (for when measures are visible)\n  const calculateMeasures = useCallback(() => {\n    const measureDur = measureDuration();\n    const measures = [];\n    \n    // Start from the first measure time\n    let currentTime = firstMeasureTime;\n    let measureNumber = 1;\n    \n    while (currentTime <= duration) {\n      measures.push({\n        time: currentTime,\n        number: measureNumber\n      });\n      currentTime += measureDur;\n      measureNumber++;\n    }\n    \n    return measures;\n  }, [duration, firstMeasureTime, measureDuration]);\n\n  // Convert time to pixel position\n  const timeToPixels = useCallback((time: number) => {\n    // Calculate pixels per second based on zoom level\n    // Base pixels per second is 40 (WaveSurfer's actual default minPxPerSec)\n    const basePixelsPerSecond = 40;\n    const zoomedPixelsPerSecond = basePixelsPerSecond * zoomLevel;\n    return time * zoomedPixelsPerSecond;\n  }, [zoomLevel]);\n\n  const beats = calculateBeats();\n  const measures = calculateMeasures();\n\n\n\n  // Don't render anything if not visible\n  if (!visible) {\n    return null;\n  }\n\n  return (\n    <div \n      ref={internalContainerRef}\n      className=\"absolute pointer-events-none\"\n      style={{ \n        height: '120px',\n        top: 0,\n        left: 0,\n        right: 0\n      }}\n    >\n      {showMeasures ? (\n        // When measures are visible, only show grid lines at measure boundaries\n        measures.map((measure, index) => (\n          <div key={`measure-${index}`}>\n            <div\n              className=\"absolute top-0 bottom-0 w-px bg-white opacity-40\"\n              style={{\n                left: `${timeToPixels(measure.time)}px`,\n                transform: 'translateX(-50%)'\n              }}\n            />\n          </div>\n        ))\n      ) : (\n        // When measures are not visible, show grid lines for every beat\n        beats.map((beat, index) => (\n          <div key={`beat-${index}`}>\n            {/* Beat line - lighter for regular beats, darker for measure starts */}\n            <div\n              className={`absolute top-0 bottom-0 w-px ${\n                beat.isMeasureStart \n                  ? 'bg-white opacity-60' // More visible for measure starts\n                  : 'bg-white opacity-30' // Less visible for regular beats\n              }`}\n              style={{\n                left: `${timeToPixels(beat.time)}px`,\n                transform: 'translateX(-50%)'\n              }}\n            />\n          </div>\n        ))\n      )}\n    </div>\n  );\n};\n\nexport default GridLines; ","import { useEffect, useRef, useState, useMemo, useCallback } from 'react';\nimport { useWavesurfer } from '@wavesurfer/react';\nimport RegionsPlugin from 'wavesurfer.js/dist/plugins/regions';\nimport MeasureDisplay from './MeasureDisplay';\nimport GridLines from './GridLines';\nimport { TimeSignature } from '../types/music';\nimport { showSignupModal } from '../hooks/useSignupModal';\n\ninterface WaveformDisplayProps {\n  audioFile: File;\n  mode: 'preview' | 'loop' | 'cue';\n  loopStart: number;\n  loopEnd: number;\n  cuePoints: number[];\n  onLoopPointsChange: (start: number, end: number) => void;\n  onCuePointChange: (index: number, time: number) => void;\n  playhead?: number;\n  playbackTime?: number;\n  zoomLevel: number;\n  onZoomIn: () => void;\n  onZoomOut: () => void;\n  onResetZoom: () => void;\n  trackId?: string;\n  // Measure display props\n  showMeasures?: boolean;\n  tempo?: number;\n  timeSignature?: TimeSignature;\n  firstMeasureTime?: number;\n  onFirstMeasureChange?: (time: number) => void;\n  // Cue thumb props\n  showCueThumbs?: boolean;\n  // Playback control\n  isPlaying?: boolean;\n  // Playhead position change callback\n  onPlayheadChange?: (time: number) => void;\n  // Scroll state callback\n  onScrollStateChange?: (isScrolling: boolean) => void;\n  // Demo mode\n  isDemoMode?: boolean;\n}\n\nconst WaveformDisplay = ({\n  audioFile,\n  mode,\n  playhead,\n  loopStart,\n  loopEnd,\n  cuePoints,\n  onLoopPointsChange,\n  onCuePointChange,\n  playbackTime = 0,\n  zoomLevel,\n  onZoomIn,\n  onZoomOut,\n  onResetZoom,\n  trackId,\n  // Measure display props\n  showMeasures = false,\n  tempo = 120,\n  timeSignature = { numerator: 4, denominator: 4 },\n  firstMeasureTime = 0,\n  onFirstMeasureChange,\n  // Cue thumb props\n  showCueThumbs = false,\n  // Playback control\n  isPlaying = false,\n  // Playhead position change callback\n  onPlayheadChange,\n  // Scroll state callback\n  onScrollStateChange,\n  // Demo mode\n  isDemoMode = false,\n}: WaveformDisplayProps) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n  const [audioUrl, setAudioUrl] = useState<string | undefined>(undefined);\n  const [plugins, setPlugins] = useState<any[]>([]);\n  const [internalShowMeasures, setInternalShowMeasures] = useState(false);\n  const [internalIsPlaying, setInternalIsPlaying] = useState(false);\n  const [isScrolling, setIsScrolling] = useState(false);\n  const scrollTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  \n  // Refs to track regions and prevent recreation\n  const regionsPluginRef = useRef<any>(null);\n  const currentRegionsRef = useRef<any[]>([]);\n  const lastUpdateTimeRef = useRef<number>(0);\n  const initialSetupDoneRef = useRef<boolean>(false);\n  const updateTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  \n  // Track previous values to detect changes\n  const prevLoopStartRef = useRef<number>(loopStart);\n  const prevLoopEndRef = useRef<number>(loopEnd);\n  const prevCuePointsRef = useRef<number[]>(cuePoints);\n  const prevModeRef = useRef<string>(mode);\n\n  const onLoopPointsChangeRef = useRef(onLoopPointsChange);\n  const onCuePointChangeRef = useRef(onCuePointChange);\n\n  useEffect(() => {\n    onLoopPointsChangeRef.current = onLoopPointsChange;\n  }, [onLoopPointsChange]);\n\n  useEffect(() => {\n    onCuePointChangeRef.current = onCuePointChange;\n  }, [onCuePointChange]);\n\n  // Debounced update function to prevent rapid changes\n  const debouncedUpdate = useCallback((callback: () => void, delay: number = 100) => {\n    if (updateTimeoutRef.current) {\n      clearTimeout(updateTimeoutRef.current);\n    }\n    updateTimeoutRef.current = setTimeout(callback, delay);\n  }, []);\n\n  // Cleanup timeout on unmount\n  useEffect(() => {\n    return () => {\n      if (updateTimeoutRef.current) {\n        clearTimeout(updateTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  // Effect to create/revoke Blob URL\n  useEffect(() => {\n    const newUrl = URL.createObjectURL(audioFile);\n    setAudioUrl(newUrl);\n\n    return () => {\n      URL.revokeObjectURL(newUrl);\n    };\n  }, [audioFile]);\n\n  // Effect to instantiate plugins only once per file\n  useEffect(() => {\n    const regionsPlugin = RegionsPlugin.create();\n    regionsPluginRef.current = regionsPlugin;\n\n    setPlugins([regionsPlugin]);\n\n    // Reset setup flag when file changes\n    initialSetupDoneRef.current = false;\n\n    return () => {\n      regionsPluginRef.current = null;\n      currentRegionsRef.current = [];\n      setPlugins([]);\n    };\n  }, [audioUrl]);\n\n  // useWavesurfer hook\n  const { wavesurfer, isReady, currentTime } = useWavesurfer({\n    container: containerRef,\n    url: audioUrl,\n    waveColor: '#008CFF',\n    progressColor: '#00F5C3',\n    cursorColor: '#00F5C3',\n    height: 120,\n    normalize: true,\n    autoplay: false,\n    plugins: plugins,\n  });\n\n\n\n  // Track playback state internally\n  useEffect(() => {\n    if (!wavesurfer) return;\n\n    const handlePlay = () => {\n      setInternalIsPlaying(true);\n    };\n    const handlePause = () => {\n      setInternalIsPlaying(false);\n    };\n    const handleFinish = () => {\n      setInternalIsPlaying(false);\n    };\n\n    wavesurfer.on('play', handlePlay);\n    wavesurfer.on('pause', handlePause);\n    wavesurfer.on('finish', handleFinish);\n\n    return () => {\n      wavesurfer.un('play', handlePlay);\n      wavesurfer.un('pause', handlePause);\n      wavesurfer.un('finish', handleFinish);\n    };\n  }, [wavesurfer]);\n\n  // Track manual playhead position changes\n  useEffect(() => {\n    if (!wavesurfer || !onPlayheadChange) return;\n\n    const handleSeek = () => {\n      // Allow position changes during both playback and when paused\n      const newTime = wavesurfer.getCurrentTime();\n      onPlayheadChange(newTime);\n    };\n\n    wavesurfer.on('interaction', handleSeek);\n\n    return () => {\n      wavesurfer.un('interaction', handleSeek);\n    };\n  }, [wavesurfer, onPlayheadChange]);\n\n  // Calculate the appropriate minPxPerSec for the current zoom level\n  const calculateMinPxPerSec = useCallback(() => {\n    if (!wavesurfer || !isReady || !containerRef.current) return 40 * zoomLevel;\n    \n    const duration = wavesurfer.getDuration();\n    if (zoomLevel <= 1) {\n      // At 1x zoom, calculate the minPxPerSec needed to fit the entire waveform\n      // We need to get the actual scroll container width (the immediate parent)\n      const scrollContainer = containerRef.current.parentElement;\n      if (scrollContainer) {\n        const availableWidth = scrollContainer.clientWidth;\n        // Ensure the waveform fits exactly within the available width\n        return availableWidth / duration;\n      }\n    }\n    return 40 * zoomLevel;\n  }, [wavesurfer, isReady, zoomLevel]);\n\n  // Set initial width for both containers when ready\n  useEffect(() => {\n    if (wavesurfer && isReady) {\n      const duration = wavesurfer.getDuration();\n      const minPxPerSec = calculateMinPxPerSec();\n      \n      // Use a small delay to ensure DOM is fully rendered\n      setTimeout(() => {\n        if (containerRef.current) {\n          // Always use the exact waveform width based on duration and minPxPerSec\n          const waveformWidth = duration * minPxPerSec;\n          containerRef.current.style.width = `${waveformWidth}px`;\n        }\n      }, 50);\n    }\n  }, [wavesurfer, isReady, zoomLevel, calculateMinPxPerSec]);\n\n  // Auto-scroll to follow playhead during playback with center-lock behavior\n  useEffect(() => {\n    if (!wavesurfer || !isReady || !containerRef.current) return;\n\n    const parentContainer = containerRef.current.parentElement;\n    if (!parentContainer) return;\n\n    // Only auto-scroll if playing\n    if (!isPlaying) return;\n\n    const pxPerSec = calculateMinPxPerSec();\n    const playheadPosition = (currentTime ?? 0) * pxPerSec;\n    const containerWidth = parentContainer.clientWidth;\n    const containerCenter = containerWidth / 2;\n    \n    // Calculate where the playhead should be relative to the scroll position\n    // We want the playhead to be at the center of the container once it reaches there\n    const targetScrollLeft = playheadPosition - containerCenter;\n    \n    // Only start scrolling once the playhead would reach the center\n    if (playheadPosition >= containerCenter) {\n      const totalWidth = wavesurfer.getDuration() * pxPerSec;\n      const maxScrollLeft = Math.max(0, totalWidth - containerWidth);\n      const clampedScrollTarget = Math.max(0, Math.min(targetScrollLeft, maxScrollLeft));\n      \n      // Smoothly scroll to keep playhead at center\n      parentContainer.scrollTo({\n        left: clampedScrollTarget,\n        behavior: 'auto' // Use 'auto' for immediate scrolling during playback\n      });\n    }\n  }, [currentTime, wavesurfer, isReady, zoomLevel, isPlaying]);\n\n  // Improved playhead centering function\n  const centerPlayheadAfterZoom = useCallback((targetZoomLevel = zoomLevel) => {\n    if (!wavesurfer || !isReady || !containerRef.current) return;\n    \n    // Get current time directly from wavesurfer instance for accuracy\n    const centerTime = wavesurfer.getCurrentTime();\n    const pxPerSec = calculateMinPxPerSec();\n    const playheadPosition = centerTime * pxPerSec;\n    const parentContainer = containerRef.current.parentElement;\n    \n    if (!parentContainer) return;\n    \n    const containerWidth = parentContainer.clientWidth;\n    const totalWidth = wavesurfer.getDuration() * pxPerSec;\n    const scrollTarget = playheadPosition - containerWidth / 2;\n    \n    // Ensure scroll target is within bounds\n    const maxScrollLeft = Math.max(0, totalWidth - containerWidth);\n    const clampedScrollTarget = Math.max(0, Math.min(scrollTarget, maxScrollLeft));\n    \n    // Use smooth scrolling for better UX\n    parentContainer.scrollTo({\n      left: clampedScrollTarget,\n      behavior: 'smooth'\n    });\n  }, [wavesurfer, isReady, zoomLevel]);\n\n  // Function to clear all regions\n  const clearRegions = useCallback(async () => {\n    \n    // First, clear tracked regions\n    if (regionsPluginRef.current && currentRegionsRef.current.length > 0) {\n      currentRegionsRef.current.forEach(region => {\n        try {\n          // Remove thumb element if it exists\n          if (region.thumbElement) {\n            region.thumbElement.remove();\n            region.thumbElement = null;\n          }\n          // Remove all event listeners before removing the region\n          region.unAll();\n          region.remove();\n        } catch (e) {\n          // Region might already be removed\n          console.warn('Region removal warning:', e);\n        }\n      });\n      currentRegionsRef.current = [];\n    }\n    \n    // Then, clear ALL regions from the plugin to ensure no leftover regions\n    if (regionsPluginRef.current) {\n      try {\n        const allRegions = regionsPluginRef.current.getRegions();\n        \n        // Try using the plugin's clearRegions method first\n        try {\n          regionsPluginRef.current.clearRegions();\n        } catch (e) {\n          console.warn('plugin.clearRegions() failed, trying manual removal:', e);\n          \n          // Fallback to manual removal\n          Object.values(allRegions).forEach((region: any) => {\n            try {\n              // Remove thumb element if it exists\n              if (region.thumbElement) {\n                region.thumbElement.remove();\n                region.thumbElement = null;\n              }\n              \n              // Remove all event listeners\n              region.unAll();\n              \n              // Try to remove the region element from DOM directly\n              if (region.element && region.element.parentNode) {\n                region.element.parentNode.removeChild(region.element);\n              }\n              \n              // Remove the region from the plugin\n              region.remove();\n            } catch (e) {\n              console.warn('Region removal warning:', e);\n            }\n          });\n        }\n        \n        // Force a small delay to ensure removal is complete\n        await new Promise(resolve => setTimeout(resolve, 10));\n        \n      } catch (e) {\n        console.warn('Error clearing all regions:', e);\n      }\n    }\n    \n    // Also clean up any orphaned thumbs for this track\n    if (containerRef.current) {\n      const currentTrackId = trackId || 'default';\n      const orphanedThumbs = containerRef.current.querySelectorAll(`.cue-thumb-${currentTrackId}`);\n      orphanedThumbs.forEach((thumb: Element) => thumb.remove());\n    }\n    \n    // Force a small delay to ensure DOM updates are complete\n    return new Promise(resolve => setTimeout(resolve, 5));\n  }, [trackId, isPlaying]);\n\n  // Function to create regions based on mode\n  const createRegions = useCallback(async () => {\n    if (!wavesurfer || !isReady || !regionsPluginRef.current) return;\n\n    await clearRegions();\n\n    if (mode === 'loop') {\n      const region = regionsPluginRef.current.addRegion({\n        start: loopStart,\n        end: loopEnd,\n        color: 'rgba(0, 245, 195, 0.2)',\n        drag: true, // Always allow dragging for loop regions\n        resize: true, // Always allow resizing for loop regions\n        id: `loop-region-${trackId || 'default'}`,\n        // Add visual styling for better interaction\n        handleStyle: {\n          left: {\n            backgroundColor: 'rgba(0, 245, 195, 0.8)',\n            border: '2px solid #00F5C3',\n            borderRadius: '2px',\n          },\n          right: {\n            backgroundColor: 'rgba(0, 245, 195, 0.8)',\n            border: '2px solid #00F5C3',\n            borderRadius: '2px',\n          }\n        }\n      });\n\n      region.on('update-end', () => {\n        // Ensure the region bounds are valid\n        const start = Math.max(0, region.start);\n        const end = Math.max(start + 0.1, region.end);\n        \n        debouncedUpdate(() => {\n          onLoopPointsChangeRef.current(start, end);\n          // Update refs to prevent recreation\n          prevLoopStartRef.current = start;\n          prevLoopEndRef.current = end;\n        });\n      });\n\n\n\n      currentRegionsRef.current = [region];\n    } else if (mode === 'cue') {\n      const duration = wavesurfer.getDuration();\n      const epsilon = 0.05; // slightly larger to avoid float issues\n      const newRegions = cuePoints.map((point, index) => {\n        // Clamp start to [0, duration - epsilon]\n        const clampedStart = Math.max(0, Math.min(point, duration - epsilon));\n        // Ensure region end does not exceed duration\n        const regionEnd = Math.min(clampedStart + 0.01, duration);\n        const region = regionsPluginRef.current.addRegion({\n          start: clampedStart,\n          end: regionEnd,\n          color: 'rgba(255, 77, 79, 0.3)',\n          drag: !isDemoMode, // Disable dragging in demo mode\n          resize: false,\n          id: `cue-${trackId || 'default'}-${index}`,\n          // Add visual styling for better interaction\n          handleStyle: {\n            left: {\n              backgroundColor: 'rgba(255, 77, 79, 0.8)',\n              border: '2px solid #FF4D4F',\n              borderRadius: '2px',\n            },\n            right: {\n              backgroundColor: 'rgba(255, 77, 79, 0.8)',\n              border: '2px solid #FF4D4F',\n              borderRadius: '2px',\n            }\n          }\n        });\n\n        // Only update the cue point and region position, do not recreate all regions\n        region.on('update-end', () => {\n          const cuePoint = region.start + (region.end - region.start) / 2;\n          const clampedCuePoint = Math.max(0, Math.min(wavesurfer.getDuration(), cuePoint));\n          debouncedUpdate(() => {\n            onCuePointChangeRef.current(index, clampedCuePoint);\n            const newCuePoints = [...prevCuePointsRef.current];\n            newCuePoints[index] = clampedCuePoint;\n            prevCuePointsRef.current = newCuePoints;\n          });\n        });\n\n        // Add thumb after region is created\n        if (showCueThumbs) {\n          // Use a more reliable method to add thumb\n          setTimeout(() => {\n            addThumbToRegion(region, index);\n          }, 100);\n        }\n\n        // Add demo mode event listeners to the region itself (cue points only)\n        if (isDemoMode) {\n          region.on('mousedown', (e: any) => {\n            e.preventDefault();\n            e.stopPropagation();\n            showSignupModal('custom_cue_points');\n          });\n          \n          region.on('touchstart', (e: any) => {\n            e.preventDefault();\n            e.stopPropagation();\n            showSignupModal('custom_cue_points');\n          });\n\n          region.on('click', (e: any) => {\n            e.preventDefault();\n            e.stopPropagation();\n            showSignupModal('custom_cue_points');\n          });\n        }\n\n        return region;\n      });\n\n      currentRegionsRef.current = newRegions;\n    }\n  }, [wavesurfer, isReady, mode, loopStart, loopEnd, cuePoints.length, trackId, showCueThumbs, isDemoMode]);\n\n  // Improved function to add thumb element to a region\n  // Alternative approach: Use WaveSurfer's internal region management\n  const addThumbToRegion = useCallback((region: any, index: number) => {\n    // Use region.element directly\n    const regionElement = region.element;\n\n    if (!regionElement) {\n      console.warn(`Could not find region element for index ${index}. Region object:`, region);\n      return;\n    }\n\n    // Remove existing thumb if it exists (both from the region and cleanup reference)\n    if (region.thumbElement) {\n      region.thumbElement.remove();\n      region.thumbElement = null;\n    }\n    \n    // Also remove any existing thumb elements in the region for this track\n    const currentTrackId = trackId || 'default';\n    const existingThumbs = regionElement.querySelectorAll(`.cue-thumb-${currentTrackId}`);\n    existingThumbs.forEach((thumb: Element) => thumb.remove());\n\n    // Create the hitbox\n    const hitbox = document.createElement('div');\n    \n    // Set cursor and pointer events based on demo mode\n    const cursor = isDemoMode ? 'pointer' : 'grab';\n    const pointerEvents = 'auto';\n    \n    hitbox.style.cssText = `\n      position: absolute;\n      bottom: -4px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 40px;\n      height: 40px;\n      cursor: ${cursor};\n      z-index: 31;\n      pointer-events: ${pointerEvents};\n      background: transparent;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `;\n\n    // Create the visible node\n    const thumb = document.createElement('div');\n    thumb.className = `cue-thumb cue-thumb-${trackId || 'default'}`;\n    thumb.style.cssText = `\n      width: 24px;\n      height: 24px;\n      background-color: #FF4D4F;\n      border: 2px solid #FF4D4F;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      font-size: 12px;\n      font-weight: bold;\n      pointer-events: none;\n      position: relative;\n    `;\n\n    thumb.textContent = index === 9 ? '0' : (index + 1).toString();\n\n    // Add lock icon in demo mode\n    if (isDemoMode) {\n      const lockIcon = document.createElement('div');\n      lockIcon.style.cssText = `\n        position: absolute;\n        bottom: -3px;\n        right: -3px;\n        width: 16px;\n        height: 16px;\n        background-color: transparent;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 12px;\n        color: #FFD700;\n        font-weight: bold;\n        z-index: 32;\n        pointer-events: none;\n        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));\n      `;\n      lockIcon.innerHTML = '🔒';\n      thumb.appendChild(lockIcon);\n    }\n\n    hitbox.appendChild(thumb);\n    regionElement.appendChild(hitbox);\n\n    // Add event listeners based on demo mode\n    if (isDemoMode) {\n      // In demo mode, prevent dragging and show signup modal on click\n      hitbox.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        showSignupModal('custom_cue_points');\n      });\n      \n      hitbox.addEventListener('touchstart', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        showSignupModal('custom_cue_points');\n      });\n\n      // Also add click event for better user experience\n      hitbox.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        showSignupModal('custom_cue_points');\n      });\n    } else {\n      // In normal mode, allow dragging by not preventing default behavior\n      // The region's built-in drag functionality will work\n    }\n\n    // Store reference to the hitbox (which contains the thumb) for cleanup\n    region.thumbElement = hitbox;\n  }, [trackId, isDemoMode]);\n\n  // Function to remove thumbs from regions\n  const removeThumbsFromRegions = useCallback(() => {\n    currentRegionsRef.current.forEach(region => {\n      if (region.thumbElement) {\n        region.thumbElement.remove();\n        region.thumbElement = null;\n      }\n    });\n    \n    // Also remove any orphaned thumbs from the container for this track\n    if (containerRef.current) {\n      const currentTrackId = trackId || 'default';\n      const orphanedThumbs = containerRef.current.querySelectorAll(`.cue-thumb-${currentTrackId}`);\n      orphanedThumbs.forEach((thumb: Element) => thumb.remove());\n    }\n  }, []);\n\n  // Handle thumb visibility and ensure proper cleanup/recreation\n  useEffect(() => {\n    if (!wavesurfer || !isReady || !initialSetupDoneRef.current) return;\n\n    if (mode === 'cue') {\n      if (showCueThumbs) {\n        // Remove any existing thumbs first\n        removeThumbsFromRegions();\n        \n        // Add thumbs with a delay to ensure regions are fully rendered\n        setTimeout(() => {\n          currentRegionsRef.current.forEach((region, index) => {\n            addThumbToRegion(region, index);\n          });\n        }, 200);\n      } else {\n        removeThumbsFromRegions();\n      }\n    } else {\n      // When not in cue mode, make sure to clean up any thumbs\n      removeThumbsFromRegions();\n    }\n  }, [showCueThumbs, mode, wavesurfer, isReady, addThumbToRegion, removeThumbsFromRegions]);\n\n  // Handle mode changes explicitly to ensure proper region cleanup\n  useEffect(() => {\n    const handleModeChange = async () => {\n      if (!wavesurfer || !isReady || !initialSetupDoneRef.current) return;\n      \n      const modeChanged = prevModeRef.current !== mode;\n      if (modeChanged) {\n        // Clear regions immediately when mode changes\n        await clearRegions();\n        // Create new regions after clearing is complete\n        await createRegions();\n        \n        // Update mode ref immediately\n        prevModeRef.current = mode;\n      }\n    };\n    \n    handleModeChange();\n  }, [mode, wavesurfer, isReady, createRegions, clearRegions]);\n\n  // Recreate regions when relevant parameters change (but not mode changes)\n  useEffect(() => {\n    const handleParameterChange = async () => {\n      if (!wavesurfer || !isReady || !initialSetupDoneRef.current) return;\n      \n      // Only update if mode hasn't changed (mode changes are handled separately)\n      const modeChanged = prevModeRef.current !== mode;\n      if (modeChanged) return;\n      \n      // Check if only the parameters changed (not the mode)\n      const loopChanged = mode === 'loop' && (\n        prevLoopStartRef.current !== loopStart || \n        prevLoopEndRef.current !== loopEnd\n      );\n      const cuePointsChanged = mode === 'cue' && (\n        prevCuePointsRef.current.length !== cuePoints.length ||\n        prevCuePointsRef.current.some((point, index) => point !== cuePoints[index])\n      );\n      \n      const needsUpdate = loopChanged || cuePointsChanged;\n      \n      if (needsUpdate) {\n        // Clear regions first, then create new ones to prevent duplicates\n        await clearRegions();\n        await createRegions();\n        // Update all refs to prevent unnecessary recreations\n        prevLoopStartRef.current = loopStart;\n        prevLoopEndRef.current = loopEnd;\n        prevCuePointsRef.current = [...cuePoints];\n      }\n    };\n    \n    handleParameterChange();\n  }, [wavesurfer, isReady, mode, loopStart, loopEnd, cuePoints, createRegions, clearRegions]);\n\n  // Effect to handle initial setup when waveform becomes ready\n  useEffect(() => {\n    const setupRegions = async () => {\n      if (wavesurfer && isReady && !initialSetupDoneRef.current) {\n        // Set initial zoom level using calculated minPxPerSec\n        const newMinPxPerSec = calculateMinPxPerSec();\n        wavesurfer.setOptions({ minPxPerSec: newMinPxPerSec });\n        \n        // Create initial regions\n        await createRegions();\n        \n        // Set initial position\n        const initialTime = currentTime || playbackTime || 0;\n        setTimeout(() => {\n          if (wavesurfer && isReady) {\n            wavesurfer.setTime(initialTime);\n          }\n        }, 100);\n        \n        initialSetupDoneRef.current = true;\n        \n        // Update previous values\n        prevLoopStartRef.current = loopStart;\n        prevLoopEndRef.current = loopEnd;\n        prevCuePointsRef.current = [...cuePoints];\n        prevModeRef.current = mode;\n      }\n    };\n    \n    setupRegions();\n  }, [wavesurfer, isReady, zoomLevel, currentTime, playbackTime, loopStart, loopEnd, cuePoints, mode, createRegions, calculateMinPxPerSec]);\n\n  // Effect to handle zoom changes\n  useEffect(() => {\n    if (wavesurfer && isReady && initialSetupDoneRef.current) {\n      const newMinPxPerSec = calculateMinPxPerSec();\n      wavesurfer.setOptions({ minPxPerSec: newMinPxPerSec });\n      \n      // Update container width to match new zoom level\n      if (containerRef.current) {\n        const duration = wavesurfer.getDuration();\n        const newWidth = duration * newMinPxPerSec;\n        containerRef.current.style.width = `${newWidth}px`;\n      }\n      \n      // Note: Removed region recreation on zoom to prevent layering issues\n      // Regions will be recreated only when mode or parameters change\n      \n      // Use improved centering with small delay for layout updates\n      setTimeout(() => centerPlayheadAfterZoom(zoomLevel), 10);\n    }\n  }, [zoomLevel, wavesurfer, isReady, centerPlayheadAfterZoom, calculateMinPxPerSec]);\n\n  // Effect to handle window resize at 1x zoom\n  useEffect(() => {\n    if (zoomLevel > 1 || !wavesurfer || !isReady || !initialSetupDoneRef.current) return;\n\n    const handleResize = () => {\n      if (!containerRef.current || !scrollContainerRef.current) return;\n      \n      const scrollContainer = containerRef.current.parentElement;\n      if (scrollContainer) {\n        // Update WaveSurfer minPxPerSec to match the new container width\n        const duration = wavesurfer.getDuration();\n        const newMinPxPerSec = scrollContainer.clientWidth / duration;\n        wavesurfer.setOptions({ minPxPerSec: newMinPxPerSec });\n        \n        // Update container width to match the new minPxPerSec\n        const newWidth = duration * newMinPxPerSec;\n        containerRef.current.style.width = `${newWidth}px`;\n        \n        // Update scroll container width to match the available space\n        const parentContainer = scrollContainerRef.current.parentElement?.parentElement;\n        if (parentContainer) {\n          scrollContainerRef.current.style.width = '100%';\n        }\n      }\n    };\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, [zoomLevel, wavesurfer, isReady]);\n\n  // Effect to manage scroll container width at 1x zoom\n  useEffect(() => {\n    if (!scrollContainerRef.current || !wavesurfer || !isReady) return;\n    \n    if (zoomLevel <= 1) {\n      // At 1x zoom, set the scroll container to fit the available space\n      const parentContainer = scrollContainerRef.current.parentElement?.parentElement;\n      if (parentContainer) {\n        scrollContainerRef.current.style.width = '100%';\n      }\n    } else {\n      // At higher zoom levels, let the scroll container be auto\n      scrollContainerRef.current.style.width = 'auto';\n    }\n  }, [zoomLevel, wavesurfer, isReady]);\n\n  // Effect to handle scroll events and communicate scroll state\n  useEffect(() => {\n    if (!scrollContainerRef.current || !onScrollStateChange) return;\n\n    const handleScroll = () => {\n      setIsScrolling(true);\n      onScrollStateChange(true);\n      \n      // Clear existing timeout\n      if (scrollTimeoutRef.current) {\n        clearTimeout(scrollTimeoutRef.current);\n      }\n      \n      // Set a timeout to mark scrolling as finished after 150ms of no scroll events\n      scrollTimeoutRef.current = setTimeout(() => {\n        setIsScrolling(false);\n        onScrollStateChange(false);\n      }, 150);\n    };\n\n    const scrollContainer = scrollContainerRef.current;\n    scrollContainer.addEventListener('scroll', handleScroll, { passive: true });\n\n    return () => {\n      scrollContainer.removeEventListener('scroll', handleScroll);\n      if (scrollTimeoutRef.current) {\n        clearTimeout(scrollTimeoutRef.current);\n      }\n    };\n  }, [onScrollStateChange]);\n\n  // Optimized playhead update with throttling\n  useEffect(() => {\n    if (!wavesurfer || !isReady) return;\n\n    const now = performance.now();\n    // Throttle updates to 30fps for smoother performance\n    if (now - lastUpdateTimeRef.current < 33) return;\n\n    wavesurfer.setTime(playbackTime);\n    lastUpdateTimeRef.current = now;\n  }, [playbackTime, wavesurfer, isReady]);\n\n  // Handle explicit playhead updates (less frequent)\n  useEffect(() => {\n    if (wavesurfer && isReady && typeof playhead === 'number') {\n      wavesurfer.setTime(playhead);\n    }\n  }, [playhead, wavesurfer, isReady]);\n\n  useEffect(() => {\n    if (wavesurfer && isReady && initialSetupDoneRef.current) {\n      setInternalShowMeasures(showMeasures || false);\n    }\n  }, [showMeasures, wavesurfer, isReady]);\n\n  // Calculate grid size based on tempo\n  const calculateGridSize = useCallback(() => {\n    // Convert tempo (BPM) to seconds per beat\n    const secondsPerBeat = 60 / tempo;\n    \n    // The denominator tells us what note gets one beat\n    // 4 = quarter note, 8 = eighth note, 2 = half note, etc.\n    const beatNoteValue = 4 / timeSignature.denominator;\n    \n    // Calculate beat duration: duration per beat × beat note value\n    const beatDuration = secondsPerBeat * beatNoteValue;\n    \n    // Base pixels per second is 40 (WaveSurfer's actual default minPxPerSec)\n    const basePixelsPerSecond = 40;\n    const zoomedPixelsPerSecond = basePixelsPerSecond * zoomLevel;\n    \n    // Calculate pixels per beat\n    const pixelsPerBeat = beatDuration * zoomedPixelsPerSecond;\n    \n    // Round to nearest pixel and ensure minimum size\n    return Math.max(10, Math.round(pixelsPerBeat));\n  }, [tempo, timeSignature, zoomLevel]);\n\n  const gridSize = calculateGridSize();\n\n  return (\n    <div className=\"w-full box-border overflow-hidden relative\">\n      {/* Compact Zoom Controls Overlay */}\n      <div className=\"absolute top-2 right-2 z-20 flex items-center gap-1 bg-audafact-surface-2 bg-opacity-80 border border-audafact-divider rounded-md shadow-sm px-1 py-0.5\">\n        <button\n          type=\"button\"\n          onClick={onZoomOut}\n          className=\"p-1 rounded hover:bg-audafact-surface-1 text-audafact-text-secondary hover:text-audafact-accent-cyan focus:outline-none\"\n          title=\"Zoom Out (X)\"\n          aria-label=\"Zoom out\"\n        >\n          <svg className=\"w-3.5 h-3.5\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n            <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\" />\n          </svg>\n        </button>\n        <button\n          type=\"button\"\n          onClick={onResetZoom}\n          className=\"px-1.5 py-0.5 text-[10px] leading-none rounded hover:bg-audafact-surface-1 text-audafact-text-secondary hover:text-audafact-accent-cyan focus:outline-none\"\n          title=\"Reset Zoom (C)\"\n          aria-label=\"Reset zoom\"\n        >\n          {(typeof zoomLevel === 'number' ? zoomLevel : 1).toFixed(2).replace(/\\.00$/, '')}x\n        </button>\n        <button\n          type=\"button\"\n          onClick={onZoomIn}\n          className=\"p-1 rounded hover:bg-audafact-surface-1 text-audafact-text-secondary hover:text-audafact-accent-cyan focus:outline-none\"\n          title=\"Zoom In (Z)\"\n          aria-label=\"Zoom in\"\n        >\n          <svg className=\"w-3.5 h-3.5\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n            <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\" />\n            <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\" />\n          </svg>\n        </button>\n      </div>\n      {!isReady && (\n        <div className=\"absolute inset-0 flex items-center justify-center audafact-text-secondary bg-audafact-surface-1 z-10\">\n          {`Loading waveform... ${mode}`}\n        </div>\n      )}\n\n      <div className={`transition-opacity duration-300 ${isReady ? 'opacity-100' : 'opacity-0'}`}>\n        <div \n          ref={scrollContainerRef}\n          style={{ \n            overflowX: zoomLevel <= 1 ? 'hidden' : 'auto', \n            overflowY: 'hidden'\n          }}\n        >\n          <div\n            key={audioUrl || 'no-url'}\n            ref={containerRef}\n            className=\"w-full box-border\"\n            style={{ \n              height: '170px', \n              minWidth: '100%',\n              position: 'relative',\n              backgroundColor: '#111827',\n              backgroundImage: `\n                linear-gradient(rgba(139, 148, 158, 0.1) 1px, transparent 1px),\n                linear-gradient(90deg, rgba(139, 148, 158, 0.1) 1px, transparent 1px)\n              `,\n              backgroundSize: `${gridSize}px ${gridSize}px`\n            }}\n          >\n            {/* Grid Lines Overlay - Always visible */}\n            {isReady && wavesurfer && (\n              <GridLines\n                key={`grid-lines-${trackId || 'default'}-${tempo}`}\n                duration={wavesurfer.getDuration()}\n                tempo={tempo}\n                zoomLevel={zoomLevel}\n                timeSignature={timeSignature}\n                firstMeasureTime={firstMeasureTime}\n                visible={true}\n                showMeasures={internalShowMeasures}\n              />\n            )}\n            \n            {/* Measure Display Overlay */}\n            {isReady && wavesurfer && (\n              <MeasureDisplay\n                key={`measure-display-${trackId || 'default'}-${tempo}`}\n                duration={wavesurfer.getDuration()}\n                tempo={tempo}\n                zoomLevel={zoomLevel}\n                onFirstMeasureChange={onFirstMeasureChange || (() => {})}\n                timeSignature={timeSignature}\n                firstMeasureTime={firstMeasureTime}\n                visible={internalShowMeasures}\n                containerRef={containerRef}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst WaveformDisplayContainer = (props: WaveformDisplayProps) => {\n  return (\n     <div className=\"w-full relative box-border overflow-hidden audafact-waveform-bg\" style={{ height: '190px' }}>\n       <WaveformDisplay {...props} />\n     </div>\n  );\n}\n\nexport default WaveformDisplayContainer;","import { useState, useRef, useEffect, useCallback } from 'react';\nimport { Play, Pause } from 'lucide-react';\nimport { useRecording } from '../context/RecordingContext';\n\ninterface TrackControlsProps {\n  mode: 'preview' | 'loop' | 'cue';\n  audioContext: AudioContext | null;\n  audioBuffer: AudioBuffer;\n  loopStart: number;\n  loopEnd: number;\n  cuePoints: number[];\n  ensureAudio: (callback: () => void) => Promise<void>;\n  isSelected?: boolean;\n  onSelect?: () => void;\n  onPlaybackTimeChange?: (time: number) => void;\n  onSpeedChange?: (speed: number) => void;\n  trackTempo?: number;\n  // Add volume props\n  volume?: number;\n  onVolumeChange?: (volume: number) => void;\n  // Add playback speed prop\n  playbackSpeed?: number;\n  // Add playback state callback\n  onPlaybackStateChange?: (isPlaying: boolean) => void;\n  // Add external playback time prop\n  playbackTime?: number;\n  // Add disabled prop\n  disabled?: boolean;\n  // Add filter props\n  filterEnabled?: boolean;\n  onFilterEnabledChange?: (enabled: boolean) => void;\n  lowpassFreq?: number;\n  onLowpassFreqChange?: (freq: number) => void;\n  highpassFreq?: number;\n  onHighpassFreqChange?: (freq: number) => void;\n  // Add delete button props\n  showDeleteButton?: boolean;\n  onDelete?: () => void;\n  // Add recording props\n  trackId?: string;\n  // Seek function ref\n  seekFunctionRef?: React.MutableRefObject<((seekTime: number) => void) | null>;\n  // Recording destination for audio capture\n  recordingDestination?: MediaStreamAudioDestinationNode | null;\n}\n\nconst TrackControls = ({ \n  mode, \n  audioContext, \n  audioBuffer, \n  loopStart, \n  loopEnd, \n  cuePoints, \n  ensureAudio, \n  isSelected = false,\n  onSelect,\n  onPlaybackTimeChange,\n  onSpeedChange,\n  trackTempo = 120,\n  volume = 1,\n  onVolumeChange,\n  playbackSpeed = 1,\n  onPlaybackStateChange,\n  playbackTime,\n  disabled = false,\n  lowpassFreq,\n  onLowpassFreqChange,\n  highpassFreq,\n  onHighpassFreqChange,\n  showDeleteButton = false,\n  onDelete,\n  trackId,\n  seekFunctionRef,\n  recordingDestination\n}: TrackControlsProps) => {\n  const { addRecordingEvent } = useRecording();\n  const [speed, setSpeed] = useState(playbackSpeed);\n  const [isPlaying, setIsPlaying] = useState(false);\n  \n\n  \n  // Reconnect audio sources when recording destination changes\n  useEffect(() => {\n    if (recordingDestination && audioSourceRef.current && isPlaying && audioContext) {\n      // Create a separate gain node for recording\n      const recordingGain = audioContext.createGain();\n      recordingGain.gain.value = gainNodeRef.current?.gain.value || 1;\n      \n      // Connect the audio source to the recording gain\n      audioSourceRef.current.connect(recordingGain);\n      recordingGain.connect(recordingDestination);\n    }\n  }, [recordingDestination, isPlaying, trackId, audioContext, mode]);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [activeCueIndex, setActiveCueIndex] = useState<number | null>(null);\n  \n  // Filter state\n  const [internalLowpassFreq, setInternalLowpassFreq] = useState(lowpassFreq || 20000);\n  const [internalHighpassFreq, setInternalHighpassFreq] = useState(highpassFreq || 20);\n  const [isFilterSectionExpanded, setIsFilterSectionExpanded] = useState(false);\n  \n  const audioSourceRef = useRef<AudioBufferSourceNode | null>(null);\n  const startTimeRef = useRef<number>(0);\n  const gainNodeRef = useRef<GainNode | null>(null);\n  const animationFrameRef = useRef<number | null>(null);\n  const lastUpdateTimeRef = useRef<number>(0);\n  const currentVolumeRef = useRef<number>(volume);\n  const currentSpeedRef = useRef<number>(1);\n  const activeCueIndexRef = useRef<number | null>(null);\n  const cueStartTimeRef = useRef<number>(0);\n  // Track the actual starting position when playback begins\n  const playbackStartTimeRef = useRef<number>(0);\n  \n  // Track mode changes to handle audio source updates\n  const prevModeRef = useRef<string>(mode);\n  \n  // Filter refs\n  const lowpassFilterRef = useRef<BiquadFilterNode | null>(null);\n  const highpassFilterRef = useRef<BiquadFilterNode | null>(null);\n  \n  // Current filter value refs for reliable state access\n  const currentLowpassFreqRef = useRef<number>(lowpassFreq || 20000);\n  const currentHighpassFreqRef = useRef<number>(highpassFreq || 20);\n  \n  // Track when we're processing a seek to prevent interference from update loop\n  const isSeekingRef = useRef<boolean>(false);\n\n  // Sync internal filter state with external props\n  useEffect(() => {\n    if (lowpassFreq !== undefined) {\n      setInternalLowpassFreq(lowpassFreq);\n      currentLowpassFreqRef.current = lowpassFreq;\n    }\n  }, [lowpassFreq]);\n\n  useEffect(() => {\n    if (highpassFreq !== undefined) {\n      setInternalHighpassFreq(highpassFreq);\n      currentHighpassFreqRef.current = highpassFreq;\n    }\n  }, [highpassFreq]);\n\n\n\n  // Calculate tempo-based speed range and step size\n  const getTempoSpeedRange = useCallback(() => {\n    const minTempo = Math.max(40, Math.round(trackTempo * 0.5)); // Half tempo, minimum 40 BPM\n    const maxTempo = Math.min(300, Math.round(trackTempo * 2)); // Double tempo, maximum 300 BPM\n    \n    // Calculate step size to ensure ~1 BPM change per step\n    // We want the step size to be approximately 1/trackTempo\n    const stepSize = Math.max(0.001, Math.min(0.05, 1 / trackTempo));\n    \n    return { minTempo, maxTempo, stepSize };\n  }, [trackTempo]);\n\n  // Convert speed multiplier to tempo\n  const speedToTempo = useCallback((speedMultiplier: number) => {\n    return Math.round(trackTempo * speedMultiplier);\n  }, [trackTempo]);\n\n  // Get current effective tempo\n  const getCurrentEffectiveTempo = useCallback(() => {\n    return speedToTempo(speed);\n  }, [speed, speedToTempo]);\n\n  // Filter control functions\n  const handleLowpassFreqChange = useCallback((freq: number) => {\n    setInternalLowpassFreq(freq);\n    currentLowpassFreqRef.current = freq;\n    if (lowpassFilterRef.current) {\n      lowpassFilterRef.current.frequency.setValueAtTime(freq, audioContext?.currentTime || 0);\n    }\n    if (onLowpassFreqChange) {\n      onLowpassFreqChange(freq);\n    }\n    \n    // Record filter change event\n    if (trackId) {\n      addRecordingEvent({\n        type: 'filter_change',\n        trackId,\n        data: { \n          filterType: 'lowpass',\n          oldFreq: internalLowpassFreq,\n          newFreq: freq,\n          mode\n        }\n      });\n    }\n  }, [audioContext, onLowpassFreqChange, trackId, addRecordingEvent, internalLowpassFreq, mode]);\n\n  const handleHighpassFreqChange = useCallback((freq: number) => {\n    setInternalHighpassFreq(freq);\n    currentHighpassFreqRef.current = freq;\n    if (highpassFilterRef.current) {\n      highpassFilterRef.current.frequency.setValueAtTime(freq, audioContext?.currentTime || 0);\n    }\n    if (onHighpassFreqChange) {\n      onHighpassFreqChange(freq);\n    }\n    \n    // Record filter change event\n    if (trackId) {\n      addRecordingEvent({\n        type: 'filter_change',\n        trackId,\n        data: { \n          filterType: 'highpass',\n          oldFreq: internalHighpassFreq,\n          newFreq: freq,\n          mode\n        }\n      });\n    }\n  }, [audioContext, onHighpassFreqChange, trackId, addRecordingEvent, internalHighpassFreq, mode]);\n\n\n\n  // Check if filters are actually active (have non-default values)\n  const areFiltersActive = useCallback(() => {\n    const lowpassFreq = internalLowpassFreq;\n    const highpassFreq = internalHighpassFreq;\n    return lowpassFreq < 20000 || highpassFreq > 20;\n  }, [internalLowpassFreq, internalHighpassFreq]);\n\n  // Helper function to create audio chain with current volume and speed\n  const createAudioChainWithCurrentSettings = useCallback(() => {\n    if (!audioContext) return null;\n    \n    const currentVolume = currentVolumeRef.current;\n    const currentSpeed = currentSpeedRef.current;\n    \n    const sourceNode = audioContext.createBufferSource();\n    const gainNode = audioContext.createGain();\n    \n    sourceNode.buffer = audioBuffer;\n    sourceNode.playbackRate.value = currentSpeed;\n    gainNode.gain.value = currentVolume;\n    \n    // Create Web Audio API filters if they have non-default values\n    const lowpassFreq = currentLowpassFreqRef.current;\n    const highpassFreq = currentHighpassFreqRef.current;\n    const isLowpassActive = lowpassFreq < 20000;\n    const isHighpassActive = highpassFreq > 20;\n    \n    if (isLowpassActive || isHighpassActive) {\n      const lowpassFilter = audioContext.createBiquadFilter();\n      lowpassFilter.type = 'lowpass';\n      lowpassFilter.frequency.value = lowpassFreq;\n      lowpassFilter.Q.value = 1;\n      \n      const highpassFilter = audioContext.createBiquadFilter();\n      highpassFilter.type = 'highpass';\n      highpassFilter.frequency.value = highpassFreq;\n      highpassFilter.Q.value = 1;\n      \n      // Store filter refs\n      lowpassFilterRef.current = lowpassFilter;\n      highpassFilterRef.current = highpassFilter;\n      \n      // Connect: source -> highpass -> lowpass -> gain -> destination\n      sourceNode.connect(highpassFilter);\n      highpassFilter.connect(lowpassFilter);\n      lowpassFilter.connect(gainNode);\n      gainNode.connect(audioContext.destination);\n      \n      // Also connect to recording destination if available\n      if (recordingDestination) {\n        // Create a separate gain node for recording to avoid conflicts\n        const recordingGain = audioContext.createGain();\n        recordingGain.gain.value = gainNode.gain.value;\n        lowpassFilter.connect(recordingGain);\n        recordingGain.connect(recordingDestination);\n      }\n      \n      return { sourceNode, gainNode, lowpassFilter, highpassFilter };\n    } else {\n      // Connect: source -> gain -> destination (no filters)\n      sourceNode.connect(gainNode);\n      gainNode.connect(audioContext.destination);\n      \n      // Also connect to recording destination if available\n      if (recordingDestination) {\n        // Create a separate gain node for recording to avoid conflicts\n        const recordingGain = audioContext.createGain();\n        recordingGain.gain.value = gainNode.gain.value;\n        sourceNode.connect(recordingGain);\n        recordingGain.connect(recordingDestination);\n      }\n      \n      return { sourceNode, gainNode };\n    }\n  }, [audioContext, audioBuffer, recordingDestination, trackId, mode]);\n\n  // Optimized time update function using requestAnimationFrame\n  const updatePlaybackTime = useCallback(() => {\n    if (!isPlaying || !audioContext || !audioSourceRef.current) return;\n    \n    // Skip updates if we're currently processing a seek\n    if (isSeekingRef.current) {\n      animationFrameRef.current = requestAnimationFrame(updatePlaybackTime);\n      return;\n    }\n\n    const now = performance.now();\n    // Only update if at least 16ms has passed (roughly 60fps)\n    if (now - lastUpdateTimeRef.current < 16) {\n      animationFrameRef.current = requestAnimationFrame(updatePlaybackTime);\n      return;\n    }\n\n    // Get the current playback time using getOutputTimestamp\n    const timestamp = audioContext.getOutputTimestamp();\n    const contextTime = timestamp.contextTime;\n    \n    if (contextTime) {\n      // Calculate time since playback started\n      const elapsed = contextTime - startTimeRef.current;\n      \n      // Get the current playback position from the source node\n      const sourceNode = audioSourceRef.current;\n      const playbackRate = sourceNode.playbackRate.value;\n      \n      if (mode === 'loop') {\n        // For loop mode, calculate position within loop region\n        const loopDuration = loopEnd - loopStart;\n        \n        // Check if we're currently outside the loop region\n        const currentVisualPosition = currentTime;\n        const isOutsideLoop = currentVisualPosition < loopStart || currentVisualPosition > loopEnd;\n        \n        if (isOutsideLoop) {\n          // If outside loop region, continue from current position until we reach the loop\n          const currentPlaybackTime = playbackStartTimeRef.current + (elapsed * playbackRate);\n          const finalTime = currentPlaybackTime >= audioBuffer.duration ? 0 : currentPlaybackTime;\n          setCurrentTime(finalTime);\n          if (onPlaybackTimeChange) {\n            onPlaybackTimeChange(finalTime);\n          }\n          \n          // Check if we just entered the loop region\n          if (finalTime >= loopStart && finalTime <= loopEnd && audioSourceRef.current) {\n            // We've entered the loop region, restart audio source with looping enabled\n            const currentSourceNode = audioSourceRef.current;\n            \n            // Stop current source\n            currentSourceNode.stop();\n            \n            // Create new audio chain with looping enabled\n            const audioChain = createAudioChainWithCurrentSettings();\n            if (audioChain) {\n              const { sourceNode, gainNode, lowpassFilter, highpassFilter } = audioChain;\n              \n              // Enable looping\n              sourceNode.loop = true;\n              sourceNode.loopStart = loopStart;\n              sourceNode.loopEnd = loopEnd;\n              \n              // Start from the current position within the loop\n              const positionInLoop = finalTime - loopStart;\n              sourceNode.start(0, loopStart + positionInLoop);\n              \n              // Update refs\n              audioSourceRef.current = sourceNode;\n              gainNodeRef.current = gainNode;\n              if (lowpassFilter) lowpassFilterRef.current = lowpassFilter;\n              if (highpassFilter) highpassFilterRef.current = highpassFilter;\n              \n              // Update start time for accurate position calculation\n              startTimeRef.current = audioContext.currentTime;\n              playbackStartTimeRef.current = loopStart + positionInLoop;\n            }\n          }\n        } else {\n          // If inside loop region, use normal loop calculation\n          const position = loopStart + ((elapsed * playbackRate) % loopDuration);\n          setCurrentTime(position);\n          if (onPlaybackTimeChange) {\n            onPlaybackTimeChange(position);\n          }\n        }\n      } else {\n        // For non-loop mode, calculate position from the actual starting position\n        const currentPlaybackTime = playbackStartTimeRef.current + (elapsed * playbackRate);\n        const finalTime = currentPlaybackTime >= audioBuffer.duration ? 0 : currentPlaybackTime;\n        setCurrentTime(finalTime);\n        if (onPlaybackTimeChange) {\n          onPlaybackTimeChange(finalTime);\n        }\n      }\n    }\n    \n    lastUpdateTimeRef.current = now;\n    animationFrameRef.current = requestAnimationFrame(updatePlaybackTime);\n  }, [isPlaying, audioContext, audioBuffer.duration, onPlaybackTimeChange, mode, loopStart, loopEnd]);\n\n  // Update refs when activeCueIndex changes\n  useEffect(() => {\n    activeCueIndexRef.current = activeCueIndex;\n    if (activeCueIndex !== null && activeCueIndex < cuePoints.length) {\n      cueStartTimeRef.current = cuePoints[activeCueIndex];\n    }\n  }, [activeCueIndex, cuePoints]);\n\n  // Function to seek directly during playback (called by waveform clicks)\n  const seekToTime = useCallback((seekTime: number) => {\n    if (!isPlaying || !audioSourceRef.current || !audioContext || isSeekingRef.current) {\n      return;\n    }\n    \n\n    \n    isSeekingRef.current = true;\n    const currentSourceNode = audioSourceRef.current;\n    \n    // Stop current source\n    currentSourceNode.stop();\n    \n    // Create new audio chain with current settings\n    const audioChain = createAudioChainWithCurrentSettings();\n    if (audioChain) {\n      const { sourceNode, gainNode, lowpassFilter, highpassFilter } = audioChain;\n      \n      // Configure based on current mode and new position\n      if (mode === 'loop') {\n        const isWithinLoop = seekTime >= loopStart && seekTime <= loopEnd;\n        \n        if (isWithinLoop) {\n          // If seeking within loop region, enable looping\n          sourceNode.loop = true;\n          sourceNode.loopStart = loopStart;\n          sourceNode.loopEnd = loopEnd;\n          sourceNode.start(0, seekTime);\n        } else {\n          // If seeking outside loop region, don't loop yet\n          sourceNode.loop = false;\n          sourceNode.start(0, seekTime);\n        }\n      } else {\n        // Preview or cue mode - no looping\n        sourceNode.loop = false;\n        sourceNode.start(0, seekTime);\n      }\n      \n      // Update refs\n      audioSourceRef.current = sourceNode;\n      gainNodeRef.current = gainNode;\n      if (lowpassFilter) lowpassFilterRef.current = lowpassFilter;\n      if (highpassFilter) highpassFilterRef.current = highpassFilter;\n      \n      // Update timing references for accurate position calculation\n      startTimeRef.current = audioContext.currentTime;\n      playbackStartTimeRef.current = seekTime;\n      \n      // Update current time state\n      setCurrentTime(seekTime);\n      \n      // Clear seeking flag after a brief delay to ensure audio source has started\n      setTimeout(() => {\n        isSeekingRef.current = false;\n      }, 10);\n    } else {\n      isSeekingRef.current = false;\n    }\n  }, [isPlaying, audioContext, mode, loopStart, loopEnd]);\n\n  // Expose seek function to parent component\n  useEffect(() => {\n    if (seekFunctionRef) {\n      seekFunctionRef.current = seekToTime;\n    }\n  }, [seekToTime, seekFunctionRef]);\n\n  // Sync external playback time with internal state when not playing\n  useEffect(() => {\n    if (!isPlaying && typeof playbackTime === 'number') {\n      setCurrentTime(playbackTime);\n    }\n  }, [playbackTime, isPlaying]);\n\n  // Handle mode changes during playback\n  useEffect(() => {\n    if (isPlaying && prevModeRef.current !== mode && audioSourceRef.current) {\n      // Mode changed during playback, restart audio source with new mode settings\n      const currentSourceNode = audioSourceRef.current;\n      \n      // Stop current source\n      currentSourceNode.stop();\n      \n      // Create new audio chain with current settings\n      const audioChain = createAudioChainWithCurrentSettings();\n      if (audioChain) {\n        const { sourceNode, gainNode, lowpassFilter, highpassFilter } = audioChain;\n        \n        // Configure based on new mode\n        if (mode === 'loop') {\n          // Check if current position is within or after the loop region\n          const isWithinLoop = currentTime >= loopStart && currentTime <= loopEnd;\n          const isAfterLoop = currentTime > loopEnd;\n          \n          if (isWithinLoop) {\n            // If within loop region, enable looping\n            sourceNode.loop = true;\n            sourceNode.loopStart = loopStart;\n            sourceNode.loopEnd = loopEnd;\n            sourceNode.start(0, currentTime);\n            playbackStartTimeRef.current = currentTime;\n          } else if (isAfterLoop) {\n            // If after loop region, continue without looping\n            sourceNode.loop = false;\n            sourceNode.start(0, currentTime);\n            playbackStartTimeRef.current = currentTime;\n          } else {\n            // If before loop region, start from current position but prepare for looping\n            sourceNode.loop = false; // Don't loop yet\n            sourceNode.start(0, currentTime);\n            playbackStartTimeRef.current = currentTime;\n          }\n        } else {\n          // Preview or cue mode - no looping\n          sourceNode.loop = false;\n          sourceNode.start(0, currentTime);\n          playbackStartTimeRef.current = currentTime;\n        }\n        \n        // Update refs\n        audioSourceRef.current = sourceNode;\n        gainNodeRef.current = gainNode;\n        if (lowpassFilter) lowpassFilterRef.current = lowpassFilter;\n        if (highpassFilter) highpassFilterRef.current = highpassFilter;\n        \n        // Update start time for accurate position calculation\n        startTimeRef.current = audioContext?.currentTime || 0;\n      }\n    }\n    \n    // Update prevModeRef\n    prevModeRef.current = mode;\n  }, [mode, isPlaying, currentTime, loopStart, loopEnd, audioContext]);\n\n  // Start/stop time updates\n  useEffect(() => {\n    if (isPlaying) {\n      lastUpdateTimeRef.current = performance.now();\n      animationFrameRef.current = requestAnimationFrame(updatePlaybackTime);\n    } else if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n      animationFrameRef.current = null;\n    }\n\n    return () => {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, [isPlaying, updatePlaybackTime]);\n\n\n  // Handle keyboard events for cue points\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      // Only handle key presses if this is a cue track AND it's selected\n      if (mode !== 'cue' || !isSelected) return;\n\n      // Map number keys 1-0 to cue points\n      const keyMap: { [key: string]: number } = {\n        '1': 0, '2': 1, '3': 2, '4': 3, '5': 4,\n        '6': 5, '7': 6, '8': 7, '9': 8, '0': 9\n      };\n\n      const cueIndex = keyMap[event.key];\n\n      if (cueIndex !== undefined && cueIndex < cuePoints.length) {\n        playCuePoint(cueIndex);\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => {\n      window.removeEventListener('keydown', handleKeyPress);\n    };\n  }, [mode, isSelected, cuePoints]);\n\n  // Handle play/pause functionality\n  const togglePlayback = async () => {\n    try {\n      await ensureAudio(() => {});\n      if (!audioContext || !audioBuffer) return;\n\n      if (isPlaying) {\n        // Stop playback\n        if (audioSourceRef.current) {\n          audioSourceRef.current.stop();\n          audioSourceRef.current = null;\n        }\n        if (gainNodeRef.current) {\n          gainNodeRef.current.disconnect();\n          gainNodeRef.current = null;\n        }\n        if (lowpassFilterRef.current) {\n          lowpassFilterRef.current.disconnect();\n          lowpassFilterRef.current = null;\n        }\n        if (highpassFilterRef.current) {\n          highpassFilterRef.current.disconnect();\n          highpassFilterRef.current = null;\n        }\n        if (animationFrameRef.current) {\n          cancelAnimationFrame(animationFrameRef.current);\n          animationFrameRef.current = null;\n        }\n        setIsPlaying(false);\n        if (onPlaybackStateChange) {\n          onPlaybackStateChange(false);\n        }\n        \n        // Record loop stop event\n        if (trackId && mode === 'loop') {\n          addRecordingEvent({\n            type: 'loop_stop',\n            trackId,\n            data: { mode }\n          });\n        }\n      } else {\n        // Start playback - create audio chain manually to ensure current volume and speed are applied\n        const audioChain = createAudioChainWithCurrentSettings();\n        if (!audioChain) return;\n        \n        const { sourceNode, gainNode, lowpassFilter, highpassFilter } = audioChain;\n        \n        if (mode === 'loop') {\n          // In loop mode, always start from the beginning of the loop region\n          sourceNode.loop = true;\n          sourceNode.loopStart = loopStart;\n          sourceNode.loopEnd = loopEnd;\n          sourceNode.start(0, loopStart);\n          playbackStartTimeRef.current = loopStart;\n        } else if (mode === 'cue' && activeCueIndex !== null) {\n          const cueStartTime = cuePoints[activeCueIndex];\n          cueStartTimeRef.current = cueStartTime;\n          sourceNode.start(0, cueStartTime);\n          playbackStartTimeRef.current = cueStartTime;\n        } else {\n          sourceNode.start(0, currentTime);\n          playbackStartTimeRef.current = currentTime;\n        }\n\n        audioSourceRef.current = sourceNode;\n        gainNodeRef.current = gainNode;\n        \n        // Store filter references if they exist\n        if (lowpassFilter) {\n          lowpassFilterRef.current = lowpassFilter;\n        }\n        if (highpassFilter) {\n          highpassFilterRef.current = highpassFilter;\n        }\n        setIsPlaying(true);\n        if (onPlaybackStateChange) {\n          onPlaybackStateChange(true);\n        }\n        \n        // Record loop play event\n        if (trackId && mode === 'loop') {\n          addRecordingEvent({\n            type: 'loop_play',\n            trackId,\n            data: { \n              mode,\n              loopStart,\n              loopEnd,\n              currentTime: playbackStartTimeRef.current\n            }\n          });\n        }\n        startTimeRef.current = audioContext.currentTime;\n        \n        // Start the animation frame loop for smooth updates\n        lastUpdateTimeRef.current = performance.now();\n        animationFrameRef.current = requestAnimationFrame(updatePlaybackTime);\n\n        sourceNode.onended = () => {\n          if (audioSourceRef.current === sourceNode) {\n            setIsPlaying(false);\n            audioSourceRef.current = null;\n            gainNodeRef.current = null;\n            if (lowpassFilterRef.current) {\n              lowpassFilterRef.current.disconnect();\n              lowpassFilterRef.current = null;\n            }\n            if (highpassFilterRef.current) {\n              highpassFilterRef.current.disconnect();\n              highpassFilterRef.current = null;\n            }\n            if (animationFrameRef.current) {\n              cancelAnimationFrame(animationFrameRef.current);\n              animationFrameRef.current = null;\n            }\n            if (onPlaybackStateChange) {\n              onPlaybackStateChange(false);\n            }\n          }\n        };\n      }\n    } catch (error) {\n      console.error('Error in togglePlayback:', error);\n      setIsPlaying(false);\n    }\n  };\n  \n  // Play from a specific cue point\n  const playCuePoint = async (index: number) => {\n    \n    if (!audioContext || !audioBuffer || index >= cuePoints.length) {\n      return;\n    }\n\n    try {\n      await ensureAudio(() => {});\n      \n      // Stop current playback if any\n      if (audioSourceRef.current) {\n        audioSourceRef.current.stop();\n        audioSourceRef.current = null;\n      }\n      if (gainNodeRef.current) {\n        gainNodeRef.current.disconnect();\n        gainNodeRef.current = null;\n      }\n      if (lowpassFilterRef.current) {\n        lowpassFilterRef.current.disconnect();\n        lowpassFilterRef.current = null;\n      }\n      if (highpassFilterRef.current) {\n        highpassFilterRef.current.disconnect();\n        highpassFilterRef.current = null;\n      }\n      \n      // Set the active cue index and update refs immediately\n      setActiveCueIndex(index);\n      activeCueIndexRef.current = index;\n      const cueTime = cuePoints[index];\n      cueStartTimeRef.current = cueTime;\n      setCurrentTime(cueTime);\n      if (onPlaybackTimeChange) {\n        onPlaybackTimeChange(cueTime);\n      }\n      \n      // Create audio chain manually to ensure current volume and speed are applied\n      const audioChain = createAudioChainWithCurrentSettings();\n      if (!audioChain) return;\n      \n      const { sourceNode, gainNode, lowpassFilter, highpassFilter } = audioChain;\n      \n      // Store references\n      audioSourceRef.current = sourceNode;\n      gainNodeRef.current = gainNode;\n      \n      // Store filter references if they exist\n      if (lowpassFilter) {\n        lowpassFilterRef.current = lowpassFilter;\n      }\n      if (highpassFilter) {\n        highpassFilterRef.current = highpassFilter;\n      }\n      \n      // Store start time\n      startTimeRef.current = audioContext.currentTime;\n      \n      sourceNode.start(0, cueTime);\n      playbackStartTimeRef.current = cueTime;\n      setIsPlaying(true);\n      if (onPlaybackStateChange) {\n        onPlaybackStateChange(true);\n      }\n      \n      // Start the animation frame loop for smooth updates\n      lastUpdateTimeRef.current = performance.now();\n      animationFrameRef.current = requestAnimationFrame(updatePlaybackTime);\n      \n      // Record cue trigger event\n      if (trackId) {\n        addRecordingEvent({\n          type: 'cue_trigger',\n          trackId,\n          data: {\n            cueIndex: index,\n            cueTime,\n            mode\n          }\n        });\n      }\n      \n      // Handle playback end\n      sourceNode.onended = () => {\n        if (audioSourceRef.current === sourceNode) {\n          setIsPlaying(false);\n          audioSourceRef.current = null;\n          gainNodeRef.current = null;\n          if (lowpassFilterRef.current) {\n            lowpassFilterRef.current.disconnect();\n            lowpassFilterRef.current = null;\n          }\n          if (highpassFilterRef.current) {\n            highpassFilterRef.current.disconnect();\n            highpassFilterRef.current = null;\n          }\n          if (animationFrameRef.current) {\n            cancelAnimationFrame(animationFrameRef.current);\n            animationFrameRef.current = null;\n          }\n          if (onPlaybackStateChange) {\n            onPlaybackStateChange(false);\n          }\n        }\n      };\n    } catch (error) {\n      console.error('Error in playCuePoint:', error);\n      setIsPlaying(false);\n    }\n  };\n  \n  // Update volume when it changes\n  useEffect(() => {\n    currentVolumeRef.current = volume;\n    if (gainNodeRef.current) {\n      gainNodeRef.current.gain.value = volume;\n    }\n  }, [volume]);\n  \n  // Update playback rate when speed changes\n  useEffect(() => {\n    if (audioSourceRef.current) {\n      audioSourceRef.current.playbackRate.value = currentSpeedRef.current;\n    }\n  }, [speed]);\n\n\n  \n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (audioSourceRef.current) {\n        audioSourceRef.current.stop();\n      }\n      if (gainNodeRef.current) {\n        gainNodeRef.current.disconnect();\n      }\n      if (lowpassFilterRef.current) {\n        lowpassFilterRef.current.disconnect();\n      }\n      if (highpassFilterRef.current) {\n        highpassFilterRef.current.disconnect();\n      }\n    };\n  }, []);\n\n  return (\n    <div className={`audafact-card p-2 md:p-4 space-y-2 md:space-y-4 ${disabled ? 'opacity-50' : ''}`}>\n      {/* Playback Controls */}\n      <div className=\"flex justify-between items-center\">\n        <div className=\"flex items-center space-x-3\">\n          <button\n            onClick={togglePlayback}\n            disabled={disabled}\n            className={`p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan transition-colors duration-200 ${\n              disabled \n                ? 'bg-audafact-text-secondary text-audafact-bg-primary cursor-not-allowed' \n                : 'bg-audafact-accent-cyan text-audafact-bg-primary hover:bg-opacity-90'\n            }`}\n            data-testid=\"play-button\"\n          >\n            {isPlaying ? <Pause size={16} /> : <Play size={16} />}\n          </button>\n          {/* Display current playback time and duration */}\n          <div className=\"text-center text-xs audafact-text-secondary\">\n            {currentTime.toFixed(2)}s / {audioBuffer.duration.toFixed(2)}s\n          </div>\n          \n          {mode === 'loop' && (\n            <div className=\"text-xs md:text-sm audafact-text-secondary\">\n              Loop: {loopStart.toFixed(2)}s - {loopEnd.toFixed(2)}s\n            </div>\n          )}\n        </div>\n\n        {mode === 'cue' && (\n          <div className=\"flex items-center space-x-3\">\n            {isSelected && (\n              <div className=\"text-xs audafact-text-secondary hidden md:block\">\n                Press 1-0 keys to trigger cues\n              </div>\n            )}\n            <button\n              onClick={onSelect}\n              disabled={disabled}\n              className={`px-2 py-0.5 text-xs rounded-sm md:px-3 md:py-1 md:text-sm transition-colors duration-200 ${\n                disabled\n                  ? 'bg-audafact-surface-2 text-audafact-text-secondary cursor-not-allowed' \n                  : isSelected \n                    ? 'bg-audafact-alert-red text-audafact-text-primary' \n                    : 'bg-audafact-surface-2 text-audafact-text-secondary hover:bg-audafact-divider hover:text-audafact-text-primary'\n              }`}\n            >\n              <span className=\"md:hidden\">{isSelected ? 'Selected' : 'Select'}</span>\n              <span className=\"hidden md:inline\">{isSelected ? 'Selected to Cue' : 'Select to Cue'}</span>\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Volume and Speed Controls */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 md:gap-4\">\n        {/* Volume Control */}\n        <div className=\"space-y-2\">\n          <label className=\"text-xs md:text-sm font-medium audafact-heading\">Volume</label>\n          <div className=\"flex items-center space-x-3\">\n            <input\n              type=\"range\"\n              min=\"0\"\n              max=\"1\"\n              step=\"0.01\"\n              value={volume}\n              disabled={disabled}\n              onChange={(e) => {\n                if (disabled) return;\n                const newVolume = parseFloat(e.target.value);\n                if (onVolumeChange) onVolumeChange(newVolume);\n                \n                // Record volume change event\n                if (trackId) {\n                  addRecordingEvent({\n                    type: 'volume_change',\n                    trackId,\n                    data: { \n                      oldVolume: volume,\n                      newVolume,\n                      mode\n                    }\n                  });\n                }\n              }}\n              className={`flex-1 h-1.5 md:h-2 bg-audafact-surface-2 rounded-lg appearance-none cursor-pointer slider ${\n                disabled ? 'cursor-not-allowed opacity-50' : ''\n              }`}\n            />\n            <span className=\"text-xs md:text-sm audafact-text-secondary w-10 md:w-12\">{Math.round(volume * 100)}%</span>\n          </div>\n        </div>\n\n        {/* Speed Control */}\n        <div className=\"space-y-2\">\n          <label className=\"text-xs md:text-sm font-medium audafact-heading\">\n            <span className=\"md:hidden\">Speed: {speed.toFixed(2)}x</span>\n            <span className=\"hidden md:inline\">Playback Speed: {speed.toFixed(2)}x</span>\n          </label>\n          <div className=\"flex items-center space-x-3\">\n            <input\n              type=\"range\"\n              min={getTempoSpeedRange().minTempo / trackTempo}\n              max={getTempoSpeedRange().maxTempo / trackTempo}\n              step={getTempoSpeedRange().stepSize}\n              value={speed}\n              disabled={disabled}\n              onChange={(e) => {\n                if (disabled) return;\n                const newSpeed = parseFloat(e.target.value);\n                setSpeed(newSpeed);\n                currentSpeedRef.current = newSpeed;\n                if (onSpeedChange) onSpeedChange(newSpeed);\n                \n                // Record speed change event\n                if (trackId) {\n                  addRecordingEvent({\n                    type: 'speed_change',\n                    trackId,\n                    data: { \n                      oldSpeed: speed,\n                      newSpeed,\n                      mode\n                    }\n                  });\n                }\n              }}\n              className={`flex-1 h-1.5 md:h-2 bg-audafact-surface-2 rounded-lg appearance-none cursor-pointer slider ${\n                disabled ? 'cursor-not-allowed opacity-50' : ''\n              }`}\n            />\n            <span className=\"text-xs md:text-sm text-gray-600 w-14 md:w-16\">\n              {getCurrentEffectiveTempo()} BPM\n            </span>\n          </div>\n        </div>\n      </div>\n\n      {/* Filter Controls */}\n      <div className=\"space-y-3\">\n        <div className=\"flex items-center justify-between\">\n          <button\n            onClick={() => setIsFilterSectionExpanded(!isFilterSectionExpanded)}\n            className=\"flex items-center gap-1 px-2 py-1 text-xs font-medium audafact-text-secondary bg-audafact-surface-1 border border-audafact-divider rounded hover:bg-audafact-surface-2 transition-colors duration-200\"\n          >\n            <span>Audio Filters {areFiltersActive() && <span className=\"text-audafact-accent-cyan\">●</span>}</span>\n            <svg \n              className={`w-3 h-3 transition-transform ${isFilterSectionExpanded ? 'rotate-180' : ''}`} \n              fill=\"none\" \n              stroke=\"currentColor\" \n              viewBox=\"0 0 24 24\"\n            >\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n            </svg>\n          </button>\n          \n          {/* Delete Track Button - positioned opposite to Audio Filters toggle */}\n          {showDeleteButton && onDelete && (\n            <button\n              onClick={onDelete}\n              className=\"flex items-center gap-1 px-2 py-1 text-xs font-medium audafact-text-secondary hover:text-audafact-red hover:bg-audafact-surface-2 border border-audafact-divider rounded transition-colors duration-200\"\n              title=\"Delete Track\"\n            >\n              <span>Delete</span>\n              <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n              </svg>\n            </button>\n          )}\n        </div>\n\n        {isFilterSectionExpanded && (\n          <div className=\"p-4 border-b bg-audafact-surface-1\">\n            <div className=\"grid grid-cols-1 gap-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <label className=\"text-sm font-medium audafact-heading\">\n                    Low Pass Filter: {(lowpassFreq || 20000) >= 1000 \n                      ? `${((lowpassFreq || 20000) / 1000).toFixed(1)}kHz` \n                      : `${(lowpassFreq || 20000)}Hz`}\n                  </label>\n                </div>\n                <input\n                  type=\"range\"\n                  min=\"20\"\n                  max=\"20000\"\n                  step=\"1\"\n                  value={lowpassFreq || 20000}\n                  disabled={disabled}\n                  onChange={(e) => {\n                    if (disabled) return;\n                    const freq = parseInt(e.target.value);\n                    handleLowpassFreqChange(freq);\n                  }}\n                  className={`w-full h-2 bg-audafact-surface-2 rounded-lg appearance-none cursor-pointer slider ${\n                    disabled ? 'cursor-not-allowed opacity-50' : ''\n                  }`}\n                />\n                <div className=\"flex justify-between text-xs audafact-text-secondary\">\n                  <span>20Hz</span>\n                  <span>20kHz</span>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <label className=\"text-sm font-medium audafact-heading\">\n                    High Pass Filter: {(highpassFreq || 20) >= 1000 \n                      ? `${((highpassFreq || 20) / 1000).toFixed(1)}kHz` \n                      : `${(highpassFreq || 20)}Hz`}\n                  </label>\n                </div>\n                <input\n                  type=\"range\"\n                  min=\"20\"\n                  max=\"20000\"\n                  step=\"1\"\n                  value={highpassFreq || 20}\n                  disabled={disabled}\n                  onChange={(e) => {\n                    if (disabled) return;\n                    const freq = parseInt(e.target.value);\n                    handleHighpassFreqChange(freq);\n                  }}\n                  className={`w-full h-2 bg-audafact-surface-2 rounded-lg appearance-none cursor-pointer slider ${\n                    disabled ? 'cursor-not-allowed opacity-50' : ''\n                  }`}\n                />\n                <div className=\"flex justify-between text-xs audafact-text-secondary\">\n                  <span>20Hz</span>\n                  <span>20kHz</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Cue Point Controls */}\n      {mode === 'cue' && (\n        <div>\n          <h4 className=\"text-xs font-medium mb-2 audafact-text-secondary\">Cue Points</h4>\n          {/* First row: 1-5 (indexes 0-4) */}\n          <div className=\"grid grid-cols-5 gap-0.5 md:gap-1 mb-1\">\n            {cuePoints.slice(0, 5).map((_, index) => (\n              <button\n                key={`cue-top-${index}`}\n                onClick={() => !disabled && playCuePoint(index)}\n                disabled={disabled}\n                className={`h-7 md:h-8 text-[10px] md:text-xs py-0.5 md:py-1 px-1 rounded-sm md:rounded transition-colors duration-200 ${\n                  disabled\n                    ? 'bg-audafact-surface-2 text-audafact-text-secondary cursor-not-allowed'\n                    : activeCueIndex === index\n                      ? 'bg-audafact-alert-red text-audafact-text-primary'\n                      : 'bg-audafact-surface-2 hover:bg-audafact-divider text-audafact-text-secondary hover:text-audafact-text-primary'\n                }`}\n              >\n                {index + 1}\n              </button>\n            ))}\n          </div>\n          {/* Second row: 6-0 (indexes 5-9, label 10th as 0) */}\n          <div className=\"grid grid-cols-5 gap-0.5 md:gap-1\">\n            {cuePoints.slice(5, 10).map((_, idx) => {\n              const index = idx + 5;\n              const label = index === 9 ? '0' : String(index + 1);\n              return (\n                <button\n                  key={`cue-bottom-${index}`}\n                  onClick={() => !disabled && playCuePoint(index)}\n                  disabled={disabled}\n                  className={`h-7 md:h-8 text-[10px] md:text-xs py-0.5 md:py-1 px-1 rounded-sm md:rounded transition-colors duration-200 ${\n                    disabled\n                      ? 'bg-audafact-surface-2 text-audafact-text-secondary cursor-not-allowed'\n                      : activeCueIndex === index\n                        ? 'bg-audafact-alert-red text-audafact-text-primary'\n                        : 'bg-audafact-surface-2 hover:bg-audafact-divider text-audafact-text-secondary hover:text-audafact-text-primary'\n                  }`}\n                >\n                  {label}\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default TrackControls;","import { useState, useEffect, useRef, useCallback } from 'react';\n\ninterface TempoControlsProps {\n  trackId: string;\n  initialTempo?: number;\n  onTempoChange: (trackId: string, tempo: number) => void;\n  playbackSpeed?: number;\n}\n\nconst TempoControls = ({ \n  trackId, \n  initialTempo = 120, \n  onTempoChange, \n  playbackSpeed = 1,\n}: TempoControlsProps) => {\n  const [tempo, setTempo] = useState(initialTempo);\n  const [tempoInput, setTempoInput] = useState(initialTempo.toString());\n  const [isTapTempoActive, setIsTapTempoActive] = useState(false);\n  const [tapCount, setTapCount] = useState(0);\n  const [lastTapTime, setLastTapTime] = useState<number | null>(null);\n  const [tapTimes, setTapTimes] = useState<number[]>([]);\n  const [effectiveTempo, setEffectiveTempo] = useState(initialTempo);\n  \n  const tapTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const keyListenerRef = useRef<((e: KeyboardEvent) => void) | null>(null);\n\n  // Calculate effective tempo based on playback speed\n  useEffect(() => {\n    setEffectiveTempo(tempo * playbackSpeed);\n  }, [tempo, playbackSpeed]);\n\n  // Update tempo input when initialTempo changes\n  useEffect(() => {\n    setTempo(initialTempo);\n    setTempoInput(initialTempo.toString());\n  }, [initialTempo]);\n\n  // Handle manual tempo input\n  const handleTempoInputChange = (value: string) => {\n    setTempoInput(value);\n    const newTempo = parseFloat(value);\n    if (!isNaN(newTempo) && newTempo >= 40 && newTempo <= 300) {\n      setTempo(newTempo);\n      onTempoChange(trackId, newTempo);\n    }\n  };\n\n  const handleTempoInputBlur = () => {\n    const newTempo = parseFloat(tempoInput);\n    if (isNaN(newTempo) || newTempo < 40 || newTempo > 300) {\n      // Reset to current tempo if invalid\n      setTempoInput(tempo.toString());\n    }\n  };\n\n  // Calculate BPM from tap intervals\n  const calculateBPM = useCallback((times: number[]) => {\n    if (times.length < 2) return null;\n    \n    const intervals: number[] = [];\n    for (let i = 1; i < times.length; i++) {\n      intervals.push(times[i] - times[i - 1]);\n    }\n    \n    // Calculate average interval in milliseconds\n    const avgInterval = intervals.reduce((sum, interval) => sum + interval, 0) / intervals.length;\n    \n    // Convert to BPM (60 seconds / interval in seconds)\n    const bpm = Math.round(60000 / avgInterval);\n    \n    return Math.max(40, Math.min(300, bpm));\n  }, []);\n\n  // Handle tap tempo\n  const handleTap = useCallback(() => {\n    const now = Date.now();\n    \n    if (lastTapTime && (now - lastTapTime) > 3000) {\n      // Reset if more than 3 seconds between taps\n      setTapTimes([now]);\n      setTapCount(1);\n    } else {\n      const newTapTimes = [...tapTimes, now];\n      setTapTimes(newTapTimes);\n      setTapCount(newTapTimes.length);\n      \n      // Keep only last 8 taps for calculation\n      if (newTapTimes.length > 8) {\n        const trimmedTimes = newTapTimes.slice(-8);\n        setTapTimes(trimmedTimes);\n        setTapCount(trimmedTimes.length);\n      }\n      \n      // Calculate BPM after at least 2 taps\n      if (newTapTimes.length >= 2) {\n        const calculatedBPM = calculateBPM(newTapTimes);\n        if (calculatedBPM) {\n          setTempo(calculatedBPM);\n          setTempoInput(calculatedBPM.toString());\n          onTempoChange(trackId, calculatedBPM);\n        }\n      }\n    }\n    \n    setLastTapTime(now);\n    \n    // Clear existing timeout\n    if (tapTimeoutRef.current) {\n      clearTimeout(tapTimeoutRef.current);\n    }\n    \n    // Set timeout to reset tap tempo after 3 seconds of inactivity\n    tapTimeoutRef.current = setTimeout(() => {\n      setIsTapTempoActive(false);\n      setTapCount(0);\n      setTapTimes([]);\n      setLastTapTime(null);\n    }, 3000);\n  }, [lastTapTime, tapTimes, calculateBPM]);\n\n  // Handle spacebar key press for tap tempo\n  useEffect(() => {\n    if (!isTapTempoActive) return;\n\n    const handleKeyPress = (e: KeyboardEvent) => {\n      if (e.code === 'Space' && !e.repeat) {\n        e.preventDefault();\n        handleTap();\n      }\n    };\n\n    keyListenerRef.current = handleKeyPress;\n    document.addEventListener('keydown', handleKeyPress);\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyPress);\n    };\n  }, [isTapTempoActive, handleTap]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (tapTimeoutRef.current) {\n        clearTimeout(tapTimeoutRef.current);\n      }\n      if (keyListenerRef.current) {\n        document.removeEventListener('keydown', keyListenerRef.current);\n      }\n    };\n  }, []);\n\n  // Toggle tap tempo mode\n  const toggleTapTempo = () => {\n    if (isTapTempoActive) {\n      setIsTapTempoActive(false);\n      setTapCount(0);\n      setTapTimes([]);\n      setLastTapTime(null);\n      if (tapTimeoutRef.current) {\n        clearTimeout(tapTimeoutRef.current);\n      }\n    } else {\n      setIsTapTempoActive(true);\n      setTapCount(0);\n      setTapTimes([]);\n      setLastTapTime(null);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-wrap items-center gap-2 md:space-x-4 md:gap-4 p-2 md:p-3 audafact-card\">\n      {/* Tempo Label */}\n      <div className=\"flex flex-col\">\n        <label className=\"text-xs md:text-sm font-medium audafact-heading\">Original Tempo</label>\n        <span className=\"hidden md:block text-xs audafact-text-secondary\">BPM</span>\n      </div>\n\n      {/* Manual Tempo Input */}\n      <div className=\"flex items-center space-x-2\">\n        <input\n          type=\"number\"\n          min=\"40\"\n          max=\"300\"\n          value={tempoInput}\n          onChange={(e) => handleTempoInputChange(e.target.value)}\n          onBlur={handleTempoInputBlur}\n          className=\"w-14 md:w-16 px-2 py-0.5 md:py-1 text-xs md:text-sm border border-audafact-divider rounded bg-audafact-surface-2 text-audafact-text-primary focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-transparent\"\n          disabled={isTapTempoActive}\n        />\n        <span className=\"text-xs md:text-sm audafact-text-secondary\">→</span>\n        <div className=\"flex flex-col\">\n          <span className=\"text-xs md:text-sm font-medium audafact-accent-cyan\">\n            {Math.round(effectiveTempo)} BPM\n          </span>\n          <span className=\"text-[10px] md:text-xs audafact-text-secondary\">\n            Speed: {playbackSpeed.toFixed(2)}x\n          </span>\n        </div>\n      </div>\n\n      {/* Tap Tempo Button */}\n      <button\n        onClick={toggleTapTempo}\n        className={`px-2 py-1 text-xs md:px-3 md:py-1.5 md:text-sm font-medium rounded-md transition-colors duration-200 ${\n          isTapTempoActive\n            ? 'bg-audafact-alert-red text-audafact-text-primary border border-audafact-alert-red hover:bg-opacity-90'\n            : 'bg-audafact-surface-2 text-audafact-text-secondary border border-audafact-divider hover:bg-audafact-divider hover:text-audafact-text-primary'\n        }`}\n        title={isTapTempoActive ? 'Click to stop tap tempo' : 'Click to start tap tempo'}\n      >\n        <span className=\"md:hidden\">{isTapTempoActive ? 'Stop' : 'Tap'}</span>\n        <span className=\"hidden md:inline\">{isTapTempoActive ? 'Stop Tap' : 'Tap Tempo'}</span>\n      </button>\n\n      {/* Tap Tempo Status */}\n      {isTapTempoActive && (\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"flex items-center space-x-1\">\n            <div className=\"w-2 h-2 bg-audafact-alert-red rounded-full animate-pulse\"></div>\n            <span className=\"text-xs md:text-sm text-audafact-alert-red font-medium\">Active</span>\n          </div>\n          <span className=\"text-xs md:text-sm audafact-text-secondary\">\n            {tapCount > 0 ? `Taps: ${tapCount}` : 'Press Spacebar to tap'}\n          </span>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default TempoControls; ","import { useState } from 'react';\nimport { TimeSignature } from '../types/music';\n\ninterface TimeSignatureControlsProps {\n  timeSignature: TimeSignature;\n  onTimeSignatureChange: (timeSignature: TimeSignature) => void;\n}\n\nconst TimeSignatureControls = ({\n  timeSignature,\n  onTimeSignatureChange\n}: TimeSignatureControlsProps) => {\n  const [isOpen, setIsOpen] = useState(false);\n\n  // Common time signatures\n  const commonTimeSignatures = [\n    { numerator: 2, denominator: 2, label: '2/2 (Cut time)' },\n    { numerator: 2, denominator: 4, label: '2/4' },\n    { numerator: 3, denominator: 4, label: '3/4' },\n    { numerator: 4, denominator: 4, label: '4/4 (Common time)' },\n    { numerator: 3, denominator: 8, label: '3/8' },\n    { numerator: 6, denominator: 8, label: '6/8' },\n    { numerator: 9, denominator: 8, label: '9/8' },\n    { numerator: 12, denominator: 8, label: '12/8' },\n    { numerator: 5, denominator: 4, label: '5/4' },\n    { numerator: 7, denominator: 8, label: '7/8' },\n    { numerator: 5, denominator: 8, label: '5/8' },\n  ];\n\n  const handleNumeratorChange = (value: string) => {\n    const numerator = parseInt(value);\n    if (!isNaN(numerator) && numerator > 0 && numerator <= 32) {\n      onTimeSignatureChange({ ...timeSignature, numerator });\n    }\n  };\n\n  const handleDenominatorChange = (value: string) => {\n    const denominator = parseInt(value);\n    if (!isNaN(denominator) && denominator > 0 && denominator <= 32) {\n      onTimeSignatureChange({ ...timeSignature, denominator });\n    }\n  };\n\n  const handleCommonTimeSignatureSelect = (ts: typeof commonTimeSignatures[0]) => {\n    onTimeSignatureChange({ numerator: ts.numerator, denominator: ts.denominator });\n    setIsOpen(false);\n  };\n\n  return (\n    <div className=\"flex flex-wrap items-center gap-2 md:space-x-4 md:gap-4 p-2 md:p-3 audafact-card\">\n      {/* Time Signature Label */}\n      <div className=\"flex flex-col\">\n        <label className=\"text-xs md:text-sm font-medium audafact-heading\">Time Signature</label>\n        <span className=\"hidden md:block text-xs audafact-text-secondary\">Beats per measure</span>\n      </div>\n\n      {/* Custom Time Signature Input */}\n      <div className=\"flex items-center space-x-2\">\n        <input\n          type=\"number\"\n          min=\"1\"\n          max=\"32\"\n          value={timeSignature.numerator}\n          onChange={(e) => handleNumeratorChange(e.target.value)}\n          className=\"w-10 md:w-12 px-2 py-0.5 md:py-1 text-xs md:text-sm border border-audafact-divider rounded bg-audafact-surface-2 text-audafact-text-primary focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-transparent text-center\"\n        />\n        <span className=\"text-xs md:text-sm audafact-text-secondary\">/</span>\n        <input\n          type=\"number\"\n          min=\"1\"\n          max=\"32\"\n          value={timeSignature.denominator}\n          onChange={(e) => handleDenominatorChange(e.target.value)}\n          className=\"w-10 md:w-12 px-2 py-0.5 md:py-1 text-xs md:text-sm border border-audafact-divider rounded bg-audafact-surface-2 text-audafact-text-primary focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-transparent text-center\"\n        />\n      </div>\n\n      {/* Common Time Signatures Dropdown */}\n      <div className=\"relative\">\n        <button\n          onClick={() => setIsOpen(!isOpen)}\n          className=\"px-2 py-1 text-xs md:px-3 md:py-1.5 md:text-sm font-medium bg-audafact-surface-2 text-audafact-text-secondary border border-audafact-divider rounded-md hover:bg-audafact-divider hover:text-audafact-text-primary transition-colors duration-200\"\n        >\n          Common\n        </button>\n        \n        {isOpen && (\n          <div className=\"absolute top-full left-0 mt-1 w-40 bg-audafact-surface-1 rounded-md shadow-card border border-audafact-divider z-10\">\n            {commonTimeSignatures.map((ts) => (\n              <button\n                key={ts.label}\n                onClick={() => handleCommonTimeSignatureSelect(ts)}\n                className=\"w-full text-left px-3 py-2 text-xs md:text-sm hover:bg-audafact-surface-2 text-audafact-text-secondary hover:text-audafact-text-primary transition-colors duration-200\"\n              >\n                {ts.label}\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Current Time Signature Display */}\n      <div className=\"flex flex-col\">\n        <span className=\"text-xs md:text-sm font-medium audafact-accent-cyan\">\n          {timeSignature.numerator}/{timeSignature.denominator}\n        </span>\n        <span className=\"text-[10px] md:text-xs audafact-text-secondary\">\n          {timeSignature.numerator} beats per measure\n        </span>\n\n      </div>\n    </div>\n  );\n};\n\nexport default TimeSignatureControls; ","import React, { useState } from 'react';\nimport { Save, Check } from 'lucide-react';\nimport { useRecording } from '../context/RecordingContext';\nimport { useAccessControl } from '../hooks/useAccessControl';\nimport { UpgradePrompt } from './UpgradePrompt';\nimport { useUserTier } from '../hooks/useUserTier';\nimport { showSignupModal } from '../hooks/useSignupModal';\n\ninterface RecordingControlsProps {\n  className?: string;\n  onSave?: () => void;\n  audioContext?: AudioContext;\n}\n\nconst RecordingControls: React.FC<RecordingControlsProps> = ({ className = '', onSave, audioContext }) => {\n  const { \n    isRecordingPerformance, \n    currentPerformance, \n    startPerformanceRecording, \n    stopPerformanceRecording\n  } = useRecording();\n  const { canPerformAction, getUpgradeMessage } = useAccessControl();\n  const { tier } = useUserTier();\n  \n  const [saveSuccess, setSaveSuccess] = useState(false);\n  const [showUpgradePrompt, setShowUpgradePrompt] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  const formatDuration = (ms: number) => {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = seconds % 60;\n    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\n  };\n\n  const handleSave = async () => {\n    if (!onSave) return;\n\n    // Check if user is authenticated\n    if (!tier || tier.id === 'guest') {\n      showSignupModal('save_session');\n      return;\n    }\n\n    // Check save limits for authenticated users\n    const canSave = await canPerformAction('save_session');\n    if (!canSave) {\n      setShowUpgradePrompt(true);\n      return;\n    }\n\n    setIsSaving(true);\n    \n    try {\n      await onSave();\n      setSaveSuccess(true);\n      setTimeout(() => setSaveSuccess(false), 2000);\n    } catch (error) {\n      console.error('Save failed:', error);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  return (\n    <div className={`flex items-center justify-between w-full ${className}`}>\n      {/* Save Button - Left Side */}\n      <button\n        onClick={handleSave}\n        disabled={!onSave || isSaving}\n        className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed ${\n          saveSuccess \n            ? 'bg-green-500 text-white' \n            : 'bg-audafact-text-secondary text-audafact-bg-primary hover:bg-opacity-90'\n        }`}\n      >\n        {saveSuccess ? (\n          <>\n            <Check size={12} />\n            Saved!\n          </>\n        ) : isSaving ? (\n          <>\n            <div className=\"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin\"></div>\n            Saving...\n          </>\n        ) : (\n          <>\n            <Save size={12} />\n            Save\n          </>\n        )}\n      </button>\n\n              {/* Record Button and Status - Right Side */}\n        <div className=\"flex items-center gap-3\">\n          {isRecordingPerformance && currentPerformance && (\n            <div className=\"flex items-center gap-2 text-sm audafact-text-secondary\">\n              <span>Recording Performance & Audio...</span>\n              <span className=\"font-mono\">\n                {formatDuration(Date.now() - currentPerformance.startTime)}\n              </span>\n            </div>\n          )}\n\n          {!isRecordingPerformance ? (\n            <button\n              onClick={async () => {\n                // Check if user is authenticated\n                if (!tier || tier.id === 'guest') {\n                  showSignupModal('record');\n                  return;\n                }\n\n                // Check record limits for authenticated users\n                const canRecord = await canPerformAction('record');\n                \n                if (!canRecord) {\n                  setShowUpgradePrompt(true);\n                  return;\n                }\n                \n                startPerformanceRecording(audioContext);\n              }}\n              className=\"flex items-center gap-2 px-4 py-2 bg-audafact-alert-red text-audafact-text-primary rounded-lg hover:bg-opacity-90 transition-colors shadow-sm\"\n            >\n              <div className=\"w-3 h-3 bg-current rounded-full\"></div>\n              Record\n            </button>\n          ) : (\n            <button\n              onClick={stopPerformanceRecording}\n              className=\"flex items-center gap-2 px-4 py-2 bg-audafact-text-secondary text-audafact-bg-primary rounded-lg hover:bg-opacity-90 transition-colors shadow-sm\"\n            >\n              <div className=\"w-3 h-3 bg-current rounded-full animate-pulse\"></div>\n              Stop Recording\n            </button>\n          )}\n        </div>\n        \n        {/* Upgrade Prompt Modal */}\n        {showUpgradePrompt && (\n          <UpgradePrompt\n            message={getUpgradeMessage('record')}\n            feature=\"Recording\"\n            onClose={() => setShowUpgradePrompt(false)}\n          />\n        )}\n    </div>\n  );\n};\n\nexport default RecordingControls; ","import { supabase } from './supabase';\nimport { StorageFile, UploadResponse, DownloadResponse, AudioFile } from '../types/music';\n\nexport class StorageService {\n  private static readonly UPLOAD_BUCKET = 'user-uploads';\n  private static readonly RECORDING_BUCKET = 'session-recordings';\n  private static readonly LIBRARY_BUCKET = 'library-tracks';\n  private static readonly MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB\n  private static readonly ALLOWED_AUDIO_TYPES = [\n    'audio/mpeg',\n    'audio/wav',\n    'audio/ogg',\n    'audio/mp4',\n    'audio/aac',\n    'audio/flac'\n  ];\n\n  /**\n   * Upload an audio file to the user-uploads bucket\n   */\n  static async uploadAudioFile(\n    file: File,\n    userId: string,\n    title?: string\n  ): Promise<UploadResponse> {\n    try {\n      // Validate file\n      if (!this.isValidAudioFile(file)) {\n        throw new Error('Invalid file type or size');\n      }\n\n      // Create unique filename\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${userId}/${Date.now()}-${Math.random().toString(36).substring(2)}.${fileExt}`;\n\n      // Upload file\n      const { data, error } = await supabase.storage\n        .from(this.UPLOAD_BUCKET)\n        .upload(fileName, file, {\n          cacheControl: '3600',\n          upsert: false,\n          metadata: {\n            title: title || file.name,\n            originalName: file.name,\n            size: file.size,\n            type: file.type,\n            uploadedBy: userId\n          }\n        });\n\n      if (error) throw error;\n\n      // Convert to StorageFile type\n      const storageFile: StorageFile = {\n        name: fileName,\n        bucket_id: this.UPLOAD_BUCKET,\n        owner: userId,\n        id: data?.path || '',\n        updated_at: new Date().toISOString(),\n        created_at: new Date().toISOString(),\n        last_accessed_at: new Date().toISOString(),\n        metadata: {\n          title: title || file.name,\n          originalName: file.name,\n          size: file.size,\n          type: file.type,\n          uploadedBy: userId\n        }\n      };\n\n      return { data: storageFile, error: null };\n    } catch (error) {\n      console.error('Error uploading file:', error);\n      return { data: null, error };\n    }\n  }\n\n  /**\n   * Upload a recording to the session-recordings bucket\n   */\n  static async uploadRecording(\n    file: File,\n    userId: string,\n    sessionId: string,\n    notes?: string\n  ): Promise<UploadResponse> {\n    try {\n      // Validate file\n      if (!this.isValidAudioFile(file)) {\n        throw new Error('Invalid file type or size');\n      }\n\n      // Create unique filename\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${userId}/${sessionId}/${Date.now()}-${Math.random().toString(36).substring(2)}.${fileExt}`;\n\n      // Upload file\n      const { data, error } = await supabase.storage\n        .from(this.RECORDING_BUCKET)\n        .upload(fileName, file, {\n          cacheControl: '3600',\n          upsert: false,\n          metadata: {\n            originalName: file.name,\n            size: file.size,\n            type: file.type,\n            sessionId,\n            notes,\n            uploadedBy: userId\n          }\n        });\n\n      if (error) throw error;\n\n      // Convert to StorageFile type\n      const storageFile: StorageFile = {\n        name: fileName,\n        bucket_id: this.RECORDING_BUCKET,\n        owner: userId,\n        id: data?.path || '',\n        updated_at: new Date().toISOString(),\n        created_at: new Date().toISOString(),\n        last_accessed_at: new Date().toISOString(),\n        metadata: {\n          originalName: file.name,\n          size: file.size,\n          type: file.type,\n          sessionId,\n          notes,\n          uploadedBy: userId\n        }\n      };\n\n      return { data: storageFile, error: null };\n    } catch (error) {\n      console.error('Error uploading recording:', error);\n      return { data: null, error };\n    }\n  }\n\n  /**\n   * Download a file from storage\n   */\n  static async downloadFile(\n    bucket: string,\n    filePath: string\n  ): Promise<DownloadResponse> {\n    try {\n      const { data, error } = await supabase.storage\n        .from(bucket)\n        .download(filePath);\n\n      if (error) throw error;\n\n      return { data, error: null };\n    } catch (error) {\n      console.error('Error downloading file:', error);\n      return { data: null, error };\n    }\n  }\n\n  /**\n   * Get a signed URL for a file (for private buckets)\n   */\n  static async getSignedUrl(bucket: string, filePath: string, expiresIn: number = 3600): Promise<string> {\n    try {\n      const { data, error } = await supabase.storage\n        .from(bucket)\n        .createSignedUrl(filePath, expiresIn);\n      \n      if (error) throw error;\n      return data.signedUrl;\n    } catch (error) {\n      console.error('Error creating signed URL:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get a public URL for a file (for public buckets)\n   */\n  static getPublicUrl(bucket: string, filePath: string): string {\n    const { data } = supabase.storage\n      .from(bucket)\n      .getPublicUrl(filePath);\n    \n    return data.publicUrl;\n  }\n\n  /**\n   * List files in a bucket for a specific user\n   */\n  static async listUserFiles(\n    bucket: string,\n    userId: string,\n    folder?: string\n  ): Promise<{ data: StorageFile[] | null; error: any }> {\n    try {\n      const path = folder ? `${userId}/${folder}` : userId;\n      \n      const { data, error } = await supabase.storage\n        .from(bucket)\n        .list(path, {\n          limit: 100,\n          offset: 0,\n          sortBy: { column: 'created_at', order: 'desc' }\n        });\n\n      if (error) throw error;\n\n      return { data: data || [], error: null };\n    } catch (error) {\n      console.error('Error listing files:', error);\n      return { data: null, error };\n    }\n  }\n\n  /**\n   * Delete a file from storage\n   */\n  static async deleteFile(\n    bucket: string,\n    filePath: string\n  ): Promise<{ error: any }> {\n    try {\n      const { error } = await supabase.storage\n        .from(bucket)\n        .remove([filePath]);\n\n      if (error) throw error;\n\n      return { error: null };\n    } catch (error) {\n      console.error('Error deleting file:', error);\n      return { error };\n    }\n  }\n\n  /**\n   * Get audio file metadata and create AudioFile object\n   */\n  static async getAudioFileInfo(\n    bucket: string,\n    filePath: string\n  ): Promise<AudioFile | null> {\n    try {\n      // Get file metadata\n      const { data: files, error } = await supabase.storage\n        .from(bucket)\n        .list(filePath.split('/').slice(0, -1).join('/'), {\n          search: filePath.split('/').pop()\n        });\n\n      if (error || !files || files.length === 0) {\n        throw new Error('File not found');\n      }\n\n      const file = files[0];\n      const publicUrl = this.getPublicUrl(bucket, filePath);\n\n      // Get audio duration (this would need to be implemented with Web Audio API)\n      const duration = await this.getAudioDuration(publicUrl);\n\n      return {\n        id: file.id,\n        name: file.name,\n        url: publicUrl,\n        duration: duration || 0,\n        size: file.metadata?.size || 0,\n        type: file.metadata?.type || 'audio/mpeg',\n        uploaded_at: file.created_at\n      };\n    } catch (error) {\n      console.error('Error getting audio file info:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Upload a library track to the library-tracks bucket\n   */\n  static async uploadLibraryTrack(\n    file: File,\n    trackId: string,\n    metadata?: {\n      name: string;\n      artist?: string;\n      genre: string;\n      bpm?: number;\n      key?: string;\n      duration?: number;\n      tags?: string[];\n    }\n  ): Promise<UploadResponse> {\n    try {\n      // Validate file\n      if (!this.isValidAudioFile(file)) {\n        throw new Error('Invalid file type or size');\n      }\n\n      // Create filename using track ID\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${trackId}.${fileExt}`;\n\n      // Upload file\n      const { data, error } = await supabase.storage\n        .from(this.LIBRARY_BUCKET)\n        .upload(fileName, file, {\n          cacheControl: '3600',\n          upsert: true, // Allow overwriting\n          metadata: {\n            trackId,\n            originalName: file.name,\n            size: file.size,\n            type: file.type,\n            ...metadata\n          }\n        });\n\n      if (error) throw error;\n\n      // Convert to StorageFile type\n      const storageFile: StorageFile = {\n        name: fileName,\n        bucket_id: this.LIBRARY_BUCKET,\n        owner: 'system',\n        id: data?.path || '',\n        updated_at: new Date().toISOString(),\n        created_at: new Date().toISOString(),\n        last_accessed_at: new Date().toISOString(),\n        metadata: {\n          trackId,\n          originalName: file.name,\n          size: file.size,\n          type: file.type,\n          ...metadata\n        }\n      };\n\n      return { data: storageFile, error: null };\n    } catch (error) {\n      console.error('Error uploading library track:', error);\n      return { data: null, error };\n    }\n  }\n\n  /**\n   * Get the public URL for a library track\n   */\n  static getLibraryTrackUrl(trackId: string, fileType: string): string {\n    return this.getPublicUrl(this.LIBRARY_BUCKET, `${trackId}.${fileType}`);\n  }\n\n  /**\n   * Get a signed URL for a library track (if needed for private access)\n   */\n  static async getLibraryTrackSignedUrl(trackId: string, fileType: string, expiresIn: number = 3600): Promise<string> {\n    return this.getSignedUrl(this.LIBRARY_BUCKET, `${trackId}.${fileType}`, expiresIn);\n  }\n\n  /**\n   * Get audio duration using Web Audio API\n   */\n  private static async getAudioDuration(url: string): Promise<number> {\n    return new Promise((resolve) => {\n      const audio = new Audio();\n      audio.addEventListener('loadedmetadata', () => {\n        resolve(audio.duration);\n      });\n      audio.addEventListener('error', () => {\n        resolve(0);\n      });\n      audio.src = url;\n    });\n  }\n\n  /**\n   * Validate if a file is a valid audio file\n   */\n  private static isValidAudioFile(file: File): boolean {\n    // Check file size\n    if (file.size > this.MAX_FILE_SIZE) {\n      return false;\n    }\n\n    // Check file type\n    if (!this.ALLOWED_AUDIO_TYPES.includes(file.type)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Get file size in human readable format\n   */\n  static formatFileSize(bytes: number): string {\n    if (bytes === 0) return '0 Bytes';\n    \n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    \n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  }\n\n  /**\n   * Get duration in human readable format\n   */\n  static formatDuration(seconds: number): string {\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = Math.floor(seconds % 60);\n    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\n  }\n} ","import { useState, useEffect } from 'react';\nimport { LibraryTrack } from '../types/music';\nimport { trackEvent } from '../services/analyticsService';\nimport { useUserTier } from './useUserTier';\n\nexport const usePreviewAudio = () => {\n  const [currentPreview, setCurrentPreview] = useState<{\n    trackId: string;\n    audio: HTMLAudioElement;\n  } | null>(null);\n  const { tier } = useUserTier();\n  \n  const startPreview = async (track: LibraryTrack) => {\n    // Stop current preview\n    if (currentPreview) {\n      currentPreview.audio.pause();\n      currentPreview.audio.currentTime = 0;\n    }\n    \n    try {\n      // Use the actual file import for preview (fallback to file if previewUrl doesn't work)\n      const audioUrl = track.file;\n      const audio = new Audio(audioUrl);\n      audio.volume = 0.7;\n      audio.loop = false;\n      \n      // Set up event listeners\n      audio.addEventListener('ended', () => {\n        setCurrentPreview(null);\n      });\n      \n      audio.addEventListener('error', () => {\n        console.error('Failed to load preview audio');\n        setCurrentPreview(null);\n      });\n      \n      await audio.play();\n      setCurrentPreview({ trackId: track.id, audio });\n      \n      // Track preview event\n      trackEvent('library_track_previewed', {\n        trackId: track.id,\n        genre: track.genre,\n        bpm: track.bpm,\n        userTier: tier.id\n      });\n      \n    } catch (error) {\n      console.error('Failed to start preview:', error);\n    }\n  };\n  \n  const stopPreview = () => {\n    if (currentPreview) {\n      currentPreview.audio.pause();\n      currentPreview.audio.currentTime = 0;\n      setCurrentPreview(null);\n    }\n  };\n  \n  const isPreviewing = (trackId: string) => {\n    return currentPreview?.trackId === trackId;\n  };\n  \n  const togglePreview = async (track: LibraryTrack) => {\n    if (isPreviewing(track.id)) {\n      stopPreview();\n    } else {\n      await startPreview(track);\n    }\n  };\n  \n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (currentPreview) {\n        currentPreview.audio.pause();\n      }\n    };\n  }, [currentPreview]);\n  \n  return {\n    startPreview,\n    stopPreview,\n    isPreviewing,\n    togglePreview,\n    currentPreview\n  };\n}; ","import React from 'react';\nimport { LibraryTrackItemProps } from '../types/music';\nimport { useUserTier } from '../hooks/useUserTier';\n\nconst LibraryTrackItem: React.FC<LibraryTrackItemProps> = ({\n  track,\n  isPreviewing,\n  onPreview,\n  onAddToStudio,\n  canAddToStudio,\n  isProOnly\n}) => {\n  const { tier } = useUserTier();\n  \n  const handleAddToStudio = () => {\n    if (tier.id === 'guest') {\n      // Dispatch custom event for signup modal\n      window.dispatchEvent(new CustomEvent('showSignupModal', {\n        detail: { trigger: 'add_library_track' }\n      }));\n      return;\n    }\n    \n    onAddToStudio();\n  };\n\n  const handleDragStart = (e: React.DragEvent) => {\n    if (tier.id === 'guest') {\n      e.preventDefault();\n      return;\n    }\n\n    e.dataTransfer.setData('text/plain', track.id);\n    e.dataTransfer.setData('application/json', JSON.stringify({\n      type: 'library-track',\n      name: track.name,\n      id: track.id,\n      file: track.file,\n      trackType: track.type\n    }));\n    e.dataTransfer.effectAllowed = 'copy';\n  };\n  \n  return (\n    <div \n      className={`track-item ${isProOnly ? 'pro-only' : ''}`}\n      draggable={canAddToStudio}\n      onDragStart={handleDragStart}\n    >\n      <div className=\"track-info\">\n        <div className=\"track-header\">\n          <h4 className=\"track-name\">{track.name}</h4>\n          {isProOnly && <span className=\"pro-badge\">PRO</span>}\n        </div>\n        \n        {track.artist && (\n          <p className=\"track-artist\">{track.artist}</p>\n        )}\n        \n        <div className=\"track-meta\">\n          <span className=\"track-genre\">{track.genre}</span>\n          <span className=\"track-bpm\">{track.bpm} BPM</span>\n          {track.key && <span className=\"track-key\">{track.key}</span>}\n        </div>\n        \n        <div className=\"track-tags\">\n          {track.tags.slice(0, 3).map(tag => (\n            <span key={tag} className=\"track-tag\">{tag}</span>\n          ))}\n        </div>\n      </div>\n      \n      <div className=\"track-actions\">\n        <button\n          onClick={onPreview}\n          className={`preview-button ${isPreviewing ? 'playing' : ''}`}\n          title={isPreviewing ? 'Stop preview' : 'Preview track'}\n        >\n          {isPreviewing ? (\n            <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n              <rect x=\"6\" y=\"4\" width=\"4\" height=\"16\" />\n              <rect x=\"14\" y=\"4\" width=\"4\" height=\"16\" />\n            </svg>\n          ) : (\n            <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path d=\"M8 5v14l11-7z\" />\n            </svg>\n          )}\n        </button>\n        \n        {canAddToStudio ? (\n          <button\n            onClick={handleAddToStudio}\n            className=\"add-button\"\n            title=\"Add to studio\"\n            style={{ color: 'white', fontSize: '18px', fontWeight: 'bold' }}\n          >\n            +\n          </button>\n        ) : (\n          <button\n            onClick={handleAddToStudio}\n            className=\"add-button locked\"\n            title=\"Sign up to add this track to your studio\"\n            style={{ color: 'white', fontSize: '16px' }}\n          >\n            🔒\n          </button>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default LibraryTrackItem; ","import React, { useState, useRef, useEffect } from 'react';\nimport { useRecording } from '../context/RecordingContext';\nimport { StorageService } from '../services/storageService';\nimport { DatabaseService } from '../services/databaseService';\nimport { useAuth } from '../context/AuthContext';\nimport { useAccessControl } from '../hooks/useAccessControl';\nimport { useUserTier } from '../hooks/useUserTier';\nimport { usePreviewAudio } from '../hooks/usePreviewAudio';\nimport { UpgradePrompt } from './UpgradePrompt';\nimport { LibraryService } from '../services/libraryService';\nimport { LibraryTrack } from '../types/music';\nimport LibraryTrackItem from './LibraryTrackItem';\nimport { showSignupModal } from '../hooks/useSignupModal';\n\ninterface AudioAsset {\n  id: string;\n  name: string;\n  file: string;\n  type: 'wav' | 'mp3';\n  size: string;\n  duration?: number;\n}\n\ninterface UserTrack {\n  id: string;\n  name: string;\n  file: File | null;\n  type: string;\n  size: string;\n  url: string;\n  uploadedAt: number;\n}\n\ninterface SidePanelProps {\n  isOpen: boolean;\n  onToggle: () => void;\n  onUploadTrack: (file: File, trackType: 'preview' | 'loop' | 'cue') => void;\n  onAddFromLibrary: (asset: AudioAsset, trackType: 'preview' | 'loop' | 'cue') => void;\n  onAddUserTrack: (track: UserTrack, trackType: 'preview' | 'loop' | 'cue') => void;\n  initialMode?: 'upload' | 'library';\n}\n\nconst SidePanel: React.FC<SidePanelProps> = ({\n  isOpen,\n  onToggle,\n  onUploadTrack,\n  onAddFromLibrary,\n  onAddUserTrack,\n  initialMode\n}) => {\n  const { savedSessions, performances, exportSession, exportPerformance, deleteSession, deletePerformance } = useRecording();\n  const { user } = useAuth();\n  const { canPerformAction, getUpgradeMessage, canAccessFeature } = useAccessControl();\n  const { tier } = useUserTier();\n  const { togglePreview, isPreviewing } = usePreviewAudio();\n  \n  // Collapsible menu state\n  const [expandedMenus, setExpandedMenus] = useState<{ [key: string]: boolean }>(() => {\n    const saved = localStorage.getItem('sidePanelExpandedMenus');\n    const defaultState = { 'audio-library': false, 'sessions': false, 'recordings': false };\n    \n    return saved ? JSON.parse(saved) : defaultState;\n  });\n  \n  // Active submenu items (null means no submenu item is selected)\n  const [activeAudioTab, setActiveAudioTab] = useState<'my-tracks' | 'library' | null>(() => {\n    const savedTab = localStorage.getItem('sidePanelActiveAudioTab');\n    return (savedTab as 'my-tracks' | 'library' | null) || 'library'; // Default to library\n  });\n  \n  const [activeSessionsTab, setActiveSessionsTab] = useState<'saved' | 'shared' | null>(() => {\n    const savedTab = localStorage.getItem('sidePanelActiveSessionsTab');\n    return (savedTab as 'saved' | 'shared' | null) || 'saved'; // Default to saved sessions\n  });\n  // When true, allow user to collapse the submenu without auto-selecting another\n  const [allowEmptyAudioTab, setAllowEmptyAudioTab] = useState(false);\n  const [allowEmptySessionsTab, setAllowEmptySessionsTab] = useState(false);\n  \n\n  const [previewAudios, setPreviewAudios] = useState<{ [key: string]: HTMLAudioElement }>({});\n  const [playingAssets, setPlayingAssets] = useState<{ [key: string]: boolean }>({});\n  const [userTracks, setUserTracks] = useState<UserTrack[]>([]);\n  const [showUpgradePrompt, setShowUpgradePrompt] = useState<{\n    show: boolean;\n    message: string;\n    feature: string;\n  }>({ show: false, message: '', feature: '' });\n  const [libraryTracks, setLibraryTracks] = useState<LibraryTrack[]>([]);\n  const [isLoadingLibrary, setIsLoadingLibrary] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Load library tracks when library tab is opened\n  useEffect(() => {\n    if (activeAudioTab === 'library' && libraryTracks.length === 0) {\n      loadLibraryTracks();\n    }\n  }, [activeAudioTab]);\n\n  // Load user tracks from database on mount\n  useEffect(() => {\n    const loadUserTracks = async () => {\n      if (!user) {\n        setUserTracks([]);\n        return;\n      }\n\n      try {\n        const uploads = await DatabaseService.getUserUploads(user.id);\n        const userTracksData = await Promise.all(\n          uploads.map(async (upload) => {\n            // Get file info from storage to get actual size and type\n            let fileSize = '0MB';\n            let fileType = 'audio/mpeg';\n            \n            try {\n              const fileInfo = await StorageService.getAudioFileInfo('user-uploads', upload.file_url);\n              if (fileInfo) {\n                fileSize = StorageService.formatFileSize(fileInfo.size);\n                fileType = fileInfo.type;\n              }\n            } catch (error) {\n              console.error('Error getting file info for:', upload.file_url, error);\n            }\n            \n            return {\n              id: upload.id,\n              name: upload.title,\n              file: null as File | null,\n              type: fileType,\n              size: fileSize,\n              url: upload.file_url, // This is now the file path\n              uploadedAt: new Date(upload.created_at).getTime()\n            };\n          })\n        );\n        \n        setUserTracks(userTracksData);\n      } catch (error) {\n        console.error('Error loading user tracks from database:', error);\n        setUserTracks([]);\n      }\n    };\n\n    loadUserTracks();\n  }, [user]);\n\n  const loadLibraryTracks = async () => {\n    setIsLoadingLibrary(true);\n    try {\n      const tracks = await LibraryService.getLibraryTracks(tier.id);\n      setLibraryTracks(tracks);\n    } catch (error) {\n      console.error('Error loading library tracks:', error);\n    } finally {\n      setIsLoadingLibrary(false);\n    }\n  };\n\n  // Toggle menu function\n  const toggleMenu = (menuKey: string) => {\n    setExpandedMenus(prev => {\n      const newState = { ...prev, [menuKey]: !prev[menuKey] };\n      localStorage.setItem('sidePanelExpandedMenus', JSON.stringify(newState));\n      return newState;\n    });\n    // Reset empty-allow flags when menus are toggled so defaults work on next open\n    if (menuKey === 'audio-library') {\n      setAllowEmptyAudioTab(false);\n    }\n    if (menuKey === 'sessions') {\n      setAllowEmptySessionsTab(false);\n    }\n  };\n\n  // Handle submenu item selection\n  const handleAudioTabSelect = (tab: 'my-tracks' | 'library') => {\n    setActiveAudioTab(prev => {\n      const next = prev === tab ? null : tab;\n      // If collapsing (setting to null), allow empty so we don't auto-select the other tab\n      setAllowEmptyAudioTab(next === null);\n      // If selecting a tab, disable empty allowance\n      if (next !== null) setAllowEmptyAudioTab(false);\n      return next;\n    });\n  };\n\n  const handleSessionsTabSelect = (tab: 'saved' | 'shared') => {\n    setActiveSessionsTab(prev => {\n      const next = prev === tab ? null : tab;\n      setAllowEmptySessionsTab(next === null);\n      if (next !== null) setAllowEmptySessionsTab(false);\n      return next;\n    });\n  };\n\n\n\n  // Auto-show library when opened in library mode or when tracks menu is expanded\n  useEffect(() => {\n    if (initialMode === 'library' && activeAudioTab !== 'library') {\n      setActiveAudioTab('library');\n      setExpandedMenus(prev => {\n        const newState = { ...prev, 'audio-library': true };\n        localStorage.setItem('sidePanelExpandedMenus', JSON.stringify(newState));\n        return newState;\n      });\n    }\n  }, [initialMode, activeAudioTab]);\n\n  // Auto-select library tab when tracks menu is expanded and no tab is selected\n  useEffect(() => {\n    if (expandedMenus['audio-library'] && !activeAudioTab && !allowEmptyAudioTab) {\n      setActiveAudioTab('library');\n    }\n  }, [expandedMenus['audio-library'], activeAudioTab, allowEmptyAudioTab]);\n\n  // Auto-select saved sessions tab when sessions menu is expanded and no tab is selected\n  useEffect(() => {\n    if (expandedMenus['sessions'] && !activeSessionsTab && !allowEmptySessionsTab) {\n      setActiveSessionsTab('saved');\n    }\n  }, [expandedMenus['sessions'], activeSessionsTab, allowEmptySessionsTab]);\n\n  // Save tab preferences to localStorage whenever they change\n  useEffect(() => {\n    if (activeAudioTab) {\n      localStorage.setItem('sidePanelActiveAudioTab', activeAudioTab);\n    } else {\n      localStorage.removeItem('sidePanelActiveAudioTab');\n    }\n  }, [activeAudioTab]);\n  \n  useEffect(() => {\n    if (activeSessionsTab) {\n      localStorage.setItem('sidePanelActiveSessionsTab', activeSessionsTab);\n    } else {\n      localStorage.removeItem('sidePanelActiveSessionsTab');\n    }\n  }, [activeSessionsTab]);\n  \n\n\n  // Cleanup audio on unmount\n  useEffect(() => {\n    return () => {\n      Object.values(previewAudios).forEach(audio => {\n        if (audio) {\n          audio.pause();\n          audio.currentTime = 0;\n        }\n      });\n    };\n  }, [previewAudios]);\n\n  // Audio assets are now loaded from the library service\n  // The audioAssets array is no longer needed as we use libraryTracks from Supabase\n\n  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) {\n      console.error('No file selected');\n      return;\n    }\n\n    // Check if user is authenticated\n    if (!user) {\n      showSignupModal('upload');\n      // Reset the input\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n      return;\n    }\n\n    // Check upload limits for authenticated users\n    const canUpload = await canPerformAction('upload');\n    if (!canUpload) {\n      setShowUpgradePrompt({\n        show: true,\n        message: getUpgradeMessage('upload'),\n        feature: 'Track Upload'\n      });\n      // Reset the input\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n      return;\n    }\n\n    try {\n      // Upload file to Supabase storage\n      const uploadResult = await StorageService.uploadAudioFile(file, user.id, file.name);\n\n      if (uploadResult.error) {\n        console.error('Upload error:', uploadResult.error);\n        throw uploadResult.error;\n      }\n\n      if (uploadResult.data) {\n        // Create database record - store the file path, not the URL\n        const uploadRecord = await DatabaseService.createUpload({\n          user_id: user.id,\n          file_url: uploadResult.data.name, // Store the file path, not the URL\n          title: file.name,\n          duration: await getAudioDuration(file)\n        });\n\n        if (uploadRecord) {\n          // Create user track object\n          const userTrack: UserTrack = {\n            id: uploadRecord.id,\n            name: file.name,\n            file: file,\n            type: file.type,\n            size: `${(file.size / (1024 * 1024)).toFixed(1)}MB`,\n            url: uploadResult.data.name, // Store the file path, not the URL\n            uploadedAt: Date.now()\n          };\n\n          // Add to user tracks\n          const updatedTracks = [...userTracks, userTrack];\n          setUserTracks(updatedTracks);\n\n          // Default to preview mode for uploaded files\n          onUploadTrack(file, 'preview');\n          \n          // Only close the sidebar on mobile and tablets (full-width mode)\n          // On desktop (lg and above), keep the sidebar open\n          if (window.innerWidth < 1024) {\n            onToggle();\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Upload failed:', error);\n      // You might want to show an error message to the user here\n    }\n\n    // Reset the input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const getAudioDuration = (file: File): Promise<number> => {\n    return new Promise((resolve) => {\n      const audio = new Audio();\n      const url = URL.createObjectURL(file);\n      \n      audio.addEventListener('loadedmetadata', () => {\n        resolve(audio.duration);\n        URL.revokeObjectURL(url);\n      });\n      \n      audio.addEventListener('error', () => {\n        resolve(0);\n        URL.revokeObjectURL(url);\n      });\n      \n      audio.src = url;\n    });\n  };\n\n  const handlePreviewPlay = async (asset: AudioAsset | UserTrack, isUserTrack = false) => {\n    const assetId = asset.id;\n    \n    // Stop any currently playing audio\n    Object.entries(previewAudios).forEach(([id, audio]) => {\n      if (id !== assetId && audio) {\n        audio.pause();\n        audio.currentTime = 0;\n        setPlayingAssets(prev => ({ ...prev, [id]: false }));\n      }\n    });\n\n    // If this asset is already playing, stop it\n    if (playingAssets[assetId]) {\n      const audio = previewAudios[assetId];\n      if (audio) {\n        audio.pause();\n        audio.currentTime = 0;\n        setPlayingAssets(prev => ({ ...prev, [assetId]: false }));\n      }\n      return;\n    }\n\n    // Create new audio element\n    let audioSource: string;\n    if (isUserTrack) {\n      // Generate signed URL for user tracks\n      try {\n        audioSource = await StorageService.getSignedUrl('user-uploads', (asset as UserTrack).url);\n      } catch (error) {\n        console.error('Failed to generate signed URL:', error);\n        return;\n      }\n    } else {\n      audioSource = (asset as AudioAsset).file;\n    }\n    \n    const audio = new Audio(audioSource);\n    \n    audio.addEventListener('ended', () => {\n      setPlayingAssets(prev => ({ ...prev, [assetId]: false }));\n    });\n    audio.addEventListener('pause', () => {\n      setPlayingAssets(prev => ({ ...prev, [assetId]: false }));\n    });\n    audio.addEventListener('error', (e) => {\n      console.error('Audio error:', e);\n      console.error('Audio error details:', audio.error);\n    });\n    \n    audio.play().then(() => {\n      setPlayingAssets(prev => ({ ...prev, [assetId]: true }));\n      setPreviewAudios(prev => ({ ...prev, [assetId]: audio }));\n    }).catch(error => {\n      console.error('Failed to play preview:', error);\n    });\n  };\n\n  const handleAddTrack = async (asset: AudioAsset | UserTrack, isUserTrack = false) => {\n    if (isUserTrack) {\n      const userTrack = asset as UserTrack;\n      onAddUserTrack(userTrack, 'preview');\n    } else {\n      // Check library track limit for free users\n      const canAddLibraryTrack = await canPerformAction('add_library_track');\n      if (!canAddLibraryTrack) {\n        setShowUpgradePrompt({\n          show: true,\n          message: getUpgradeMessage('add_library_track'),\n          feature: 'Library Track'\n        });\n        return;\n      }\n      \n      // No longer need to track individual user library usage\n      \n      const libraryAsset = asset as AudioAsset;\n      onAddFromLibrary(libraryAsset, 'preview');\n    }\n    \n    // Only close the sidebar on mobile and tablets (full-width mode)\n    // On desktop (lg and above), keep the sidebar open\n    if (window.innerWidth < 1024) {\n      onToggle();\n    }\n  };\n\n  const handleRemoveUserTrack = async (trackId: string) => {\n    const trackToRemove = userTracks.find(track => track.id === trackId);\n    if (!trackToRemove || !user) {\n      return;\n    }\n\n    try {\n      // Delete from storage first\n      const storageResult = await StorageService.deleteFile('user-uploads', trackToRemove.url);\n      if (storageResult.error) {\n        console.error('Failed to delete file from storage:', storageResult.error);\n      }\n      \n      // Delete from database\n      const success = await DatabaseService.deleteUpload(trackId, user.id);\n      \n      if (success) {\n        // Remove from local state\n        const updatedTracks = userTracks.filter(track => track.id !== trackId);\n        setUserTracks(updatedTracks);\n      } else {\n        console.error('Failed to delete track from database');\n      }\n    } catch (error) {\n      console.error('Error deleting track:', error);\n    }\n  };\n\n\n\n  return (\n    <>\n      {/* Mobile and Tablet overlay */}\n      {isOpen && (\n        <div \n          className=\"fixed top-15 left-0 right-0 bottom-0 bg-black bg-opacity-50 z-40 lg:hidden\"\n          onClick={onToggle}\n        />\n      )}\n      \n      {/* Sidebar */}\n      <div \n        data-sidepanel\n        className={`fixed top-16 left-0 h-[calc(100vh-4rem)] bg-audafact-surface-1 border-r border-audafact-divider shadow-card transition-transform duration-300 ease-in-out z-50 overflow-hidden flex flex-col ${\n          isOpen ? 'translate-x-0' : '-translate-x-full'\n        } w-full lg:w-[400px]`}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-audafact-divider\">\n          <h2 className=\"text-lg font-semibold audafact-heading\">\n            Stash\n          </h2>\n          <button\n            onClick={onToggle}\n            className=\"p-2 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded-lg transition-colors duration-200\"\n            data-testid=\"side-panel-toggle\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n            </svg>\n          </button>\n        </div>\n\n        {/* Collapsible Menu Navigation */}\n        <div className=\"flex-1 overflow-y-auto\">\n          {/* Audio Library Menu - Show for all users */}\n          <div className=\"border-b border-audafact-divider\">\n            <button\n              onClick={() => toggleMenu('audio-library')}\n              className=\"w-full flex items-center justify-between px-4 py-3 text-sm font-medium text-audafact-text-primary hover:bg-audafact-surface-2 transition-colors duration-200\"\n            >\n              <span>Tracks</span>\n              <svg \n                className={`w-4 h-4 transition-transform duration-200 ${expandedMenus['audio-library'] ? 'rotate-90' : ''}`} \n                fill=\"none\" \n                stroke=\"currentColor\" \n                viewBox=\"0 0 24 24\"\n              >\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n              </svg>\n            </button>\n            \n            {expandedMenus['audio-library'] && (\n              <div className=\"bg-audafact-surface-2\">\n                <button\n                        onClick={() => handleAudioTabSelect('library')}\n                        className={`w-full px-8 py-2 text-xs text-left transition-colors duration-200 ${\n                          activeAudioTab === 'library'\n                            ? 'text-audafact-accent-cyan bg-audafact-surface-3'\n                            : 'text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-3'\n                  }`}\n                >\n                  Audafact Library\n                </button>\n                \n                {/* Enhanced Library Content */}\n                {activeAudioTab === 'library' && (\n                  <div className=\"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider\">\n                                          <div className=\"space-y-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <h3 className=\"text-md font-medium audafact-heading\">Track Library</h3>\n                        </div>\n\n                        {/* Rotation Info for Free Users - Hidden for now */}\n                        {/* <RotationInfo className=\"mb-4\" /> */}\n\n                        {/* Search and Filter */}\n                        <div className=\"space-y-3\">\n                        <input\n                          type=\"text\"\n                          placeholder=\"Search tracks...\"\n                          className=\"w-full px-3 py-2 bg-audafact-surface-2 border border-audafact-divider rounded-lg text-audafact-text-primary placeholder-audafact-text-secondary focus:outline-none focus:border-audafact-accent-cyan\"\n                        />\n                        \n                        <div className=\"text-sm audafact-text-secondary bg-audafact-surface-2 p-2 rounded\">\n                          Preview tracks and add them to your studio. Drag tracks to the studio or use the + button. Guest users can preview but need to sign up to add tracks.\n                        </div>\n                        \n                        {/* Enhanced Library Tracks */}\n                        <div className=\"space-y-3\">\n                          {isLoadingLibrary ? (\n                            <div className=\"text-center py-4\">\n                              <div className=\"loading-spinner mx-auto\"></div>\n                              <p className=\"text-sm audafact-text-secondary mt-2\">Loading tracks...</p>\n                            </div>\n                          ) : libraryTracks.length === 0 ? (\n                            <div className=\"text-center py-4\">\n                              <p className=\"text-sm audafact-text-secondary\">No tracks available</p>\n                            </div>\n                          ) : (\n                            libraryTracks.map((track) => (\n                              <LibraryTrackItem\n                                key={track.id}\n                                track={track}\n                                isPreviewing={isPreviewing(track.id)}\n                                onPreview={() => togglePreview(track)}\n                                onAddToStudio={() => handleAddTrack({\n                                  id: track.id,\n                                  name: track.name,\n                                  file: track.file,\n                                  type: track.type,\n                                  size: track.size\n                                }, false)}\n                                canAddToStudio={tier.id !== 'guest'}\n                                isProOnly={track.isProOnly || false}\n                              />\n                            ))\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n                \n                {/* My Tracks - Show for all users */}\n                <button\n                  onClick={() => handleAudioTabSelect('my-tracks')}\n                  className={`w-full px-8 py-2 text-xs text-left transition-colors duration-200 ${\n                    activeAudioTab === 'my-tracks'\n                      ? 'text-audafact-accent-cyan bg-audafact-surface-3'\n                      : 'text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-3'\n                  }`}\n                >\n                  My Tracks\n                </button>\n                \n                {/* My Tracks Content - Show for all users */}\n                {activeAudioTab === 'my-tracks' && (\n                  <div className=\"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider\">\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center justify-center\">\n                        <h3 className=\"text-md font-medium audafact-heading\">\n                          {user ? 'My Uploaded Tracks' : 'Upload Tracks'}\n                        </h3>\n                      </div>\n\n                      {!user ? (\n                        // Guest user view\n                        <div className=\"text-center py-8 flex-1 flex flex-col justify-center\">\n                          <div className=\"text-audafact-text-secondary mb-4\">\n                            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\n                            </svg>\n                          </div>\n                          <p className=\"audafact-text-secondary mb-4\">Upload your own tracks</p>\n                          <p className=\"text-sm audafact-text-secondary mb-4\">Sign up to upload and manage your audio files</p>\n                            <button\n                              onClick={() => {\n                                // Check if user is authenticated\n                                if (!user) {\n                                  showSignupModal('upload');\n                                  return;\n                                }\n                                // For authenticated users, open file browser\n                                fileInputRef.current?.click();\n                              }}\n                              className=\"audafact-button-primary\"\n                            >\n                              Upload Track\n                            </button>\n                        </div>\n                      ) : userTracks.length === 0 ? (\n                        // Authenticated user with no tracks\n                        <div className=\"text-center py-8 flex-1 flex flex-col justify-center\">\n                          <div className=\"text-audafact-text-secondary mb-4\">\n                            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\n                            </svg>\n                          </div>\n                          <p className=\"audafact-text-secondary mb-4\">No tracks uploaded yet</p>\n                            <button\n                              onClick={() => {\n                                // Check if user is authenticated\n                                if (!user) {\n                                  showSignupModal('upload');\n                                  return;\n                                }\n                                // For authenticated users, open file browser\n                                fileInputRef.current?.click();\n                              }}\n                              className=\"audafact-button-primary\"\n                            >\n                              Upload Your First Track\n                            </button>\n                        </div>\n                      ) : user ? (\n                        <div className=\"space-y-3\">\n                          {userTracks.map((track) => (\n                            <div\n                              key={track.id}\n                              draggable\n                              onDragStart={(e) => {\n                                e.dataTransfer.setData('text/plain', track.id);\n                                e.dataTransfer.setData('application/json', JSON.stringify({\n                                  type: 'user-track',\n                                  name: track.name,\n                                  id: track.id\n                                }));\n                                e.dataTransfer.effectAllowed = 'copy';\n                              }}\n                              className=\"p-3 border border-audafact-divider rounded-lg hover:bg-audafact-surface-2 transition-colors duration-200 audafact-card\"\n                            >\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n                                  {/* Play/Pause Button */}\n                                  <button\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      handlePreviewPlay(track, true);\n                                    }}\n                                    className=\"flex-shrink-0 p-2 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded transition-colors duration-200\"\n                                    title={playingAssets[track.id] ? 'Pause Preview' : 'Play Preview'}\n                                  >\n                                    {playingAssets[track.id] ? (\n                                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                                      </svg>\n                                    ) : (\n                                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347c-.75.412-1.667-.13-1.667-.986V5.653Z\" />\n                                      </svg>\n                                    )}\n                                  </button>\n\n                                  {/* Track Info */}\n                                  <div className=\"flex-1 min-w-0\">\n                                    <h4 className=\"font-medium audafact-text-primary truncate max-w-[200px]\" title={track.name}>{track.name}</h4>\n                                    <p className=\"text-sm audafact-text-secondary truncate max-w-[200px]\">\n                                      {track.type ? track.type.split('/')[1]?.toUpperCase() || 'AUDIO' : 'AUDIO'} • {track.size}\n                                    </p>\n                                  </div>\n                                </div>\n\n                                {/* Action Buttons */}\n                                <div className=\"flex items-center gap-1\">\n                                  {/* Add Track Button */}\n                                  <button\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      handleAddTrack(track, true);\n                                    }}\n                                    className=\"flex-shrink-0 p-2 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded transition-colors duration-200\"\n                                    title=\"Add to Studio\"\n                                  >\n                                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\n                                    </svg>\n                                  </button>\n\n                                  {/* Remove Track Button */}\n                                  <button\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      handleRemoveUserTrack(track.id);\n                                    }}\n                                    className=\"flex-shrink-0 p-2 text-audafact-text-secondary hover:text-audafact-alert-red hover:bg-audafact-surface-2 rounded transition-colors duration-200\"\n                                    title=\"Remove Track\"\n                                  >\n                                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n                                    </svg>\n                                  </button>\n                                </div>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      ) : null}\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Sessions Menu - Only show for authenticated users */}\n          {user && (\n            <div className=\"border-b border-audafact-divider\">\n              <button\n                onClick={() => toggleMenu('sessions')}\n                className=\"w-full flex items-center justify-between px-4 py-3 text-sm font-medium text-audafact-text-primary hover:bg-audafact-surface-2 transition-colors duration-200\"\n              >\n                <span>Sessions</span>\n                <svg \n                  className={`w-4 h-4 transition-transform duration-200 ${expandedMenus['sessions'] ? 'rotate-90' : ''}`} \n                  fill=\"none\" \n                  stroke=\"currentColor\" \n                  viewBox=\"0 0 24 24\"\n                >\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                </svg>\n              </button>\n              \n              {expandedMenus['sessions'] && (\n              <div className=\"bg-audafact-surface-2\">\n                <button\n                  onClick={() => handleSessionsTabSelect('saved')}\n                  className={`w-full px-8 py-2 text-xs text-left transition-colors duration-200 ${\n                    activeSessionsTab === 'saved'\n                      ? 'text-audafact-accent-cyan bg-audafact-surface-3'\n                      : 'text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-3'\n                  }`}\n                >\n                  Saved Sessions\n                </button>\n            \n                {/* Saved Sessions Content */}\n                {activeSessionsTab === 'saved' && (\n                  <div className=\"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider\">\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-md font-medium audafact-heading\">Saved Sessions</h3>\n                        <span className=\"text-xs audafact-text-secondary\">{savedSessions.length} sessions</span>\n                      </div>\n\n                      {savedSessions.length === 0 ? (\n                        <div className=\"text-center py-8 flex-1 flex flex-col justify-center\">\n                          <div className=\"text-audafact-text-secondary mb-4\">\n                            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3\" />\n                            </svg>\n                          </div>\n                          <p className=\"audafact-text-secondary mb-4\">No sessions saved yet</p>\n                          <p className=\"text-xs audafact-text-secondary\">Use \"Record\" \"Save\" to store current studio state</p>\n                        </div>\n                      ) : (\n                        <div className=\"space-y-3\">\n                          {savedSessions.map((session) => {\n                            const isStateSnapshot = session.id.startsWith('session_');\n                            const isRecording = session.id.startsWith('recording_');\n                            \n                            return (\n                              <div\n                                key={session.id}\n                                className=\"p-3 border border-audafact-divider rounded-lg hover:bg-audafact-surface-2 transition-colors duration-200 audafact-card\"\n                              >\n                                <div className=\"flex items-start justify-between mb-2\">\n                                  <div className=\"flex-1 min-w-0\">\n                                    <div className=\"flex items-center gap-2 mb-1\">\n                                      <h4 className=\"font-medium audafact-text-primary text-sm\">\n                                        {new Date(session.startTime).toLocaleDateString()} at {new Date(session.startTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                      </h4>\n                                      {isStateSnapshot && (\n                                        <span className=\"px-2 py-0.5 text-xs bg-audafact-accent-cyan text-audafact-bg-primary rounded-full\">\n                                          State\n                                        </span>\n                                      )}\n                                      {isRecording && (\n                                        <span className=\"px-2 py-0.5 text-xs bg-audafact-alert-red text-audafact-text-primary rounded-full\">\n                                          Recording\n                                        </span>\n                                      )}\n                                    </div>\n                                    {isRecording && (\n                                      <p className=\"text-xs audafact-text-secondary\">\n                                        Duration: {Math.floor(session.duration / 60000)}:{((session.duration % 60000) / 1000).toFixed(0).padStart(2, '0')}\n                                      </p>\n                                    )}\n                                    <p className=\"text-xs audafact-text-secondary\">\n                                      {isStateSnapshot ? 'Studio snapshot' : `${session.events.length} events`} • {session.tracks.length} tracks\n                                    </p>\n                                  </div>\n                                  <div className=\"flex items-center gap-1 ml-2\">\n                                    {canAccessFeature('download') && (\n                                      <button\n                                        onClick={async () => {\n                                          const canDownload = await canPerformAction('download');\n                                          if (!canDownload) {\n                                            setShowUpgradePrompt({\n                                              show: true,\n                                              message: getUpgradeMessage('download'),\n                                              feature: 'Download'\n                                            });\n                                            return;\n                                          }\n                                          exportSession(session.id);\n                                        }}\n                                        className=\"p-1 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded transition-colors duration-200\"\n                                        title=\"Export Session\"\n                                      >\n                                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                                        </svg>\n                                      </button>\n                                    )}\n                                    <button\n                                      onClick={async () => await deleteSession(session.id)}\n                                      className=\"p-1 text-audafact-text-secondary hover:text-audafact-alert-red hover:bg-audafact-surface-2 rounded transition-colors duration-200\"\n                                      title=\"Delete Session\"\n                                    >\n                                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n                                      </svg>\n                                    </button>\n                                  </div>\n                                </div>\n                              \n                                {session.events.length > 0 && (\n                                  <details className=\"mt-2\">\n                                    <summary className=\"text-xs audafact-text-secondary cursor-pointer hover:text-audafact-text-primary\">\n                                      View Events ({session.events.length})\n                                    </summary>\n                                    <div className=\"mt-2 space-y-1 max-h-32 overflow-y-auto\">\n                                      {session.events.slice(0, 5).map((event, index) => (\n                                        <div key={index} className=\"text-xs bg-audafact-surface-3 p-2 rounded\">\n                                          <div className=\"flex justify-between\">\n                                            <span className=\"font-mono text-audafact-accent-cyan\">\n                                              {Math.floor(event.timestamp / 1000)}:{((event.timestamp % 1000) / 10).toFixed(0).padStart(2, '0')}\n                                            </span>\n                                            <span className=\"text-audafact-alert-red\">{event.type}</span>\n                                          </div>\n                                          <div className=\"text-audafact-text-secondary\">\n                                            Track: {event.trackId.substring(0, 8)}...\n                                          </div>\n                                        </div>\n                                      ))}\n                                      {session.events.length > 5 && (\n                                        <div className=\"text-xs text-center audafact-text-secondary py-1\">\n                                          ...and {session.events.length - 5} more events\n                                        </div>\n                                      )}\n                                    </div>\n                                  </details>\n                                )}\n                              </div>\n                            );\n                          })}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n                 \n                <button\n                  onClick={() => handleSessionsTabSelect('shared')}\n                  className={`w-full px-8 py-2 text-xs text-left transition-colors duration-200 ${\n                    activeSessionsTab === 'shared'\n                      ? 'text-audafact-accent-cyan bg-audafact-surface-3'\n                      : 'text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-3'\n                  }`}\n                >\n                  Shared Sessions\n                </button>\n                 \n                {/* Shared Sessions Content */}\n                {activeSessionsTab === 'shared' && (\n                  <div className=\"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider\">\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-md font-medium audafact-heading\">Shared Sessions</h3>\n                      </div>\n\n                      <div className=\"text-center py-8 flex-1 flex flex-col justify-center\">\n                        <div className=\"text-audafact-text-secondary mb-4\">\n                          <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z\" />\n                          </svg>\n                        </div>\n                        <p className=\"audafact-text-secondary mb-4\">Shared sessions coming soon</p>\n                        <p className=\"text-xs audafact-text-secondary\">Discover and import sessions shared by the community</p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n            </div>\n          )}\n          {/* Recordings Menu - Only show for authenticated users */}\n          {user && (\n            <div className=\"border-b border-audafact-divider\">\n              <button\n                onClick={() => toggleMenu('recordings')}\n                className=\"w-full flex items-center justify-between px-4 py-3 text-sm font-medium text-audafact-text-primary hover:bg-audafact-surface-2 transition-colors duration-200\"\n              >\n                <span>Recordings</span>\n                <svg \n                  className={`w-4 h-4 transition-transform duration-200 ${expandedMenus['recordings'] ? 'rotate-90' : ''}`} \n                  fill=\"none\" \n                  stroke=\"currentColor\" \n                  viewBox=\"0 0 24 24\"\n                >\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                </svg>\n              </button>\n              {expandedMenus['recordings'] && (\n                  <div className=\"bg-audafact-surface-2\">\n                    <div className=\"px-4 py-4 bg-audafact-surface-1 border-t border-audafact-divider\">\n                        <div className=\"flex items-center justify-between\">\n                          <h3 className=\"text-md font-medium audafact-heading\">Recordings</h3>\n                          <span className=\"text-xs audafact-text-secondary\">{performances.length} recordings</span>\n                        </div>\n                        \n                        {performances.length === 0 ? (\n                          <div className=\"text-center py-8 flex-1 flex flex-col justify-center\">\n                            <div className=\"text-audafact-text-secondary mb-4\">\n                              <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3\" />\n                              </svg>\n                            </div>\n                            <p className=\"audafact-text-secondary mb-4\">No recordings captured yet</p>\n                            <p className=\"text-xs audafact-text-secondary\">Use \"Record\" to capture your edits and flips</p>\n                          </div>\n                        ) : (\n                          <div className=\"space-y-3\">\n                            {performances.map((performance) => (\n                              <div\n                                key={performance.id}\n                                className=\"p-3 border border-audafact-divider rounded-lg hover:bg-audafact-surface-2 transition-colors duration-200 audafact-card\"\n                              >\n                                <div className=\"flex items-start justify-between mb-2\">\n                                  <div className=\"flex-1 min-w-0\">\n                                    <div className=\"flex items-center gap-2 mb-1\">\n                                      <h4 className=\"font-medium audafact-text-primary text-sm\">\n                                        {new Date(performance.startTime).toLocaleDateString()} at {new Date(performance.startTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                      </h4>\n                                      <span className=\"px-2 py-0.5 text-xs bg-audafact-alert-red text-audafact-text-primary rounded-full\">\n                                        Performance\n                                      </span>\n                                    </div>\n                                    <p className=\"text-xs audafact-text-secondary\">\n                                      Duration: {Math.floor(performance.duration / 60000)}:{((performance.duration % 60000) / 1000).toFixed(0).padStart(2, '0')}\n                                    </p>\n                                    <p className=\"text-xs audafact-text-secondary\">\n                                      {performance.events.length} events • {performance.tracks.length} tracks\n                                      {performance.audioBlob && ' • Audio recorded'}\n                                    </p>\n                                  </div>\n                                  <div className=\"flex items-center gap-1 ml-2\">\n                                    {performance.audioBlob && (\n                                      <button\n                                        onClick={() => {\n                                          try {\n                                            const url = URL.createObjectURL(performance.audioBlob!);\n                                            const audio = new Audio(url);\n                                            \n                                            audio.onerror = (e) => {\n                                              console.error('Audio playback error:', e);\n                                              alert('Failed to play audio. The format may not be supported.');\n                                            };\n                                            \n                                            audio.onloadeddata = () => {\n                                              // Audio loaded successfully\n                                            };\n                                            \n                                            audio.play().catch(error => {\n                                              console.error('Audio play failed:', error);\n                                              alert('Failed to play audio. Please check browser audio permissions.');\n                                            });\n                                          } catch (error) {\n                                            console.error('Audio playback setup failed:', error);\n                                            alert('Failed to setup audio playback.');\n                                          }\n                                        }}\n                                        className=\"p-1 text-audafact-text-secondary hover:text-audafact-accent-green hover:bg-audafact-surface-2 rounded transition-colors duration-200\"\n                                        title=\"Play Audio\"\n                                      >\n                                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 3l14 9-14 9V3z\" />\n                                        </svg>\n                                      </button>\n                                    )}\n                                    {canAccessFeature('download') && (\n                                      <button\n                                        onClick={async () => {\n                                          const canDownload = await canPerformAction('download');\n                                          if (!canDownload) {\n                                            setShowUpgradePrompt({\n                                              show: true,\n                                              message: getUpgradeMessage('download'),\n                                              feature: 'Download'\n                                            });\n                                            return;\n                                          }\n                                          exportPerformance(performance.id);\n                                        }}\n                                        className=\"p-1 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded transition-colors duration-200\"\n                                        title=\"Export Performance\"\n                                      >\n                                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                                        </svg>\n                                      </button>\n                                    )}\n                                    <button\n                                      onClick={async () => await deletePerformance(performance.id)}\n                                      className=\"p-1 text-audafact-text-secondary hover:text-audafact-alert-red hover:bg-audafact-surface-2 rounded transition-colors duration-200\"\n                                      title=\"Delete Performance\"\n                                    >\n                                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n                                      </svg>\n                                    </button>\n                                  </div>\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        )}\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n        </div>\n      </div>\n      \n      {/* Hidden file input for upload functionality */}\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"audio/*\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n      />\n      \n      {/* Upgrade Prompt Modal */}\n      {showUpgradePrompt.show && (\n        <UpgradePrompt\n          message={showUpgradePrompt.message}\n          feature={showUpgradePrompt.feature}\n          onClose={() => setShowUpgradePrompt({ show: false, message: '', feature: '' })}\n        />\n      )}\n    </>\n  );\n};\n\nexport default SidePanel; ","import React from 'react';\n\ninterface DemoModeIndicatorProps {\n  className?: string;\n}\n\nconst DemoModeIndicator: React.FC<DemoModeIndicatorProps> = ({ className = '' }) => {\n  return (\n    <div className={`demo-mode-indicator ${className}`}>\n      Demo Mode\n    </div>\n  );\n};\n\nexport default DemoModeIndicator; ","import React, { useState, useEffect, useRef, useCallback } from 'react';\n\nexport interface OnboardingStep {\n  id: string;\n  title: string;\n  description: string;\n  targetSelector: string;\n  position: 'top' | 'bottom' | 'left' | 'right' | 'center';\n  action?: () => void;\n  required?: boolean;\n}\n\ninterface OnboardingWalkthroughProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onComplete: () => void;\n  steps: OnboardingStep[];\n  currentStep: number;\n  onStepChange: (step: number) => void;\n}\n\nconst OnboardingWalkthrough: React.FC<OnboardingWalkthroughProps> = ({\n  isOpen,\n  onClose,\n  onComplete,\n  steps,\n  currentStep,\n  onStepChange\n}) => {\n  const [targetElement, setTargetElement] = useState<HTMLElement | null>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n  const ranActionForStepRef = useRef<string | null>(null);\n  const [, setPositionTick] = useState<number>(0);\n\n  useEffect(() => {\n    if (!isOpen || currentStep >= steps.length) return;\n\n    const step = steps[currentStep];\n    \n    // Use a small delay to ensure DOM is ready\n    const findElement = () => {\n      // Ensure any step action (which may mutate the layout) runs before measuring\n      if (step.action && ranActionForStepRef.current !== step.id) {\n        ranActionForStepRef.current = step.id;\n        try {\n          step.action();\n        } catch (error) {\n          console.warn('Onboarding action failed:', error);\n        }\n        // Wait a frame so the DOM reflects the action, then re-run\n        requestAnimationFrame(() => setTimeout(findElement, 50));\n        return;\n      }\n      // There can be multiple matching elements (e.g., per-track controls).\n      // Choose the first visible, on-screen element closest to the viewport center.\n      // For some steps we want to prefer a specific selector.\n\n      const getPreferredMatches = (): HTMLElement[] => {\n        // Step-specific selector preferences\n        if (step.id === 'track-modes') {\n          const preferred = Array.from(document.querySelectorAll('[data-testid=\"preview-mode-button\"]')) as HTMLElement[];\n          if (preferred.length > 0) return preferred;\n        }\n        if (step.id === 'volume-controls') {\n          const preferred = Array.from(document.querySelectorAll('[data-testid=\"volume-control\"]')) as HTMLElement[];\n          if (preferred.length > 0) return preferred;\n        }\n        return Array.from(document.querySelectorAll(step.targetSelector)) as HTMLElement[];\n      };\n\n      const allMatches = getPreferredMatches();\n\n      const viewportWidth = window.innerWidth;\n      const viewportHeight = window.innerHeight;\n      const viewportCenterX = viewportWidth / 2;\n      const viewportCenterY = viewportHeight / 2;\n\n      const candidates = allMatches\n        .map((el) => {\n          const rect = el.getBoundingClientRect();\n          const style = window.getComputedStyle(el);\n          const isDisplayed = style.display !== 'none' && style.visibility !== 'hidden' && parseFloat(style.opacity || '1') > 0;\n          const hasSize = rect.width > 0 && rect.height > 0;\n          const fullyOnScreen = rect.top >= 0 && rect.left >= 0 && rect.bottom <= viewportHeight && rect.right <= viewportWidth;\n          const partiallyOnScreen = rect.right > 0 && rect.bottom > 0 && rect.left < viewportWidth && rect.top < viewportHeight;\n          const onScreen = fullyOnScreen || partiallyOnScreen;\n          const visible = isDisplayed && hasSize && onScreen;\n          const centerX = rect.left + rect.width / 2;\n          const centerY = rect.top + rect.height / 2;\n          const distanceToCenter = Math.hypot(centerX - viewportCenterX, centerY - viewportCenterY);\n          return { el, rect, visible, distanceToCenter, fullyOnScreen };\n        })\n        .filter((x) => x.visible);\n\n      let element: HTMLElement | undefined;\n      if (candidates.length === 0) {\n        element = allMatches[0];\n      } else if (step.id === 'volume-controls') {\n        // Prefer the left-most visible range (volume slider is left-most), bias to fully visible\n        const sorted = candidates.sort((a, b) => {\n          if (a.fullyOnScreen !== b.fullyOnScreen) return a.fullyOnScreen ? -1 : 1;\n          return a.rect.left - b.rect.left;\n        });\n        element = sorted[0].el;\n      } else {\n        // Prefer fully visible closest to center; fallback to partially visible\n        const fully = candidates\n          .filter((c) => c.fullyOnScreen)\n          .sort((a, b) => a.distanceToCenter - b.distanceToCenter);\n        if (fully.length > 0) {\n          element = fully[0].el;\n        } else {\n          element = candidates\n            .sort((a, b) => a.distanceToCenter - b.distanceToCenter)[0].el;\n        }\n      }\n      \n      // Debug mode\n      const isDebugMode = localStorage.getItem('audafact_debug_onboarding') === 'true';\n      \n      if (element) {\n        setTargetElement(element);\n        \n        if (isDebugMode) {\n          console.log(`Onboarding: Found element for step \"${step.id}\"`, element);\n        }\n        \n        // Ensure the element is scrolled into view so the overlay positions correctly\n        try {\n          element.scrollIntoView({ behavior: 'auto', block: 'center', inline: 'center' });\n        } catch {\n          // Fallback without options in older environments\n          element.scrollIntoView();\n        }\n        // Force a re-measure on the next frame after potential scroll\n        requestAnimationFrame(() => setTargetElement(element));\n\n        // Action already executed above (once per step)\n      } else {\n        console.warn(`Onboarding: Element not found for selector: ${step.targetSelector}`);\n        if (isDebugMode) {\n          console.log('Available elements with data-testid:', \n            Array.from(document.querySelectorAll('[data-testid]'))\n              .map(el => ({ testid: el.getAttribute('data-testid'), tag: el.tagName }))\n          );\n        }\n        setTargetElement(null);\n      }\n    };\n\n    // Try immediately, then with a small delay\n    findElement();\n    const timeoutId = setTimeout(findElement, 150);\n\n    return () => clearTimeout(timeoutId);\n  }, [isOpen, currentStep]);\n\n  // Keep overlay in sync when user scrolls or resizes\n  useEffect(() => {\n    if (!isOpen) return;\n    const handle = () => setPositionTick((v) => v + 1);\n    window.addEventListener('scroll', handle, { passive: true });\n    window.addEventListener('resize', handle);\n    return () => {\n      window.removeEventListener('scroll', handle);\n      window.removeEventListener('resize', handle);\n    };\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleKeyPress = (e: KeyboardEvent) => {\n      if (e.repeat) return; // avoid auto-repeat causing race conditions\n      if (e.key === 'Escape') {\n        onClose();\n      } else if (e.key === 'ArrowRight' || e.key === ' ') {\n        e.preventDefault();\n        e.stopPropagation();\n        handleNext();\n      } else if (e.key === 'ArrowLeft') {\n        e.preventDefault();\n        e.stopPropagation();\n        handlePrevious();\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyPress);\n    return () => document.removeEventListener('keydown', handleKeyPress);\n  }, [isOpen, currentStep, steps.length]);\n\n  const handleNext = useCallback(() => {\n    if (currentStep < steps.length - 1) {\n      onStepChange(currentStep + 1);\n    } else {\n      onComplete();\n    }\n  }, [currentStep, steps.length, onStepChange, onComplete]);\n\n  const handlePrevious = useCallback(() => {\n    if (currentStep > 0) {\n      onStepChange(currentStep - 1);\n    }\n  }, [currentStep, onStepChange]);\n\n  const handleSkip = () => {\n    onClose();\n  };\n\n  if (!isOpen || currentStep >= steps.length) return null;\n\n  const step = steps[currentStep];\n  const progress = ((currentStep + 1) / steps.length) * 100;\n\n  const getHighlightPadding = () => {\n    if (step.id === 'time-tempo-controls') return 2;\n    return 4;\n  };\n\n  // Calculate tooltip position\n  const getTooltipPosition = () => {\n    if (!targetElement) return { top: '50%', left: '50%', transform: 'translate(-50%, -50%)' };\n\n    const rect = targetElement.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n\n    // Tooltip dimensions and padding\n    const tooltipWidth = 320;\n    const tooltipHeight = 250; // Increased height to account for content\n    const padding = 40; // Increased padding for better spacing\n\n    // Default positioning\n    let top = rect.top + rect.height / 2;\n    let left = rect.left + rect.width / 2;\n    let transform = 'translate(-50%, -50%)';\n\n    switch (step.position) {\n      case 'top':\n        top = rect.top - 20;\n        left = rect.left + rect.width / 2;\n        transform = 'translateX(-50%)';\n        \n        // If tooltip would go off the top, flip to bottom\n        if (top < tooltipHeight / 2 + padding) {\n          top = rect.bottom + 20;\n        }\n        break;\n        \n      case 'bottom':\n        // Add extra space for volume controls to avoid blocking the highlighted area\n        const extraSpace = step.id === 'volume-controls' ? 120 : 60;\n        top = rect.bottom + extraSpace;\n        left = rect.left + rect.width / 2;\n        transform = 'translateX(-50%)';\n        \n        // If tooltip would go off the bottom, flip to top\n        if (top > viewportHeight - tooltipHeight - padding) {\n          top = rect.top - extraSpace;\n        }\n        break;\n        \n      case 'left':\n        top = rect.top + rect.height / 2;\n        left = rect.left - 20;\n        transform = 'translateY(-50%)';\n        \n        // If tooltip would go off the left, flip to right\n        if (left < tooltipWidth / 2 + padding) {\n          left = rect.right + 20;\n        }\n        break;\n        \n      case 'right':\n        top = rect.top + rect.height / 2;\n        left = rect.right + 20;\n        transform = 'translateY(-50%)';\n        \n        // If tooltip would go off the right, flip to left\n        if (left > viewportWidth - tooltipWidth / 2 - padding) {\n          left = rect.left - 20;\n        }\n        break;\n        \n      case 'center':\n      default:\n        // Center in the viewport, not relative to the target element\n        top = viewportHeight / 2;\n        left = viewportWidth / 2;\n        transform = 'translate(-50%, -50%)';\n        break;\n    }\n\n    // Ensure tooltip stays within viewport bounds with extra margin\n    const minLeft = tooltipWidth / 2 + padding;\n    const maxLeft = viewportWidth - tooltipWidth / 2 - padding;\n    const minTop = tooltipHeight / 2 + padding;\n    const maxTop = viewportHeight - tooltipHeight / 2 - padding;\n\n    // Clamp horizontal position\n    left = Math.max(minLeft, Math.min(maxLeft, left));\n    \n    // Clamp vertical position with extra bottom margin\n    const extraBottomMargin = 80; // Increased extra space from bottom edge\n    const adjustedMaxTop = Math.min(maxTop, viewportHeight - tooltipHeight - extraBottomMargin);\n    top = Math.max(minTop, Math.min(adjustedMaxTop, top));\n    \n    // Special handling for volume controls to position above the target\n    if (step.id === 'volume-controls' && targetElement) {\n      const rect = targetElement.getBoundingClientRect();\n      top = rect.top - tooltipHeight - 40; // Position above with extra space\n    }\n    // Only reposition if tooltip is very close to bottom edge and would be cut off\n    else if (top > viewportHeight - tooltipHeight - 50) {\n      // Position above the target element instead\n      if (targetElement) {\n        const rect = targetElement.getBoundingClientRect();\n        const newTop = rect.top - tooltipHeight - 20;\n        // Only move up if there's actually space above and it's better than current position\n        if (newTop > padding && newTop < top) {\n          top = newTop;\n        }\n      }\n    }\n\n    return { top: `${top}px`, left: `${left}px`, transform };\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50\">\n      {/* Backdrop with cutout for highlighted element */}\n      {targetElement && (\n        <>\n          {/* Top backdrop */}\n          <div \n            className=\"absolute bg-black bg-opacity-50 backdrop-blur-sm\"\n            style={{\n              top: 0,\n              left: 0,\n              right: 0,\n              height: targetElement.getBoundingClientRect().top - 4,\n            }}\n            onClick={step.required ? undefined : handleNext}\n          />\n          \n          {/* Bottom backdrop */}\n          <div \n            className=\"absolute bg-black bg-opacity-50 backdrop-blur-sm\"\n            style={{\n              top: targetElement.getBoundingClientRect().bottom + 4,\n              left: 0,\n              right: 0,\n              bottom: 0,\n            }}\n            onClick={step.required ? undefined : handleNext}\n          />\n          \n          {/* Left backdrop */}\n          <div \n            className=\"absolute bg-black bg-opacity-50 backdrop-blur-sm\"\n            style={{\n              top: targetElement.getBoundingClientRect().top - 4,\n              left: 0,\n              width: targetElement.getBoundingClientRect().left - 4,\n              height: targetElement.getBoundingClientRect().height + 8,\n            }}\n            onClick={step.required ? undefined : handleNext}\n          />\n          \n          {/* Right backdrop */}\n          <div \n            className=\"absolute bg-black bg-opacity-50 backdrop-blur-sm\"\n            style={{\n              top: targetElement.getBoundingClientRect().top - 4,\n              left: targetElement.getBoundingClientRect().right + 4,\n              right: 0,\n              height: targetElement.getBoundingClientRect().height + 8,\n            }}\n            onClick={step.required ? undefined : handleNext}\n          />\n        </>\n      )}\n\n      {/* Fallback backdrop when no target element */}\n      {!targetElement && (\n        <div \n          className=\"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm\"\n          onClick={step.required ? undefined : handleNext}\n        />\n      )}\n\n      {/* Highlight overlay */}\n      {targetElement && (\n        <div\n          className=\"absolute border-2 border-audafact-accent-cyan rounded-lg shadow-lg transition-all duration-300 ease-in-out\"\n          style={{\n            top: targetElement.getBoundingClientRect().top - getHighlightPadding(),\n            left: targetElement.getBoundingClientRect().left - getHighlightPadding(),\n            width: targetElement.getBoundingClientRect().width + getHighlightPadding() * 2,\n            height: targetElement.getBoundingClientRect().height + getHighlightPadding() * 2,\n            pointerEvents: 'none',\n            boxShadow: '0 0 0 4px rgba(6, 182, 212, 0.3), 0 0 20px rgba(6, 182, 212, 0.5)',\n            opacity: targetElement ? 1 : 0,\n            zIndex: 5 // Lower than the tooltip (z-50) but higher than background\n          }}\n        />\n      )}\n\n      {/* Tooltip */}\n      <div\n        ref={overlayRef}\n        className=\"absolute bg-audafact-surface-1 border border-audafact-divider rounded-lg shadow-xl max-w-sm p-4 transition-all duration-300 ease-in-out\"\n        style={{\n          ...getTooltipPosition(),\n          zIndex: 60 // Higher than highlight overlay\n        }}\n      >\n        {/* Progress indicator */}\n        <div className=\"flex items-center justify-between mb-3\">\n          <span className=\"text-xs text-audafact-text-secondary\">\n            Step {currentStep + 1} of {steps.length}\n          </span>\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={handleSkip}\n              className=\"text-xs text-audafact-text-secondary hover:text-audafact-text-primary transition-colors\"\n            >\n              Skip\n            </button>\n            <button\n              onClick={onClose}\n              className=\"text-xs text-audafact-text-secondary hover:text-audafact-text-primary transition-colors\"\n            >\n              ✕\n            </button>\n          </div>\n        </div>\n\n        {/* Progress bar */}\n        <div className=\"w-full bg-audafact-surface-2 rounded-full h-1 mb-3\">\n          <div\n            className=\"bg-audafact-accent-cyan h-1 rounded-full transition-all duration-300\"\n            style={{ width: `${progress}%` }}\n          />\n        </div>\n\n        {/* Content */}\n        <h3 className=\"font-medium text-audafact-text-primary mb-2\">\n          {step.title}\n        </h3>\n        <p className=\"text-sm text-audafact-text-secondary mb-4\">\n          {step.description}\n        </p>\n\n        {/* Navigation */}\n        <div className=\"flex items-center justify-between\">\n          <button\n            onClick={handlePrevious}\n            disabled={currentStep === 0}\n            className={`px-3 py-1 text-xs rounded transition-colors ${\n              currentStep === 0\n                ? 'text-audafact-text-secondary cursor-not-allowed'\n                : 'text-audafact-accent-cyan hover:bg-audafact-surface-2'\n            }`}\n          >\n            ← Previous\n          </button>\n\n          <div className=\"flex items-center gap-2 text-xs text-audafact-text-secondary\">\n            <span>Use arrow keys or click to navigate</span>\n          </div>\n\n          <button\n            onClick={handleNext}\n            className=\"px-3 py-1 text-xs bg-audafact-accent-cyan text-audafact-bg-primary rounded hover:bg-opacity-90 transition-colors\"\n          >\n            {currentStep === steps.length - 1 ? 'Finish' : 'Next →'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default OnboardingWalkthrough; ","import React, { useState } from 'react';\n\ninterface HelpButtonProps {\n  onStartTutorial: () => void;\n  onShowHelp: () => void;\n  className?: string;\n}\n\nconst HelpButton: React.FC<HelpButtonProps> = ({\n  onStartTutorial,\n  onShowHelp,\n  className = ''\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n\n  const handleToggle = () => {\n    setIsOpen(!isOpen);\n  };\n\n  const handleStartTutorial = () => {\n    setIsOpen(false);\n    onStartTutorial();\n  };\n\n  const handleShowHelp = () => {\n    setIsOpen(false);\n    onShowHelp();\n  };\n\n  return (\n    <div className={`fixed bottom-6 right-6 z-40 ${className}`}>\n      {/* Help Menu */}\n      {isOpen && (\n        <div className=\"absolute bottom-16 right-0 bg-audafact-surface-1 border border-audafact-divider rounded-lg shadow-xl p-2 min-w-48\">\n          <button\n            onClick={handleStartTutorial}\n            className=\"w-full text-left px-3 py-2 text-sm text-audafact-text-primary hover:bg-audafact-surface-2 rounded transition-colors flex items-center gap-2\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n            Start Tutorial\n          </button>\n          <button\n            onClick={handleShowHelp}\n            className=\"w-full text-left px-3 py-2 text-sm text-audafact-text-primary hover:bg-audafact-surface-2 rounded transition-colors flex items-center gap-2\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n            Help & Tips\n          </button>\n          <div className=\"border-t border-audafact-divider my-1\"></div>\n          <div className=\"px-3 py-1 text-xs text-audafact-text-secondary\">\n            Press ? for keyboard shortcuts\n          </div>\n        </div>\n      )}\n\n      {/* Main Help Button */}\n      <button\n        onClick={handleToggle}\n        className=\"bg-audafact-accent-cyan text-audafact-bg-primary w-12 h-12 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center hover:scale-105\"\n        title=\"Help & Tutorial\"\n      >\n        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n        </svg>\n      </button>\n    </div>\n  );\n};\n\nexport default HelpButton; ","import React from 'react';\n\ninterface HelpModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst HelpModal: React.FC<HelpModalProps> = ({ isOpen, onClose }) => {\n  if (!isOpen) return null;\n\n  const shortcuts = [\n    { key: 'Space', description: 'Play/Pause current track' },\n    { key: 'Left/Right Arrow', description: 'Navigate between tracks' },\n    { key: '1-0', description: 'Trigger cue points (in Chop mode)' },\n    { key: 'Escape', description: 'Close modals and dialogs' },\n    { key: '?', description: 'Show this help modal' },\n    { key: 'Z', description: 'Zoom in on waveform' },\n    { key: 'X', description: 'Zoom out on waveform' },\n    { key: 'C', description: 'Reset zoom level' }\n  ];\n\n  const tips = [\n    'Click anywhere on the waveform to jump to that position',\n    'Drag on the waveform to set loop start and end points',\n    'Use the side panel to browse and preview tracks from your library',\n    'Switch between Preview, Loop, and Chop modes for different workflows',\n    'Adjust tempo and time signature to match different tracks',\n    'Use filters to shape your sound and create effects',\n    'Record your performances to capture your creative process',\n    'Save your sessions to return to them later'\n  ];\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"relative bg-audafact-surface-1 border border-audafact-divider rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-audafact-divider\">\n          <h2 className=\"text-xl font-medium text-audafact-text-primary\">\n            Help & Tips\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"text-audafact-text-secondary hover:text-audafact-text-primary transition-colors\"\n          >\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n            </svg>\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 space-y-6\">\n          {/* Keyboard Shortcuts */}\n          <div>\n            <h3 className=\"text-lg font-medium text-audafact-text-primary mb-3\">\n              Keyboard Shortcuts\n            </h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n              {shortcuts.map((shortcut, index) => (\n                <div key={index} className=\"flex items-center justify-between p-2 bg-audafact-surface-2 rounded\">\n                  <kbd className=\"px-2 py-1 text-xs font-mono bg-audafact-bg-primary border border-audafact-divider rounded\">\n                    {shortcut.key}\n                  </kbd>\n                  <span className=\"text-sm text-audafact-text-secondary\">\n                    {shortcut.description}\n                  </span>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Tips */}\n          <div>\n            <h3 className=\"text-lg font-medium text-audafact-text-primary mb-3\">\n              Pro Tips\n            </h3>\n            <ul className=\"space-y-2\">\n              {tips.map((tip, index) => (\n                <li key={index} className=\"flex items-start gap-2 text-sm text-audafact-text-secondary\">\n                  <span className=\"text-audafact-accent-cyan mt-0.5\">•</span>\n                  {tip}\n                </li>\n              ))}\n            </ul>\n          </div>\n\n          {/* Modes Explanation */}\n          <div>\n            <h3 className=\"text-lg font-medium text-audafact-text-primary mb-3\">\n              Track Modes\n            </h3>\n            <div className=\"space-y-3\">\n              <div className=\"p-3 bg-audafact-surface-2 rounded\">\n                <h4 className=\"font-medium text-audafact-accent-blue mb-1\">Preview Mode</h4>\n                <p className=\"text-sm text-audafact-text-secondary\">\n                  Play the full track from start to finish. Perfect for listening and getting familiar with the material.\n                </p>\n              </div>\n              <div className=\"p-3 bg-audafact-surface-2 rounded\">\n                <h4 className=\"font-medium text-audafact-accent-cyan mb-1\">Loop Mode</h4>\n                <p className=\"text-sm text-audafact-text-secondary\">\n                  Create repeating sections by setting custom start and end points. Great for practicing and building arrangements.\n                </p>\n              </div>\n              <div className=\"p-3 bg-audafact-surface-2 rounded\">\n                <h4 className=\"font-medium text-audafact-alert-red mb-1\">Chop Mode</h4>\n                <p className=\"text-sm text-audafact-text-secondary\">\n                  Trigger specific points in the track using keyboard shortcuts. Ideal for live performances and remixing.\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Getting Started */}\n          <div>\n            <h3 className=\"text-lg font-medium text-audafact-text-primary mb-3\">\n              Getting Started\n            </h3>\n            <div className=\"space-y-2 text-sm text-audafact-text-secondary\">\n              <p>\n                1. <strong>Load a track</strong> - Use the navigation arrows or browse the library\n              </p>\n              <p>\n                2. <strong>Play and explore</strong> - Try different playback modes and controls\n              </p>\n              <p>\n                3. <strong>Set up loops</strong> - Switch to Loop mode and drag on the waveform\n              </p>\n              <p>\n                4. <strong>Trigger cues</strong> - Use Chop mode and press 1-0 keys\n              </p>\n              <p>\n                5. <strong>Experiment</strong> - Adjust tempo, filters, and effects\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between p-6 border-t border-audafact-divider\">\n          <button\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm bg-audafact-surface-2 text-audafact-text-primary rounded hover:bg-audafact-surface-3 transition-colors\"\n          >\n            Close\n          </button>\n          <div className=\"text-xs text-audafact-text-secondary\">\n            Need more help? Contact support at help@audafact.com\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default HelpModal; ","import { useState, useEffect, useCallback, useRef } from 'react';\nimport { useAudioContext } from '../context/AudioContext';\nimport { useSidePanel } from '../context/SidePanelContext';\nimport { useRecording } from '../context/RecordingContext';\nimport { useAuth } from '../context/AuthContext';\nimport { useDemo } from '../context/DemoContext';\nimport { useAccessControl } from '../hooks/useAccessControl';\nimport { useSignupModal } from '../hooks/useSignupModal';\nimport { useOnboarding } from '../hooks/useOnboarding';\nimport { createOnboardingSteps, createQuickOnboardingSteps } from '../config/onboardingConfig';\nimport { UpgradePrompt } from '../components/UpgradePrompt';\nimport WaveformDisplay from '../components/WaveformDisplay';\nimport TrackControls from '../components/TrackControls';\n// import ModeSelector from '../components/ModeSelector';\nimport TempoControls from '../components/TempoControls';\nimport TimeSignatureControls from '../components/TimeSignatureControls';\nimport RecordingControls from '../components/RecordingControls';\nimport SidePanel from '../components/SidePanel';\nimport SignupModal from '../components/SignupModal';\nimport DemoModeIndicator from '../components/DemoModeIndicator';\n// import DemoTrackInfo from '../components/DemoTrackInfo';\n// import NextTrackButton from '../components/NextTrackButton';\nimport OnboardingWalkthrough from '../components/OnboardingWalkthrough';\nimport HelpButton from '../components/HelpButton';\nimport HelpModal from '../components/HelpModal';\n// import { AccessService } from '../services/accessService';\nimport { TimeSignature } from '../types/music';\nimport { useUserTier } from '../hooks/useUserTier';\nimport { LibraryService } from '../services/libraryService';\n\n// Default bundled audio assets - used as fallback when no Supabase library tracks are available\nconst defaultAudioAssets: AudioAsset[] = [\n  {\n    id: 'ron-drums',\n    name: 'RON Drums',\n    file: '/src/assets/audio/RON-drums.wav',\n    type: 'wav',\n    size: '5.5MB'\n  },\n  {\n    id: 'secrets-of-the-heart',\n    name: 'Secrets of the Heart',\n    file: '/src/assets/audio/Secrets of the Heart.mp3',\n    type: 'mp3',\n    size: '775KB'\n  },\n  {\n    id: 'rhythm-revealed',\n    name: 'The Rhythm Revealed (Drums)',\n    file: '/src/assets/audio/The Rhythm Revealed(Drums).wav',\n    type: 'wav',\n    size: '5.5MB'\n  },\n  {\n    id: 'unveiled-desires',\n    name: 'Unveiled Desires',\n    file: '/src/assets/audio/Unveiled Desires.wav',\n    type: 'wav',\n    size: '6.0MB'\n  }\n];\n\n// Define a Track type\ninterface Track {\n  id: string;\n  file: File;\n  buffer: AudioBuffer;\n  mode: 'preview' | 'loop' | 'cue';\n  loopStart: number;\n  loopEnd: number;\n  cuePoints: number[];\n  tempo: number;\n  timeSignature: TimeSignature;\n  firstMeasureTime: number;\n  showMeasures: boolean;\n}\n\n// Define AudioAsset interface for library\ninterface AudioAsset {\n  id: string;\n  name: string;\n  file: string;\n  type: 'wav' | 'mp3';\n  size: string;\n  duration?: number;\n}\n\n// Define UserTrack interface for uploaded tracks\ninterface UserTrack {\n  id: string;\n  name: string;\n  file: File | null;\n  type: string;\n  size: string;\n  url: string;\n  uploadedAt: number;\n}\n\nconst Studio = () => {\n  const { audioContext, initializeAudio, resumeAudioContext } = useAudioContext();\n  const { isOpen: isSidePanelOpen, toggleSidePanel } = useSidePanel();\n  const { addRecordingEvent, saveCurrentState, isRecordingPerformance, getRecordingDestination } = useRecording();\n  const { user, loading: authLoading } = useAuth();\n  const { isDemoMode, currentDemoTrack, loadRandomDemoTrack, isLoading: isDemoLoading, trackDemoEvent } = useDemo();\n  const { modalState, closeSignupModal } = useSignupModal();\n  const { canPerformAction, getUpgradeMessage } = useAccessControl();\n  const { tier } = useUserTier();\n  const [tracks, setTracks] = useState<Track[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [showHelpModal, setShowHelpModal] = useState<boolean>(false);\n  const [error, setError] = useState<string | null>(null);\n  const [isAudioInitialized, setIsAudioInitialized] = useState<boolean>(false);\n  // Unified list of assets available for navigation (Supabase library if available, else defaults)\n  const [availableAssets, setAvailableAssets] = useState<AudioAsset[]>(defaultAudioAssets);\n\n  // Onboarding handlers\n  const onboardingHandlers = {\n    onPlayTrack: () => {\n      // Trigger play on the first track if available\n      if (tracks.length > 0) {\n        const firstTrack = tracks[0];\n        // This will be handled by the TrackControls component\n      }\n    },\n    onNextTrack: () => {\n      handleNextTrack();\n    },\n    onPreviousTrack: () => {\n      handlePreviousTrack();\n    },\n    onToggleSidePanel: () => {\n      toggleSidePanel();\n    },\n    onSwitchToLoopMode: () => {\n      if (tracks.length > 0) {\n        handleModeChange(tracks[0].id, 'loop');\n      }\n    },\n    onSwitchToCueMode: () => {\n      if (tracks.length > 0) {\n        handleModeChange(tracks[0].id, 'cue');\n      }\n    },\n    onToggleControls: () => {\n      if (tracks.length > 0) {\n        handleToggleControls(tracks[0].id);\n      }\n    },\n    onAdjustVolume: () => {\n      // Volume adjustment will be handled by the TrackControls component\n    },\n    onSetLoopPoints: () => {\n      // Loop point setting will be handled by the WaveformDisplay component\n    },\n    onTriggerCue: () => {\n      // Cue triggering will be handled by keyboard events\n    }\n  };\n\n  // Create onboarding steps\n  const onboardingSteps = createOnboardingSteps(onboardingHandlers);\n  const quickOnboardingSteps = createQuickOnboardingSteps(onboardingHandlers);\n\n  // Initialize onboarding\n  const isAnonymousUser = !user && !authLoading;\n  const onboarding = useOnboarding(onboardingSteps, isAnonymousUser);\n  const [needsUserInteraction, setNeedsUserInteraction] = useState<boolean>(false);\n  const [isInitializingAudio, setIsInitializingAudio] = useState<boolean>(false);\n  const [isManuallyAddingTrack, setIsManuallyAddingTrack] = useState<boolean>(false);\n  const [loopPlayhead, setLoopPlayhead] = useState(0);\n  const [samplePlayhead, setSamplePlayhead] = useState(0);\n  const [uploadError, setUploadError] = useState<string | null>(null);\n  const [selectedCueTrackId, setSelectedCueTrackId] = useState<string | null>(null);\n  const [playbackTimes, setPlaybackTimes] = useState<{ [key: string]: number }>({});\n  const [zoomLevels, setZoomLevels] = useState<{ [key: string]: number }>({});\n  const [playbackSpeeds, setPlaybackSpeeds] = useState<{ [key: string]: number }>({});\n  const [volume, setVolume] = useState<{ [key: string]: number }>({});\n  // Add lastUsedVolume state\n  const [lastUsedVolume, setLastUsedVolume] = useState<number>(1);\n  const lastUsedVolumeRef = useRef(lastUsedVolume);\n  useEffect(() => {\n    lastUsedVolumeRef.current = lastUsedVolume;\n  }, [lastUsedVolume]);\n  const [showMeasures, setShowMeasures] = useState<{ [key: string]: boolean }>({});\n  // Add state for showing cue thumbs\n  const [showCueThumbs, setShowCueThumbs] = useState<{ [key: string]: boolean }>({});\n  // Add playback state tracking\n  const [playbackStates, setPlaybackStates] = useState<{ [key: string]: boolean }>({});\n  \n\n  \n  // Add accordion state for collapsible controls\n  const [expandedControls, setExpandedControls] = useState<{ [key: string]: boolean }>({});\n  \n  // Store seek functions for each track\n  const seekFunctionRefs = useRef<{ [key: string]: React.MutableRefObject<((seekTime: number) => void) | null> }>({});\n  \n  // Get or create seek function ref for a track\n  const getSeekFunctionRef = useCallback((trackId: string) => {\n    if (!seekFunctionRefs.current[trackId]) {\n      seekFunctionRefs.current[trackId] = { current: null };\n    }\n    return seekFunctionRefs.current[trackId];\n  }, []);\n  \n  // Filter state\n  const [lowpassFreqs, setLowpassFreqs] = useState<{ [key: string]: number }>({});\n  const [highpassFreqs, setHighpassFreqs] = useState<{ [key: string]: number }>({});\n  const [filterEnabled, setFilterEnabled] = useState<{ [key: string]: boolean }>({});\n  \n  // Track navigation state\n  const [currentTrackIndex, setCurrentTrackIndex] = useState<number>(0);\n  const [touchStartX, setTouchStartX] = useState<number | null>(null);\n  const [touchStartY, setTouchStartY] = useState<number | null>(null);\n  const [touchEndX, setTouchEndX] = useState<number | null>(null);\n  const [touchEndY, setTouchEndY] = useState<number | null>(null);\n  // const [isSwiping, setIsSwiping] = useState<boolean>(false);\n  // const [swipeDirection, setSwipeDirection] = useState<'left' | 'right' | null>(null);\n  const [isWaveformScrolling, setIsWaveformScrolling] = useState<boolean>(false);\n  \n  // Add track functionality state\n  const [isAddingTrack, setIsAddingTrack] = useState<boolean>(false);\n  const [addTrackAnimation, setAddTrackAnimation] = useState<boolean>(false);\n  const [canAddTrack, setCanAddTrack] = useState<boolean>(false);\n  const [showAddTrackGesture, setShowAddTrackGesture] = useState<boolean>(false);\n  const [lastGestureTime, setLastGestureTime] = useState<number>(0);\n  const [isGestureProcessing, setIsGestureProcessing] = useState<boolean>(false);\n  const lastProcessedGestureRef = useRef<string>('');\n  \n  // Separate loading states\n  const [isTrackLoading, setIsTrackLoading] = useState<boolean>(false);\n\n  // Add drag and drop state\n  const [isDragOver, setIsDragOver] = useState<boolean>(false);\n  const [dragTarget, setDragTarget] = useState<string | null>(null);\n  const [dragData, setDragData] = useState<{ type: string; name: string; id: string } | null>(null);\n  const [showUpgradePrompt, setShowUpgradePrompt] = useState<{\n    show: boolean;\n    message: string;\n    feature: string;\n  }>({ show: false, message: '', feature: '' });\n  \n\n\n  // --- Utility functions for localStorage ---\n  const saveCuePointsToLocal = (trackId: string, cuePoints: number[]) => {\n    localStorage.setItem(`cuePoints-${trackId}`, JSON.stringify(cuePoints));\n  };\n  const loadCuePointsFromLocal = (trackId: string): number[] | null => {\n    const saved = localStorage.getItem(`cuePoints-${trackId}`);\n    return saved ? JSON.parse(saved) : null;\n  };\n  const removeCuePointsFromLocal = (trackId: string) => {\n    localStorage.removeItem(`cuePoints-${trackId}`);\n  };\n\n  // --- PATCH: Settings persistence ---\n  const saveTrackSettingsToLocal = (trackId: string, settings: any) => {\n    localStorage.setItem(`trackSettings-${trackId}`, JSON.stringify(settings));\n  };\n  const loadTrackSettingsFromLocal = (trackId: string): any | null => {\n    const saved = localStorage.getItem(`trackSettings-${trackId}`);\n    return saved ? JSON.parse(saved) : null;\n  };\n  const removeTrackSettingsFromLocal = (trackId: string) => {\n    localStorage.removeItem(`trackSettings-${trackId}`);\n  };\n  const saveSelectedCueTrackIdToLocal = (trackId: string | null) => {\n    if (trackId) {\n      localStorage.setItem('selectedCueTrackId', trackId);\n    } else {\n      localStorage.removeItem('selectedCueTrackId');\n    }\n  };\n  const loadSelectedCueTrackIdFromLocal = (): string | null => {\n    return localStorage.getItem('selectedCueTrackId');\n  };\n\n  // --- PATCH: Load settings on mount ---\n  useEffect(() => {\n    // Load selected cue track id\n    const selected = loadSelectedCueTrackIdFromLocal();\n    if (selected) setSelectedCueTrackId(selected);\n  }, []);\n\n  // Note: We're not implementing localStorage persistence for studio tracks\n  // because:\n  // 1. Library tracks are already available in assets/audio directory\n  // 2. User-uploaded tracks are persisted in the sidebar's \"My Tracks\" section\n  // 3. Audio files are too large for localStorage (causes QuotaExceededError)\n  // \n  // Instead, users can re-add tracks from the sidebar when needed\n\n  // Monitor tracks to determine if we can add a new track\n  useEffect(() => {\n    if (tracks.length === 0) {\n      setCanAddTrack(false);\n      return;\n    }\n    \n    // Check if the top track (first in array) is in preview mode\n    const topTrack = tracks[0];\n    const hasPreviewTrack = topTrack && topTrack.mode === 'preview';\n    \n    // Can add track if there's no preview track or if the top track is not in preview mode\n    setCanAddTrack(!hasPreviewTrack);\n  }, [tracks]);\n\n  // Load library tracks for navigation based on tier\n  useEffect(() => {\n    let isCancelled = false;\n    const loadAssets = async () => {\n      try {\n      if (isDemoMode) return; // demo mode uses curated demo flow\n        const libraryTracks = await LibraryService.getLibraryTracks(tier.id);\n        if (isCancelled) return;\n        if (libraryTracks && libraryTracks.length > 0) {\n          const mapped: AudioAsset[] = libraryTracks.map(t => ({\n            id: t.id,\n            name: t.name,\n            file: t.file,\n            type: t.type,\n            size: t.size\n          }));\n          setAvailableAssets(mapped);\n        } else {\n          setAvailableAssets(defaultAudioAssets);\n        }\n      } catch (e) {\n        console.error('Failed to load library tracks:', e);\n        if (!isCancelled) setAvailableAssets(defaultAudioAssets);\n      }\n    };\n    loadAssets();\n    return () => { isCancelled = true; };\n  }, [tier.id, isDemoMode]);\n\n  // Load a random track on component mount\n  useEffect(() => {\n    const loadRandomTrack = async () => {\n      try {\n        setIsTrackLoading(true);\n        setError(null);\n        \n        // Use demo track if in demo mode, otherwise select a random asset\n        let asset;\n        if (isDemoMode && currentDemoTrack) {\n          asset = {\n            id: currentDemoTrack.id,\n            name: currentDemoTrack.name,\n            file: currentDemoTrack.file,\n            type: currentDemoTrack.type\n          };\n        } else {\n          const sourceAssets = (availableAssets && availableAssets.length > 0) ? availableAssets : defaultAudioAssets;\n          const randomIndex = Math.floor(Math.random() * sourceAssets.length);\n          asset = sourceAssets[randomIndex];\n        }\n        \n        // Use existing audio context if available\n        let context = audioContext;\n\n        if (!context) {\n          try {\n            context = await initializeAudio();\n            setIsAudioInitialized(true);\n          } catch (initError) {\n            console.error('Error initializing audio context:', initError);\n            setNeedsUserInteraction(true);\n            setIsTrackLoading(false);\n            return;\n          }\n        } else if (context.state === 'suspended') {\n          try {\n            await context.resume();\n          } catch (resumeError) {\n            console.error('Failed to resume audio context:', resumeError);\n            setNeedsUserInteraction(true);\n            setIsTrackLoading(false);\n            return;\n          }\n        }\n\n        if (!context) {\n          setNeedsUserInteraction(true);\n          setIsTrackLoading(false);\n          return;\n        }\n        \n        // Fetch the audio file from the asset\n        const response = await fetch(asset.file);\n        const blob = await response.blob();\n        const file = new File([blob], `${asset.name}.${asset.type}`, { type: `audio/${asset.type}` });\n        \n        // Load the audio file into buffer\n        const buffer = await loadAudioBuffer(file, context);\n        \n        // Generate track ID\n        const trackId = asset.id;\n        \n        // Try to load settings from localStorage\n        const settings = loadTrackSettingsFromLocal(trackId) || {};\n        \n        const newTrack: Track = {\n          id: trackId,\n          file,\n          buffer,\n          mode: isDemoMode ? 'preview' : (settings.mode || 'preview'), // Force preview mode in demo\n          loopStart: settings.loopStart || 0,\n          loopEnd: settings.loopEnd || buffer.duration,\n          cuePoints: settings.cuePoints || Array.from({ length: 10 }, (_, i) => \n            buffer.duration * (i / 10)\n          ),\n          tempo: settings.tempo || 120,\n          timeSignature: settings.timeSignature || { numerator: 4, denominator: 4 },\n          firstMeasureTime: settings.firstMeasureTime || 0,\n          showMeasures: settings.showMeasures || false\n        };\n        \n        setTracks([newTrack]);\n        // Align navigation index with chosen asset\n        if (!isDemoMode) {\n          const sourceAssets = (availableAssets && availableAssets.length > 0) ? availableAssets : defaultAudioAssets;\n          const idx = sourceAssets.findIndex(a => a.id === asset.id);\n          setCurrentTrackIndex(Math.max(0, idx));\n        } else {\n          setCurrentTrackIndex(0);\n        }\n        setShowMeasures(prev => ({ ...prev, [trackId]: !!settings.showMeasures }));\n        setShowCueThumbs(prev => ({ ...prev, [trackId]: !!settings.showCueThumbs }));\n        setZoomLevels(prev => ({ ...prev, [trackId]: settings.zoomLevel || 1 }));\n        // Reset playback speed but keep volume\n        setPlaybackSpeeds(prev => ({ ...prev, [trackId]: 1 }));\n        // Set volume based on mode\n        const trackVolume = newTrack.mode === 'preview' \n          ? lastUsedVolumeRef.current \n          : (typeof settings.volume === 'number' ? settings.volume : lastUsedVolumeRef.current);\n        setVolume(prev => ({ ...prev, [trackId]: trackVolume }));\n        setExpandedControls(prev => ({ ...prev, [trackId]: false }));\n        \n        // Track demo event if in demo mode\n        if (isDemoMode) {\n          trackDemoEvent('session_started', { \n            trackId: asset.id,\n            timestamp: Date.now()\n          });\n        }\n        \n        // Start onboarding only for anonymous users when first track loads\n        // Logged-in users should only get walkthrough when explicitly clicking \"Load a random track\"\n        if (isAnonymousUser && onboarding.shouldShowOnboarding()) {\n          // Small delay to ensure UI is fully rendered\n          setTimeout(() => {\n            onboarding.startOnboarding();\n          }, 1000);\n        }\n        \n        // Track loading is complete\n        setIsTrackLoading(false);\n      } catch (error) {\n        console.error('Error loading random track:', error);\n        const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred';\n        setError(`Error loading track: ${errorMessage}`);\n        setIsTrackLoading(false);\n      }\n    };\n\n    // Only load a random track if there are no tracks currently loaded\n    if (tracks.length === 0 && !isManuallyAddingTrack && !isTrackLoading) {\n      // In demo mode, wait until a demo track is selected to avoid double-loading\n      if (isDemoMode && !currentDemoTrack) {\n        return;\n      }\n      loadRandomTrack();\n    }\n  }, [audioContext, initializeAudio, tracks.length, isManuallyAddingTrack, isDemoMode, currentDemoTrack, onboarding, availableAssets, isTrackLoading]);\n\n  // Keyboard navigation for track switching\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      // Handle help modal\n      if (event.key === '?') {\n        event.preventDefault();\n        setShowHelpModal(true);\n        return;\n      }\n\n      // Zoom shortcuts: z=zoom in, x=zoom out, c=reset (affects first track)\n      if (tracks.length > 0) {\n        const activeTrackId = tracks[0].id;\n        if (event.key === 'z' || event.key === 'Z') {\n          event.preventDefault();\n          handleZoomIn(activeTrackId);\n          return;\n        } else if (event.key === 'x' || event.key === 'X') {\n          event.preventDefault();\n          handleZoomOut(activeTrackId);\n          return;\n        } else if (event.key === 'c' || event.key === 'C') {\n          event.preventDefault();\n          handleResetZoom(activeTrackId);\n          return;\n        }\n      }\n\n      if (event.key === 'ArrowLeft') {\n        event.preventDefault();\n        handlePreviousTrack();\n      } else if (event.key === 'ArrowRight') {\n        event.preventDefault();\n        handleNextTrack();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [tracks, currentTrackIndex]);\n\n  // Handle demo track changes\n  useEffect(() => {\n    if (isDemoMode && currentDemoTrack && audioContext && tracks.length > 0) {\n      // If the currently loaded track already matches the demo track, do nothing\n      if (tracks[0]?.id === currentDemoTrack.id) return;\n      // Update the current track with the new demo track\n      const updateTrackWithDemoTrack = async () => {\n        try {\n          const response = await fetch(currentDemoTrack.file);\n          const blob = await response.blob();\n          const file = new File([blob], `${currentDemoTrack.name}.${currentDemoTrack.type}`, { \n            type: `audio/${currentDemoTrack.type}` \n          });\n          \n          const buffer = await loadAudioBuffer(file, audioContext);\n          const trackId = currentDemoTrack.id;\n          const settings = loadTrackSettingsFromLocal(trackId) || {};\n          \n          const updatedTrack: Track = {\n            id: trackId,\n            file,\n            buffer,\n            mode: isDemoMode ? 'preview' : (settings.mode || 'preview'),\n            loopStart: settings.loopStart || 0,\n            loopEnd: settings.loopEnd || buffer.duration,\n            cuePoints: settings.cuePoints || Array.from({ length: 10 }, (_, i) => \n              buffer.duration * (i / 10)\n            ),\n            tempo: settings.tempo || 120,\n            timeSignature: settings.timeSignature || { numerator: 4, denominator: 4 },\n            firstMeasureTime: settings.firstMeasureTime || 0,\n            showMeasures: settings.showMeasures || false\n          };\n          \n        setTracks([updatedTrack]);\n          setShowMeasures(prev => ({ ...prev, [trackId]: !!settings.showMeasures }));\n          setShowCueThumbs(prev => ({ ...prev, [trackId]: !!settings.showCueThumbs }));\n          setZoomLevels(prev => ({ ...prev, [trackId]: settings.zoomLevel || 1 }));\n          setPlaybackSpeeds(prev => ({ ...prev, [trackId]: 1 }));\n          const trackVolume = updatedTrack.mode === 'preview' \n            ? lastUsedVolumeRef.current \n            : (typeof settings.volume === 'number' ? settings.volume : lastUsedVolumeRef.current);\n          setVolume(prev => ({ ...prev, [trackId]: trackVolume }));\n          setExpandedControls(prev => ({ ...prev, [trackId]: false }));\n          \n          // Track demo event\n          trackDemoEvent('next_track', { \n            fromTrackId: tracks[0]?.id,\n            toTrackId: trackId\n          });\n          // keep index at 0 in demo mode\n          setCurrentTrackIndex(0);\n          \n        } catch (error) {\n          console.error('Error updating demo track:', error);\n        }\n      };\n      \n      updateTrackWithDemoTrack();\n    }\n  }, [isDemoMode, currentDemoTrack, audioContext, tracks.length, trackDemoEvent]);\n\n  // Touch/swipe handlers\n  const handleTouchStart = (e: React.TouchEvent) => {\n    if (isTrackLoading || isWaveformScrolling) return; // Disable during loading or waveform scrolling\n    \n    // Prevent multiple touch starts\n    if (touchStartX !== null) return; // Already tracking a touch\n    \n    // Check if the touch target is within a waveform container\n    const target = e.target as Element;\n    const isWaveformTouch = target.closest('.audafact-waveform-bg') !== null;\n    \n    if (isWaveformTouch) return; // Don't handle swipe gestures on waveform\n    \n    // Check if the touch target is within track controls or consolidated header\n    const isTrackControlsTouch = target.closest('.audafact-card.p-4.space-y-4') !== null;\n    const isConsolidatedHeaderTouch = target.closest('.p-4.border-b.bg-audafact-surface-2') !== null;\n    \n    if (isTrackControlsTouch || isConsolidatedHeaderTouch) return; // Don't handle swipe gestures on track controls or header\n    \n    // Only allow swipe gestures in the navigation controls area\n    const isNavigationControlsTouch = target.closest('.flex.items-center.justify-between.bg-audafact-surface-2.border-b.border-audafact-divider.py-1.px-2') !== null;\n    \n    if (!isNavigationControlsTouch) return; // Only handle swipe gestures in navigation controls\n    \n    // Prevent browser navigation gestures from the start\n    e.preventDefault();\n    e.stopPropagation(); // Prevent event bubbling\n    \n    setTouchStartX(e.targetTouches[0].clientX);\n    setTouchStartY(e.targetTouches[0].clientY);\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    if (isTrackLoading || isWaveformScrolling) return; // Disable during loading or waveform scrolling\n    if (touchStartX === null || touchStartY === null) return;\n    \n    // Check if the touch target is within a waveform container\n    const target = e.target as Element;\n    const isWaveformTouch = target.closest('.audafact-waveform-bg') !== null;\n    \n    if (isWaveformTouch) return; // Don't handle swipe gestures on waveform\n    \n    // Check if the touch target is within track controls or consolidated header\n    const isTrackControlsTouch = target.closest('.audafact-card.p-4.space-y-4') !== null;\n    const isConsolidatedHeaderTouch = target.closest('.p-4.border-b.bg-audafact-surface-2') !== null;\n    \n    if (isTrackControlsTouch || isConsolidatedHeaderTouch) return; // Don't handle swipe gestures on track controls or header\n    \n    // Only allow swipe gestures in the navigation controls area\n    const isNavigationControlsTouch = target.closest('.flex.items-center.justify-between.bg-audafact-surface-2.border-b.border-audafact-divider.py-1.px-2') !== null;\n    \n    if (!isNavigationControlsTouch) return; // Only handle swipe gestures in navigation controls\n    \n    const currentX = e.targetTouches[0].clientX;\n    const currentY = e.targetTouches[0].clientY;\n    setTouchEndX(currentX);\n    setTouchEndY(currentY);\n    \n    const deltaX = Math.abs(touchStartX - currentX);\n    const deltaY = Math.abs(touchStartY - currentY);\n    \n    // Check for vertical swipe down gesture for add track\n    const rawDeltaY = touchStartY - currentY; // Negative means finger moved down\n    const isVerticalSwipeDown = deltaY > 50 && deltaY > deltaX * 2 && rawDeltaY < 0 && deltaX < 50;\n    \n    // Prevent browser navigation gestures early if this looks like horizontal movement\n    const potentialHorizontalMovement = deltaX > 20 && deltaX > deltaY;\n    if (potentialHorizontalMovement) {\n      e.preventDefault();\n    }\n    \n    // Show add track gesture indicator if valid gesture and can add track - disabled in demo mode\n    if (isVerticalSwipeDown && canAddTrack && !isAddingTrack && !isDemoMode) {\n      setShowAddTrackGesture(true);\n      e.preventDefault(); // Prevent browser pulldown gestures\n    } else {\n      setShowAddTrackGesture(false);\n    }\n    \n    // More strict horizontal swipe detection:\n    // 1. Horizontal movement must be at least 100px\n    // 2. Horizontal movement must be at least 3x larger than vertical\n    // 3. Vertical movement must be less than 50px to avoid accidental triggers\n    const isHorizontalSwipe = deltaX > 100 && deltaX > deltaY * 3 && deltaY < 50;\n    \n    if (isHorizontalSwipe) {\n      // Horizontal swipe in progress\n    }\n  };\n\n  const handleTouchEnd = (e: React.TouchEvent) => {\n    if (isTrackLoading || isWaveformScrolling) return; // Disable during loading or waveform scrolling\n    if (touchStartX === null || touchEndX === null || touchStartY === null || touchEndY === null) return;\n    \n    // Prevent multiple touch ends\n    e.preventDefault();\n    e.stopPropagation(); // Prevent event bubbling\n    \n    // Check if the touch target is within a waveform container\n    const target = e.target as Element;\n    const isWaveformTouch = target.closest('.audafact-waveform-bg') !== null;\n    \n    if (isWaveformTouch) return; // Don't handle swipe gestures on waveform\n    \n    // Check if the touch target is within track controls or consolidated header\n    const isTrackControlsTouch = target.closest('.audafact-card.p-4.space-y-4') !== null;\n    const isConsolidatedHeaderTouch = target.closest('.p-4.border-b.bg-audafact-surface-2') !== null;\n    \n    if (isTrackControlsTouch || isConsolidatedHeaderTouch) return; // Don't handle swipe gestures on track controls or header\n    \n    // Only allow swipe gestures in the navigation controls area\n    const isNavigationControlsTouch = target.closest('.flex.items-center.justify-between.bg-audafact-surface-2.border-b.border-audafact-divider.py-1.px-2') !== null;\n    \n    if (!isNavigationControlsTouch) return; // Only handle swipe gestures in navigation controls\n    \n    // Prevent any browser navigation\n    e.preventDefault();\n    \n    const deltaX = touchStartX - touchEndX;\n    const deltaY = touchStartY - touchEndY;\n    const absDeltaX = Math.abs(deltaX);\n    const absDeltaY = Math.abs(deltaY);\n    \n    // Strict horizontal swipe validation:\n    // 1. Horizontal movement must be at least 120px (increased from 100px)\n    // 2. Horizontal movement must be at least 4x larger than vertical (increased from 3x)\n    // 3. Vertical movement must be less than 40px (decreased from 50px)\n    const isValidHorizontalSwipe = absDeltaX > 120 && absDeltaX > absDeltaY * 4 && absDeltaY < 40;\n    \n    // Strict vertical swipe validation for add track:\n    // 1. Vertical movement must be at least 100px\n    // 2. Vertical movement must be at least 3x larger than horizontal\n    // 3. Horizontal movement must be less than 50px\n    // 4. Must be a downward swipe (negative deltaY means finger moved down)\n    const isValidVerticalSwipe = absDeltaY > 100 && absDeltaY > absDeltaX * 3 && absDeltaX < 50;\n    \n    // Prevent multiple gesture processing\n    if (isGestureProcessing) {\n      // Reset touch state and ignore this gesture\n      setTouchStartX(null);\n      setTouchEndX(null);\n      setTouchStartY(null);\n      setTouchEndY(null);\n      setShowAddTrackGesture(false);\n      return;\n    }\n    \n    // Debounce gestures to prevent rapid successive triggers\n    const now = Date.now();\n    const timeSinceLastGesture = now - lastGestureTime;\n    const minGestureInterval = 800; // Increased to 800ms between gestures\n    \n    if (timeSinceLastGesture < minGestureInterval) {\n      // Reset touch state and ignore this gesture\n      setTouchStartX(null);\n      setTouchEndX(null);\n      setTouchStartY(null);\n      setTouchEndY(null);\n      setShowAddTrackGesture(false);\n      return;\n    }\n    \n    if (isValidHorizontalSwipe) {\n      const gestureType = deltaX > 0 ? 'swipe-left' : 'swipe-right';\n      const gestureKey = `${gestureType}-${now}`;\n      \n      // Prevent duplicate gestures\n      if (lastProcessedGestureRef.current === gestureKey) {\n        return;\n      }\n      \n      setLastGestureTime(now);\n      setIsGestureProcessing(true);\n      lastProcessedGestureRef.current = gestureKey;\n      \n      if (deltaX > 0) {\n        // Swiped left (finger moved left) - next track\n        handleNextTrack();\n      } else {\n        // Swiped right (finger moved right) - previous track\n        handlePreviousTrack();\n      }\n      // Reset gesture processing flag after a delay\n      setTimeout(() => {\n        setIsGestureProcessing(false);\n        lastProcessedGestureRef.current = '';\n      }, 1000);\n    } else if (isValidVerticalSwipe && deltaY < 0) {\n      // Swiped down (finger moved down) - add track - disabled in demo mode\n      if (canAddTrack && !isAddingTrack && !isDemoMode) {\n        const gestureKey = `swipe-down-${now}`;\n        \n        // Prevent duplicate gestures\n        if (lastProcessedGestureRef.current === gestureKey) {\n          return;\n        }\n        \n        setLastGestureTime(now);\n        setIsGestureProcessing(true);\n        lastProcessedGestureRef.current = gestureKey;\n        addNewTrack();\n        // Reset gesture processing flag after a delay\n        setTimeout(() => {\n          setIsGestureProcessing(false);\n          lastProcessedGestureRef.current = '';\n        }, 1000);\n      }\n    }\n    \n    // Reset touch state\n    setTouchStartX(null);\n    setTouchEndX(null);\n    setTouchStartY(null);\n    setTouchEndY(null);\n    setShowAddTrackGesture(false);\n  };\n\n  // Mouse wheel handler for track navigation and adding tracks\n  const handleWheel = (e: React.WheelEvent) => {\n    if (isTrackLoading || isWaveformScrolling) return; // Disable during loading or waveform scrolling\n    \n    // Prevent multiple gesture processing (same protection as touch handlers)\n    if (isGestureProcessing) {\n      e.preventDefault();\n      return;\n    }\n    \n    // Debounce wheel gestures to prevent rapid successive triggers\n    const now = Date.now();\n    const timeSinceLastGesture = now - lastGestureTime;\n    const minGestureInterval = 800; // Same as touch handlers\n    \n    if (timeSinceLastGesture < minGestureInterval) {\n      e.preventDefault();\n      return;\n    }\n    \n    // Check if the wheel event target is within a waveform container\n    const target = e.target as Element;\n    const isWaveformWheel = target.closest('.audafact-waveform-bg') !== null;\n    \n    if (isWaveformWheel) return; // Don't handle wheel gestures on waveform\n    \n    // Check if the wheel event target is within track controls or consolidated header\n    const isTrackControlsWheel = target.closest('.p-4.relative.z-10.bg-audafact-surface-1') !== null;\n    const isConsolidatedHeaderWheel = target.closest('.p-4.border-b.bg-audafact-surface-2') !== null;\n    \n    if (isTrackControlsWheel || isConsolidatedHeaderWheel) return; // Don't handle wheel gestures on track controls or header\n    \n    // Only allow wheel gestures in the navigation controls area\n    const isNavigationControlsWheel = target.closest('.flex.items-center.justify-between.bg-audafact-surface-2.border-b.border-audafact-divider') !== null;\n    \n    if (!isNavigationControlsWheel) return; // Only handle wheel gestures in navigation controls\n    \n    const absDeltaX = Math.abs(e.deltaX);\n    const absDeltaY = Math.abs(e.deltaY);\n    \n\n    \n    // Handle horizontal trackpad gestures for track navigation\n    const isHorizontalGesture = absDeltaX > absDeltaY && absDeltaX > 10;\n    \n    // Handle vertical trackpad gestures for adding tracks\n    // Relaxed thresholds: lower minimum movement, allow more horizontal drift\n    const isVerticalGesture = absDeltaY > absDeltaX && absDeltaY > 10 && absDeltaX < 25;\n    \n          if (isHorizontalGesture) {\n        // Prevent default only for horizontal gestures\n        e.preventDefault();\n        \n        setLastGestureTime(now);\n        setIsGestureProcessing(true);\n        \n        if (e.deltaX > 0) {\n        // Scrolling right - next track\n        handleNextTrack();\n      } else if (e.deltaX < 0) {\n        // Scrolling left - previous track\n        handlePreviousTrack();\n      }\n      \n      // Reset gesture processing flag after a delay\n      setTimeout(() => setIsGestureProcessing(false), 1000);\n    } else if (isVerticalGesture && e.deltaY < 0 && canAddTrack && !isAddingTrack && !isDemoMode) {\n      // Scrolling down - add track (negative deltaY = down) - disabled in demo mode\n      e.preventDefault();\n      setLastGestureTime(now);\n      setIsGestureProcessing(true);\n      addNewTrack();\n      // Reset gesture processing flag after a delay\n      setTimeout(() => setIsGestureProcessing(false), 1000);\n    }\n    // For other gestures, allow normal scrolling to pass through\n  };\n\n  // Track navigation functions\n  const handleNextTrack = useCallback(async () => {\n    if (isTrackLoading || isDemoLoading) return; // Disable during loading\n    if (tracks.length === 0) return;\n    \n    if (isDemoMode) {\n      // In demo mode, load next demo track\n      loadRandomDemoTrack();\n    } else {\n      // Normal mode - cycle through available assets\n      const assets = (availableAssets && availableAssets.length > 0) ? availableAssets : defaultAudioAssets;\n      const nextIndex = (currentTrackIndex + 1) % assets.length;\n      await loadTrackByIndex(nextIndex, true); // true = only update first track\n    }\n  }, [tracks.length, currentTrackIndex, isTrackLoading, isDemoLoading, isDemoMode, loadRandomDemoTrack, availableAssets]);\n\n  const handlePreviousTrack = useCallback(async () => {\n    if (isTrackLoading || isDemoLoading) return; // Disable during loading\n    if (tracks.length === 0) return;\n    \n    if (isDemoMode) {\n      // In demo mode, load next demo track (since we don't have previous demo track concept)\n      loadRandomDemoTrack();\n    } else {\n      // Normal mode - cycle through available assets\n      const assets = (availableAssets && availableAssets.length > 0) ? availableAssets : defaultAudioAssets;\n      const prevIndex = currentTrackIndex === 0 ? assets.length - 1 : currentTrackIndex - 1;\n      await loadTrackByIndex(prevIndex, true); // true = only update first track\n    }\n  }, [tracks.length, currentTrackIndex, isTrackLoading, isDemoLoading, isDemoMode, loadRandomDemoTrack, availableAssets]);\n\n  const loadTrackByIndex = async (index: number, onlyUpdateFirstTrack: boolean = false) => {\n    try {\n      setIsTrackLoading(true);\n\n      setError(null);\n      \n      const assets = (availableAssets && availableAssets.length > 0) ? availableAssets : defaultAudioAssets;\n      const safeIndex = ((index % assets.length) + assets.length) % assets.length;\n      const asset = assets[safeIndex];\n      \n      // Use existing audio context if available\n      let context = audioContext;\n\n      if (!context) {\n        try {\n          context = await initializeAudio();\n          setIsAudioInitialized(true);\n        } catch (initError) {\n          console.error('Error initializing audio context:', initError);\n          throw new Error('Unable to initialize audio. Please try again or check your browser settings.');\n        }\n      } else if (context.state === 'suspended') {\n        try {\n          await context.resume();\n        } catch (resumeError) {\n          console.error('Failed to resume audio context:', resumeError);\n          throw new Error('Browser blocked audio playback. Please try again.');\n        }\n      }\n\n      if (!context) {\n        throw new Error('Audio initialization failed. Please try again.');\n      }\n      \n      // Fetch the audio file from the asset\n      const response = await fetch(asset.file);\n      const blob = await response.blob();\n      const file = new File([blob], `${asset.name}.${asset.type}`, { type: `audio/${asset.type}` });\n      \n      // Load the audio file into buffer\n      const buffer = await loadAudioBuffer(file, context);\n      \n      // Generate track ID - preserve existing first track ID if only updating first track\n      let trackId;\n      if (onlyUpdateFirstTrack && tracks.length > 0) {\n        trackId = tracks[0].id; // Keep the existing first track's ID\n      } else {\n        trackId = asset.id; // Use asset ID for new tracks\n      }\n      \n      // Try to load settings from localStorage\n      const settings = loadTrackSettingsFromLocal(trackId) || {};\n      \n      const newTrack: Track = {\n        id: trackId,\n        file,\n        buffer,\n        mode: settings.mode || 'preview', // Default to preview mode\n        loopStart: settings.loopStart || 0,\n        loopEnd: settings.loopEnd || buffer.duration,\n        cuePoints: settings.cuePoints || Array.from({ length: 10 }, (_, i) => \n          buffer.duration * (i / 10)\n        ),\n        tempo: settings.tempo || 120,\n        timeSignature: settings.timeSignature || { numerator: 4, denominator: 4 },\n        firstMeasureTime: settings.firstMeasureTime || 0,\n        showMeasures: settings.showMeasures || false\n      };\n      \n      if (onlyUpdateFirstTrack && tracks.length > 0) {\n        // Only update the first track, preserve other tracks\n        setTracks(prevTracks => {\n          const updatedTracks = [...prevTracks];\n          // Update the first track in place to preserve React's reference\n          updatedTracks[0] = {\n            ...updatedTracks[0], // Keep existing properties\n            ...newTrack, // Override with new track data\n            id: updatedTracks[0].id // Ensure we keep the original ID\n          };\n          return updatedTracks;\n        });\n      } else {\n        // Replace all tracks (original behavior)\n        setTracks([newTrack]);\n      }\n      setCurrentTrackIndex(safeIndex);\n      setShowMeasures(prev => ({ ...prev, [trackId]: !!settings.showMeasures }));\n      setShowCueThumbs(prev => ({ ...prev, [trackId]: !!settings.showCueThumbs }));\n      setZoomLevels(prev => ({ ...prev, [trackId]: settings.zoomLevel || 1 }));\n      // Reset playback speed but keep volume\n      setPlaybackSpeeds(prev => ({ ...prev, [trackId]: 1 }));\n      // Set volume based on mode\n      const trackVolume = newTrack.mode === 'preview' \n        ? lastUsedVolumeRef.current \n        : (typeof settings.volume === 'number' ? settings.volume : lastUsedVolumeRef.current);\n      setVolume(prev => ({ ...prev, [trackId]: trackVolume }));\n      setExpandedControls(prev => ({ ...prev, [trackId]: false }));\n      \n      // Start onboarding when loading track via \"Load Random Track\" button for all users\n      if (onboarding.shouldShowOnboarding()) {\n        // Small delay to ensure UI is fully rendered\n        setTimeout(() => {\n          onboarding.startOnboarding();\n        }, 1000);\n      }\n      \n      // Track loading is complete\n      setIsTrackLoading(false);\n      \n      // Waveform loading will be handled by the WaveformDisplay component\n      \n    \n    } catch (error) {\n      console.error('Error loading track by index:', error);\n      const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred';\n      setError(`Error loading track: ${errorMessage}`);\n              setIsTrackLoading(false);\n    }\n  };\n\n  // Add new track function\n  const addNewTrack = async () => {\n    if (!canAddTrack || isAddingTrack) return;\n    \n    try {\n      setIsAddingTrack(true);\n      setAddTrackAnimation(true);\n      setError(null);\n      \n      // Select a random asset that's different from existing tracks\n      const assets = (availableAssets && availableAssets.length > 0) ? availableAssets : defaultAudioAssets;\n      const existingAssetIds = tracks.map(track => track.id);\n      const unusedAssets = assets.filter(asset => !existingAssetIds.includes(asset.id));\n      \n      // If all assets are used, allow duplicates but with different IDs\n      let selectedAsset;\n      if (unusedAssets.length > 0) {\n        selectedAsset = unusedAssets[Math.floor(Math.random() * unusedAssets.length)];\n      } else {\n        selectedAsset = assets[Math.floor(Math.random() * assets.length)];\n      }\n      \n      // Use existing audio context\n      let context = audioContext;\n      if (!context) {\n        context = await initializeAudio();\n        setIsAudioInitialized(true);\n      } else if (context.state === 'suspended') {\n        await context.resume();\n      }\n\n      if (!context) {\n        throw new Error('Audio initialization failed. Please try again.');\n      }\n      \n      // Fetch the audio file from the asset\n      const response = await fetch(selectedAsset.file);\n      const blob = await response.blob();\n      const file = new File([blob], `${selectedAsset.name}.${selectedAsset.type}`, { type: `audio/${selectedAsset.type}` });\n      \n      // Load the audio file into buffer\n      const buffer = await loadAudioBuffer(file, context);\n      \n      // Generate unique track ID\n      const timestamp = Date.now();\n      const trackId = `${selectedAsset.id}-${timestamp}`;\n      \n      const newTrack: Track = {\n        id: trackId,\n        file,\n        buffer,\n        mode: 'preview', // New tracks always start as preview\n        loopStart: 0,\n        loopEnd: buffer.duration,\n        cuePoints: Array.from({ length: 10 }, (_, i) => \n          buffer.duration * (i / 10)\n        ),\n        tempo: 120,\n        timeSignature: { numerator: 4, denominator: 4 },\n        firstMeasureTime: 0,\n        showMeasures: false\n      };\n      \n      // Update existing tracks: force non-preview modes for tracks that will be pushed down\n      const updatedExistingTracks = tracks.map(track => {\n        if (track.mode === 'preview') {\n          // Change preview tracks to loop mode when pushed down\n          return { ...track, mode: 'loop' as const };\n        }\n        return track;\n      });\n      \n      // Add new track to the beginning of the array (top of stack)\n      setTracks([newTrack, ...updatedExistingTracks]);\n      \n      // Initialize states for the new track\n      setShowMeasures(prev => ({ ...prev, [trackId]: false }));\n      setShowCueThumbs(prev => ({ ...prev, [trackId]: false }));\n      setZoomLevels(prev => ({ ...prev, [trackId]: 1 }));\n      setPlaybackSpeeds(prev => ({ ...prev, [trackId]: 1 }));\n      setVolume(prev => ({ ...prev, [trackId]: lastUsedVolumeRef.current }));\n      setExpandedControls(prev => ({ ...prev, [trackId]: false }));\n      \n      // Animation delay\n      setTimeout(() => {\n        setAddTrackAnimation(false);\n        setIsAddingTrack(false);\n      }, 500);\n      \n    } catch (error) {\n      console.error('Error adding new track:', error);\n      const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred';\n      setError(`Error adding track: ${errorMessage}`);\n      setIsAddingTrack(false);\n      setAddTrackAnimation(false);\n    }\n  };\n\n  // Remove track function\n  const removeTrack = (trackId: string) => {\n    if (tracks.length <= 1) return; // Don't allow removing the last track\n    \n    // Find the track to be removed\n    const trackToRemove = tracks.find(track => track.id === trackId);\n    if (!trackToRemove) return; // Track not found\n    \n    // Don't allow removing tracks in preview mode\n    if (trackToRemove.mode === 'preview') {\n      console.warn('Cannot remove track in preview mode');\n      return;\n    }\n    \n    setTracks(prev => {\n      const filtered = prev.filter(track => track.id !== trackId);\n      \n      // If we removed the top track and there are remaining tracks,\n      // make sure the new top track can be preview mode\n      if (filtered.length > 0 && prev[0]?.id === trackId) {\n        // The track that was second is now first, allow it to be preview if desired\n        // (User can change mode manually)\n      }\n      \n      return filtered;\n    });\n    \n    // Clean up track-specific states\n    setShowMeasures(prev => {\n      const { [trackId]: removed, ...rest } = prev;\n      return rest;\n    });\n    setShowCueThumbs(prev => {\n      const { [trackId]: removed, ...rest } = prev;\n      return rest;\n    });\n    setZoomLevels(prev => {\n      const { [trackId]: removed, ...rest } = prev;\n      return rest;\n    });\n    setPlaybackSpeeds(prev => {\n      const { [trackId]: removed, ...rest } = prev;\n      return rest;\n    });\n    setVolume(prev => {\n      const { [trackId]: removed, ...rest } = prev;\n      return rest;\n    });\n    setExpandedControls(prev => {\n      const { [trackId]: removed, ...rest } = prev;\n      return rest;\n    });\n    \n    // Clean up selected cue track if it was removed\n    if (selectedCueTrackId === trackId) {\n      setSelectedCueTrackId(null);\n    }\n    \n    // Clean up localStorage\n    removeTrackSettingsFromLocal(trackId);\n    removeCuePointsFromLocal(trackId);\n  };\n\n  // Persist all track settings to localStorage when they change\n  useEffect(() => {\n    tracks.forEach(track => {\n      if (!track) return;\n      const settings: any = {\n        mode: track.mode,\n        loopStart: track.loopStart,\n        loopEnd: track.loopEnd,\n        tempo: track.tempo,\n        timeSignature: track.timeSignature,\n        firstMeasureTime: track.firstMeasureTime,\n        showMeasures: showMeasures[track.id] || false,\n        showCueThumbs: showCueThumbs[track.id] || false,\n        zoomLevel: zoomLevels[track.id] || 1,\n        playbackSpeed: playbackSpeeds[track.id] || 1   };\n      \n      // Only save volume for loop and cue tracks\n      if (track.mode !== 'preview') {\n        settings.volume = volume[track.id] || 1    }\n      \n      saveTrackSettingsToLocal(track.id, settings);\n    });\n  }, [tracks, showMeasures, showCueThumbs, zoomLevels, playbackSpeeds, volume]);\n\n  // Persist selected cue track id\n  useEffect(() => {\n    saveSelectedCueTrackIdToLocal(selectedCueTrackId);\n  }, [selectedCueTrackId]);\n\n  const loadAudioBuffer = async (file: File, context: AudioContext): Promise<AudioBuffer> => {\n    if (!context) throw new Error('Audio context not initialized');\n    \n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      \n      reader.onload = async (e) => {\n        try {\n          if (!e.target) {\n            reject(new Error('Failed to read file. Please try again.'));\n            return;\n          }\n          \n          const arrayBuffer = e.target.result as ArrayBuffer;\n          if (!arrayBuffer) {\n            reject(new Error('Failed to read file. Please try again.'));\n            return;\n          }\n          \n          try {\n            const decodedBuffer = await context.decodeAudioData(arrayBuffer);\n            resolve(decodedBuffer);\n          } catch (decodeError) {\n            console.error('Failed to decode audio data:', decodeError);\n            reject(new Error('Unable to decode audio file. The file might be corrupted or in an unsupported format. Please try a different file.'));\n          }\n        } catch (error) {\n          reject(error);\n        }\n      };\n      \n      reader.onerror = (error) => {\n        console.error('FileReader error:', error);\n        reject(new Error('Error reading file. Please try again.'));\n      };\n      \n      reader.readAsArrayBuffer(file);\n    });\n  };\n\n  const handleLoopPointsChange = (trackId: string, start: number, end: number) => {\n    if (!tracks) return;\n    \n    setTracks(prev => \n      prev.map(track => \n        track && track.id === trackId \n          ? { ...track, loopStart: start, loopEnd: end } \n          : track\n      )\n    );\n  };\n  \n  const handleCuePointChange = (trackId: string, index: number, time: number) => {\n    if (!tracks) return;\n    \n    setTracks(prev => \n      prev.map(track => {\n        if (!track || track.id !== trackId) return track;\n        const duration = track.buffer?.duration || 0;\n        // Clamp cue point to just before the end\n        const epsilon = 0.01;\n        const clampedTime = Math.max(0, Math.min(time, duration - epsilon));\n        const newCuePoints = [...track.cuePoints];\n        newCuePoints[index] = clampedTime;\n        // Save to localStorage\n        saveCuePointsToLocal(trackId, newCuePoints);\n        // Save settings\n        const settings = loadTrackSettingsFromLocal(trackId) || {};\n        saveTrackSettingsToLocal(trackId, { ...settings, cuePoints: newCuePoints });\n        return { ...track, cuePoints: newCuePoints };\n      })\n    );\n  };\n  \n  const handleModeChange = (trackId: string, mode: 'preview' | 'loop' | 'cue') => {\n    if (!tracks) return;\n    \n    // Enforce rule: only the top track (first in array) can be in preview mode\n    if (mode === 'preview') {\n      const trackIndex = tracks.findIndex(track => track.id === trackId);\n      if (trackIndex !== 0) {\n        // Non-top tracks cannot be preview mode\n        console.warn('Only the top track can be in preview mode');\n        return;\n      }\n    }\n    \n    setTracks(prev => \n      prev.map(track => {\n        if (!track || track.id !== trackId) return track;\n        // When switching to cue mode, auto-generate default cue points if none exist\n        if (mode === 'cue' && (!track.cuePoints || track.cuePoints.length === 0)) {\n          const duration = track.buffer?.duration || 0;\n          const autoCues = Array.from({ length: 10 }, (_, i) => duration * (i / 10));\n          // persist cue points\n          const settings = loadTrackSettingsFromLocal(trackId) || {};\n          saveTrackSettingsToLocal(trackId, { ...settings, cuePoints: autoCues });\n          saveCuePointsToLocal(trackId, autoCues);\n          return { ...track, mode, cuePoints: autoCues };\n        }\n        return { ...track, mode };\n      })\n    );\n    \n    // Handle state transitions when switching modes\n    if (mode === 'loop') {\n      // If switching to loop mode, clear cue track selection and hide cue thumbs\n      if (selectedCueTrackId === trackId) {\n        setSelectedCueTrackId(null);\n      }\n      setShowCueThumbs(prev => ({ ...prev, [trackId]: false }));\n    } else if (mode === 'cue') {\n      // If switching to cue mode, show cue thumbs by default\n      setShowCueThumbs(prev => ({ ...prev, [trackId]: true }));\n      \n      // Always auto-select this track when switching to Chop mode\n      setSelectedCueTrackId(trackId);\n    } else if (mode === 'preview') {\n      // If switching to preview mode, clear cue track selection and hide cue thumbs\n      if (selectedCueTrackId === trackId) {\n        setSelectedCueTrackId(null);\n      }\n      setShowCueThumbs(prev => ({ ...prev, [trackId]: false }));\n    }\n  };\n\n  // Add a function to handle play requests and ensure audio context is running\n  const ensureAudioBeforeAction = async (callback: () => void) => {\n    try {\n      if (!isAudioInitialized) {\n        await initializeAudio();\n        setIsAudioInitialized(true);\n      } else if (audioContext?.state === 'suspended') {\n        await resumeAudioContext();\n      }\n      callback();\n    } catch (error) {\n      console.error('Failed to initialize audio context:', error);\n      setError('Failed to initialize audio context. Please try again.');\n    }\n  };\n\n  // Add this function to handle track selection\n  const handleTrackSelect = (trackId: string) => {\n    setSelectedCueTrackId(prevId => prevId === trackId ? null : trackId);\n  };\n\n  // Add handler for playback time updates\n  const handlePlaybackTimeChange = (trackId: string, time: number) => {\n    setPlaybackTimes(prev => ({\n      ...prev,\n      [trackId]: time\n    }));\n  };\n\n  // Handle waveform scroll state changes\n  const handleWaveformScrollStateChange = (trackId: string, isScrolling: boolean) => {\n    // Only track scroll state for the first track (where swipe gestures are active)\n    if (tracks.length > 0 && trackId === tracks[0]?.id) {\n      setIsWaveformScrolling(isScrolling);\n    }\n  };\n\n  // Zoom functions\n  const handleZoomIn = (trackId: string) => {\n    setZoomLevels(prev => {\n      const currentZoom = prev[trackId] || 1;\n      const newZoom = Math.min(currentZoom * 2, 8);\n      return { ...prev, [trackId]: newZoom };\n    });\n  };\n\n  const handleZoomOut = (trackId: string) => {\n    setZoomLevels(prev => {\n      const currentZoom = prev[trackId] || 1;\n      const newZoom = Math.max(currentZoom / 2, 1);\n      return { ...prev, [trackId]: newZoom };\n    });\n  };\n\n  const handleResetZoom = (trackId: string) => {\n    setZoomLevels(prev => ({ ...prev, [trackId]: 1 }));\n  };\n\n  // Handle tempo changes\n  const handleTempoChange = (trackId: string, tempo: number) => {\n    setTracks(prev => \n      prev.map(track => \n        track.id === trackId ? { ...track, tempo } : track\n      )\n    );\n  };\n\n  // Handle playback speed changes\n  const handleSpeedChange = (trackId: string, speed: number) => {\n    setPlaybackSpeeds(prev => ({\n      ...prev,\n      [trackId]: speed\n    }));\n  };\n\n  // Handle playback state changes\n  const handlePlaybackStateChange = (trackId: string, isPlaying: boolean) => {\n    setPlaybackStates(prev => ({\n      ...prev,\n      [trackId]: isPlaying\n    }));\n  };\n\n  // Handle manual playhead position changes from waveform\n  const handlePlayheadChange = (trackId: string, time: number) => {\n    const track = tracks.find(t => t.id === trackId);\n    const isTrackPlaying = playbackStates[trackId] || false;\n    \n\n    \n    if (isTrackPlaying) {\n      // If track is playing, use the direct seek function\n      const seekFunctionRef = seekFunctionRefs.current[trackId];\n      if (seekFunctionRef?.current) {\n        seekFunctionRef.current(time);\n      }\n    } else {\n      // If track is not playing, update playback time normally\n      setPlaybackTimes(prev => ({\n        ...prev,\n        [trackId]: time\n      }));\n      \n      // Also update the appropriate playhead state\n      if (track?.mode === 'loop') {\n        setLoopPlayhead(time);\n      } else {\n        setSamplePlayhead(time);\n      }\n    }\n  };\n\n  // Drag and drop handlers for SidePanel tracks and file drops\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    // Check if we're dragging over the SidePanel area (only when SidePanel is open)\n    const target = e.target as Element;\n    const isInSidePanel = isSidePanelOpen && target.closest('[data-sidepanel]') !== null;\n    \n    if (isInSidePanel) {\n      // Don't show drag indicator when over SidePanel\n      setIsDragOver(false);\n      setDragData(null);\n      return;\n    }\n    \n    // Check if this is a track drag from SidePanel or file drop from computer\n    const hasSidePanelData = e.dataTransfer.types.includes('text/plain');\n    const hasFiles = e.dataTransfer.types.includes('Files');\n\n    if (hasSidePanelData || hasFiles) {\n      e.dataTransfer.dropEffect = 'copy';\n      setIsDragOver(true);\n      \n      // Set drag data for file drops immediately\n      if (hasFiles && !dragData) {\n        setDragData({\n          type: 'file',\n          name: 'Audio file',\n          id: `file-${Date.now()}`\n        });\n      }\n    }\n  };\n\n  const handleDragEnter = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    // Check if we're dragging over the SidePanel area (only when SidePanel is open)\n    const target = e.target as Element;\n    const isInSidePanel = isSidePanelOpen && target.closest('[data-sidepanel]') !== null;\n    \n    if (isInSidePanel) {\n      // Don't show drag indicator when over SidePanel\n      setIsDragOver(false);\n      setDragData(null);\n      return;\n    }\n    \n    // Check if this is a track drag from SidePanel or file drop from computer\n    const hasSidePanelData = e.dataTransfer.types.includes('text/plain') && e.dataTransfer.types.includes('application/json');\n    const hasFiles = e.dataTransfer.types.includes('Files');\n    \n    if (hasSidePanelData || hasFiles) {\n      setIsDragOver(true);\n      \n      // Try to get the drag data for better visual feedback (SidePanel tracks)\n      if (hasSidePanelData) {\n        try {\n          const jsonData = e.dataTransfer.getData('application/json');\n          if (jsonData) {\n            const parsed = JSON.parse(jsonData);\n            setDragData(parsed);\n          }\n        } catch (error) {\n          // Ignore errors, we'll still show the basic drag indicator\n        }\n      }\n      \n      // Set drag data for file drops\n      if (hasFiles) {\n        setDragData({\n          type: 'file',\n          name: 'Audio file',\n          id: `file-${Date.now()}`\n        });\n      }\n    }\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    // Only clear drag state if we're leaving the drop zone entirely\n    if (!e.currentTarget.contains(e.relatedTarget as Node)) {\n      setIsDragOver(false);\n      setDragTarget(null);\n      setDragData(null);\n    }\n  };\n\n  const handleDrop = async (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    // Check if the drop occurred within the SidePanel area (only when SidePanel is open)\n    const target = e.target as Element;\n    const isInSidePanel = isSidePanelOpen && target.closest('[data-sidepanel]') !== null;\n    \n    if (isInSidePanel) {\n      // Ignore drops in the SidePanel area\n      setIsDragOver(false);\n      setDragTarget(null);\n      setDragData(null);\n      return;\n    }\n    \n    setIsDragOver(false);\n    setDragTarget(null);\n    setDragData(null);\n    \n    try {\n      // Check if this is a file drop from computer\n      if (e.dataTransfer.files.length > 0) {\n        const file = e.dataTransfer.files[0];\n        \n        // Validate file type\n        const validAudioTypes = ['audio/wav', 'audio/mp3', 'audio/mpeg', 'audio/aac', 'audio/ogg', 'audio/flac'];\n        const isValidAudioFile = validAudioTypes.includes(file.type) || \n          file.name.toLowerCase().endsWith('.wav') || \n          file.name.toLowerCase().endsWith('.mp3') || \n          file.name.toLowerCase().endsWith('.m4a') || \n          file.name.toLowerCase().endsWith('.aac') || \n          file.name.toLowerCase().endsWith('.ogg') || \n          file.name.toLowerCase().endsWith('.flac');\n        \n        if (!isValidAudioFile) {\n          setError('Please drop a valid audio file (WAV, MP3, M4A, AAC, OGG, or FLAC)');\n          return;\n        }\n        \n        // Add the dropped file as a track\n        await handleUploadTrack(file, 'preview');\n        return;\n      }\n      \n      // Handle SidePanel track drops\n      const trackId = e.dataTransfer.getData('text/plain');\n      if (!trackId) return;\n      \n      // Find the asset in the available assets list\n      const assets = (availableAssets && availableAssets.length > 0) ? availableAssets : defaultAudioAssets;\n      const asset = assets.find(a => a.id === trackId);\n      if (asset) {\n        // Add from library\n        await handleAddFromLibrary(asset, 'preview');\n        return;\n      }\n      \n      // If not found in library, it might be a user track\n      // User tracks are now managed through Supabase and the SidePanel\n      console.log('Track not found in library. User should re-add from SidePanel.');\n      \n      console.warn('Track not found for drop:', trackId);\n    } catch (error) {\n      console.error('Error handling drop:', error);\n      setError('Failed to add dropped track. Please try again.');\n    }\n  };\n\n  // Handle time signature changes\n  const handleTimeSignatureChange = (trackId: string, timeSignature: TimeSignature) => {\n    setTracks(prev => \n      prev.map(track => \n        track.id === trackId ? { ...track, timeSignature } : track\n      )\n    );\n  };\n\n  // Handle first measure time changes\n  const handleFirstMeasureChange = (trackId: string, time: number) => {\n    setTracks(prev => \n      prev.map(track => \n        track.id === trackId ? { ...track, firstMeasureTime: time } : track\n      )\n    );\n  };\n\n  // Handle measure display toggle\n  const handleToggleMeasures = (trackId: string) => {\n    setShowMeasures(prev => ({\n      ...prev,\n      [trackId]: !prev[trackId]\n    }));\n  };\n\n  // Add handler for toggling cue thumbs\n  const handleToggleCueThumbs = (trackId: string) => {\n    setShowCueThumbs(prev => ({\n      ...prev,\n      [trackId]: !prev[trackId]\n    }));\n  };\n\n  // Handle volume changes\n  const handleVolumeChange = (trackId: string, newVolume: number) => {\n    setVolume(prev => ({ ...prev, [trackId]: newVolume }));\n    setLastUsedVolume(newVolume);\n  };\n\n  // Handle filter changes\n  const handleLowpassFreqChange = (trackId: string, freq: number) => {\n    setLowpassFreqs(prev => ({ ...prev, [trackId]: freq }));\n  };\n\n  const handleHighpassFreqChange = (trackId: string, freq: number) => {\n    setHighpassFreqs(prev => ({ ...prev, [trackId]: freq }));\n  };\n\n  const handleFilterEnabledChange = (trackId: string, enabled: boolean) => {\n    setFilterEnabled(prev => ({ ...prev, [trackId]: enabled }));\n  };\n\n  // Handle save current studio state\n  const handleSaveCurrentState = async () => {\n    // Check session save limits\n    const canSaveSession = await canPerformAction('save_session');\n    if (!canSaveSession) {\n      setShowUpgradePrompt({\n        show: true,\n        message: getUpgradeMessage('save_session'),\n        feature: 'Session Save'\n      });\n      return;\n    }\n\n    const studioState = {\n      tracks: tracks.map(track => ({\n        id: track.id,\n        name: track.file.name,\n        mode: track.mode,\n        loopStart: track.loopStart,\n        loopEnd: track.loopEnd,\n        cuePoints: track.cuePoints,\n        tempo: track.tempo,\n        timeSignature: track.timeSignature,\n        firstMeasureTime: track.firstMeasureTime,\n        showMeasures: showMeasures[track.id] || false,\n        showCueThumbs: showCueThumbs[track.id] || false,\n        zoomLevel: zoomLevels[track.id] || 1,\n        playbackSpeed: playbackSpeeds[track.id] || 1,\n        volume: volume[track.id] || 1,\n        lowpassFreq: lowpassFreqs[track.id] || 20000,\n        highpassFreq: highpassFreqs[track.id] || 20,\n        filterEnabled: filterEnabled[track.id] || false\n      })),\n      selectedCueTrackId,\n      timestamp: Date.now()\n    };\n    \n    await saveCurrentState(studioState);\n  };\n\n  // Add handler for toggling accordion controls\n  const handleToggleControls = (trackId: string) => {\n    setExpandedControls(prev => ({\n      ...prev,\n      [trackId]: !prev[trackId]\n    }));\n  };\n\n  // SidePanel handlers\n  const handleUploadTrack = async (file: File, trackType: 'preview' | 'loop' | 'cue' = 'preview') => {\n    try {\n      setIsManuallyAddingTrack(true);\n      setIsLoading(true);\n      setError(null);\n      \n      // Use existing audio context if available\n      let context = audioContext;\n      if (!context) {\n        context = await initializeAudio();\n        setIsAudioInitialized(true);\n      } else if (context.state === 'suspended') {\n        await resumeAudioContext();\n      }\n\n      // Load the audio buffer\n      const buffer = await loadAudioBuffer(file, context);\n      \n      // Create a new track\n      const newTrack: Track = {\n        id: `track-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        file: file,\n        buffer: buffer,\n        mode: trackType,\n        loopStart: 0,\n        loopEnd: buffer.duration,\n        cuePoints: [],\n        tempo: 120,\n        timeSignature: { numerator: 4, denominator: 4 },\n        firstMeasureTime: 0,\n        showMeasures: false\n      };\n\n      // Add the track to the beginning of the tracks array\n      setTracks(prev => {\n        const updatedTracks = [newTrack, ...prev];\n        \n        // If the new track is in preview mode and there's an existing preview track, change it to cue mode\n        if (trackType === 'preview' && prev.length > 0 && prev[0].mode === 'preview') {\n          updatedTracks[1] = { ...prev[0], mode: 'cue' };\n        }\n        \n        return updatedTracks;\n      });\n      \n      // Initialize default values for the new track\n      setPlaybackTimes(prev => ({ ...prev, [newTrack.id]: 0 }));\n      setZoomLevels(prev => ({ ...prev, [newTrack.id]: 1 }));\n      setPlaybackSpeeds(prev => ({ ...prev, [newTrack.id]: 1 }));\n      setVolume(prev => ({ ...prev, [newTrack.id]: lastUsedVolumeRef.current }));\n      setShowMeasures(prev => ({ ...prev, [newTrack.id]: false }));\n      setShowCueThumbs(prev => ({ ...prev, [newTrack.id]: false }));\n      setPlaybackStates(prev => ({ ...prev, [newTrack.id]: false }));\n      setExpandedControls(prev => ({ ...prev, [newTrack.id]: false }));\n      \n      // Initialize filter state\n      setLowpassFreqs(prev => ({ ...prev, [newTrack.id]: 20000 }));\n      setHighpassFreqs(prev => ({ ...prev, [newTrack.id]: 20 }));\n      setFilterEnabled(prev => ({ ...prev, [newTrack.id]: false }));\n      \n      // Set a small delay to simulate waveform loading\n      setTimeout(() => {\n        // setIsWaveformLoading(false); // This line was removed\n      }, 500);\n      \n    } catch (error) {\n      console.error('Error uploading track:', error);\n      setError(error instanceof Error ? error.message : 'Failed to upload track');\n    } finally {\n      setIsLoading(false);\n      setIsManuallyAddingTrack(false);\n      // setIsWaveformLoading(false); // This line was removed\n    }\n  };\n\n  const handleAddFromLibrary = async (asset: AudioAsset, trackType: 'preview' | 'loop' | 'cue' = 'preview') => {\n    try {\n      setIsManuallyAddingTrack(true);\n      setIsLoading(true);\n      setError(null);\n      \n      // No longer need to track individual user library usage\n      \n      // Use existing audio context if available\n      let context = audioContext;\n      if (!context) {\n        context = await initializeAudio();\n        setIsAudioInitialized(true);\n      } else if (context.state === 'suspended') {\n        await resumeAudioContext();\n      }\n\n      // Fetch the audio file\n      const response = await fetch(asset.file);\n      const blob = await response.blob();\n      const buffer = await context.decodeAudioData(await blob.arrayBuffer());\n      \n      // Create a File object from the blob\n      const file = new File([blob], `${asset.name}.${asset.type}`, { type: `audio/${asset.type}` });\n      \n      // Create a new track\n      const newTrack: Track = {\n        id: `track-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        file: file,\n        buffer: buffer,\n        mode: trackType,\n        loopStart: 0,\n        loopEnd: buffer.duration,\n        cuePoints: [],\n        tempo: 120,\n        timeSignature: { numerator: 4, denominator: 4 },\n        firstMeasureTime: 0,\n        showMeasures: false\n      };\n\n      // Add the track to the beginning of the tracks array\n      setTracks(prev => {\n        const updatedTracks = [newTrack, ...prev];\n        \n        // If the new track is in preview mode and there's an existing preview track, change it to cue mode\n        if (trackType === 'preview' && prev.length > 0 && prev[0].mode === 'preview') {\n          updatedTracks[1] = { ...prev[0], mode: 'cue' };\n        }\n        \n        return updatedTracks;\n      });\n      \n      // Initialize default values for the new track\n      setPlaybackTimes(prev => ({ ...prev, [newTrack.id]: 0 }));\n      setZoomLevels(prev => ({ ...prev, [newTrack.id]: 1 }));\n      setPlaybackSpeeds(prev => ({ ...prev, [newTrack.id]: 1 }));\n      setVolume(prev => ({ ...prev, [newTrack.id]: lastUsedVolumeRef.current }));\n      setShowMeasures(prev => ({ ...prev, [newTrack.id]: false }));\n      setShowCueThumbs(prev => ({ ...prev, [newTrack.id]: false }));\n      setPlaybackStates(prev => ({ ...prev, [newTrack.id]: false }));\n      setExpandedControls(prev => ({ ...prev, [newTrack.id]: false }));\n      \n      // Initialize filter state\n      setLowpassFreqs(prev => ({ ...prev, [newTrack.id]: 20000 }));\n      setHighpassFreqs(prev => ({ ...prev, [newTrack.id]: 20 }));\n      setFilterEnabled(prev => ({ ...prev, [newTrack.id]: false }));\n      \n      // Set a small delay to simulate waveform loading\n      setTimeout(() => {\n        // setIsWaveformLoading(false); // This line was removed\n      }, 500);\n      \n    } catch (error) {\n      console.error('Error adding from library:', error);\n      setError(error instanceof Error ? error.message : 'Failed to add track from library');\n    } finally {\n      setIsLoading(false);\n      setIsManuallyAddingTrack(false);\n      // setIsWaveformLoading(false); // This line was removed\n    }\n  };\n\n  const handleAddUserTrack = async (userTrack: UserTrack, trackType: 'preview' | 'loop' | 'cue' = 'preview') => {\n    if (!userTrack.file) {\n      setError('File not available for this track');\n      return;\n    }\n\n    try {\n      setIsManuallyAddingTrack(true);\n      setIsLoading(true);\n      setError(null);\n      \n      // Use existing audio context if available\n      let context = audioContext;\n      if (!context) {\n        context = await initializeAudio();\n        setIsAudioInitialized(true);\n      } else if (context.state === 'suspended') {\n        await resumeAudioContext();\n      }\n\n      // Load the audio buffer from the user track's file\n      const buffer = await loadAudioBuffer(userTrack.file, context);\n      \n      // Create a new track\n      const newTrack: Track = {\n        id: `track-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        file: userTrack.file,\n        buffer: buffer,\n        mode: trackType,\n        loopStart: 0,\n        loopEnd: buffer.duration,\n        cuePoints: [],\n        tempo: 120,\n        timeSignature: { numerator: 4, denominator: 4 },\n        firstMeasureTime: 0,\n        showMeasures: false\n      };\n\n      // Add the track to the beginning of the tracks array\n      setTracks(prev => {\n        const updatedTracks = [newTrack, ...prev];\n        \n        // If the new track is in preview mode and there's an existing preview track, change it to cue mode\n        if (trackType === 'preview' && prev.length > 0 && prev[0].mode === 'preview') {\n          updatedTracks[1] = { ...prev[0], mode: 'cue' };\n        }\n        \n        return updatedTracks;\n      });\n      \n      // Initialize default values for the new track\n      setPlaybackTimes(prev => ({ ...prev, [newTrack.id]: 0 }));\n      setZoomLevels(prev => ({ ...prev, [newTrack.id]: 1 }));\n      setPlaybackSpeeds(prev => ({ ...prev, [newTrack.id]: 1 }));\n      setVolume(prev => ({ ...prev, [newTrack.id]: lastUsedVolumeRef.current }));\n      setShowMeasures(prev => ({ ...prev, [newTrack.id]: false }));\n      setShowCueThumbs(prev => ({ ...prev, [newTrack.id]: false }));\n      setPlaybackStates(prev => ({ ...prev, [newTrack.id]: false }));\n      setExpandedControls(prev => ({ ...prev, [newTrack.id]: false }));\n      \n      // Initialize filter state\n      setLowpassFreqs(prev => ({ ...prev, [newTrack.id]: 20000 }));\n      setHighpassFreqs(prev => ({ ...prev, [newTrack.id]: 20 }));\n      setFilterEnabled(prev => ({ ...prev, [newTrack.id]: false }));\n      \n      // Set a small delay to simulate waveform loading\n      setTimeout(() => {\n        // setIsWaveformLoading(false); // This line was removed\n      }, 500);\n      \n    } catch (error) {\n      console.error('Error adding user track:', error);\n      setError(error instanceof Error ? error.message : 'Failed to add user track');\n    } finally {\n      setIsLoading(false);\n      setIsManuallyAddingTrack(false);\n      // setIsWaveformLoading(false); // This line was removed\n    }\n  };\n\n\n\n\n\n  const handleInitializeAudio = async () => {\n    try {\n      setNeedsUserInteraction(false);\n      setIsInitializingAudio(true);\n      setError(null);\n      \n      const context = await initializeAudio();\n      setIsAudioInitialized(true);\n      \n      // Load demo track if in demo mode; if no demo selected yet, just return and let demo selection trigger update\n      let asset;\n      if (isDemoMode) {\n        if (!currentDemoTrack) {\n          setIsInitializingAudio(false);\n          return;\n        }\n        asset = {\n          id: currentDemoTrack.id,\n          name: currentDemoTrack.name,\n          file: currentDemoTrack.file,\n          type: currentDemoTrack.type\n        };\n      } else {\n        const sourceAssets = (availableAssets && availableAssets.length > 0) ? availableAssets : defaultAudioAssets;\n        const randomIndex = Math.floor(Math.random() * sourceAssets.length);\n        asset = sourceAssets[randomIndex];\n      }\n      \n      const response = await fetch(asset.file);\n      const blob = await response.blob();\n      const file = new File([blob], `${asset.name}.${asset.type}`, { type: `audio/${asset.type}` });\n      \n      const buffer = await loadAudioBuffer(file, context);\n      const trackId = asset.id;\n      const settings = loadTrackSettingsFromLocal(trackId) || {};\n      \n              const newTrack: Track = {\n          id: trackId,\n          file,\n          buffer,\n          mode: isDemoMode ? 'preview' : (settings.mode || 'preview'),\n          loopStart: settings.loopStart || 0,\n          loopEnd: settings.loopEnd || buffer.duration,\n          cuePoints: settings.cuePoints || Array.from({ length: 10 }, (_, i) => \n            buffer.duration * (i / 10)\n          ),\n          tempo: settings.tempo || 120,\n          timeSignature: settings.timeSignature || { numerator: 4, denominator: 4 },\n          firstMeasureTime: settings.firstMeasureTime || 0,\n          showMeasures: settings.showMeasures || false\n        };\n      \n      setTracks([newTrack]);\n      setCurrentTrackIndex(0);\n      setShowMeasures(prev => ({ ...prev, [trackId]: !!settings.showMeasures }));\n      setShowCueThumbs(prev => ({ ...prev, [trackId]: !!settings.showCueThumbs }));\n      setZoomLevels(prev => ({ ...prev, [trackId]: settings.zoomLevel || 1 }));\n      setPlaybackSpeeds(prev => ({ ...prev, [trackId]: 1 }));\n      const trackVolume = newTrack.mode === 'preview' \n        ? lastUsedVolumeRef.current \n        : (typeof settings.volume === 'number' ? settings.volume : lastUsedVolumeRef.current);\n      setVolume(prev => ({ ...prev, [trackId]: trackVolume }));\n      setExpandedControls(prev => ({ ...prev, [trackId]: false }));\n      \n      // Track demo event if in demo mode\n      if (isDemoMode) {\n        trackDemoEvent('session_started', { \n          trackId: asset.id,\n          timestamp: Date.now()\n        });\n      }\n      \n      // Start onboarding only for anonymous users when first track loads\n      // Logged-in users should only get walkthrough when explicitly clicking \"Load a random track\"  \n      if (isAnonymousUser && onboarding.shouldShowOnboarding()) {\n        // Small delay to ensure UI is fully rendered\n        setTimeout(() => {\n          onboarding.startOnboarding();\n        }, 1000);\n      }\n      \n      setIsInitializingAudio(false);\n    } catch (error) {\n      console.error('Error initializing audio:', error);\n      setError('Failed to initialize audio. Please try again.');\n      setNeedsUserInteraction(true);\n      setIsInitializingAudio(false);\n    }\n  };\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div className=\"max-w-6xl mx-auto p-6\">\n        <div className=\"audafact-card p-8 text-center\">\n          <h1 className=\"text-2xl font-medium audafact-heading mb-4\">\n            Loading Audafact Studio\n          </h1>\n          <p className=\"audafact-text-secondary mb-8\">\n            Loading audio track...\n          </p>\n          <div className=\"flex justify-center\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-audafact-accent-cyan\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (error) {\n    return (\n      <div className=\"max-w-6xl mx-auto p-6\">\n        <div className=\"bg-audafact-surface-1 border border-audafact-alert-red rounded-lg p-8 text-center\">\n          <h1 className=\"text-2xl font-medium text-audafact-alert-red mb-4\">\n            Error Loading Track\n          </h1>\n          <p className=\"text-audafact-alert-red mb-8\">{error}</p>\n          <button\n            onClick={() => window.location.reload()}\n            className=\"bg-audafact-alert-red text-audafact-text-primary px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors\"\n          >\n            Try Again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Audio context needs user interaction state\n  if (needsUserInteraction) {\n    return (\n      <>\n        <div \n          className={`mx-auto p-4 lg:p-6 space-y-6 relative transition-all duration-300 ease-in-out ${\n            (user || isDemoMode) && isSidePanelOpen \n              ? 'lg:ml-[400px] lg:max-w-[calc(100vw-400px)] lg:bg-audafact-surface-2 lg:bg-opacity-30' \n              : 'max-w-6xl'\n          }`}\n        >\n          <div className=\"max-w-6xl mx-auto p-6\">\n            <div className=\"audafact-card p-8 text-center\">\n              <h1 className=\"text-2xl font-medium audafact-heading mb-4\">\n                Audio Context Required\n              </h1>\n              <p className=\"audafact-text-secondary mb-6\">\n                Your browser requires user interaction before allowing audio playback. \n                Click the button below to initialize audio and load a random track.\n              </p>\n              {user ? (\n                <p className=\"audafact-text-secondary mb-6\">\n                  You can also select a track from the side panel after audio is initialized.\n                </p>\n              ) : (\n                <p className=\"audafact-text-secondary mb-6\">\n                  <a href=\"/auth\" className=\"text-audafact-accent-cyan hover:underline\">\n                    Login to Audafact\n                  </a> to access your library and select specific tracks.\n                </p>\n              )}\n              <button\n                onClick={handleInitializeAudio}\n                className=\"audafact-button-primary\"\n                disabled={isInitializingAudio}\n              >\n                {isInitializingAudio ? 'Initializing...' : 'Initialize Audio & Load Track'}\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* SidePanel */}\n        {user && (\n          <SidePanel\n            isOpen={isSidePanelOpen}\n            onToggle={toggleSidePanel}\n            onUploadTrack={handleUploadTrack}\n            onAddFromLibrary={handleAddFromLibrary}\n            onAddUserTrack={handleAddUserTrack}\n          />\n        )}\n      </>\n    );\n  }\n\n  // No tracks state\n  if (tracks.length === 0) {\n    return (\n      <>\n        <div \n          className={`mx-auto p-4 lg:p-6 space-y-6 relative transition-all duration-300 ease-in-out ${\n            (user || isDemoMode) && isSidePanelOpen \n              ? 'lg:ml-[400px] lg:max-w-[calc(100vw-400px)] lg:bg-audafact-surface-2 lg:bg-opacity-30' \n              : 'max-w-6xl'\n          }`}\n          onDragOver={handleDragOver}\n          onDragEnter={handleDragEnter}\n          onDragLeave={handleDragLeave}\n          onDrop={handleDrop}\n        >\n          {/* Full-page drag and drop overlay - covers entire viewport when SidePanel is closed */}\n          {(user || isDemoMode) && !isSidePanelOpen && isDragOver && (\n            <div\n              className=\"fixed inset-0 z-40 bg-transparent\"\n              onDragOver={handleDragOver}\n              onDragEnter={handleDragEnter}\n              onDragLeave={handleDragLeave}\n              onDrop={handleDrop}\n            />\n          )}\n          \n          {/* Full-screen drag and drop overlay - only active when dragging and SidePanel is open */}\n          {(user || isDemoMode) && isDragOver && isSidePanelOpen && (\n            <div\n              className=\"fixed inset-0 z-40 bg-transparent\"\n              onDragOver={handleDragOver}\n              onDragEnter={handleDragEnter}\n              onDragLeave={handleDragLeave}\n              onDrop={handleDrop}\n            />\n          )}\n\n          {/* Drag and Drop Indicator */}\n          {isDragOver && (\n            <div className=\"fixed inset-0 z-50 pointer-events-none flex items-center justify-center\">\n              <div className=\"bg-audafact-accent-cyan bg-opacity-90 text-audafact-bg-primary px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 animate-pulse\">\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\n                </svg>\n                <div className=\"text-center\">\n                  <span className=\"text-lg font-medium block\">\n                    {dragData?.type === 'file' ? 'Drop audio file to add to studio' : 'Drop track to add to studio'}\n                  </span>\n                  {dragData && (\n                    <span className=\"text-sm opacity-90 block mt-1\">\n                      {dragData.name}\n                    </span>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"max-w-6xl mx-auto p-6\">\n            <div className=\"relative overflow-hidden audafact-card p-12 text-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border border-slate-700/50 shadow-2xl\">\n              {/* Vinyl record background element */}\n              <div className=\"absolute inset-0 opacity-5\">\n                <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 rounded-full border-8 border-slate-600\"></div>\n                <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 rounded-full border-4 border-slate-500\"></div>\n                <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 rounded-full bg-slate-400\"></div>\n              </div>\n              \n              {/* Animated groove lines */}\n              <div className=\"absolute inset-0 opacity-10\">\n                {[...Array(20)].map((_, i) => (\n                  <div\n                    key={i}\n                    className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 rounded-full border border-slate-500\"\n                    style={{\n                      width: `${200 + i * 8}px`,\n                      height: `${200 + i * 8}px`,\n                      animation: `vinyl-spin ${20 + i * 0.5}s linear infinite`,\n                      animationDelay: `${i * 0.1}s`\n                    }}\n                  ></div>\n                ))}\n              </div>\n\n              {/* Main content */}\n              <div className=\"relative z-10\">\n                {/* Icon/Logo area */}\n                <div className=\"mb-8\">\n                  <div className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-audafact-accent-cyan to-audafact-accent-purple mb-4 shadow-lg\">\n                    <svg className=\"w-10 h-10 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/>\n                    </svg>\n                  </div>\n                </div>\n\n                {user ? (\n                  // Registered Users Content\n                  <>\n                    <h1 className=\"text-4xl font-bold bg-gradient-to-r from-audafact-accent-cyan via-audafact-accent-purple to-audafact-accent-cyan bg-clip-text text-transparent mb-6 tracking-tight\">\n                      Welcome Back to Audafact Studio\n                    </h1>\n                    \n                    <div className=\"max-w-2xl mx-auto\">\n                      <p className=\"text-lg text-slate-300 mb-6 leading-relaxed\">\n                        Start creating by:\n                      </p>\n                      \n                      <div className=\"flex flex-wrap justify-center gap-4 mb-8 text-sm text-slate-400\">\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">🔄 Looping segments</span>\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">🎯 Adjusting cue points</span>\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">🎛️ Creating real-time remixes</span>\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">📚 Adding tracks from your library</span>\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">📤 Uploading new samples</span>\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">🎙️ Recording your live performances</span>\n                      </div>\n                    </div>\n\n                    <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                      <button\n                        onClick={handleInitializeAudio}\n                        className=\"group relative inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-audafact-accent-cyan to-audafact-accent-purple text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\"\n                        disabled={isInitializingAudio}\n                      >\n                        <span className=\"relative z-10 flex items-center gap-2\">\n                          {isInitializingAudio ? (\n                            <>\n                              <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n                              Loading...\n                            </>\n                          ) : (\n                            <>\n                              <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/>\n                              </svg>\n                              Load a Random Track\n                            </>\n                          )}\n                        </span>\n                        <div className=\"absolute inset-0 bg-gradient-to-r from-audafact-accent-purple to-audafact-accent-cyan rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200\"></div>\n                      </button>\n\n                      <button\n                        onClick={toggleSidePanel}\n                        className=\"group relative inline-flex items-center justify-center px-8 py-4 bg-slate-800 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 border border-slate-600 hover:border-slate-500\"\n                      >\n                        <span className=\"relative z-10 flex items-center gap-2\">\n                          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n                          </svg>\n                          Select from Your Library\n                        </span>\n                      </button>\n                    </div>\n                  </>\n                ) : (\n                  // Anonymous Users Content\n                  <>\n                    <h1 className=\"text-4xl font-bold bg-gradient-to-r from-audafact-accent-cyan via-audafact-accent-purple to-audafact-accent-cyan bg-clip-text text-transparent mb-6 tracking-tight\">\n                      Welcome to Audafact Studio\n                    </h1>\n                    \n                    <div className=\"max-w-2xl mx-auto\">\n                      <p className=\"text-lg text-slate-300 mb-6 leading-relaxed\">\n                        Explore the basics of Audafact in this interactive demo:\n                      </p>\n                      \n                      <div className=\"flex flex-wrap justify-center gap-4 mb-8 text-sm text-slate-400\">\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">🎵 Preview curated tracks</span>\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">🔄 Create loops from segments</span>\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">🎯 Trigger cues for playback</span>\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">⬅️➡️ Navigate with buttons/swipe</span>\n                        <span className=\"px-3 py-1 rounded-full bg-slate-800/50 border border-slate-600/50\">📚 Browse curated library</span>\n                      </div>\n\n                      <p className=\"text-slate-300 mb-8 font-medium\">\n                        Ready for more? Sign up to unlock advanced tools and features.\n                      </p>\n                    </div>\n\n                    <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                      <button\n                        onClick={handleInitializeAudio}\n                        className=\"group relative inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-audafact-accent-cyan to-audafact-accent-purple text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\"\n                        disabled={isInitializingAudio}\n                      >\n                        <span className=\"relative z-10 flex items-center gap-2\">\n                          {isInitializingAudio ? (\n                            <>\n                              <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n                              Loading...\n                            </>\n                          ) : (\n                            <>\n                              <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/>\n                              </svg>\n                              Load a Random Track\n                            </>\n                          )}\n                        </span>\n                        <div className=\"absolute inset-0 bg-gradient-to-r from-audafact-accent-purple to-audafact-accent-cyan rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200\"></div>\n                      </button>\n\n                      <button\n                        onClick={toggleSidePanel}\n                        className=\"group relative inline-flex items-center justify-center px-8 py-4 bg-slate-800 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 border border-slate-600 hover:border-slate-500\"\n                      >\n                        <span className=\"relative z-10 flex items-center gap-2\">\n                          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n                          </svg>\n                          Browse Curated Library\n                        </span>\n                      </button>\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* SidePanel */}\n        <SidePanel\n          isOpen={isSidePanelOpen}\n          onToggle={toggleSidePanel}\n          onUploadTrack={handleUploadTrack}\n          onAddFromLibrary={handleAddFromLibrary}\n          onAddUserTrack={handleAddUserTrack}\n        />\n      </>\n    );\n  }\n\n  return (\n    <>\n      {/* Demo Mode Indicator */}\n      {isDemoMode && <DemoModeIndicator />}\n      \n      <div \n        className={`mx-auto p-4 lg:p-6 space-y-6 relative transition-all duration-300 ease-in-out ${\n          (user || isDemoMode) && isSidePanelOpen \n            ? 'lg:ml-[400px] lg:max-w-[calc(100vw-400px)] lg:bg-audafact-surface-2 lg:bg-opacity-30' \n            : 'max-w-6xl'\n        }`}\n        style={{ \n          overscrollBehaviorX: 'none'\n        }}\n        onDragOver={handleDragOver}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n      >\n        {/* Demo Track Info */}\n        {/* {isDemoMode && <DemoTrackInfo track={currentDemoTrack} />} */}\n        {/* Full-page drag and drop overlay - covers entire viewport when SidePanel is closed */}\n        {(user || isDemoMode) && !isSidePanelOpen && isDragOver && (\n          <div\n            className=\"fixed inset-0 z-40 bg-transparent\"\n            onDragOver={handleDragOver}\n            onDragEnter={handleDragEnter}\n            onDragLeave={handleDragLeave}\n            onDrop={handleDrop}\n          />\n        )}\n        \n        {/* Full-screen drag and drop overlay - only active when dragging and SidePanel is open */}\n        {(user || isDemoMode) && isDragOver && isSidePanelOpen && (\n          <div\n            className=\"fixed inset-0 z-40 bg-transparent\"\n            onDragOver={handleDragOver}\n            onDragEnter={handleDragEnter}\n            onDragLeave={handleDragLeave}\n            onDrop={handleDrop}\n          />\n        )}\n        \n        {/* Add Track Gesture Indicator */}\n        {showAddTrackGesture && (\n          <div className=\"fixed top-16 left-1/2 transform -translate-x-1/2 z-50 pointer-events-none\">\n            <div className=\"bg-green-500 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2 animate-bounce\">\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n              </svg>\n              <span className=\"text-sm font-medium\">Release to add track</span>\n            </div>\n          </div>\n        )}\n\n        {/* Drag and Drop Indicator */}\n        {isDragOver && (\n          <div className=\"fixed inset-0 z-50 pointer-events-none flex items-center justify-center\">\n            <div className=\"bg-audafact-accent-cyan bg-opacity-90 text-audafact-bg-primary px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 animate-pulse\">\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\n              </svg>\n              <div className=\"text-center\">\n                <span className=\"text-lg font-medium block\">\n                  {dragData?.type === 'file' ? 'Drop audio file to add to studio' : 'Drop track to add to studio'}\n                </span>\n                {dragData && (\n                  <span className=\"text-sm opacity-90 block mt-1\">\n                    {dragData.name}\n                  </span>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Global Recording Controls */}\n        <div className=\"flex justify-end mb-4\">\n          <RecordingControls onSave={handleSaveCurrentState} audioContext={audioContext || undefined} />\n        </div>\n\n        {/* Render all tracks */}\n        {tracks.map((track, index) => (\n          <div \n            key={track.id} \n            className={`audafact-card overflow-hidden transition-all duration-300 relative ${\n              index === 0 \n                ? 'border-audafact-accent-cyan shadow-card' // Top track styling\n                : 'border-audafact-divider shadow-sm' // Lower tracks styling\n            } ${isDragOver ? 'ring-2 ring-audafact-accent-cyan ring-opacity-50' : ''}`}\n            style={{\n              transform: isAddingTrack && index > 0 ? 'translateY(10px)' : 'translateY(0)'\n            }}\n            data-testid={index === 0 ? 'main-track-card' : `track-card-${index}`}\n          >\n            {/* Add Track and Navigation Controls - Only show on first track */}\n            {index === 0 && (\n              <div \n                className=\"flex items-center justify-between bg-audafact-surface-2 border-b border-audafact-divider py-1 px-2\"\n                style={{ touchAction: 'pan-y pinch-zoom' }}\n                onWheel={handleWheel}\n                onTouchStart={handleTouchStart}\n                onTouchMove={handleTouchMove}\n                onTouchEnd={handleTouchEnd}\n              >\n                <button\n                  onClick={handlePreviousTrack}\n                  disabled={isTrackLoading}\n                  className={`p-2 rounded-full transition-all duration-200 ${\n                    isTrackLoading\n                      ? 'text-audafact-text-secondary cursor-not-allowed'\n                      : 'text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-1 shadow-sm'\n                  }`}\n                  title=\"Previous Track (Left Arrow)\"\n                  data-testid=\"previous-track-button\"\n                >\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n                  </svg>\n                </button>\n                  \n                {/* Add Track Button */}\n                <button\n                  onClick={addNewTrack}\n                  disabled={!canAddTrack || isAddingTrack || isTrackLoading || isDemoMode}\n                  className={`flex flex-col items-center justify-center p-2 rounded-lg transition-all duration-200 ${\n                    !canAddTrack || isAddingTrack || isTrackLoading || isDemoMode\n                      ? 'text-audafact-text-secondary cursor-not-allowed'\n                      : 'text-audafact-accent-cyan hover:text-audafact-accent-cyan hover:bg-audafact-surface-1 shadow-sm'\n                  } ${addTrackAnimation ? 'animate-pulse' : ''}`}\n                  title={isDemoMode ? 'Add tracks not available in demo mode' : (canAddTrack ? 'Add New Track' : 'Change current track mode to enable adding tracks')}\n                >\n                  <svg className=\"w-4 h-4 mb-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\n                  </svg>\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\n                  </svg>\n                  {isAddingTrack && (\n                    <span className=\"text-xs mt-1\">Adding...</span>\n                  )}\n                </button>\n                \n\n                  \n              <button\n                onClick={handleNextTrack}\n                disabled={isTrackLoading}\n                className={`p-2 rounded-full transition-all duration-200 ${\n                  isTrackLoading\n                    ? 'text-audafact-text-secondary cursor-not-allowed'\n                    : 'text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-1 shadow-sm'\n                }`}\n                title=\"Next Track (Right Arrow)\"\n                data-testid=\"next-track-button\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                </svg>\n              </button>\n            </div>\n            )}\n\n            {/* Track Header */}\n            <div className=\"p-4 border-b border-audafact-divider bg-audafact-surface-1\">\n              {/* Mobile layout */}\n              <div className=\"flex flex-col gap-2 md:hidden\">\n                {/* Row 1: Mode buttons */}\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"grid grid-cols-3 gap-1 bg-audafact-surface-2 rounded-md p-0.5 border border-audafact-divider w-full max-w-full\">\n                    <button\n                      onClick={() => handleModeChange(track.id, 'preview')}\n                      className={`w-full text-center px-2 py-1 text-xs font-medium rounded transition-colors ${\n                        track.mode === 'preview'\n                          ? 'bg-audafact-accent-blue text-audafact-text-primary shadow-sm'\n                          : 'text-audafact-text-secondary hover:text-audafact-text-primary'\n                      }`}\n                      data-testid=\"preview-mode-button\"\n                    >\n                      Preview\n                    </button>\n                    <button\n                      onClick={() => handleModeChange(track.id, 'loop')}\n                      className={`w-full text-center px-2 py-1 text-xs font-medium rounded transition-colors ${\n                        track.mode === 'loop'\n                          ? 'bg-audafact-accent-cyan text-audafact-bg-primary shadow-sm'\n                          : 'text-audafact-text-secondary hover:text-audafact-text-primary'\n                      }`}\n                      data-testid=\"loop-mode-button\"\n                    >\n                      Loop\n                    </button>\n                    <button\n                      onClick={() => handleModeChange(track.id, 'cue')}\n                      className={`w-full text-center px-2 py-1 text-xs font-medium rounded transition-colors ${\n                        track.mode === 'cue'\n                          ? 'bg-audafact-alert-red text-audafact-text-primary shadow-sm'\n                          : 'text-audafact-text-secondary hover:text-audafact-text-primary'\n                      }`}\n                      data-testid=\"chop-mode-button\"\n                    >\n                      Chop\n                    </button>\n                  </div>\n                </div>\n                {/* Row 2: Song name (truncated) + mode */}\n                <div className=\"min-w-0\">\n                  <h3 className=\"font-medium audafact-heading truncate\">\n                    {track.file.name}\n                  </h3>\n                  <p className=\"text-xs audafact-text-secondary truncate\">\n                    {track.mode === 'preview' ? 'Preview Mode' : track.mode === 'loop' ? 'Loop Mode' : 'Cue Mode'}\n                  </p>\n                </div>\n                {/* Row 3: Measures, Cues, Select */}\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <button\n                    onClick={() => handleToggleMeasures(track.id)}\n                    className={`flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 ${\n                      showMeasures[track.id]\n                        ? 'bg-audafact-accent-cyan text-audafact-bg-primary'\n                        : 'bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary'\n                    }`}\n                    title={showMeasures[track.id] ? 'Hide Measures' : 'Show Measures'}\n                    data-testid=\"measures-button\"\n                  >\n                    <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\n                    </svg>\n                    <span>Measures</span>\n                  </button>\n                  {track.mode === 'cue' && (\n                    <button\n                      onClick={() => handleToggleCueThumbs(track.id)}\n                      className={`flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 ${\n                        showCueThumbs[track.id]\n                          ? 'bg-audafact-alert-red text-audafact-text-primary'\n                          : 'bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary'\n                      }`}\n                      title={showCueThumbs[track.id] ? 'Hide Cue Points' : 'Show Cue Points'}\n                    >\n                      <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\n                      </svg>\n                      <span>Cues</span>\n                    </button>\n                  )}\n                  {track.mode === 'cue' && (\n                    <button\n                      onClick={() => handleTrackSelect(track.id)}\n                      className={`flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 ${\n                        track.id === selectedCueTrackId\n                          ? 'bg-audafact-alert-red text-audafact-text-primary'\n                          : 'bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary'\n                      }`}\n                      title={track.id === selectedCueTrackId ? 'Selected for Cue Control' : 'Select for Cue Control'}\n                    >\n                      <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\n                      </svg>\n                      <span>Select</span>\n                    </button>\n                  )}\n                </div>\n                {/* Row 4: Time & Tempo toggle */}\n                <div>\n                  <button\n                    onClick={() => handleToggleControls(track.id)}\n                    className=\"flex items-center gap-1 px-2 py-1 text-xs font-medium audafact-text-secondary bg-audafact-surface-1 border border-audafact-divider rounded hover:bg-audafact-surface-2 transition-colors duration-200 w-full justify-between\"\n                    title={expandedControls[track.id] ? 'Collapse Controls' : 'Expand Controls'}\n                    data-testid=\"time-tempo-controls-button\"\n                  >\n                    <span className=\"truncate\">Time and Tempo</span>\n                    <svg\n                      className={`w-3 h-3 transition-transform ${expandedControls[track.id] ? 'rotate-180' : ''}`}\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Desktop layout */}\n              <div className=\"hidden md:flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  {/* Custom Mode Selector */}\n                  <div className=\"flex items-center bg-audafact-surface-2 rounded-md p-0.5 border border-audafact-divider\">\n                    <button\n                      onClick={() => handleModeChange(track.id, 'preview')}\n                      className={`px-2 py-1 text-xs font-medium rounded transition-colors ${\n                        track.mode === 'preview'\n                          ? 'bg-audafact-accent-blue text-audafact-text-primary shadow-sm'\n                          : 'text-audafact-text-secondary hover:text-audafact-text-primary'\n                      }`}\n                      data-testid=\"preview-mode-button\"\n                    >\n                      Preview\n                    </button>\n                    <button\n                      onClick={() => handleModeChange(track.id, 'loop')}\n                      className={`px-2 py-1 text-xs font-medium rounded transition-colors ${\n                        track.mode === 'loop'\n                          ? 'bg-audafact-accent-cyan text-audafact-bg-primary shadow-sm'\n                          : 'text-audafact-text-secondary hover:text-audafact-text-primary'\n                      }`}\n                      data-testid=\"loop-mode-button\"\n                    >\n                      Loop\n                    </button>\n                    <button\n                      onClick={() => handleModeChange(track.id, 'cue')}\n                      className={`px-2 py-1 text-xs font-medium rounded transition-colors ${\n                        track.mode === 'cue'\n                          ? 'bg-audafact-alert-red text-audafact-text-primary shadow-sm'\n                          : 'text-audafact-text-secondary hover:text-audafact-text-primary'\n                      }`}\n                      data-testid=\"chop-mode-button\"\n                    >\n                      Chop\n                    </button>\n                  </div>\n                  <div className=\"min-w-0\">\n                    <h3 className=\"font-medium audafact-heading truncate max-w-[420px]\">\n                      {track.file.name}\n                    </h3>\n                    <p className=\"text-sm audafact-text-secondary\">\n                      {track.mode === 'preview' ? 'Preview Mode' : track.mode === 'loop' ? 'Loop Mode' : 'Cue Mode'}\n                    </p>\n                  </div>\n                </div>\n                \n                <div className=\"flex items-center gap-2\">\n                  {/* Show Measures Button */}\n                  <button\n                    onClick={() => handleToggleMeasures(track.id)}\n                    className={`flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 ${\n                      showMeasures[track.id]\n                        ? 'bg-audafact-accent-cyan text-audafact-bg-primary'\n                        : 'bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary'\n                    }`}\n                    title={showMeasures[track.id] ? 'Hide Measures' : 'Show Measures'}\n                    data-testid=\"measures-button\"\n                  >\n                    <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\n                    </svg>\n                    <span>Measures</span>\n                  </button>\n\n                  {/* Show Cue Points Button - Only visible on cue tracks */}\n                  {track.mode === 'cue' && (\n                    <button\n                      onClick={() => handleToggleCueThumbs(track.id)}\n                      className={`flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 ${\n                        showCueThumbs[track.id]\n                          ? 'bg-audafact-alert-red text-audafact-text-primary'\n                          : 'bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary'\n                      }`}\n                      title={showCueThumbs[track.id] ? 'Hide Cue Points' : 'Show Cue Points'}\n                    >\n                      <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\n                      </svg>\n                      <span>Cues</span>\n                    </button>\n                  )}\n\n                  {/* Cue Track Selection Indicator */}\n                  {track.mode === 'cue' && (\n                    <button\n                      onClick={() => handleTrackSelect(track.id)}\n                      className={`flex items-center gap-1 px-2 py-1 text-xs font-medium border border-audafact-divider rounded transition-colors duration-200 ${\n                        track.id === selectedCueTrackId\n                          ? 'bg-audafact-alert-red text-audafact-text-primary'\n                          : 'bg-audafact-surface-1 text-audafact-text-secondary hover:bg-audafact-surface-2 hover:text-audafact-text-primary'\n                      }`}\n                      title={track.id === selectedCueTrackId ? 'Selected for Cue Control' : 'Select for Cue Control'}\n                    >\n                      <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\n                      </svg>\n                      <span>Select</span>\n                    </button>\n                  )}\n\n                  <button\n                    onClick={() => handleToggleControls(track.id)}\n                    className=\"flex items-center gap-1 px-2 py-1 text-xs font-medium audafact-text-secondary bg-audafact-surface-1 border border-audafact-divider rounded hover:bg-audafact-surface-2 transition-colors duration-200\"\n                    title={expandedControls[track.id] ? 'Collapse Controls' : 'Expand Controls'}\n                    data-testid=\"time-tempo-controls-button\"\n                  >\n                    <span>Time and Tempo</span>\n                    <svg \n                      className={`w-3 h-3 transition-transform ${expandedControls[track.id] ? 'rotate-180' : ''}`} \n                      fill=\"none\" \n                      stroke=\"currentColor\" \n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {/* Collapsible Controls */}\n            {expandedControls[track.id] && (\n              <div className=\"p-4 border-b border-audafact-divider bg-audafact-surface-2 space-y-4\">\n                {/* Tempo Controls */}\n                <div className=\"space-y-2\">\n                  <TempoControls\n                    trackId={track.id}\n                    initialTempo={track.tempo}\n                    onTempoChange={handleTempoChange}\n                    playbackSpeed={playbackSpeeds[track.id] || 1}\n                  />\n                </div>\n\n                {/* Time Signature Controls */}\n                <div className=\"space-y-2\">\n                  <TimeSignatureControls\n                    timeSignature={track.timeSignature}\n                    onTimeSignatureChange={(timeSignature) => handleTimeSignatureChange(track.id, timeSignature)}\n                  />\n                </div>\n              </div>\n            )}\n\n            {/* Waveform Display */}\n            <div className=\"audafact-waveform-bg relative\" style={{ height: '120px' }}>\n            <WaveformDisplay\n                audioFile={track.file}\n                mode={track.mode}\n                loopStart={track.loopStart}\n                loopEnd={track.loopEnd}\n                cuePoints={track.cuePoints}\n                onLoopPointsChange={(start, end) => handleLoopPointsChange(track.id, start, end)}\n                onCuePointChange={(index, time) => handleCuePointChange(track.id, index, time)}\n                playhead={track.mode === 'loop' ? loopPlayhead : samplePlayhead}\n                playbackTime={playbackTimes[track.id] || 0}\n                zoomLevel={zoomLevels[track.id] || 1}\n                onZoomIn={() => handleZoomIn(track.id)}\n                onZoomOut={() => handleZoomOut(track.id)}\n                onResetZoom={() => handleResetZoom(track.id)}\n                trackId={track.id}\n                showMeasures={showMeasures[track.id]}\n                tempo={track.tempo}\n                timeSignature={track.timeSignature}\n                firstMeasureTime={track.firstMeasureTime}\n                onFirstMeasureChange={(time) => handleFirstMeasureChange(track.id, time)}\n                showCueThumbs={showCueThumbs[track.id]}\n                isPlaying={playbackStates[track.id] || false}\n                onPlayheadChange={(time) => handlePlayheadChange(track.id, time)}\n                onScrollStateChange={(isScrolling) => handleWaveformScrollStateChange(track.id, isScrolling)}\n                isDemoMode={isDemoMode}\n              />\n              \n\n            </div>\n\n            {/* Track Controls */}\n            <div className=\"p-4 relative z-10 bg-audafact-surface-1\">\n              <TrackControls\n                key={`controls-${track.id}`}\n                mode={track.mode}\n                audioContext={audioContext}\n                audioBuffer={track.buffer}\n                loopStart={track.loopStart}\n                loopEnd={track.loopEnd}\n                cuePoints={track.cuePoints}\n                ensureAudio={ensureAudioBeforeAction}\n                isSelected={track.id === selectedCueTrackId}\n                onSelect={() => handleTrackSelect(track.id)}\n                onPlaybackTimeChange={(time) => handlePlaybackTimeChange(track.id, time)}\n                onSpeedChange={(speed) => handleSpeedChange(track.id, speed)}\n                trackTempo={track.tempo}\n                volume={volume[track.id] || 1}\n                onVolumeChange={(newVolume) => handleVolumeChange(track.id, newVolume)}\n                playbackSpeed={playbackSpeeds[track.id] || 1}\n                onPlaybackStateChange={(isPlaying: boolean) => handlePlaybackStateChange(track.id, isPlaying)}\n                playbackTime={playbackTimes[track.id] || 0}\n                disabled={false}\n                lowpassFreq={lowpassFreqs[track.id] || 20000}\n                onLowpassFreqChange={(freq) => handleLowpassFreqChange(track.id, freq)}\n                highpassFreq={highpassFreqs[track.id] || 20}\n                onHighpassFreqChange={(freq) => handleHighpassFreqChange(track.id, freq)}\n                filterEnabled={filterEnabled[track.id] || false}\n                onFilterEnabledChange={(enabled) => handleFilterEnabledChange(track.id, enabled)}\n                showDeleteButton={tracks.length > 1 && track.mode !== 'preview'}\n                onDelete={() => removeTrack(track.id)}\n                trackId={track.id}\n                seekFunctionRef={getSeekFunctionRef(track.id)}\n                recordingDestination={isRecordingPerformance ? getRecordingDestination() : null}\n              />\n\n              {track.mode === 'cue' && track.id === selectedCueTrackId && (\n                <div className=\"mt-3 bg-audafact-accent-blue bg-opacity-10 p-2 rounded text-audafact-accent-blue text-xs\">\n                  Press keyboard keys 1-0 to trigger cue points\n                </div>\n              )}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* SidePanel - Show for all users on studio page */}\n      <SidePanel\n        isOpen={isSidePanelOpen}\n        onToggle={toggleSidePanel}\n        onUploadTrack={handleUploadTrack}\n        onAddFromLibrary={handleAddFromLibrary}\n        onAddUserTrack={handleAddUserTrack}\n      />\n      \n\n      \n      {/* Signup Modal */}\n      <SignupModal\n        isOpen={modalState.isOpen}\n        onClose={closeSignupModal}\n        trigger={modalState.trigger}\n      />\n      \n      {/* Upgrade Prompt Modal */}\n      {showUpgradePrompt.show && (\n        <UpgradePrompt\n          message={showUpgradePrompt.message}\n          feature={showUpgradePrompt.feature}\n          onClose={() => setShowUpgradePrompt({ show: false, message: '', feature: '' })}\n        />\n      )}\n\n      {/* Onboarding Walkthrough */}\n      <OnboardingWalkthrough\n        isOpen={onboarding.isOpen}\n        onClose={onboarding.closeOnboarding}\n        onComplete={onboarding.completeOnboarding}\n        steps={onboardingSteps}\n        currentStep={onboarding.currentStep}\n        onStepChange={onboarding.setCurrentStep}\n      />\n\n      {/* Help Button */}\n      <HelpButton\n        onStartTutorial={onboarding.startOnboarding}\n        onShowHelp={() => setShowHelpModal(true)}\n      />\n\n      {/* Help Modal */}\n      <HelpModal\n        isOpen={showHelpModal}\n        onClose={() => setShowHelpModal(false)}\n      />\n    </>\n  );\n};\n\nexport default Studio; ","import { OnboardingStep } from '../components/OnboardingWalkthrough';\n\nexport const createOnboardingSteps = (\n  handlers: {\n    onPlayTrack: () => void;\n    onNextTrack: () => void;\n    onPreviousTrack: () => void;\n    onToggleSidePanel: () => void;\n    onSwitchToLoopMode: () => void;\n    onSwitchToCueMode: () => void;\n    onToggleControls: () => void;\n    onAdjustVolume: () => void;\n    onSetLoopPoints: () => void;\n    onTriggerCue: () => void;\n  }\n): OnboardingStep[] => [\n  {\n    id: 'welcome',\n    title: 'Welcome to Audafact Studio!',\n    description: 'Let\\'s take a quick tour of your music production workspace. You can skip this anytime and explore freely.',\n    targetSelector: '[data-testid=\"main-track-card\"]',\n    position: 'center',\n    required: false\n  },\n  {\n    id: 'track-navigation',\n    title: 'Track Navigation',\n    description: 'Use these arrow buttons to navigate between different tracks. You can also swipe left/right on mobile or use keyboard arrows.',\n    targetSelector: '[data-testid=\"previous-track-button\"], [data-testid=\"next-track-button\"]',\n    position: 'bottom'\n  },\n  {\n    id: 'playback-controls',\n    title: 'Playback Controls',\n    description: 'Here you can play, pause, and control the current track. Try playing the track to hear it!',\n    targetSelector: '[data-testid=\"play-button\"], button[title*=\"Play\"], button[title*=\"Pause\"]',\n    position: 'center',\n    action: handlers.onPlayTrack\n  },\n  {\n    id: 'track-modes',\n    title: 'Track Modes',\n    description: 'Switch between different playback modes: Preview (full track), Loop (repeat a section), and Chop (trigger specific points).',\n    targetSelector: '[data-testid=\"preview-mode-button\"], [data-testid=\"loop-mode-button\"], [data-testid=\"chop-mode-button\"]',\n    position: 'bottom'\n  },\n  {\n    id: 'loop-mode',\n    title: 'Loop Mode',\n    description: 'Switch to Loop mode to create repeating sections. You can set custom start and end points on the waveform.',\n    targetSelector: '[data-testid=\"loop-mode-button\"]',\n    position: 'bottom',\n    action: handlers.onSwitchToLoopMode\n  },\n  {\n    id: 'loop-points',\n    title: 'Setting Loop Points',\n    description: 'Click and drag on the waveform to set your loop start and end points. The highlighted section will repeat continuously.',\n    targetSelector: '.audafact-waveform-bg',\n    position: 'top',\n    action: handlers.onSetLoopPoints\n  },\n  {\n    id: 'cue-mode',\n    title: 'Chop Mode',\n    description: 'Switch to Chop mode to trigger specific points in the track. Perfect for live performances and remixing.',\n    targetSelector: '[data-testid=\"chop-mode-button\"]',\n    position: 'bottom',\n    action: handlers.onSwitchToCueMode\n  },\n  {\n    id: 'cue-triggering',\n    title: 'Triggering Cues',\n    description: 'In Chop mode, press keys 1-0 to trigger different cue points. Each number corresponds to a specific position in the track.',\n    targetSelector: '.audafact-waveform-bg',\n    position: 'top',\n    action: handlers.onTriggerCue\n  },\n  {\n    id: 'volume-controls',\n    title: 'Volume & Effects',\n    description: 'Adjust the volume, playback speed, and apply filters to shape your sound. Try the low-pass and high-pass filters for different effects.',\n    targetSelector: '[data-testid=\"volume-control\"], input[type=\"range\"]',\n    position: 'bottom',\n    action: handlers.onAdjustVolume\n  },\n  {\n    id: 'time-tempo-controls',\n    title: 'Time & Tempo',\n    description: 'Expand this section to adjust tempo and time signature. Great for matching different tracks and setting the musical grid.',\n    targetSelector: '[data-testid=\"time-tempo-controls-button\"]',\n    position: 'bottom'\n  },\n  {\n    id: 'side-panel',\n    title: 'Track Library',\n    description: 'Open the side panel to browse your track library. You can preview tracks and add them to your studio.',\n    targetSelector: '[data-testid=\"side-panel-toggle\"]',\n    position: 'left'\n  },\n  {\n    id: 'waveform-interaction',\n    title: 'Waveform Interaction',\n    description: 'Click anywhere on the waveform to jump to that position. Use the zoom controls to get a closer look at specific sections.',\n    targetSelector: '.audafact-waveform-bg',\n    position: 'top'\n  },\n  {\n    id: 'measures-grid',\n    title: 'Measures & Grid',\n    description: 'Toggle the measures display to see musical grid lines. This helps with timing and beat matching.',\n    targetSelector: '[data-testid=\"measures-button\"]',\n    position: 'bottom'\n  },\n  {\n    id: 'completion',\n    title: 'You\\'re All Set!',\n    description: 'You now know the basics of Audafact Studio. Feel free to explore and experiment with different tracks and features. Happy creating!',\n    targetSelector: '[data-testid=\"main-track-card\"]',\n    position: 'center',\n    required: false\n  }\n];\n\n// Alternative shorter version for quick overview\nexport const createQuickOnboardingSteps = (\n  handlers: {\n    onPlayTrack: () => void;\n    onNextTrack: () => void;\n    onToggleSidePanel: () => void;\n    onSwitchToLoopMode: () => void;\n    onSwitchToCueMode: () => void;\n  }\n): OnboardingStep[] => [\n  {\n    id: 'welcome',\n    title: 'Welcome to Audafact Studio!',\n    description: 'Let\\'s quickly explore the key features of your music production workspace.',\n    targetSelector: '[data-testid=\"main-track-card\"]',\n    position: 'center'\n  },\n  {\n    id: 'navigation',\n    title: 'Track Navigation',\n    description: 'Use arrow buttons to switch between tracks, or swipe on mobile.',\n    targetSelector: '[data-testid=\"previous-track-button\"], [data-testid=\"next-track-button\"]',\n    position: 'bottom'\n  },\n  {\n    id: 'playback',\n    title: 'Playback',\n    description: 'Play, pause, and control your tracks. Try it now!',\n    targetSelector: '[data-testid=\"play-button\"], button[title*=\"Play\"]',\n    position: 'bottom',\n    action: handlers.onPlayTrack\n  },\n  {\n    id: 'modes',\n    title: 'Three Modes',\n    description: 'Preview (full track), Loop (repeat section), Chop (trigger points).',\n    targetSelector: '[data-testid=\"preview-mode-button\"], [data-testid=\"loop-mode-button\"], [data-testid=\"chop-mode-button\"]',\n    position: 'bottom'\n  },\n  {\n    id: 'library',\n    title: 'Track Library',\n    description: 'Browse and preview tracks from your library.',\n    targetSelector: '[data-testid=\"side-panel-toggle\"]',\n    position: 'left',\n    action: handlers.onToggleSidePanel\n  },\n  {\n    id: 'ready',\n    title: 'Ready to Create!',\n    description: 'You\\'re all set! Explore the features and start making music.',\n    targetSelector: '[data-testid=\"main-track-card\"]',\n    position: 'center'\n  }\n]; "],"names":["AccessService","static","maxUploads","maxSessions","maxRecordings","maxLibraryTracks","canDownload","Infinity","getLimitsForTier","accessTier","this","PRO_LIMITS","FREE_LIMITS","getUserAccessStatus","userId","uploadsResult","sessionsResult","recordingsResult","Promise","all","supabase","from","select","count","eq","currentUploads","currentSessions","currentRecordings","currentLibraryTracks","getUserLibraryTrackCount","limits","canUpload","canSaveSession","canRecord","canAddLibraryTrack","error","getLibraryTracksToShow","totalTracks","Math","min","canPerformAction","action","getUpgradeMessage","baseMessage","addLibraryTrackToUser","trackId","removeLibraryTrackFromUser","getUserLibraryTracks","getRotationInfo","data","rpc","EnhancedAccessService","canAccessFeature","feature","tier","upload","features","save_session","record","download","edit_cues","canEditCues","edit_loops","canEditLoops","browse_library","canBrowseLibrary","access_pro_tracks","canAccessProTracks","getFeatureGateConfig","gateType","message","ctaText","upgradeRequired","id","checkUsageLimits","getUserUploadCount","getUserSessionCount","getUserRecordingCount","useAccessControl","user","useAuth","useUserTier","accessStatus","setAccessStatus","useState","loading","setLoading","refreshAccessStatus","async","status","useEffect","handleRecordingSaved","window","addEventListener","removeEventListener","ONBOARDING_STORAGE_KEY","UpgradePrompt","onClose","variant","navigate","useNavigate","handleUpgrade","className","children","jsxs","jsx","Crown","onClick","ArrowRight","t","constructor","listeners","on","e","i","Set","add","once","un","delete","unAll","emit","forEach","super","subscriptions","isDestroyed","options","onInit","_init","wavesurfer","destroy","n","s","r","o","h","matchMedia","matches","a","l","button","preventDefault","stopPropagation","d","clientX","c","clientY","u","v","Date","now","g","abs","getBoundingClientRect","left","top","p","m","relatedTarget","document","documentElement","f","b","passive","capture","setTimeout","xmlns","createElementNS","createElement","Object","entries","Node","appendChild","createTextNode","assign","style","textContent","setAttribute","toString","totalDuration","numberOfChannels","element","minLength","maxLength","contentEditable","isRemoved","random","slice","start","clampPosition","end","drag","resize","resizeStart","resizeEnd","color","channelIdx","initElement","setContent","content","setPart","renderPosition","initMouseEvents","max","addResizeHandles","position","zIndex","width","height","cursor","wordBreak","part","borderLeft","borderRadius","right","borderRight","push","onResize","onEndResizing","removeResizeHandles","querySelector","removeChild","backgroundColor","boxSizing","transition","pointerEvents","toggleCursor","onMove","onContentClick","onContentBlur","_onUpdate","parentElement","target","focus","_setTotalDuration","play","getContent","HTMLElement","innerHTML","remove","padding","display","setOptions","regions","regionsContainer","initRegionsContainer","create","Error","getWrapper","filter","includes","getRegions","avoidOverlapping","map","reduce","marginTop","adjustScroll","clientWidth","scrollWidth","scrollLeft","virtualAppend","getWidth","getScroll","getDuration","round","saveRegion","addRegion","getDecodedData","enableDragSelection","clearRegions","MeasureDisplay","duration","tempo","zoomLevel","onFirstMeasureChange","timeSignature","firstMeasureTime","visible","containerRef","externalContainerRef","isDraggingFirstMeasure","setIsDraggingFirstMeasure","dragStartX","setDragStartX","dragStartTime","setDragStartTime","internalContainerRef","useRef","measureDuration","useCallback","secondsPerBeat","beatNoteValue","denominator","numerator","calculateMeasures","measureDur","measures","currentTime","measureNumber","time","number","timeToPixels","pixelsToTime","pixels","handleFirstMeasureMouseDown","handleMouseMove","current","deltaX","timeDelta","newTime","handleMouseUp","ref","transform","onMouseDown","title","toFixed","measure","index","GridLines","showMeasures","beatDuration","calculateBeats","beatDur","beats","beatNumber","beatInMeasure","beatTime","isMeasureStart","beat","WaveformDisplay","audioFile","mode","playhead","loopStart","loopEnd","cuePoints","onLoopPointsChange","onCuePointChange","playbackTime","onZoomIn","onZoomOut","onResetZoom","showCueThumbs","isPlaying","onPlayheadChange","onScrollStateChange","isDemoMode","scrollContainerRef","audioUrl","setAudioUrl","plugins","setPlugins","internalShowMeasures","setInternalShowMeasures","internalIsPlaying","setInternalIsPlaying","isScrolling","setIsScrolling","scrollTimeoutRef","regionsPluginRef","currentRegionsRef","lastUpdateTimeRef","initialSetupDoneRef","updateTimeoutRef","prevLoopStartRef","prevLoopEndRef","prevCuePointsRef","prevModeRef","onLoopPointsChangeRef","onCuePointChangeRef","debouncedUpdate","callback","delay","clearTimeout","newUrl","URL","createObjectURL","revokeObjectURL","regionsPlugin","RegionsPlugin","isReady","useWavesurfer","container","url","waveColor","progressColor","cursorColor","normalize","autoplay","handlePlay","handlePause","handleFinish","handleSeek","getCurrentTime","calculateMinPxPerSec","scrollContainer","minPxPerSec","waveformWidth","parentContainer","pxPerSec","playheadPosition","containerWidth","containerCenter","targetScrollLeft","totalWidth","maxScrollLeft","clampedScrollTarget","scrollTo","behavior","centerPlayheadAfterZoom","targetZoomLevel","centerTime","scrollTarget","length","region","thumbElement","allRegions","values","parentNode","resolve","currentTrackId","querySelectorAll","thumb","createRegions","handleStyle","border","epsilon","newRegions","point","clampedStart","regionEnd","cuePoint","clampedCuePoint","newCuePoints","addThumbToRegion","showSignupModal","regionElement","hitbox","cssText","lockIcon","removeThumbsFromRegions","handleModeChange","loopChanged","cuePointsChanged","some","handleParameterChange","newMinPxPerSec","initialTime","setTime","setupRegions","newWidth","handleResize","handleScroll","performance","gridSize","pixelsPerBeat","calculateGridSize","type","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","x1","y1","x2","y2","replace","overflowX","overflowY","minWidth","backgroundImage","backgroundSize","WaveformDisplayContainer","props","TrackControls","audioContext","audioBuffer","ensureAudio","isSelected","onSelect","onPlaybackTimeChange","onSpeedChange","trackTempo","volume","onVolumeChange","playbackSpeed","onPlaybackStateChange","disabled","lowpassFreq","onLowpassFreqChange","highpassFreq","onHighpassFreqChange","showDeleteButton","onDelete","seekFunctionRef","recordingDestination","addRecordingEvent","useRecording","speed","setSpeed","setIsPlaying","audioSourceRef","recordingGain","createGain","gain","value","gainNodeRef","connect","setCurrentTime","activeCueIndex","setActiveCueIndex","internalLowpassFreq","setInternalLowpassFreq","internalHighpassFreq","setInternalHighpassFreq","isFilterSectionExpanded","setIsFilterSectionExpanded","startTimeRef","animationFrameRef","currentVolumeRef","currentSpeedRef","activeCueIndexRef","cueStartTimeRef","playbackStartTimeRef","lowpassFilterRef","highpassFilterRef","currentLowpassFreqRef","currentHighpassFreqRef","isSeekingRef","getTempoSpeedRange","minTempo","maxTempo","stepSize","speedToTempo","speedMultiplier","getCurrentEffectiveTempo","handleLowpassFreqChange","freq","frequency","setValueAtTime","filterType","oldFreq","newFreq","handleHighpassFreqChange","areFiltersActive","createAudioChainWithCurrentSettings","currentVolume","currentSpeed","sourceNode","createBufferSource","gainNode","buffer","playbackRate","lowpassFilter","createBiquadFilter","Q","highpassFilter","destination","updatePlaybackTime","requestAnimationFrame","contextTime","getOutputTimestamp","elapsed","loopDuration","currentPlaybackTime","finalTime","stop","audioChain","loop","positionInLoop","seekToTime","seekTime","cancelAnimationFrame","handleKeyPress","event","cueIndex","key","playCuePoint","disconnect","cueTime","onended","cueStartTime","Pause","size","Play","step","onChange","newVolume","parseFloat","oldVolume","newSpeed","oldSpeed","parseInt","_","idx","label","String","TempoControls","initialTempo","onTempoChange","setTempo","tempoInput","setTempoInput","isTapTempoActive","setIsTapTempoActive","tapCount","setTapCount","lastTapTime","setLastTapTime","tapTimes","setTapTimes","effectiveTempo","setEffectiveTempo","tapTimeoutRef","keyListenerRef","calculateBPM","times","intervals","avgInterval","sum","interval","bpm","handleTap","newTapTimes","trimmedTimes","calculatedBPM","code","repeat","newTempo","isNaN","handleTempoInputChange","onBlur","TimeSignatureControls","onTimeSignatureChange","isOpen","setIsOpen","handleNumeratorChange","handleDenominatorChange","ts","handleCommonTimeSignatureSelect","RecordingControls","onSave","isRecordingPerformance","currentPerformance","startPerformanceRecording","stopPerformanceRecording","saveSuccess","setSaveSuccess","showUpgradePrompt","setShowUpgradePrompt","isSaving","setIsSaving","Fragment","Check","Save","ms","seconds","floor","padStart","formatDuration","startTime","StorageService","uploadAudioFile","file","isValidAudioFile","fileExt","name","split","pop","fileName","substring","storage","UPLOAD_BUCKET","cacheControl","upsert","metadata","originalName","uploadedBy","bucket_id","owner","path","updated_at","toISOString","created_at","last_accessed_at","uploadRecording","sessionId","notes","RECORDING_BUCKET","downloadFile","bucket","filePath","getSignedUrl","expiresIn","createSignedUrl","signedUrl","getPublicUrl","publicUrl","listUserFiles","folder","list","limit","offset","sortBy","column","order","deleteFile","getAudioFileInfo","files","join","search","getAudioDuration","uploaded_at","uploadLibraryTrack","LIBRARY_BUCKET","getLibraryTrackUrl","fileType","getLibraryTrackSignedUrl","audio","Audio","src","MAX_FILE_SIZE","ALLOWED_AUDIO_TYPES","formatFileSize","bytes","log","pow","LibraryTrackItem","track","isPreviewing","onPreview","onAddToStudio","canAddToStudio","isProOnly","handleAddToStudio","dispatchEvent","CustomEvent","detail","trigger","draggable","onDragStart","dataTransfer","setData","JSON","stringify","trackType","effectAllowed","artist","genre","tags","tag","x","y","fontSize","fontWeight","SidePanel","onToggle","onUploadTrack","onAddFromLibrary","onAddUserTrack","initialMode","savedSessions","performances","exportSession","exportPerformance","deleteSession","deletePerformance","togglePreview","currentPreview","setCurrentPreview","startPreview","pause","trackEvent","userTier","stopPreview","usePreviewAudio","expandedMenus","setExpandedMenus","saved","localStorage","getItem","parse","sessions","recordings","activeAudioTab","setActiveAudioTab","activeSessionsTab","setActiveSessionsTab","allowEmptyAudioTab","setAllowEmptyAudioTab","allowEmptySessionsTab","setAllowEmptySessionsTab","previewAudios","setPreviewAudios","playingAssets","setPlayingAssets","userTracks","setUserTracks","show","libraryTracks","setLibraryTracks","isLoadingLibrary","setIsLoadingLibrary","fileInputRef","loadLibraryTracks","uploads","DatabaseService","getUserUploads","userTracksData","fileSize","fileInfo","file_url","uploadedAt","getTime","loadUserTracks","tracks","LibraryService","getLibraryTracks","toggleMenu","menuKey","prev","newState","setItem","handleAudioTabSelect","tab","next","handleSessionsTabSelect","removeItem","handleAddTrack","asset","isUserTrack","innerWidth","placeholder","click","assetId","audioSource","then","catch","handlePreviewPlay","toUpperCase","trackToRemove","find","deleteUpload","updatedTracks","handleRemoveUserTrack","session","isStateSnapshot","startsWith","isRecording","toLocaleDateString","toLocaleTimeString","hour","minute","events","timestamp","audioBlob","onerror","alert","onloadeddata","accept","uploadResult","uploadRecord","createUpload","user_id","userTrack","DemoModeIndicator","OnboardingWalkthrough","onComplete","steps","currentStep","onStepChange","targetElement","setTargetElement","overlayRef","ranActionForStepRef","setPositionTick","findElement","allMatches","preferred","Array","targetSelector","getPreferredMatches","viewportWidth","viewportHeight","innerHeight","viewportCenterX","viewportCenterY","candidates","el","rect","getComputedStyle","isDisplayed","visibility","opacity","hasSize","fullyOnScreen","bottom","partiallyOnScreen","centerX","centerY","distanceToCenter","hypot","sorted","sort","fully","scrollIntoView","block","inline","timeoutId","handle","handleNext","handlePrevious","progress","getHighlightPadding","required","boxShadow","tooltipHeight","extraSpace","tooltipWidth","maxLeft","maxTop","adjustedMaxTop","newTop","getTooltipPosition","description","HelpButton","onStartTutorial","onShowHelp","HelpModal","shortcut","tip","defaultAudioAssets","Studio","initializeAudio","resumeAudioContext","useAudioContext","isSidePanelOpen","toggleSidePanel","useSidePanel","saveCurrentState","getRecordingDestination","authLoading","currentDemoTrack","loadRandomDemoTrack","isLoading","isDemoLoading","trackDemoEvent","useDemo","modalState","closeSignupModal","useSignupModal","setTracks","setIsLoading","showHelpModal","setShowHelpModal","setError","isAudioInitialized","setIsAudioInitialized","availableAssets","setAvailableAssets","onboardingHandlers","onPlayTrack","onNextTrack","handleNextTrack","onPreviousTrack","handlePreviousTrack","onToggleSidePanel","onSwitchToLoopMode","onSwitchToCueMode","onToggleControls","handleToggleControls","onAdjustVolume","onSetLoopPoints","onTriggerCue","onboardingSteps","handlers","createQuickOnboardingSteps","isAnonymousUser","onboarding","state","setState","hasCompleted","hasBeenShown","stored","parsed","saveState","updated","startOnboarding","closeOnboarding","completeOnboarding","setCurrentStep","resetOnboarding","shouldShowOnboarding","totalSteps","useOnboarding","needsUserInteraction","setNeedsUserInteraction","isInitializingAudio","setIsInitializingAudio","isManuallyAddingTrack","setIsManuallyAddingTrack","loopPlayhead","setLoopPlayhead","samplePlayhead","setSamplePlayhead","selectedCueTrackId","setSelectedCueTrackId","playbackTimes","setPlaybackTimes","zoomLevels","setZoomLevels","playbackSpeeds","setPlaybackSpeeds","setVolume","lastUsedVolume","setLastUsedVolume","lastUsedVolumeRef","setShowMeasures","setShowCueThumbs","playbackStates","setPlaybackStates","expandedControls","setExpandedControls","seekFunctionRefs","getSeekFunctionRef","lowpassFreqs","setLowpassFreqs","highpassFreqs","setHighpassFreqs","filterEnabled","setFilterEnabled","currentTrackIndex","setCurrentTrackIndex","touchStartX","setTouchStartX","touchStartY","setTouchStartY","touchEndX","setTouchEndX","touchEndY","setTouchEndY","isWaveformScrolling","setIsWaveformScrolling","isAddingTrack","setIsAddingTrack","addTrackAnimation","setAddTrackAnimation","canAddTrack","setCanAddTrack","showAddTrackGesture","setShowAddTrackGesture","lastGestureTime","setLastGestureTime","isGestureProcessing","setIsGestureProcessing","lastProcessedGestureRef","isTrackLoading","setIsTrackLoading","isDragOver","setIsDragOver","dragTarget","setDragTarget","dragData","setDragData","saveCuePointsToLocal","saveTrackSettingsToLocal","settings","loadTrackSettingsFromLocal","selected","topTrack","hasPreviewTrack","isCancelled","mapped","loadAssets","sourceAssets","randomIndex","context","resume","resumeError","initError","response","fetch","blob","File","loadAudioBuffer","newTrack","findIndex","trackVolume","errorMessage","loadRandomTrack","activeTrackId","handleZoomIn","handleZoomOut","handleResetZoom","updateTrackWithDemoTrack","updatedTrack","fromTrackId","toTrackId","handleTouchStart","closest","isTrackControlsTouch","isConsolidatedHeaderTouch","targetTouches","handleTouchMove","currentX","currentY","deltaY","isVerticalSwipeDown","handleTouchEnd","absDeltaX","absDeltaY","isValidHorizontalSwipe","isValidVerticalSwipe","gestureKey","addNewTrack","handleWheel","isTrackControlsWheel","isConsolidatedHeaderWheel","isVerticalGesture","assets","nextIndex","loadTrackByIndex","prevIndex","onlyUpdateFirstTrack","safeIndex","prevTracks","existingAssetIds","unusedAssets","selectedAsset","updatedExistingTracks","removeTrack","filtered","removed","rest","removeTrackSettingsFromLocal","removeCuePointsFromLocal","reject","reader","FileReader","onload","arrayBuffer","result","decodedBuffer","decodeAudioData","decodeError","readAsArrayBuffer","autoCues","ensureAudioBeforeAction","handleTrackSelect","prevId","currentZoom","newZoom","handleTempoChange","handleDragOver","hasSidePanelData","types","hasFiles","dropEffect","handleDragEnter","jsonData","getData","handleDragLeave","currentTarget","contains","handleDrop","toLowerCase","endsWith","handleUploadTrack","handleAddFromLibrary","handleToggleMeasures","handleToggleCueThumbs","substr","handleAddUserTrack","handleInitializeAudio","location","reload","href","onDragOver","onDragEnter","onDragLeave","onDrop","animation","animationDelay","overscrollBehaviorX","studioState","touchAction","onWheel","onTouchStart","onTouchMove","onTouchEnd","handleTimeSignatureChange","handleLoopPointsChange","clampedTime","handleCuePointChange","handleFirstMeasureChange","handlePlayheadChange","handleWaveformScrollStateChange","handlePlaybackTimeChange","handleSpeedChange","handleVolumeChange","handlePlaybackStateChange","onFilterEnabledChange","enabled","handleFilterEnabledChange","SignupModal"],"mappings":"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","x_google_ignoreList":[4]}