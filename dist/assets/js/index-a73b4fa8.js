import{j as e}from"./audio-0ea8d21d.js";import{a as t,r as a,R as s,u as r,L as n,O as c,b as i,d as o,e as d,f as u}from"./vendor-b17dff21.js";import{c as l,_ as m}from"./auth-86c3050d.js";import{R as h,X as g,C as f,T as p,a as x}from"./ui-e2671ff1.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var y={},w=t;y.createRoot=w.createRoot,y.hydrateRoot=w.hydrateRoot;const b=l("https://julxtxaspzhwbylnqkkj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1bHh0eGFzcHpod2J5bG5xa2tqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3MzU3NzcsImV4cCI6MjA2OTMxMTc3N30.0KKAyMEeLFD3ZXq0REC_1Hp8G_cEO5igfHFW6YLzA4A"),v={async signUp(e,t){try{const{data:a,error:s}=await b.auth.signUp({email:e,password:t});return s?{success:!1,error:s.message}:{success:!0,user:a.user||void 0}}catch(a){return{success:!1,error:"An unexpected error occurred during sign up"}}},async signIn(e,t){try{const{data:a,error:s}=await b.auth.signInWithPassword({email:e,password:t});return s?{success:!1,error:s.message}:{success:!0,user:a.user||void 0}}catch(a){return{success:!1,error:"An unexpected error occurred during sign in"}}},async signOut(){try{const{error:e}=await b.auth.signOut();return e?{success:!1,error:e.message}:{success:!0}}catch(e){return{success:!1,error:"An unexpected error occurred during sign out"}}},async resetPassword(e){try{const{error:t}=await b.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/reset-password`});return t?{success:!1,error:t.message}:{success:!0}}catch(t){return{success:!1,error:"An unexpected error occurred during password reset"}}},async updatePassword(e){try{const{data:t,error:a}=await b.auth.updateUser({password:e});return a?{success:!1,error:a.message}:{success:!0,user:t.user||void 0}}catch(t){return{success:!1,error:"An unexpected error occurred while updating password"}}},getSession:async()=>await b.auth.getSession(),async signInWithGoogle(){try{const{error:e}=await b.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});return e?{success:!1,error:e.message}:{success:!0}}catch(e){return{success:!1,error:"An unexpected error occurred during Google sign in"}}}},S=[{name:"Demo Started",event:"demo_track_loaded",required:!0},{name:"Feature Interaction",event:"demo_mode_switched"},{name:"Gate Clicked",event:"feature_gate_clicked",required:!0},{name:"Signup Modal Shown",event:"signup_modal_shown",required:!0},{name:"Signup Completed",event:"signup_completed",required:!0},{name:"Upgrade Clicked",event:"upgrade_clicked"},{name:"Upgrade Completed",event:"upgrade_completed",required:!0}];class j{static instance;events=[];isOnline=navigator.onLine;sessionId;userId;userTier="guest";retryQueue=[];userProgress=new Map;performanceMetrics=new Map;constructor(){this.sessionId=this.generateSessionId(),this.setupOnlineOfflineHandling(),this.setupGlobalErrorHandling(),this.loadRetryQueue(),this.trackPageLoadTime()}static getInstance(){return j.instance||(j.instance=new j),j.instance}static resetInstance(){j.instance=void 0}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}setupOnlineOfflineHandling(){this.isOnline=navigator.onLine,window.addEventListener("online",()=>{this.isOnline=!0,this.processRetryQueue()}),window.addEventListener("offline",()=>{this.isOnline=!1})}setupGlobalErrorHandling(){window.addEventListener("error",e=>{this.trackError(e.error,"global_error")}),window.addEventListener("unhandledrejection",e=>{this.trackError(new Error(e.reason),"unhandled_promise")})}trackPageLoadTime(){const e=performance.now();window.addEventListener("load",()=>{const t=performance.now()-e;this.trackMetric("page_load_time",t)})}setUser(e,t){this.userId=e,this.userTier=t}track(e,t){const a={event:e,userId:this.userId,sessionId:this.sessionId,timestamp:Date.now(),properties:t,userTier:this.userTier,version:"1.0.0",platform:"web"};this.events.push(a),this.trackFunnelProgress(e,t),this.isOnline?this.sendEvent(a):this.storeForRetry(a),this.events.length>100&&(this.events=this.events.slice(-100))}trackFunnelProgress(e,t){const a=S.find(t=>t.event===e);if(!a)return;const s=S.findIndex(e=>e.name===a.name),r=this.userId||"anonymous";this.userProgress.has(r)||this.userProgress.set(r,new Set),this.userProgress.get(r).add(a.name),this.track("funnel_progress",{stage:a.name,stageIndex:s,properties:t,previousStages:S.slice(0,s).map(e=>e.name),completedStages:Array.from(this.userProgress.get(r)||[])}),this.checkFunnelCompletion(r,a.name)}checkFunnelCompletion(e,t){const a=this.userProgress.get(e);if(!a)return;S.filter(e=>e.required).map(e=>e.name).every(e=>a.has(e))&&this.track("funnel_completed",{userId:e,completedStages:Array.from(a),completionTime:this.calculateFunnelTime(e)})}calculateFunnelTime(e){return 0}trackMetric(e,t){this.performanceMetrics.has(e)||this.performanceMetrics.set(e,[]),this.performanceMetrics.get(e).push(t),this.performanceMetrics.get(e).length>100&&this.performanceMetrics.set(e,this.performanceMetrics.get(e).slice(-100)),this.track("performance_metric",{metric:e,value:t,userTier:this.userTier})}trackError(e,t){this.track("error_occurred",{error:e.message,stack:e.stack,context:t,userTier:this.userTier,url:window.location.href,userAgent:navigator.userAgent})}trackFeatureError(e,t){this.track("feature_error",{feature:e,error:t.message,userTier:this.userTier})}trackFeatureResponseTime(e){const t=performance.now();return()=>{const a=performance.now()-t;this.track("feature_gate_response_time",{feature:e,responseTime:a,userTier:this.userTier})}}async sendEvent(e){try{const t=await fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Analytics request failed: ${t.status}`)}catch(t){this.storeForRetry(e)}}storeForRetry(e){this.retryQueue.push(e),this.saveRetryQueue()}saveRetryQueue(){try{localStorage.setItem("analytics_retry_queue",JSON.stringify(this.retryQueue))}catch(e){}}loadRetryQueue(){try{const e=localStorage.getItem("analytics_retry_queue");e&&(this.retryQueue=JSON.parse(e))}catch(e){}}async processRetryQueue(){if(0===this.retryQueue.length)return;const e=[...this.retryQueue];this.retryQueue=[];for(const t of e)await this.sendEvent(t);this.saveRetryQueue()}getEvents(){return[...this.events]}getSessionId(){return this.sessionId}getRetryQueueLength(){return this.retryQueue.length}getFunnelConversionRate(){const e={},t=this.userProgress.size;return S.forEach(a=>{const s=Array.from(this.userProgress.values()).filter(e=>e.has(a.name)).length;e[a.name]=t>0?s/t*100:0}),e}getAverageMetric(e){const t=this.performanceMetrics.get(e);return t&&0!==t.length?t.reduce((e,t)=>e+t,0)/t.length:0}getUserProgress(){return this.userProgress}setUserProgress(e){this.userProgress=e}clearEvents(){this.events=[]}}const k=j.getInstance(),_=(e,t)=>{k.track(e,t)},N="post_signup_intent",C="demo_session_state";class I{static instance;constructor(){}static getInstance(){return I.instance||(I.instance=new I),I.instance}cacheIntent(e){try{const t=this.getIntentCache(),a={actions:[...t.actions.filter(t=>t.id!==e.id),e].sort((e,t)=>{const a={high:3,medium:2,low:1};return a[t.priority]-a[e.priority]}),sessionId:this.getSessionId(),lastUpdated:Date.now(),userTier:"guest"};localStorage.setItem(N,JSON.stringify(a))}catch(t){}}getIntentCache(){try{const e=localStorage.getItem(N);if(!e)return{actions:[],sessionId:this.getSessionId(),lastUpdated:Date.now(),userTier:"guest"};const t=JSON.parse(e),a=Date.now(),s=t.actions.filter(e=>!e.expiresAt||a<e.expiresAt);return s.length!==t.actions.length&&(t.actions=s,this.updateIntentCache(t)),t}catch(e){return{actions:[],sessionId:this.getSessionId(),lastUpdated:Date.now(),userTier:"guest"}}}clearIntentCache(){try{localStorage.removeItem(N)}catch(e){}}updateUserTier(e){try{const t=this.getIntentCache();t.userTier=e,t.lastUpdated=Date.now(),this.updateIntentCache(t)}catch(t){}}updateIntentCache(e){localStorage.setItem(N,JSON.stringify(e))}getSessionId(){return localStorage.getItem("session_id")||`session_${Date.now()}`}}class E{async execute(e){this.setSidePanelMode("upload"),e.context.file}canExecute(e,t){return"guest"!==t}getSuccessMessage(e){return"🎉 Welcome! You can now upload your own tracks."}setSidePanelMode(e){}}class R{async execute(e){await this.handleSaveSession()}canExecute(e,t){return"guest"!==t}getSuccessMessage(e){return"💾 Session saved! You can now save unlimited sessions."}async handleSaveSession(){}}class P{async execute(e){this.setSidePanelMode("library"),e.context.trackId}canExecute(e,t){return"guest"!==t}getSuccessMessage(e){return"🎵 Browse our full library and add tracks to your studio!"}setSidePanelMode(e){}}class T{async execute(e){this.setCueEditingMode(!0),e.context.cueIndex}canExecute(e,t){return"guest"!==t}getSuccessMessage(e){return"🎯 You can now customize cue points and loops!"}setCueEditingMode(e){}}class A{async execute(e){this.setRecordingMode(!0)}canExecute(e,t){return"pro"===t}getSuccessMessage(e){return"🎙 Start recording your performances!"}setRecordingMode(e){}}class U{async execute(e){this.setDownloadMode(!0)}canExecute(e,t){return"pro"===t}getSuccessMessage(e){return"📥 Download your mixes and share them!"}setDownloadMode(e){}}let D=e=>{},M=e=>{};class L{static instance;executors=new Map;constructor(){this.registerExecutors()}static getInstance(){return L.instance||(L.instance=new L),L.instance}static setMessageFunctions(e,t){D=e,M=t}registerExecutors(){this.executors.set("upload",new E),this.executors.set("save_session",new R),this.executors.set("add_library_track",new P),this.executors.set("edit_cues",new T),this.executors.set("record",new A),this.executors.set("download",new U)}async executePendingActions(e="free"){const t=I.getInstance().getIntentCache();I.getInstance().updateUserTier(e);const a=t.actions.filter(t=>{const a=this.executors.get(t.type);return a&&a.canExecute(t,e)});for(const r of a)try{const t=this.executors.get(r.type);if(t){await t.execute(r);const a=t.getSuccessMessage(r);D(a),k.track("intent_executed",{actionType:r.type,success:!0,userTier:e}),this.removeActionFromCache(r.id)}}catch(s){M(`Failed to complete ${r.type} action`),k.track("intent_executed",{actionType:r.type,success:!1,userTier:e})}}removeActionFromCache(e){const t=I.getInstance().getIntentCache();t.actions=t.actions.filter(t=>t.id!==e),localStorage.setItem(N,JSON.stringify(t))}}class O{static instance;constructor(){}static getInstance(){return O.instance||(O.instance=new O),O.instance}saveDemoState(e){try{const t={...e,timestamp:Date.now()};localStorage.setItem(C,JSON.stringify(t))}catch(t){}}getDemoState(){try{const e=localStorage.getItem(C);if(!e)return null;const t=JSON.parse(e),a=Date.now(),s=36e5;return a-t.timestamp>s?(this.clearDemoState(),null):t}catch(e){return null}}clearDemoState(){try{localStorage.removeItem(C)}catch(e){}}restoreDemoState(){const e=this.getDemoState();if(!e)return!1;try{return e.currentTrack&&this.loadTrack(e.currentTrack),e.playbackPosition&&this.setPlaybackPosition(e.playbackPosition),e.mode&&this.setPlaybackMode(e.mode),e.volume&&this.setVolume(e.volume),e.tempo&&this.setTempo(e.tempo),e.cuePoints&&this.setCuePoints(e.cuePoints),e.loopRegions&&this.setLoopRegions(e.loopRegions),!0}catch(t){return!1}}loadTrack(e){}setPlaybackPosition(e){}setPlaybackMode(e){}setVolume(e){}setTempo(e){}setCuePoints(e){}setLoopRegions(e){}}let F=e=>{},q=e=>{};class z{static setMessageFunctions(e,t){F=e,q=t,L.setMessageFunctions(e,t)}async handleSignupSuccess(e,t){try{I.getInstance().updateUserTier("free"),await L.getInstance().executePendingActions("free");const e=O.getInstance().restoreDemoState();F(e?"🎉 Welcome back! Your session has been restored.":"🎉 Welcome to Audafact! Start creating your mixes."),k.track("signup_completed",{method:"email",trigger:t,hasRestoredSession:e,userTier:"free"}),k.track("post_signup_flow_completed",{actionsExecuted:1,sessionRestored:e,totalTime:Date.now()})}catch(a){q("Welcome! Some features may take a moment to activate.")}}async handleTierUpgrade(e,t){try{I.getInstance().updateUserTier(t),await L.getInstance().executePendingActions(t);F({pro:"🚀 Welcome to Pro Creator! You now have access to all features.",free:"Your subscription has been updated."}[t]||"Subscription updated!"),k.track("tier_upgraded",{newTier:t,previousTier:"free",timestamp:Date.now()})}catch(a){q("Upgrade processed! Some features may take a moment to activate.")}}}const $=a.createContext({user:null,loading:!0,signUp:async()=>({success:!1,error:"Context not initialized"}),signIn:async()=>({success:!1,error:"Context not initialized"}),signInWithGoogle:async()=>({success:!1,error:"Context not initialized"}),signOut:async()=>({success:!1,error:"Context not initialized"}),resetPassword:async()=>({success:!1,error:"Context not initialized"}),updatePassword:async()=>({success:!1,error:"Context not initialized"})}),B=({children:t})=>{const[s,r]=a.useState(null),[n,c]=a.useState(!0);a.useEffect(()=>{b.auth.getSession().then(({data:{session:e}})=>{r(e?.user??null),c(!1),e?.user&&k.setUser(e.user.id,"free")});const{data:{subscription:e}}=b.auth.onAuthStateChange(async(e,t)=>{if(r(t?.user??null),t?.user){if(k.setUser(t.user.id,"free"),"SIGNED_IN"===e){const e=new z;await e.handleSignupSuccess(t.user)}if("USER_UPDATED"===e&&t.user.user_metadata?.tier_changed){const e=new z;await e.handleTierUpgrade(t.user,t.user.user_metadata.new_tier)}}else k.setUser("","guest"),"SIGNED_OUT"===e&&I.getInstance().clearIntentCache()});return()=>e.unsubscribe()},[]);return e.jsx($.Provider,{value:{user:s,loading:n,signUp:async(e,t)=>await v.signUp(e,t),signIn:async(e,t)=>await v.signIn(e,t),signInWithGoogle:async()=>await v.signInWithGoogle(),signOut:async()=>{const e=await v.signOut();return e.success&&r(null),e},resetPassword:async e=>await v.resetPassword(e),updatePassword:async e=>await v.updatePassword(e)},children:t})},J=()=>a.useContext($),G=a.createContext(null),W=({children:t})=>{const[s,r]=a.useState(null),n=a.useCallback(async()=>{try{if(!s){const t=new(window.AudioContext||window.webkitAudioContext)({sampleRate:44100,latencyHint:"interactive"});if("suspended"===t.state)try{await t.resume()}catch(e){}return r(t),t}return"suspended"===s.state&&await s.resume(),s}catch(t){throw t}},[s]),c=a.useCallback(async()=>{try{s&&"suspended"===s.state&&await s.resume()}catch(e){throw e}},[s]),i={audioContext:s,initializeAudio:n,resumeAudioContext:c};return e.jsx(G.Provider,{value:i,children:t})},H=()=>{const e=a.useContext(G);if(!e)throw new Error("useAudioContext must be used within an AudioProvider");return e},Q=a.createContext(void 0),Y=()=>{const e=a.useContext(Q);if(void 0===e)throw new Error("useSidePanel must be used within a SidePanelProvider");return e},V=({children:t})=>{const[s,r]=a.useState(!1);return e.jsx(Q.Provider,{value:{isOpen:s,toggleSidePanel:()=>r(!s),openSidePanel:()=>r(!0),closeSidePanel:()=>r(!1)},children:t})};class X{static async getCurrentUser(){try{const{data:{user:e}}=await b.auth.getUser();if(!e)return null;const{data:t,error:a}=await b.from("users").select("*").eq("id",e.id).single();if(a)throw a;return t}catch(e){return null}}static async updateUser(e,t){try{const{data:a,error:s}=await b.from("users").update(t).eq("id",e).select().single();if(s)throw s;return a}catch(a){return null}}static async createUpload(e){try{const{data:t,error:a}=await b.from("uploads").insert(e).select().single();if(a)throw a;return t}catch(t){return null}}static async getUserUploads(e){try{const{data:t,error:a}=await b.from("uploads").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(a)throw a;return t||[]}catch(t){return[]}}static async deleteUpload(e,t){try{const{error:a}=await b.from("uploads").delete().eq("id",e).eq("user_id",t);if(a)throw a;return!0}catch(a){return!1}}static async createSession(e){try{const{data:t,error:a}=await b.from("sessions").insert(e).select().single();if(a)throw a;return t}catch(t){return null}}static async getUserSessions(e){try{const{data:t,error:a}=await b.from("sessions").select("*").eq("user_id",e).order("updated_at",{ascending:!1});if(a)throw a;return t||[]}catch(t){return[]}}static async getSession(e,t){try{const{data:a,error:s}=await b.from("sessions").select("*").eq("id",e).eq("user_id",t).single();if(s)throw s;return a}catch(a){return null}}static async updateSession(e,t,a){try{const{data:s,error:r}=await b.from("sessions").update(a).eq("id",e).eq("user_id",t).select().single();if(r)throw r;return s}catch(s){return null}}static async deleteSession(e,t){try{const{error:a}=await b.from("sessions").delete().eq("id",e).eq("user_id",t);if(a)throw a;return!0}catch(a){return!1}}static async createRecording(e){try{const{data:t,error:a}=await b.from("recordings").insert(e).select().single();if(a)throw a;return t}catch(t){return null}}static async getSessionRecordings(e,t){try{const{data:a,error:s}=await b.from("recordings").select("*").eq("session_id",e).eq("user_id",t).order("created_at",{ascending:!1});if(s)throw s;return a||[]}catch(a){return[]}}static async getUserRecordings(e){try{const{data:t,error:a}=await b.from("recordings").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(a)throw a;return t||[]}catch(t){return[]}}static async deleteRecording(e,t){try{const{error:a}=await b.from("recordings").delete().eq("id",e).eq("user_id",t);if(a)throw a;return!0}catch(a){return!1}}static async getSessionWithData(e,t){try{const[a,s,r]=await Promise.all([this.getSession(e,t),this.getUserUploads(t),this.getSessionRecordings(e,t)]);return{session:a,uploads:s,recordings:r}}catch(a){return{session:null,uploads:[],recordings:[]}}}}const Z=a.createContext(null),K=({children:t})=>{const{user:s}=J(),[r,n]=a.useState(!1),[c,i]=a.useState(null),[o,d]=a.useState(()=>{const e=localStorage.getItem("audafact_performances");return e?JSON.parse(e):[]}),u=a.useRef(0),[l,m]=a.useState(!1),[h,g]=a.useState(null),[f,p]=a.useState(()=>{const e=localStorage.getItem("audafact_audioRecordings");return e?JSON.parse(e):[]}),[x,y]=a.useState(()=>{const e=localStorage.getItem("audafact_savedSessions");return e?JSON.parse(e):[]}),w=a.useRef(null),v=a.useRef(null),S=a.useRef([]),j=a.useRef([]),k=a.useRef(null),_=a.useRef(null);a.useEffect(()=>{localStorage.setItem("audafact_performances",JSON.stringify(o))},[o]),a.useEffect(()=>{localStorage.setItem("audafact_audioRecordings",JSON.stringify(f))},[f]),a.useEffect(()=>{localStorage.setItem("audafact_savedSessions",JSON.stringify(x))},[x]);const N=a.useCallback(async e=>{try{const t=`performance_${Date.now()}`,a=Date.now();if(u.current=a,!e)return void alert("Audio context is required for recording. Please ensure audio is initialized.");const r=e.createMediaStreamDestination();_.current=r;let c="";MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?c="audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?c="audio/webm":MediaRecorder.isTypeSupported("audio/mp4;codecs=mp4a.40.2")?c="audio/mp4;codecs=mp4a.40.2":MediaRecorder.isTypeSupported("audio/mp4")&&(c="audio/mp4");const o=new MediaRecorder(r.stream,c?{mimeType:c}:void 0);o.onerror=e=>{},w.current=o,v.current=r.stream;const l=[];o.ondataavailable=e=>{e.data.size>0&&l.push(e.data)},o.onstop=async()=>{const e=new Blob(l,{type:c||"audio/webm"});let r=e;try{const t=new(window.AudioContext||window.webkitAudioContext),a=await e.arrayBuffer(),s=await t.decodeAudioData(a),n=await(async e=>{try{const t=e.length,a=e.numberOfChannels,s=e.sampleRate,r=new ArrayBuffer(44+t*a*2),n=new DataView(r),c=(e,t)=>{for(let a=0;a<t.length;a++)n.setUint8(e+a,t.charCodeAt(a))};c(0,"RIFF"),n.setUint32(4,36+t*a*2,!0),c(8,"WAVE"),c(12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,a,!0),n.setUint32(24,s,!0),n.setUint32(28,s*a*2,!0),n.setUint16(32,2*a,!0),n.setUint16(34,16,!0),c(36,"data"),n.setUint32(40,t*a*2,!0);let i=44;for(let o=0;o<t;o++)for(let t=0;t<a;t++){const a=Math.max(-1,Math.min(1,e.getChannelData(t)[o]));n.setInt16(i,a<0?32768*a:32767*a,!0),i+=2}return new Blob([r],{type:"audio/wav"})}catch(t){return null}})(s);n&&(r=n)}catch(h){}const o=Date.now(),u=o-a,m={id:t,startTime:a,endTime:o,duration:u,events:S.current,tracks:j.current,audioBlob:r};if(d(e=>[m,...e]),i(null),n(!1),s?.id&&r)try{const{data:e,error:a}=await b.from("users").select("id").eq("id",s.id).single();if(a&&"PGRST116"===a.code){const{error:e}=await b.from("users").insert({id:s.id,access_tier:"free"});if(e)return}else if(a)return;const{count:r,error:n}=await b.from("recordings").select("id",{count:"exact"}).eq("user_id",s.id);if(n)return;const c=r||0,{data:i,error:o}=await b.from("users").select("access_tier").eq("id",s.id).single();if(c>=("pro"===(o?"free":i?.access_tier||"free")?1/0:1))return;const l=await X.createRecording({user_id:s.id,session_id:void 0,recording_url:`local://recording_${Date.now()}.wav`,length:u/1e3,notes:`Performance recording with ${S.current.length} events`});l&&(d(e=>e.map(e=>e.id===t?{...e,databaseId:l.id}:e)),window.dispatchEvent(new CustomEvent("recordingSaved",{detail:{userId:s.id,recordingCount:1}})))}catch(h){}w.current=null,v.current=null,_.current=null,k.current&&(clearTimeout(k.current),k.current=null)};const m={id:t,startTime:a,events:[],tracks:[],duration:0};S.current=[],j.current=[],i(m),n(!0),o.start()}catch(t){alert("Failed to start recording. Please check microphone permissions.")}},[c]),C=a.useCallback(()=>{if(c&&w.current)try{w.current.stop(),v.current&&(v.current.getTracks().forEach(e=>e.stop()),v.current=null),w.current=null}catch(e){}},[c]),I=a.useCallback(e=>{if(!r||!c)return;const t=Date.now()-u.current,a={...e,timestamp:t};S.current=[...S.current,a],j.current.includes(e.trackId)||(j.current=[...j.current,e.trackId]),i(t=>{if(!t)return null;const s=t.tracks.includes(e.trackId)?t.tracks:[...t.tracks,e.trackId];return{...t,events:[...t.events,a],tracks:s}})},[r,c]),E=a.useCallback(async(e,t=4)=>{await N()},[N]),R=a.useCallback(()=>{C()},[C]),P=a.useCallback(async e=>{const t=`session_${Date.now()}`,a=Date.now(),r={id:t,startTime:a,endTime:a,events:[{timestamp:0,type:"cue_trigger",trackId:"studio",data:e}],tracks:e.tracks?.map(e=>e.id)||[],duration:0};if(y(e=>[r,...e]),s?.id)try{const{count:a,error:r}=await b.from("sessions").select("id",{count:"exact"}).eq("user_id",s.id);if(r)return;const n=a||0,{data:c,error:i}=await b.from("users").select("access_tier").eq("id",s.id).single();if(n>=("pro"===(i?"free":c?.access_tier||"free")?1/0:2))return void y(e=>e.filter(e=>e.id!==t));const o=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),d=e.tracks?.map(e=>e.id).filter(e=>o(e))||[],u=await X.createSession({user_id:s.id,session_name:`Studio Session ${(new Date).toLocaleString()}`,track_ids:d,cuepoints:e.tracks?.flatMap(e=>e.cuePoints||[])||[],loop_regions:e.tracks?.map(e=>({trackId:e.id,start:e.loopStart,end:e.loopEnd})).filter(e=>void 0!==e.start&&void 0!==e.end)||[],mode:"loop"});u?(y(e=>e.map(e=>e.id===t?{...e,id:u.id}:e)),window.dispatchEvent(new CustomEvent("sessionSaved",{detail:{userId:s.id,sessionCount:n+1}}))):y(e=>e.filter(e=>e.id!==t))}catch(n){y(e=>e.filter(e=>e.id!==t))}},[s]),T=a.useCallback(()=>{d([]),p([]),y([]),localStorage.removeItem("audafact_performances"),localStorage.removeItem("audafact_audioRecordings"),localStorage.removeItem("audafact_savedSessions")},[]),A=a.useCallback(e=>{const t=o.find(t=>t.id===e);if(!t)return;const{audioBlob:a,...s}=t,r=JSON.stringify(s,null,2),n=new Blob([r],{type:"application/json"}),c=URL.createObjectURL(n),i=document.createElement("a");if(i.href=c,i.download=`audafact_performance_${e}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(c),a){const t=URL.createObjectURL(a),s=document.createElement("a");s.href=t;let r="webm";a.type.includes("mp4")?r="m4a":a.type.includes("wav")?r="wav":a.type.includes("ogg")?r="ogg":a.type.includes("opus")&&(r="opus"),s.download=`audafact_performance_${e}.${r}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}},[o]),U=a.useCallback(e=>{const t=x.find(t=>t.id===e);if(!t)return;const a=JSON.stringify(t,null,2),s=new Blob([a],{type:"application/json"}),r=URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download=`audafact_session_${e}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)},[x]),D=a.useCallback(e=>{const t=f.find(t=>t.id===e);if(!t||!t.audioBlob)return;const a=URL.createObjectURL(t.audioBlob),s=document.createElement("a");s.href=a,s.download=`audafact_recording_${e}.wav`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},[f]),M=a.useCallback(async e=>{const t=o.find(t=>t.id===e);if(d(t=>t.filter(t=>t.id!==e)),t?.databaseId&&s?.id)try{await X.deleteRecording(t.databaseId,s.id)}catch(a){}},[o,s]),L=a.useCallback(async e=>{if(y(t=>t.filter(t=>t.id!==e)),s?.id)try{await X.deleteSession(e,s.id)}catch(t){}},[s]),O=a.useCallback(async e=>{if(p(t=>t.filter(t=>t.id!==e)),s?.id)try{await X.deleteRecording(e,s.id)}catch(t){}},[s]),F=a.useCallback(()=>_.current,[]),q={isRecordingPerformance:r,currentPerformance:c,performances:o,startPerformanceRecording:N,stopPerformanceRecording:C,addRecordingEvent:I,getRecordingDestination:F,isRecordingAudio:l,currentAudioRecording:h,audioRecordings:f,startAudioRecording:E,stopAudioRecording:R,savedSessions:x,saveCurrentState:P,clearAll:T,exportPerformance:A,exportSession:U,exportAudioRecording:D,deletePerformance:M,deleteSession:L,deleteAudioRecording:O};return e.jsx(Z.Provider,{value:q,children:t})},ee=()=>{const e=a.useContext(Z);if(!e)throw new Error("useRecording must be used within a RecordingProvider");return e};class te{static async getLibraryTracks(e){try{let t=b.from("library_tracks").select("*").eq("is_active",!0);if("free"===e){t=t.eq("is_pro_only",!1);const{data:e,error:a}=await b.rpc("get_free_user_tracks");if(a)throw a;return this.transformDatabaseTracks(e||[])}if("pro"===e){const{data:e,error:t}=await b.rpc("get_pro_user_tracks");if(t)throw t;return this.transformDatabaseTracks(e||[])}const{data:a,error:s}=await b.rpc("get_free_user_tracks");if(s)throw s;return this.transformDatabaseTracks(a||[])}catch(t){return[]}}static async getTracksByGenre(e,t){return(await this.getLibraryTracks(t)).filter(t=>t.genre===e)}static async getAvailableGenres(e){const t=await this.getLibraryTracks(e);return[...new Set(t.map(e=>e.genre))]}static async getTrackById(e,t){return(await this.getLibraryTracks(t)).find(t=>t.id===e)||null}static async getCurrentRotationInfo(){try{const{data:e,error:t}=await b.rpc("get_rotation_info");if(t)throw t;if(e&&e.length>0){const t=e[0];return{weekNumber:t.current_week,trackCount:t.current_track_count,nextRotationDate:t.next_rotation_date,daysUntilRotation:t.days_until_rotation}}return{weekNumber:1,trackCount:0,nextRotationDate:"",daysUntilRotation:0}}catch(e){return{weekNumber:1,trackCount:0,nextRotationDate:"",daysUntilRotation:0}}}static transformDatabaseTracks(e){return e.map(e=>({id:e.track_id,name:e.name,artist:e.artist||void 0,genre:e.genre,bpm:e.bpm||0,key:e.key||void 0,duration:e.duration||0,file:this.getLibraryTrackUrl(e.track_id,e.type),type:e.type,size:e.size||"Unknown",tags:e.tags,isProOnly:e.is_pro_only,previewUrl:e.preview_url||void 0}))}static getLibraryTrackUrl(e,t){const{data:a}=b.storage.from("library-tracks").getPublicUrl(`${e}.${t}`);return a.publicUrl}static async fetchAudioFile(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch audio file: ${t.statusText}`);const a=await t.blob(),s=e.split("/").pop()||"audio.wav";return new File([a],s,{type:a.type})}catch(t){throw t}}static async getTrackCount(e){return(await this.getLibraryTracks(e)).length}}const ae=a.createContext(null),se=({children:t})=>{const{user:s}=J(),[r,n]=a.useState(null),[c,i]=a.useState(!1),[o,d]=a.useState([]),u=!s,l=!!s,m=a.useCallback((e,t)=>{},[u]),h=a.useCallback(async()=>{i(!0);try{let e=o;if(!e||0===e.length){e=(await te.getLibraryTracks("guest")).map(e=>({id:e.id,name:e.name,genre:e.genre,bpm:e.bpm||0,file:e.file,type:e.type,size:e.size||"Unknown"})),d(e)}const t=(e=>{if(!e||0===e.length)return null;const t=localStorage.getItem("lastDemoTrack"),a=e.length>1?e.filter(e=>e.id!==t):e,s=a[Math.floor(Math.random()*a.length)];return localStorage.setItem("lastDemoTrack",s.id),s})(e);t&&(n(t),m("track_loaded",{trackId:t.id,genre:t.genre,bpm:t.bpm}))}catch(e){}finally{i(!1)}},[o,m]);a.useEffect(()=>{(async()=>{if(u)try{if(!o||0===o.length){const e=(await te.getLibraryTracks("guest")).map(e=>({id:e.id,name:e.name,genre:e.genre,bpm:e.bpm||0,file:e.file,type:e.type,size:e.size||"Unknown"}));d(e)}r||await h()}catch(e){}})()},[u,r,o.length,h]);const g={isDemoMode:u,isAuthenticated:l,currentDemoTrack:r,isLoading:c,loadRandomDemoTrack:h,trackDemoEvent:m,demoTracks:o};return e.jsx(ae.Provider,{value:g,children:t})},re=()=>{const e=a.useContext(ae);if(!e)throw new Error("useDemo must be used within DemoProvider");return e},ne=({isOpen:t,onClose:s,children:r,className:n=""})=>(a.useEffect(()=>{const e=e=>{"Escape"===e.key&&s()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,s]),t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:s,"data-testid":"modal-backdrop"}),e.jsx("div",{className:`relative bg-audafact-surface-1 border border-audafact-divider rounded-card shadow-card max-w-md w-11/12 max-h-[90vh] overflow-y-auto ${n}`,onClick:e=>e.stopPropagation(),children:r})]}):null),ce={canUpload:!1,canSaveSession:!1,canRecord:!1,canDownload:!1,canEditCues:!1,canEditLoops:!1,canBrowseLibrary:!0,canAccessProTracks:!1},ie={canUpload:!0,canSaveSession:!0,canRecord:!0,canDownload:!1,canEditCues:!0,canEditLoops:!0,canBrowseLibrary:!0,canAccessProTracks:!1},oe={canUpload:!0,canSaveSession:!0,canRecord:!0,canDownload:!0,canEditCues:!0,canEditLoops:!0,canBrowseLibrary:!0,canAccessProTracks:!0},de={maxUploads:0,maxSessions:0,maxRecordings:0,maxLibraryTracks:10},ue={maxUploads:3,maxSessions:2,maxRecordings:1,maxLibraryTracks:10},le={maxUploads:1/0,maxSessions:1/0,maxRecordings:1/0,maxLibraryTracks:1/0},me=()=>{const{user:e}=J(),[t,s]=a.useState(null),[r,n]=a.useState(!0),[c,i]=a.useState(null);a.useEffect(()=>{(async()=>{if(!e)return s(null),void n(!1);try{n(!0),i(null);const{data:t,error:a}=await b.from("users").select("access_tier").eq("id",e.id).single();a?(i(a.message),s("free")):s(t?.access_tier||"free")}catch(t){i("Failed to fetch user tier"),s("free")}finally{n(!1)}})()},[e]);const o=e?"pro"===t?{id:"pro",name:"Pro Creator",features:oe,limits:le}:{id:"free",name:"Free User",features:ie,limits:ue}:{id:"guest",name:"Guest",features:ce,limits:de};return{tier:o,isGuest:"guest"===o.id,isFree:"free"===o.id,isPro:"pro"===o.id,features:o.features,limits:o.limits,loading:r,error:c}},he=()=>{const[e,t]=a.useState([]),s=a.useCallback((e,a,s=5e3)=>{const n=Date.now().toString(),c={id:n,type:e,message:a,duration:s};t(e=>[...e,c]),s>0&&setTimeout(()=>{r(n)},s)},[]),r=a.useCallback(e=>{t(t=>t.filter(t=>t.id!==e))},[]);return{messages:e,showSuccessMessage:a.useCallback(e=>{s("success",e)},[s]),showErrorMessage:a.useCallback(e=>{s("error",e)},[s]),showInfoMessage:a.useCallback(e=>{s("info",e)},[s]),removeMessage:r}},ge=()=>{const{user:e}=J(),{tier:t}=me(),{showSuccessMessage:s,showErrorMessage:r}=he(),[n,c]=a.useState(!1);a.useEffect(()=>{z.setMessageFunctions(s,r)},[s,r]);const i=a.useCallback(e=>{const t=I.getInstance(),a={...e,id:`intent_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),expiresAt:Date.now()+864e5};return t.cacheIntent(a),a.id},[]),o=a.useCallback(async()=>{if(e&&!n){c(!0);try{await L.getInstance().executePendingActions(t.id)}catch(a){}finally{c(!1)}}},[e,t.id,n]),d=a.useCallback(async t=>{if(e){c(!0);try{const a=new z;await a.handleSignupSuccess(e,t)}catch(a){}finally{c(!1)}}},[e]),u=a.useCallback(async t=>{if(e){c(!0);try{const a=new z;await a.handleTierUpgrade(e,t)}catch(a){}finally{c(!1)}}},[e]),l=a.useCallback(e=>{O.getInstance().saveDemoState(e)},[]),m=a.useCallback(()=>O.getInstance().restoreDemoState(),[]),h=a.useCallback(()=>{I.getInstance().clearIntentCache()},[]),g=a.useCallback(()=>I.getInstance().getIntentCache(),[]);return a.useEffect(()=>{e&&"guest"!==t.id&&!n&&o()},[e,t.id]),{cacheIntent:i,executePendingActions:o,handleSignupSuccess:d,handleTierUpgrade:u,saveDemoState:l,restoreDemoState:m,clearIntentCache:h,getIntentCache:g,isProcessing:n}},fe=({onSuccess:t,onClick:s,isLoading:r,className:n=""})=>{const{signInWithGoogle:c}=J(),[i,o]=a.useState(!1),d=void 0!==r?r:i;return e.jsx("button",{onClick:async()=>{s&&s();try{o(!0);(await c()).success}catch(e){o(!1)}},disabled:d,className:`w-full flex items-center justify-center gap-3 px-4 py-2 bg-audafact-surface-2 border border-audafact-divider rounded-lg text-audafact-text-primary hover:bg-audafact-surface-1-enhanced transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed ${n}`,children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-audafact-accent-cyan"}),e.jsx("span",{className:"font-medium",children:"Connecting..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{className:"font-medium",children:"Continue with Google"})]})})},pe=({isOpen:t,onClose:s,trigger:r})=>{const{signIn:n}=J(),{cacheIntent:c}=ge(),[i,o]=a.useState(""),[d,u]=a.useState(""),[l,m]=a.useState(!1),[h,g]=a.useState(null);a.useEffect(()=>{t&&_("signup_modal_shown",{trigger:r,userTier:"guest"})},[t,r]);return e.jsx(ne,{isOpen:t,onClose:()=>{_("signup_modal_dismissed",{trigger:r,userTier:"guest"}),s()},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold audafact-heading mb-2",children:["Unlock ",(()=>{switch(r){case"add_library_track":return"Add tracks to your studio";case"save_session":return"Save your session";case"upload":return"Upload your own tracks";case"record":return"Record your performance";case"download":return"Download your tracks";case"custom_cue_points":return"Set custom cue points";default:return"Access premium features"}})()]}),e.jsx("p",{className:"audafact-text-secondary",children:"Sign up to access all features and start creating amazing music"})]}),h&&e.jsx("div",{className:"bg-audafact-alert-red text-audafact-text-primary p-3 rounded-lg mb-4",children:h}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(fe,{onClick:()=>{r&&c({type:r,context:{},priority:"high",expiresAt:Date.now()+864e5}),_("signup_completed",{method:"google",trigger:r,upgradeRequired:!1})}}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-audafact-divider"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-audafact-surface-1 audafact-text-secondary",children:"Or continue with email"})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),m(!0),g(null);try{r&&c({type:r,context:{},priority:"high",expiresAt:Date.now()+864e5}),await n(i,d),_("signup_completed",{method:"email",trigger:r,upgradeRequired:!1}),s()}catch(t){g("Failed to sign in with email"),_("signup_error",{trigger:r,error:"email_signin_failed"})}finally{m(!1)}},className:"space-y-4",children:[e.jsx("input",{type:"email",placeholder:"Email address",value:i,onChange:e=>o(e.target.value),className:"w-full bg-audafact-surface-2 border border-audafact-divider text-audafact-text-primary px-4 py-3 rounded-lg focus:outline-none focus:border-audafact-accent-cyan placeholder-audafact-text-secondary",required:!0}),e.jsx("input",{type:"password",placeholder:"Password",value:d,onChange:e=>u(e.target.value),className:"w-full bg-audafact-surface-2 border border-audafact-divider text-audafact-text-primary px-4 py-3 rounded-lg focus:outline-none focus:border-audafact-accent-cyan placeholder-audafact-text-secondary",required:!0}),e.jsx("button",{type:"submit",disabled:l,className:"w-full audafact-button-primary py-3 px-4 disabled:opacity-50",children:l?"Signing in...":"Sign up with Email"})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-sm audafact-text-secondary",children:"By signing up, you agree to our Terms of Service and Privacy Policy"})})]})})},xe=()=>{const[e,t]=a.useState({isOpen:!1,trigger:"",action:void 0});return{modalState:e,showSignupModal:(e,a)=>{t({isOpen:!0,trigger:e,action:a}),_("signup_modal_shown",{trigger:e,userTier:"guest"})},closeSignupModal:()=>{t(e=>({...e,isOpen:!1})),_("signup_modal_dismissed",{trigger:e.trigger,userTier:"guest"})}}},ye=(e,t)=>{window.dispatchEvent(new CustomEvent("showSignupModal",{detail:{trigger:e,action:t}}))},we=({messages:t,onRemove:a})=>{const s=e=>{switch(e){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}},r=e=>{switch(e){case"success":return"✅";case"error":return"❌";case"info":return"ℹ️";default:return"💬"}};return e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:t.map(t=>e.jsxs("div",{className:`flex items-center p-4 rounded-lg border shadow-lg max-w-sm transition-all duration-300 ${s(t.type)}`,children:[e.jsx("span",{className:"mr-3 text-lg",children:r(t.type)}),e.jsx("span",{className:"flex-1 text-sm font-medium",children:t.message}),e.jsx("button",{onClick:()=>a(t.id),className:"ml-3 text-gray-400 hover:text-gray-600 transition-colors",children:"✕"})]},t.id))})},be=()=>{const{modalState:t,showSignupModal:s,closeSignupModal:r}=xe(),{messages:n,showSuccessMessage:c,removeMessage:i}=he();return ge(),a.useEffect(()=>{const e=e=>{const{trigger:t,action:a}=e.detail;s(t,a)},t=e=>{const{action:t}=e.detail;switch(t){case"upload":c("🎉 Welcome! You can now upload your own tracks.");break;case"save_session":c("💾 Session saved! You can now save unlimited sessions.");break;case"add_library_track":c("🎵 Browse our full library and add tracks to your studio!");break;case"edit_cues":c("🎯 You can now customize cue points!");break;case"edit_loops":c("🔄 You can now set custom loops!");break;case"record":c("🎙️ You can now record your performances! (1 free recording available)");break;case"download":c("💿 Upgrade to Pro Creator to download your work!");break;default:c("🎉 Welcome to Audafact! Start creating your mixes.")}};return window.addEventListener("showSignupModal",e),window.addEventListener("postSignupAction",t),()=>{window.removeEventListener("showSignupModal",e),window.removeEventListener("postSignupAction",t)}},[s,c]),e.jsxs(e.Fragment,{children:[e.jsx(pe,{isOpen:t.isOpen,onClose:r,trigger:t.trigger}),e.jsx(we,{messages:n,onRemove:i})]})},ve=({message:t,onClose:s})=>{const[r,n]=a.useState(!0);return a.useEffect(()=>{const e=setTimeout(()=>{n(!1),setTimeout(s,300)},t.duration);return()=>clearTimeout(e)},[t.duration,s]),e.jsxs("div",{className:"success-message "+(r?"visible":"hidden"),children:[e.jsxs("div",{className:"success-content",children:[e.jsx("div",{className:"success-icon",children:t.icon}),e.jsxs("div",{className:"success-text",children:[e.jsx("h4",{children:t.title}),e.jsx("p",{children:t.message})]}),e.jsx("button",{className:"close-button",onClick:s,children:"✕"})]}),t.actions&&e.jsx("div",{className:"success-actions",children:t.actions.map((t,a)=>e.jsx("button",{className:`action-button ${t.variant}`,onClick:t.action,children:t.label},a))})]})},Se=()=>{const{messages:t}=he(),[s,r]=a.useState([]);a.useEffect(()=>{const e=t.filter(e=>"success"===e.type).map(e=>({id:e.id,message:{id:e.id,title:"Success",message:e.message,icon:"✅",duration:e.duration||5e3}}));r(e)},[t]);return e.jsx(e.Fragment,{children:s.map(({id:t,message:a})=>e.jsx(ve,{message:a,onClose:()=>(e=>{r(t=>t.filter(t=>t.id!==e))})(t)},t))})};class je{static instance;errors=[];analytics;maxErrors=50;constructor(){this.setupGlobalHandlers()}static getInstance(){return je.instance||(je.instance=new je),je.instance}setupGlobalHandlers(){window.addEventListener("error",e=>{this.captureError(e.error,"global",{filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.captureError(new Error(e.reason),"unhandled_promise",{promise:e.promise})}),"undefined"!=typeof window&&(window.__REACT_ERROR_BOUNDARY__=(e,t)=>{this.captureError(e,"react_boundary",{componentStack:t.componentStack})})}captureError(e,t,a={}){const s={id:this.generateErrorId(),message:e.message,stack:e.stack||"",type:"error",timestamp:Date.now(),context:this.buildErrorContext(t,a),severity:this.determineSeverity(e,t),fingerprint:this.generateFingerprint(e,t)};this.storeError(s),this.analytics&&this.analytics.track("error_captured",s)}captureCustomError(e,t,a="medium",s={}){const r={id:this.generateErrorId(),message:e,stack:(new Error).stack||"",type:"custom",timestamp:Date.now(),context:this.buildErrorContext(t,s),severity:a,fingerprint:this.generateFingerprint(new Error(e),t)};this.storeError(r),this.analytics&&this.analytics.track("custom_error",r)}buildErrorContext(e,t){return{userId:this.getCurrentUserId(),userTier:this.getCurrentUserTier(),sessionId:this.getSessionId(),currentRoute:window.location.pathname,componentStack:t.componentStack||"",featureGates:this.getActiveFeatureGates(),userAgent:navigator.userAgent,screenSize:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,memoryUsage:performance.memory?.usedJSHeapSize,networkStatus:navigator.onLine?"online":"offline",customContext:t}}determineSeverity(e,t){return e.message.includes("Failed to fetch")||e.message.includes("NetworkError")||e.message.includes("QuotaExceededError")?"critical":e.message.includes("AudioContext")||e.message.includes("WebAudio")||"react_boundary"===t?"high":e.message.includes("localStorage")||e.message.includes("IndexedDB")?"medium":"low"}generateFingerprint(e,t){const a=`${e.message}:${t}:${this.getCurrentUserTier()}`;return this.hashString(a)}hashString(e){let t=0;for(let a=0;a<e.length;a++){t=(t<<5)-t+e.charCodeAt(a),t&=t}return Math.abs(t).toString(36)}generateErrorId(){return`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}storeError(e){this.errors.push(e),this.errors.length>this.maxErrors&&(this.errors=this.errors.slice(-this.maxErrors));try{localStorage.setItem("error_log",JSON.stringify(this.errors))}catch(t){}}getCurrentUserId(){return localStorage.getItem("user_id")||void 0}getCurrentUserTier(){return localStorage.getItem("user_tier")||"guest"}getSessionId(){return localStorage.getItem("session_id")||`session_${Date.now()}`}getActiveFeatureGates(){try{return JSON.parse(localStorage.getItem("active_feature_gates")||"[]")}catch(e){return[]}}getErrors(){return[...this.errors]}clearErrors(){this.errors=[];try{localStorage.removeItem("error_log")}catch(e){}}getErrorRate(){const e=Date.now();return this.errors.filter(t=>e-t.timestamp<36e5).length}setAnalyticsService(e){this.analytics=e}}class ke extends s.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){je.getInstance().captureError(e,"react_boundary",{componentStack:t.componentStack})}resetError=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})};render(){if(this.state.hasError){if(this.props.fallback){const t=this.props.fallback;return e.jsx(t,{error:this.state.error,resetError:this.resetError})}return e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"We've been notified and are working to fix this issue."}),e.jsx("button",{onClick:this.resetError,className:"error-boundary-button",children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"error-boundary-button secondary",children:"Reload Page"})]})})}return this.props.children}}const _e=({isOpen:t,onClose:s})=>{const[r,n]=a.useState([]),[c,i]=a.useState([]),[o,d]=a.useState(0),[u,l]=a.useState(!0),[y,w]=a.useState(null),[b,v]=a.useState(!1),S=async()=>{v(!0);try{const{EnhancedAnalyticsService:e}=await m(()=>import("./enhancedAnalyticsService-ad800dc7.js"),["assets/js/enhancedAnalyticsService-ad800dc7.js","assets/js/audio-0ea8d21d.js","assets/js/vendor-b17dff21.js","assets/js/auth-86c3050d.js","assets/js/ui-e2671ff1.js"]),t=e.getInstance(),a=t.getHealthStatus();n(a.performanceMetrics),i(t.getErrors()),d(a.pendingEvents),l(a.isOnline),w(a.lastError)}catch(e){}finally{v(!1)}};return a.useEffect(()=>{t&&S()},[t]),t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-audafact-surface-1 rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-audafact-divider",children:[e.jsx("h2",{className:"text-xl font-semibold audafact-heading",children:"Performance Dashboard"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:S,disabled:b,className:"p-2 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:e.jsx(h,{className:"w-5 h-5 "+(b?"animate-spin":"")})}),e.jsx("button",{onClick:s,className:"p-2 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded-lg transition-colors duration-200",children:e.jsx(g,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 audafact-card-enhanced",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(f,{className:"w-5 h-5 text-audafact-accent-cyan"}),e.jsx("span",{className:"font-medium",children:"Metrics"})]}),e.jsx("p",{className:"text-2xl font-bold",children:r.length})]}),e.jsxs("div",{className:"p-4 audafact-card-enhanced",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(p,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"font-medium",children:"Errors"})]}),e.jsx("p",{className:"text-2xl font-bold",children:c.length})]}),e.jsxs("div",{className:"p-4 audafact-card-enhanced",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(h,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"font-medium",children:"Pending"})]}),e.jsx("p",{className:"text-2xl font-bold",children:o})]}),e.jsxs("div",{className:"p-4 audafact-card-enhanced",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u?e.jsx(x,{className:"w-5 h-5 text-green-500"}):e.jsx(p,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"font-medium",children:"Network"})]}),e.jsx("p",{className:"text-2xl font-bold",children:u?"Online":"Offline"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold audafact-heading mb-4",children:"Performance Metrics"}),e.jsx("div",{className:"space-y-2",children:r.slice(0,10).map((t,a)=>e.jsxs("div",{className:"p-3 audafact-card-enhanced",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:t.metric}),e.jsx("span",{className:"text-audafact-accent-cyan",children:t.value})]}),e.jsx("div",{className:"text-sm text-audafact-text-secondary mt-1",children:new Date(t.timestamp).toLocaleTimeString()})]},a))})]}),c.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold audafact-heading mb-4",children:"Recent Errors"}),e.jsx("div",{className:"space-y-2",children:c.slice(0,5).map((t,a)=>e.jsxs("div",{className:"p-3 audafact-card-enhanced border-l-4 border-red-500",children:[e.jsx("div",{className:"font-medium text-red-500",children:t.message}),e.jsx("div",{className:"text-sm text-audafact-text-secondary mt-1",children:t.context}),e.jsx("div",{className:"text-xs text-audafact-text-secondary mt-1",children:new Date(t.timestamp).toLocaleTimeString()})]},a))})]})]})]})}):null},Ne=()=>{const{user:t,loading:s,signOut:c}=J(),{isOpen:i,toggleSidePanel:o}=Y(),d=r(),u="/studio"===d.pathname,[l,m]=a.useState(!1),[h,g]=a.useState(!1);return e.jsxs("nav",{className:"sticky top-0 bg-audafact-surface-1 border-b border-audafact-divider shadow-card z-50",children:[e.jsx("div",{className:"w-full px-4 md:px-8",children:e.jsxs("div",{className:"flex items-center h-14 md:h-16 relative",children:[e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[u&&e.jsx("button",{onClick:o,className:"p-2 text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 rounded-lg transition-colors duration-200","aria-label":i?"Close sidebar":"Open sidebar","data-testid":"side-panel-toggle",children:i?e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}):e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs(n,{to:"/",className:"flex items-center gap-2",children:[e.jsx("img",{src:"/favicon.svg",alt:"Audafact Logo",className:"w-7 h-7 md:w-8 md:h-8"}),e.jsx("span",{className:"text-lg md:text-xl font-poppins font-bold",children:"Audafact"})]})]}),e.jsxs("div",{className:"hidden lg:flex space-x-8 absolute left-1/2 transform -translate-x-1/2",children:[!t&&e.jsx(n,{to:"/",className:"font-medium transition-colors duration-200 "+("/"===d.pathname?"text-audafact-accent-cyan":"text-audafact-text-secondary hover:text-audafact-text-primary"),children:"Home"}),e.jsx(n,{to:"/studio",className:"font-medium transition-colors duration-200 "+("/studio"===d.pathname?"text-audafact-accent-cyan":"text-audafact-text-secondary hover:text-audafact-text-primary"),children:"Studio"}),e.jsx(n,{to:"/pricing",className:"font-medium transition-colors duration-200 "+("/pricing"===d.pathname?"text-audafact-accent-cyan":"text-audafact-text-secondary hover:text-audafact-text-primary"),children:"Pricing"})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4 ml-auto",children:[!1,!s&&(t?e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4",children:[e.jsx(n,{to:"/profile",className:"hidden sm:inline text-audafact-text-secondary hover:text-audafact-text-primary transition-colors duration-200 text-sm",children:"Profile"}),e.jsx("span",{className:"hidden md:inline text-audafact-text-secondary text-sm",children:t.email}),e.jsx("button",{onClick:c,className:"text-audafact-text-secondary hover:text-audafact-text-primary transition-colors duration-200",children:"Sign Out"})]}):e.jsx(n,{to:"/auth",className:"audafact-button-primary px-3 py-1.5 md:px-4 md:py-2",children:"Sign In"})),e.jsx("button",{onClick:()=>g(e=>!e),className:"p-2 rounded-lg lg:hidden text-audafact-text-secondary hover:text-audafact-accent-cyan hover:bg-audafact-surface-2 transition-colors duration-200","aria-label":"Toggle navigation menu","aria-expanded":h,"aria-controls":"mobile-nav",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]})}),e.jsx("div",{id:"mobile-nav",className:(h?"block":"hidden")+" lg:hidden border-t border-audafact-divider bg-audafact-surface-1",children:e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[!t&&e.jsx(n,{to:"/",onClick:()=>g(!1),className:"block px-2 py-2 rounded-lg transition-colors duration-200 "+("/"===d.pathname?"text-audafact-accent-cyan bg-audafact-surface-2":"text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-2"),children:"Home"}),e.jsx(n,{to:"/studio",onClick:()=>g(!1),className:"block px-2 py-2 rounded-lg transition-colors duration-200 "+("/studio"===d.pathname?"text-audafact-accent-cyan bg-audafact-surface-2":"text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-2"),children:"Studio"}),e.jsx(n,{to:"/pricing",onClick:()=>g(!1),className:"block px-2 py-2 rounded-lg transition-colors duration-200 "+("/pricing"===d.pathname?"text-audafact-accent-cyan bg-audafact-surface-2":"text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-2"),children:"Pricing"}),!s&&(t?e.jsxs("div",{className:"pt-2 mt-2 border-t border-audafact-divider",children:[e.jsx(n,{to:"/profile",onClick:()=>g(!1),className:"block px-2 py-2 rounded-lg text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-2 transition-colors duration-200",children:"Profile"}),e.jsx("button",{onClick:()=>{g(!1),c()},className:"w-full text-left px-2 py-2 rounded-lg text-audafact-text-secondary hover:text-audafact-text-primary hover:bg-audafact-surface-2 transition-colors duration-200",children:"Sign Out"})]}):e.jsx("div",{className:"pt-2 mt-2 border-t border-audafact-divider",children:e.jsx(n,{to:"/auth",onClick:()=>g(!1),className:"block px-2 py-2 rounded-lg bg-audafact-accent-blue text-audafact-text-primary text-center font-medium hover:bg-opacity-90 transition-colors duration-200",children:"Sign In"})}))]})}),e.jsx(_e,{isOpen:l,onClose:()=>m(!1)})]})},Ce=()=>e.jsxs("div",{className:"min-h-screen bg-audafact-surface-1",children:[e.jsx(Ne,{}),e.jsx("main",{className:"container mx-auto px-4 py-0",children:e.jsx(c,{})})]}),Ie=({mode:t,onSuccess:s})=>{const[r,n]=a.useState(""),[c,i]=a.useState(""),[o,d]=a.useState(""),[u,l]=a.useState(!1),[m,h]=a.useState(""),[g,f]=a.useState(""),{signIn:p,signUp:x}=J();return e.jsxs("div",{className:"max-w-md mx-auto p-6 audafact-card-enhanced",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center audafact-heading",children:"signin"===t?"Sign In":"Sign Up"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),l(!0),h(""),f(""),!r||!c)return h("Please fill in all fields"),void l(!1);if("signup"===t&&c!==o)return h("Passwords do not match"),void l(!1);if("signup"===t&&c.length<6)return h("Password must be at least 6 characters long"),void l(!1);try{const e="signin"===t?await p(r,c):await x(r,c);e.success?(f("signin"===t?"Signed in successfully!":"Account created! Please check your email to verify your account."),s&&s()):h(e.error||"An error occurred")}catch(a){h("An unexpected error occurred")}finally{l(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium audafact-text-secondary mb-1",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:r,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 bg-audafact-surface-2 border border-audafact-divider rounded-lg focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-audafact-accent-cyan text-audafact-text-primary placeholder-audafact-text-secondary",placeholder:"Enter your email",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium audafact-text-secondary mb-1",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:c,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 bg-audafact-surface-2 border border-audafact-divider rounded-lg focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-audafact-accent-cyan text-audafact-text-primary placeholder-audafact-text-secondary",placeholder:"Enter your password",required:!0})]}),"signup"===t&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium audafact-text-secondary mb-1",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPassword",value:o,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 bg-audafact-surface-2 border border-audafact-divider rounded-lg focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-audafact-accent-cyan text-audafact-text-primary placeholder-audafact-text-secondary",placeholder:"Confirm your password",required:!0})]}),m&&e.jsx("div",{className:"text-audafact-alert-red text-sm bg-audafact-surface-2 border border-audafact-alert-red p-3 rounded-lg",children:m}),g&&e.jsx("div",{className:"text-audafact-accent-green text-sm bg-audafact-surface-2 border border-audafact-accent-green p-3 rounded-lg",children:g}),e.jsx("button",{type:"submit",disabled:u,className:"w-full audafact-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Loading...":"signin"===t?"Sign In":"Sign Up"})]}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-audafact-divider"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-audafact-surface-1-enhanced text-audafact-text-secondary",children:"or"})})]}),e.jsx(fe,{onSuccess:s})]})},Ee=()=>{const[t,s]=a.useState(""),[r,n]=a.useState(!1),[c,i]=a.useState(""),[o,d]=a.useState(""),{resetPassword:u}=J();return e.jsxs("div",{className:"max-w-md mx-auto p-6 audafact-card-enhanced",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center audafact-heading",children:"Reset Password"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),n(!0),i(""),d(""),!t)return i("Please enter your email address"),void n(!1);try{const e=await u(t);e.success?(d("Password reset email sent! Please check your inbox."),s("")):i(e.error||"An error occurred")}catch(a){i("An unexpected error occurred")}finally{n(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium audafact-text-secondary mb-1",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:t,onChange:e=>s(e.target.value),className:"w-full px-3 py-2 bg-audafact-surface-2 border border-audafact-divider rounded-lg focus:outline-none focus:ring-2 focus:ring-audafact-accent-cyan focus:border-audafact-accent-cyan text-audafact-text-primary placeholder-audafact-text-secondary",placeholder:"Enter your email",required:!0})]}),c&&e.jsx("div",{className:"text-audafact-alert-red text-sm bg-audafact-surface-2 border border-audafact-alert-red p-3 rounded-lg",children:c}),o&&e.jsx("div",{className:"text-audafact-accent-green text-sm bg-audafact-surface-2 border border-audafact-accent-green p-3 rounded-lg",children:o}),e.jsx("button",{type:"submit",disabled:r,className:"w-full audafact-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:r?"Sending...":"Send Reset Email"})]})]})},Re=()=>{const[t,s]=a.useState("signin");return e.jsx("div",{className:"min-h-screen bg-audafact-surface-1 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/favicon.svg",alt:"Audafact Logo",className:"w-12 h-12"})}),e.jsx("h1",{className:"text-center text-3xl font-extrabold audafact-heading",children:"Welcome to Audafact"}),e.jsx("p",{className:"mt-2 text-center text-sm audafact-text-secondary",children:"Your music production companion"})]}),e.jsxs("div",{className:"flex rounded-lg shadow-sm",children:[e.jsx("button",{onClick:()=>s("signin"),className:"flex-1 py-2 px-4 text-sm font-medium rounded-l-lg border "+("signin"===t?"bg-audafact-accent-blue text-audafact-text-primary border-audafact-accent-blue":"bg-audafact-surface-2 text-audafact-text-secondary border-audafact-divider hover:bg-audafact-surface-1-enhanced hover:text-audafact-text-primary"),children:"Sign In"}),e.jsx("button",{onClick:()=>s("signup"),className:"flex-1 py-2 px-4 text-sm font-medium border-t border-b border-audafact-divider "+("signup"===t?"bg-audafact-accent-blue text-audafact-text-primary border-audafact-accent-blue":"bg-audafact-surface-2 text-audafact-text-secondary border-audafact-divider hover:bg-audafact-surface-1-enhanced hover:text-audafact-text-primary"),children:"Sign Up"}),e.jsx("button",{onClick:()=>s("reset"),className:"flex-1 py-2 px-4 text-sm font-medium rounded-r-lg border "+("reset"===t?"bg-audafact-accent-blue text-audafact-text-primary border-audafact-accent-blue":"bg-audafact-surface-2 text-audafact-text-secondary border-audafact-divider hover:bg-audafact-surface-1-enhanced hover:text-audafact-text-primary"),children:"Reset"})]}),e.jsx("div",{className:"mt-8",children:"reset"===t?e.jsx(Ee,{}):e.jsx(Ie,{mode:t,onSuccess:()=>{window.location.href="/"}})}),e.jsxs("div",{className:"text-center",children:["signin"===t&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"audafact-text-secondary",children:"Don't have an account? "}),e.jsx("button",{onClick:()=>s("signup"),className:"text-audafact-accent-cyan hover:text-audafact-accent-blue font-medium transition-colors duration-200",children:"Sign up"})]}),"signup"===t&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"audafact-text-secondary",children:"Already have an account? "}),e.jsx("button",{onClick:()=>s("signin"),className:"text-audafact-accent-cyan hover:text-audafact-accent-blue font-medium transition-colors duration-200",children:"Sign in"})]}),("signin"===t||"signup"===t)&&e.jsx("div",{className:"mt-2 text-sm",children:e.jsx("button",{onClick:()=>s("reset"),className:"text-audafact-accent-cyan hover:text-audafact-accent-blue font-medium transition-colors duration-200",children:"Forgot your password?"})})]})]})})},Pe=()=>{const[t,s]=a.useState(!0),[r,n]=a.useState(null),c=i(),[d]=o();return a.useEffect(()=>{(async()=>{try{if(window.location.hash&&window.location.hash.includes("access_token")){const e=new URLSearchParams(window.location.hash.substring(1)),t=e.get("access_token"),a=e.get("refresh_token");if(t){const{data:e,error:r}=await b.auth.setSession({access_token:t,refresh_token:a||""});if(r)return n(r.message),void s(!1);if(e.session?.user)return void c("/studio",{replace:!0})}}await new Promise(e=>setTimeout(e,2e3));const{data:{session:e},error:t}=await b.auth.getSession();if(t)return n(t.message),void s(!1);if(e?.user)c("/studio",{replace:!0});else{const e=d.get("error"),t=d.get("error_description");if(e)return n(`Authentication failed: ${t||e}`),void s(!1);c("/auth",{replace:!0})}}catch(e){n("An unexpected error occurred"),s(!1)}})()},[c,d]),t?e.jsx("div",{className:"min-h-screen bg-audafact-surface-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-audafact-accent-cyan mx-auto mb-4"}),e.jsx("p",{className:"audafact-text-secondary",children:"Completing sign in..."})]})}):r?e.jsx("div",{className:"min-h-screen bg-audafact-surface-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-audafact-alert-red mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-xl font-semibold audafact-heading mb-2",children:"Sign In Failed"}),e.jsx("p",{className:"audafact-text-secondary mb-4",children:r}),e.jsx("button",{onClick:()=>c("/auth"),className:"audafact-button-primary",children:"Try Again"})]})}):null},Te=a.lazy(()=>m(()=>import("./Home-be5d3c51.js"),["assets/js/Home-be5d3c51.js","assets/js/audio-0ea8d21d.js","assets/js/vendor-b17dff21.js","assets/js/auth-86c3050d.js","assets/js/ui-e2671ff1.js"])),Ae=a.lazy(()=>m(()=>import("./Studio-25bff011.js"),["assets/js/Studio-25bff011.js","assets/js/audio-0ea8d21d.js","assets/js/vendor-b17dff21.js","assets/js/ui-e2671ff1.js","assets/js/auth-86c3050d.js"])),Ue=a.lazy(()=>m(()=>import("./Pricing-ea483875.js"),["assets/js/Pricing-ea483875.js","assets/js/audio-0ea8d21d.js","assets/js/vendor-b17dff21.js","assets/js/useUserAccess-a2b05641.js","assets/js/stripeService-1c21ca88.js","assets/js/ui-e2671ff1.js","assets/js/auth-86c3050d.js"]).then(e=>({default:e.Pricing}))),De=a.lazy(()=>m(()=>import("./CheckoutResult-3ace7210.js"),["assets/js/CheckoutResult-3ace7210.js","assets/js/audio-0ea8d21d.js","assets/js/vendor-b17dff21.js","assets/js/useUserAccess-a2b05641.js","assets/js/ui-e2671ff1.js","assets/js/auth-86c3050d.js"]).then(e=>({default:e.CheckoutResult}))),Me=a.lazy(()=>m(()=>import("./Profile-e9bfece0.js"),["assets/js/Profile-e9bfece0.js","assets/js/audio-0ea8d21d.js","assets/js/vendor-b17dff21.js","assets/js/useUserAccess-a2b05641.js","assets/js/stripeService-1c21ca88.js","assets/js/ui-e2671ff1.js","assets/js/auth-86c3050d.js"]).then(e=>({default:e.Profile}))),Le=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-audafact-accent-cyan"})}),Oe=d([{path:"/",element:e.jsx(Ce,{}),children:[{index:!0,element:e.jsx(a.Suspense,{fallback:e.jsx(Le,{}),children:e.jsx(Te,{})})},{path:"studio",element:e.jsx(a.Suspense,{fallback:e.jsx(Le,{}),children:e.jsx(Ae,{})})},{path:"pricing",element:e.jsx(a.Suspense,{fallback:e.jsx(Le,{}),children:e.jsx(Ue,{})})},{path:"checkout-result",element:e.jsx(a.Suspense,{fallback:e.jsx(Le,{}),children:e.jsx(De,{})})},{path:"profile",element:e.jsx(a.Suspense,{fallback:e.jsx(Le,{}),children:e.jsx(Me,{})})}]},{path:"/auth",element:e.jsx(Re,{})},{path:"/auth/callback",element:e.jsx(Pe,{})}]);function Fe(){return s.useEffect(()=>{const e=setTimeout(async()=>{const{EnhancedAnalyticsService:e}=await m(()=>import("./enhancedAnalyticsService-ad800dc7.js"),["assets/js/enhancedAnalyticsService-ad800dc7.js","assets/js/audio-0ea8d21d.js","assets/js/vendor-b17dff21.js","assets/js/auth-86c3050d.js","assets/js/ui-e2671ff1.js"]);e.getInstance()},1e3);return()=>clearTimeout(e)},[]),e.jsx(ke,{children:e.jsx(B,{children:e.jsx(se,{children:e.jsx(W,{children:e.jsx(V,{children:e.jsxs(K,{children:[e.jsx(u,{router:Oe}),e.jsx(be,{}),e.jsx(Se,{})]})})})})})})}y.createRoot(document.getElementById("root")).render(e.jsx(s.StrictMode,{children:e.jsx(Fe,{})}));export{j as A,X as D,je as E,te as L,pe as S,me as a,ye as b,ee as c,H as d,Y as e,re as f,xe as g,b as s,_ as t,J as u};
//# sourceMappingURL=index-a73b4fa8.js.map
